/*! video-player v1.3.4-0-g53f7fe21 - Version Build Date 2017-03-08 1152 Last Build: 201703081158 */(function(){var R="SDK_"+"6.13.3.0-00a922a2-201702072048".replace(/[^\w]/g,"_"),v="undefined"!=typeof window?window:"undefined"!=typeof GLOBAL?GLOBAL:this;v.tv=v.tv||{};v.tv.freewheel=v.tv.freewheel||{};v.tv.freewheel[R]=function(v){var a={version:"js-6.13.3.0-00a922a2-201702072048"};if("undefined"!==typeof window)window._fw_admanager=window._fw_admanager||{},window._fw_admanager.version=a.version;a.LOG_LEVEL_QUIET=0;a.LOG_LEVEL_INFO=1;a.LOG_LEVEL_DEBUG=2;a.setLogLevel=function(b){a.warn=a.log=a.debug=
function(){};if("undefined"!==typeof console){try{window.localStorage&&window.localStorage.getItem("fwLogLevel")&&-1<window.localStorage.getItem("fwLogLevel")&&(b=window.localStorage.getItem("fwLogLevel"))}catch(c){console.warn(">FW Common.setLogLevel"+c.description)}if(b>a.LOG_LEVEL_QUIET&&(a.log=function(){console.log(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))},a.warn=function(){console.warn(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))},
b>a.LOG_LEVEL_INFO))a.debug=function(){console.log(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))}}};a.setLogLevel(a.LOG_LEVEL_INFO);a.log("FreeWheel Integration Runtime",a.version);a.proxyUrl=null;a.proxyAuthenticationParameter=null;a.setProxy=function(b){"string"==typeof b?("/"!=b.charAt(b.length-1)&&(b+="/"),a.proxyUrl=b):a.proxyUrl=null};a.setProxyAuthenticationParameter=function(b,c){a.proxyAuthenticationParameter=2<=arguments.length&&b?{key:b,value:c||
""}:null};(function(){var b=navigator.userAgent.toLowerCase();a.PLATFORM_IS_WINDOWSPHONE=-1<b.search("windows phone os");a.PLATFORM_IS_IPAD=-1<b.search("ipad");a.PLATFORM_IS_IPHONE_IPOD=-1<b.search("iphone")||-1<b.search("ipod");a.PLATFORM_IE_MOBILE_VERSION=function(){var a=b.search(/iemobile\/\d\.\d/);if(-1<a){var d=b.substr(a+9,1),a=b.substr(a+11,1);return 1*d+0.1*a}return 0}();a.PLATFORM_IOS_VERSION=function(){var a=b.match(/os \d+_\d+/);return a&&0<a.length?(a=a[0].match(/\d+/g),1*a[0]+0.1*a[1]):
0}();a.PLATFORM_ANDROID_VERSION=function(){var a=b.search(/android \d\.\d/);if(-1<a){var d=b.substr(a+8,1),a=b.substr(a+10,1);return 1*d+0.1*a}return-1<b.indexOf("transformer")?3.2:0}();a.PLATFORM_IS_SAFARI=0<a.PLATFORM_IOS_VERSION&&-1<b.search("applewebkit")||0===a.PLATFORM_ANDROID_VERSION&&0>b.search("chrome")&&-1<b.search("safari");a.PLATFORM_IS_MOBILE=0<a.PLATFORM_IOS_VERSION||0<a.PLATFORM_ANDROID_VERSION;a.PLATFORM_ID=a.PLATFORM_IS_MOBILE?0<a.PLATFORM_ANDROID_VERSION?"Android"+a.PLATFORM_ANDROID_VERSION:
a.PLATFORM_IS_IPAD?"iPad"+a.PLATFORM_IOS_VERSION:a.PLATFORM_IS_IPHONE_IPOD?"iPhone"+a.PLATFORM_IOS_VERSION:"UnknownMobile":"Desktop";a.log("Device:",a.PLATFORM_ID,"PLATFORM_IS_SAFARI:",a.PLATFORM_IS_SAFARI)})();a.PLATFORM_EVENT_CLICK=a.PLATFORM_IS_MOBILE?"touchend":"click";a.MOBILE_EVENT_DRAG="touchmove";a.PLATFORM_SEND_REQUEST_BY_FORM=!1;a.PLATFORM_HIDE_AND_SHOW_CONTENT_VIDEO_BY_MOVE_POSITION=3.1<=a.PLATFORM_ANDROID_VERSION;a.PLATFORM_HIDE_AND_SHOW_CONTENT_VIDEO_BY_SET_DISPLAY=!0;a.PLATFORM_SUPPORT_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT=
a.PLATFORM_IS_IPAD||a.PLATFORM_IS_IPHONE_IPOD;a.PLATFORM_AUTO_SEEK_AFTER_MIDROLL=a.PLATFORM_IS_IPAD;a.PLATFORM_NOT_SUPPORT_OVERLAY_AD=a.PLATFORM_IS_IPHONE_IPOD||0<a.PLATFORM_ANDROID_VERSION&&3.1>a.PLATFORM_ANDROID_VERSION||a.PLATFORM_IS_WINDOWSPHONE;a.PLATFORM_FILL_VIDEO_POOL_FOR_MIDROLL=4.2<=a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_SUPPORT_MIDROLL_AD=2.2<=a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION||9<=a.PLATFORM_IE_MOBILE_VERSION;a.PLATFORM_NOT_SUPPORT_VIDEO_AD=0<a.PLATFORM_ANDROID_VERSION&&
2.1>=a.PLATFORM_ANDROID_VERSION;a.PLATFORM_DETECT_FULL_SCREEN_FOR_MIDROLL=a.PLATFORM_IS_IPAD&&4.2<=a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO=a.PLATFORM_IS_IPHONE_IPOD&&10>a.PLATFORM_IOS_VERSION||a.PLATFORM_IS_WINDOWSPHONE;a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED=3.1<=a.PLATFORM_ANDROID_VERSION||10<=a.PLATFORM_IOS_VERSION;a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT=0<a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION;a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE=9<=a.PLATFORM_IE_MOBILE_VERSION;
a.PLATFORM_PLAY_DUMMY_VIDEO_FOR_PREROLL=0<a.PLATFORM_IOS_VERSION&&4.2>a.PLATFORM_IOS_VERSION&&4<=a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_WAIT_FOR_ERROR_WHEN_PLAY_DUMMY_VIDEO_FOR_PREROLL=!1;a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT=0===a.PLATFORM_IOS_VERSION||4<=a.PLATFORM_IOS_VERSION&&4.2>a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_SUPPORT_OVERLAY_CLICK_WHEN_CONTROLS_IS_TRUE=a.PLATFORM_IS_IPAD;a.RENDERER_STATE_INIT=1;a.RENDERER_STATE_STARTING=2;a.RENDERER_STATE_STARTED=3;a.RENDERER_STATE_COMPLETING=4;
a.RENDERER_STATE_COMPLETED=5;a.RENDERER_STATE_FAILED=6;a.TRANSLATOR_STATE_INIT=a.RENDERER_STATE_INIT;a.TRANSLATOR_STATE_STARTING=a.RENDERER_STATE_STARTING;a.TRANSLATOR_STATE_STARTED=a.RENDERER_STATE_STARTED;a.TRANSLATOR_STATE_COMPLETING=a.RENDERER_STATE_COMPLETING;a.TRANSLATOR_STATE_COMPLETED=a.RENDERER_STATE_COMPLETED;a.TRANSLATOR_STATE_FAILED=a.RENDERER_STATE_FAILED;a.EVENT_AD="adEvent";a.EVENT_AD_BUFFERING_START="adBufferingStart";a.EVENT_AD_BUFFERING_END="adBufferingEnd";a.EVENT_SLOT_IMPRESSION=
"slotImpression";a.EVENT_SLOT_END="slotEnd";a.EVENT_AD_INITIATED="adInitiated";a.EVENT_AD_IMPRESSION="defaultImpression";a.EVENT_AD_IMPRESSION_END="adEnd";a.EVENT_AD_QUARTILE="quartile";a.EVENT_AD_FIRST_QUARTILE="firstQuartile";a.EVENT_AD_MIDPOINT="midPoint";a.EVENT_AD_THIRD_QUARTILE="thirdQuartile";a.EVENT_AD_SKIPPED="adSkipped";a.EVENT_AD_COMPLETE="complete";a.EVENT_AD_CLICK="defaultClick";a.EVENT_AD_MUTE="_mute";a.EVENT_AD_UNMUTE="_un-mute";a.EVENT_AD_COLLAPSE="_collapse";a.EVENT_AD_EXPAND="_expand";
a.EVENT_AD_PAUSE="_pause";a.EVENT_AD_RESUME="_resume";a.EVENT_AD_REWIND="_rewind";a.EVENT_AD_ACCEPT_INVITATION="_accept-invitation";a.EVENT_AD_CLOSE="_close";a.EVENT_AD_MINIMIZE="_minimize";a.EVENT_ERROR="_e_unknown";a.EVENT_RESELLER_NO_AD="resellerNoAd";a.EVENT_AD_MEASUREMENT="concreteEvent";a.EVENT_EXTENSION_LOADED="extensionLoaded";a.EVENT_AD_VOLUME_CHANGE="adVolumeChange";a.INFO_KEY_CUSTOM_ID="customId";a.INFO_KEY_MODULE_TYPE="moduleType";a.MODULE_TYPE_EXTENSION="extension";a.MODULE_TYPE_RENDERER=
"renderer";a.MODULE_TYPE_TRANSLATOR="translator";a.INFO_KEY_ERROR_CODE="errorCode";a.INFO_KEY_ERROR_INFO="errorInfo";a.INFO_KEY_ERROR_MODULE="errorModule";a.ERROR_IO="_e_io";a.ERROR_TIMEOUT="_e_timeout";a.ERROR_NULL_ASSET="_e_null-asset";a.ERROR_ADINSTANCE_UNAVAILABLE="_e_adinst-unavail";a.ERROR_UNKNOWN="_e_unknown";a.ERROR_MISSING_PARAMETER="_e_missing-param";a.ERROR_NO_AD_AVAILABLE="_e_no-ad";a.ERROR_PARSE="_e_parse";a.ERROR_INVALID_VALUE="_e_invalid-value";a.ERROR_INVALID_SLOT="_e_invalid-slot";
a.ERROR_NO_RENDERER="_e_no-renderer";a.ERROR_DEVICE_LIMIT="_e_device-limit";a.ERROR_3P_COMPONENT="_e_3p-comp";a.ERROR_UNSUPPORTED_3P_FEATURE="_e_unsupp-3p-feature";a.ERROR_SECURITY="_e_security";a.ERROR_UNMATCHED_SLOT_SIZE="_e_slot-size-unmatch";a.INFO_KEY_URL="url";a.INFO_KEY_SHOW_BROWSER="showBrowser";a.INFO_KEY_CUSTOM_EVENT_NAME="customEventName";a.INFO_KEY_NEED_EMPTY_CT="needEmptyCT";a.INFO_KEY_CONCRETE_EVENT_ID="concreteEventId";a.EVENT_TYPE_CLICK_TRACKING="CLICKTRACKING";a.EVENT_TYPE_IMPRESSION=
"IMPRESSION";a.EVENT_TYPE_CLICK="CLICK";a.EVENT_TYPE_STANDARD="STANDARD";a.EVENT_TYPE_GENERIC="GENERIC";a.EVENT_TYPE_ERROR="ERROR";a.EVENT_VIDEO_VIEW="videoView";a.SHORT_EVENT_TYPE_IMPRESSION="i";a.SHORT_EVENT_TYPE_CLICK="c";a.SHORT_EVENT_TYPE_STANDARD="s";a.SHORT_EVENT_TYPE_ERROR="e";a.INIT_VALUE_ZERO="0";a.INIT_VALUE_ONE="1";a.INIT_VALUE_TWO="2";a.INFO_KEY_PARAMETERS="parameters";a.URL_PARAMETER_KEY_ET="et";a.URL_PARAMETER_KEY_CN="cn";a.URL_PARAMETER_KEY_INIT="init";a.URL_PARAMETER_KEY_CT="ct";
a.URL_PARAMETER_KEY_METR="metr";a.URL_PARAMETER_KEY_CR="cr";a.URL_PARAMETER_KEY_KEY_VALUE="kv";a.URL_PARAMETER_KEY_ERROR_INFO="additional";a.URL_PARAMETER_KEY_ERROR_MODULE="renderer";a.URL_PARAMETER_KEY_CREATIVE_RENDITION_ID="reid";a.URL_PARAMETER_KEY_CONCRETE_EVENT_ID="creid";a.CAPABILITY_SLOT_TEMPLATE="sltp";a.CAPABILITY_DISPLAY_REFRESH="rfnt";a.CAPABILITY_MULTIPLE_CREATIVE_RENDITIONS="emcr";a.CAPABILITY_RECORD_VIDEO_VIEW="exvt";a.CAPABILITY_CHECK_COMPANION="cmpn";a.CAPABILITY_CHECK_TARGETING="targ";
a.CAPABILITY_RESET_EXCLUSIVITY="rste";a.CAPABILITY_FALLBACK_UNKNOWN_ASSET="unka";a.CAPABILITY_FALLBACK_UNKNOWN_SITE_SECTION="unks";a.CAPABILITY_FALLBACK_ADS="fbad";a.CAPABILITY_SLOT_CALLBACK="slcb";a.CAPABILITY_NULL_CREATIVE="nucr";a.CAPABILITY_AUTO_EVENT_TRACKING="aeti";a.CAPABILITY_RENDERER_MANIFEST="rema";a.CAPABILITY_REQUIRE_VIDEO_CALLBACK="vicb";a.CAPABILITY_SKIP_AD_SELECTION="skas";a.SLOT_TYPE_TEMPORAL="temporal";a.SLOT_TYPE_VIDEOPLAYER_NONTEMPORAL="videoPlayerNonTemporal";a.SLOT_TYPE_SITESECTION_NONTEMPORAL=
"siteSectionNonTemporal";a.TIME_POSITION_CLASS_PREROLL="PREROLL";a.TIME_POSITION_CLASS_MIDROLL="MIDROLL";a.TIME_POSITION_CLASS_POSTROLL="POSTROLL";a.TIME_POSITION_CLASS_OVERLAY="OVERLAY";a.TIME_POSITION_CLASS_DISPLAY="DISPLAY";a.TIME_POSITION_CLASS_PAUSE_MIDROLL="PAUSE_MIDROLL";a.EVENT_REQUEST_INITIATED="onRequestInitiated";a.EVENT_REQUEST_COMPLETE="onRequestComplete";a.EVENT_SLOT_STARTED="onSlotStarted";a.EVENT_SLOT_ENDED="onSlotEnded";a.EVENT_CONTENT_VIDEO_PAUSED="contentVideoPaused";a.EVENT_CONTENT_VIDEO_RESUMED=
"contentVideoResumed";a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST="contentVideoPauseRequest";a.EVENT_CONTENT_VIDEO_RESUME_REQUEST="contentVideoResumeRequest";a.CAPABILITY_STATUS_OFF=0;a.CAPABILITY_STATUS_ON=1;a.PARAMETER_LEVEL_PROFILE=0;a.PARAMETER_LEVEL_GLOBAL=1;a.PARAMETER_LEVEL_OVERRIDE=5;a.PARAMETER_ENABLE_FORM_TRANSPORT="sdk.enableFormTransport";a.PARAMETER_DESIRED_BITRATE="desiredBitrate";a.PARAMETER_VIDEO_POOL_SIZE="sdk.videoPoolSize";a.PARAMETER_PAGE_SLOT_CONTENT_TYPE="sdk.pageSlotContentType";a.PARAMETER_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT=
"PARAMETER_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT";a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT="extension.ad.control.clickElement";a.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED="extension.contentVideo.enabled";a.PARAMETER_EXTENSION_CONTENT_VIDEO_RESPOND_PAUSE_RESUME="extension.contentVideo.respondPauseResume";a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SEEK_BACK="extension.contentVideo.autoSeekBack";a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SOURCE_RESTORE="extension.contentVideo.autoSourceRestore";a.PARAMETER_EXTENSION_VIDEO_STATE_ENABLED=
"extension.videoState.enabled";a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT="renderer.video.startDetectTimeout";a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT="renderer.video.progressDetectTimeout";a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY="renderer.video.android.delay";a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE="renderer.video.displayControlsWhenPause";a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION="renderer.video.clickDetection";a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED="renderer.video.playAfterStalled";
a.PARAMETER_EXTENSION_SURVEY_ENABLED="extension.survey.enabled";a.PARAMETER_RENDERER_DISPLAY_COAD_SCRIPT_NAME="renderer.html.coadScriptName";a.PARAMETER_RENDERER_HTML_SHOULD_BACKGROUND_TRANSPARENT="renderer.html.isBackgroundTransparent";a.PARAMETER_RENDERER_HTML_SHOULD_END_AFTER_DURATION="renderer.html.shouldEndAfterDuration";a.PARAMETER_RENDERER_HTML_AD_LOAD_TIMEOUT="renderer.html.adLoadTimeout";a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE="renderer.html.placementType";a.PARAMETER_RENDERER_HTML_BOOTSTRAP=
"renderer.html.bootstrap";a.PARAMETER_RENDERER_HTML_PRIMARY_ANCHOR="renderer.html.primaryAnchor";a.PARAMETER_RENDERER_HTML_MARGIN_WIDTH="renderer.html.marginWidth";a.PARAMETER_RENDERER_HTML_MARGIN_HEIGHT="renderer.html.marginHeight";a.PARAMETER_VPAID_CREATIVE_TIMEOUT_DELAY="renderer.vpaid.creativeTimeoutDelay";a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INLINE="inline";a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INTERSTITIAL="interstitial";a.PARAMETER_RENDERER_HTML_BASEUNIT_INTERSTITIAL="app-interstitial";
a.ID_TYPE_FW=1;a.ID_TYPE_CUSTOM=2;a.ID_TYPE_GROUP=3;a.VIDEO_STATE_PLAYING=1;a.VIDEO_STATE_PAUSED=2;a.VIDEO_STATE_STOPPED=3;a.VIDEO_STATE_COMPLETED=4;a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED=1;a.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED=2;a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE=3;a.VIDEO_ASSET_AUTO_PLAY_TYPE_NON_AUTO_PLAY=3;a.VIDEO_ASSET_DURATION_TYPE_EXACT="exact";a.VIDEO_ASSET_DURATION_TYPE_VARIABLE="variable";a.ADUNIT_PREROLL="preroll";a.ADUNIT_MIDROLL="midroll";a.ADUNIT_POSTROLL="postroll";a.ADUNIT_OVERLAY=
"overlay";a.ADUNIT_STREAM_PREROLL="stream_preroll";a.ADUNIT_STREAM_POSTROLL="stream_postroll";a.SLOT_LOCATION_PLAYER="player";a.SLOT_LOCATION_EXTERNAL="external";a.SLOT_OPTION_INITIAL_AD_STAND_ALONE=0;a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL=1;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY=2;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE=3;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE=4;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE=5;a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE=
6;a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE_IF_TEMPORAL=7;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL=8;a.REQUEST_MODE_ON_DEMAND="on-demand";a.REQUEST_MODE_LIVE="live";a.Util={canPlayVideoType:function(b){if(a.PLATFORM_IS_SAFARI&&("video/ogg"==b||"video/webm"==b))return!1;if(1<a.PLATFORM_ANDROID_VERSION&&"video/m4v"==b)return!0;"video/3gp"==b&&(b="video/3gpp");if(3<=a.PLATFORM_ANDROID_VERSION&&"video/3gpp"==b)return!0;var c=document.createElement("video");return!c.canPlayType?
!1:!(!c.canPlayType(b)&&!c.canPlayType(b.replace("/","/x-")))},str2bool:function(b){if(!b)return!1;b=a.Util.trim(b).toLowerCase();return"true"==b||"yes"==b||"on"==b||"1"==b},trim:function(a){return"string"!=typeof a?a.toString():a.replace(/^\s+|\s+$/g,"")},isBlank:function(b){return!b||""===a.Util.trim(b)},encodeToHex:function(a){for(var c="",d=0;d<a.length;d++){for(var f=a.charCodeAt(d).toString(16).toUpperCase();4>f.length;)f="0"+f;c+="\\u"+f.toUpperCase()}return c},forEachOnArray:function(a,c,
d){var f;if(null==a)throw new TypeError(" array is null or not defined");var a=Object(a),g=a.length>>>0;if("[object Function]"!={}.toString.call(c))throw new TypeError(c+" is not a function");d&&(f=d);for(d=0;d<g;){var h;d in a&&(h=a[d],c.call(f,h,d,a));d++}},mixin:function(a,c){for(var d in c)"undefined"!=typeof c[d]&&(a[d]=c[d]);return a},copy:function(b){return a.Util.mixin({},b)},bind:function(a,c){var d=Array.prototype.slice.call(arguments);d.shift();c=d.shift();return function(){return c.apply(a,
d.concat(Array.prototype.slice.call(arguments)))}},getObject:function(a,c,d){if(!a)return null;for(var a=a.split("."),c=c||window,f=0,g;c&&(g=a[f]);f++)c=g in c?c[g]:d?c[g]={}:void 0;return c},buildNode:function(b,c,d,f,g){a.debug("Util.buildNode");d||(d=document);var h=null!=navigator.userAgent.match(/Firefox/);b.innerHTML=c||"";for(var b=b.getElementsByTagName("script"),i=d.getElementsByTagName("head")[0],c=0;c<b.length;++c)if(h||b[c].src){var j=d.createElement("script");if(b[c].charset)j.charset=
b[c].charset;if(b[c].src)j.src=b[c].src;if(b[c].innerHTML)j.innerHTML=b[c].innerHTML;j.onload=j.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&i.removeChild(j)};try{i.appendChild(j)}catch(k){a.warn("load script err: "+k)}}else j=b[c].innerHTML,f&&(j=j.replace(/var fw_scope = document;/,"var fw_scope="+f+";")),g&&(j=j.replace(/var fw_scope_window = window;/,"var fw_scope_window="+g+";")),eval(j)},replacePageSlot:function(b,c,d){a.debug("Util.replacePageSlot("+
Array.prototype.slice.call(arguments).join(",")+")");var f,g,h;try{f=document.getElementById(b)?document:parent.document.getElementById(b)?parent.document:null,g=document.getElementById(b)?"window":parent.document.getElementById(b)?"parent":null}catch(i){g=f=null}if(!f)for(var j=0;j<window.frames.length;j++)try{if(window.frames[j].document.getElementById(b))f=window.frames[j].document,g="window.frames["+j+"]"}catch(k){a.warn(k)}g&&(h=g+".document");a.log("replacing slot "+b+" in frame "+h);if(!f)throw"Slot element not found: "+
b;j=d?f.getElementById(d):f.getElementById("_fw_container_"+b);a.Util.buildNode(j,c,f,h,g)},transformUrlToProxy:function(b){if(null===a.proxyUrl)return b;var c=a.proxyUrl.replace("$","$$"),b=b.replace(/https?:\/\//,c);a.proxyAuthenticationParameter&&(b=a.Util.setParameterInURL(b,a.proxyAuthenticationParameter.key,a.proxyAuthenticationParameter.value));return b},pingURLWithImage:function(b){(new Image(1,1)).src=a.Util.transformUrlToProxy(b)},pingURLWithForm:function(b,c,d){d=d?"_fw_request":"_fw_cb";
null==c&&(c=Math.random());var f=document.createElement("iframe");f.name=d+"_iframe_"+c;f.id=d+"_iframe_"+c;f.style.position="absolute";f.style.left="-10000px";f.style.width="1px";f.style.visibility="hidden";var g=document.createElement("form");g.action=a.Util.transformUrlToProxy(b);g.id=d+"_form_"+c;g.target=f.id;g.method="post";g.style.position="absolute";g.style.left="-10000px";g.style.width="1px";g.style.visibility="hidden";document.body&&(document.body.appendChild(f),document.body.appendChild(g),
g.submit(),document.body.removeChild(g))},pingURLWithScript:function(b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.src=a.Util.transformUrlToProxy(b);d.onload=d.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&c.removeChild(d)};c.appendChild(d)},pingURL:function(b){a.debug("send callback: "+b);b&&(a.PLATFORM_SEND_REQUEST_BY_FORM?a.Util.pingURLWithForm(b,null,!1):a.Util.pingURLWithImage(b))},pingURLs:function(b){for(var c=
0;c<b.length;c++)a.Util.pingURL(b[c])},setParameterInURL:function(a,c,d){if(!a||!c||null==d)return null;var f=!1,g,a=a.split("?"),h,d=encodeURIComponent(d);if(a[1]){h=a[1].split("&");for(var i=0;i<h.length;++i)if(g=h[i].split("="),g[0]==c){h[i]=g[0]+"="+d;f=!0;break}g=h.join("&");f||(g=c+"="+d+"&"+g)}else g=c+"="+d;return g=a[0]+"?"+g},getParameterInURL:function(b,c){if(!b||!c)return null;var d=b.split("?");if(d[1])for(var d=d[1].split("&"),f=0;f<d.length;++f){var g=d[f].split("=");if(g[0]==c&&!a.Util.isBlank(g[1]))return decodeURIComponent(g[1])}return null},
isParameterInURL:function(a,c){if(!a||!c)return!1;var d=a.split("?");if(d[1])for(var d=d[1].split("&"),f=0;f<d.length;++f)if(d[f].split("=")[0]==c)return!0;return!1},flashVersion:function(){var b="0,0,0,0";if(null!=navigator.plugins&&0<navigator.plugins.length){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"])try{var c=navigator.plugins["Shockwave Flash"+(navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"")].description.split(" "),d=c[2].split("."),f=d[0],g=d[1],h=
c[3];""==h&&(h=c[4]);"d"==h[0]?h=h.substring(1):"r"==h[0]&&(h=h.substring(1),0<h.indexOf("d")&&(h=h.substring(0,h.indexOf("d"))));b=f+","+g+","+h+",0"}catch(i){a.warn("Flash detection failed on navigator method")}}else{var j;try{j=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var k=j.GetVariable("$version").split(" ")[1].split(",");3==k.length?b=k.join(",")+",0":4==k.length&&(b=k.join(","))}catch(m){a.warn("Flash detection failed on ActiveX method")}}return b},xmlToJson:function(b){var c={};
if(!b)return null;if(1===b.nodeType){if(0<b.attributes.length){c["@attributes"]={};for(var d=0;d<b.attributes.length;d++){var f=b.attributes.item(d);c["@attributes"][f.nodeName]=f.nodeValue}}}else if(3===b.nodeType)c=b.nodeValue;else if(4===b.nodeType)c=b.nodeValue;if(b.hasChildNodes()){for(d=0;d<b.childNodes.length;d++){var f=b.childNodes.item(d),g=f.nodeName;if("undefined"===typeof c[g])c[g]=a.Util.xmlToJson(f);else{if("undefined"===typeof c[g].length||"string"===typeof c[g]){var h=c[g];c[g]=[];
c[g].push(h)}c[g].push(a.Util.xmlToJson(f))}}if("undefined"!==typeof c["#cdata-section"])c.value=c["#cdata-section"];else if(c["#text"])c.value=c["#text"]}return c},lazyJavaScriptLoad:function(a,c){var d=document.getElementsByTagName("head")[0]||document.documentElement,f=document.createElement("script");f.type="text/javascript";f.src=a;if(c)f.attachEvent&&!window.opera?f.onreadystatechange=function(){if("loaded"==f.readyState||"complete"==f.readyState)d.removeChild(f),f.onreadystatechange=null,c()}:
f.addEventListener("load",function(){d.removeChild(f);c()},!1);d.insertBefore(f,d.firstChild)},getViewport:function(){var a=0,c=0;if("undefined"!==typeof window.innerWidth)a=window.innerWidth,c=window.innerHeight;else if("undefined"!==typeof document.documentElement&&"undefined"!==typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth)a=document.documentElement.clientWidth,c=document.documentElement.clientHeight;else if(document.getElementsByTagName("body")&&document.getElementsByTagName("body")[0])a=
document.getElementsByTagName("body")[0].clientWidth,c=document.getElementsByTagName("body")[0].clientHeight;return{width:a,height:c,offsetX:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,offsetY:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}},getAbsoluteUrl:function(b,c){b=a.Util.trim(b);c=a.Util.trim(c);if(-1!==c.indexOf("://"))return c;var d=b.substring(0,b.indexOf("://"));if(0===c.indexOf("//"))return d+":"+c;var d=b.indexOf("/",
b.indexOf("://")+5),f=b;-1!==d&&(f=b.substring(0,d));if(0==c.indexOf("/"))return f+c;d=b.lastIndexOf("#");f=b;-1!==d&&(f=b.substring(0,d));if(0==c.indexOf("#"))return f+c;f=b.indexOf("?");d=b;-1!==f&&(d=b.substring(0,f));if(0==c.indexOf("?"))return d+c;f=-1===f?b.lastIndexOf("/"):d.lastIndexOf("/");d=-1!==f?b.substring(0,f+1):d+"/";return d+c}};a.MediaState=function(){};a.MediaState.prototype={};a.MediaState.prototype.constructor=a.MediaState;a.Util.mixin(a.MediaState.prototype,{play:function(b){a.debug(this._name+
" play("+b+")")},pause:function(b){a.debug(this._name+" pause("+b+")")},complete:function(b){a.debug(this._name+" complete("+b+")")}});a.MediaInitState=function(){this._name="MediaInitState"};a.MediaInitState.prototype=new a.MediaState;a.MediaInitState.prototype.constructor=a.MediaInitState;a.Util.mixin(a.MediaInitState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaPlayingState.instance);if("function"===typeof b.onStartPlaying)b.onStartPlaying()}});a.MediaInitState.instance=
new a.MediaInitState;a.MediaPlayingState=function(){this._name="MediaPlayingState"};a.MediaPlayingState.prototype=new a.MediaState;a.MediaPlayingState.prototype.constructor=a.MediaPlayingState;a.Util.mixin(a.MediaPlayingState.prototype,{pause:function(b){a.debug(this._name+" pause("+b+")");b.setMediaState(a.MediaPausedState.instance);if("function"===typeof b.onPausePlaying)b.onPausePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===
typeof b.onCompletePlaying)b.onCompletePlaying()}});a.MediaPlayingState.instance=new a.MediaPlayingState;a.MediaPausedState=function(){this._name="MediaPausedState"};a.MediaPausedState.prototype=new a.MediaState;a.MediaPausedState.prototype.constructor=a.MediaPausedState;a.Util.mixin(a.MediaPausedState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaPlayingState.instance);if("function"===typeof b.onResumePlaying)b.onResumePlaying()},complete:function(b){a.debug(this._name+
" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompletePlaying)b.onCompletePlaying()}});a.MediaPausedState.instance=new a.MediaPausedState;a.MediaReplayingState=function(){this._name="MediaReplayingState"};a.MediaReplayingState.prototype=new a.MediaState;a.MediaReplayingState.prototype.constructor=a.MediaReplayingState;a.Util.mixin(a.MediaReplayingState.prototype,{pause:function(b){a.debug(this._name+" pause("+b+")");b.setMediaState(a.MediaReplayPausedState.instance);
if("function"===typeof b.onPausePlaying)b.onPausePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompleteReplaying)b.onCompleteReplaying()}});a.MediaReplayingState.instance=new a.MediaReplayingState;a.MediaReplayPausedState=function(){this._name="MediaReplayPausedState"};a.MediaReplayPausedState.prototype=new a.MediaState;a.MediaReplayPausedState.prototype.constructor=a.MediaReplayPausedState;a.Util.mixin(a.MediaReplayPausedState.prototype,
{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaReplayingState.instance);if("function"===typeof b.onResumePlaying)b.onResumePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompleteReplaying)b.onCompleteReplaying()}});a.MediaReplayPausedState.instance=new a.MediaReplayPausedState;a.MediaEndState=function(){this._name="MediaEndState"};a.MediaEndState.prototype=new a.MediaState;a.MediaEndState.prototype.constructor=
a.MediaEndState;a.Util.mixin(a.MediaEndState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaReplayingState.instance);if("function"===typeof b.onStartReplaying)b.onStartReplaying()}});a.MediaEndState.instance=new a.MediaEndState;a.RendererState=function(){};a.RendererState.prototype={};a.RendererState.prototype.constructor=a.RendererState;a.Util.mixin(a.RendererState.prototype,{start:function(){a.debug(this._name+" start()")},notifyStarted:function(){a.debug(this._name+
" notifyStarted()")},stop:function(){a.debug(this._name+" stop()")},complete:function(){a.debug(this._name+" complete()")},notifyCompleted:function(){a.debug(this._name+" notifyCompleted()")},fail:function(b){a.debug(this._name+" fail()");b.setRendererState(a.RendererFailedState.instance);b.getAdInstance().complete()}});a.RendererInitState=function(){this._name="RendererInitState"};a.RendererInitState.prototype=new a.RendererState;a.RendererInitState.prototype.constructor=a.RendererInitState;a.RendererInitState.instance=
new a.RendererInitState;a.Util.mixin(a.RendererInitState.prototype,{start:function(b){a.debug(this._name+" start()");b.setRendererState(a.RendererStartingState.instance);b.getRenderer().start(b)},stop:function(b){a.debug(this._name+" stop()");b.setRendererState(a.RendererCompletingState.instance);b.getRendererState().notifyCompleted()}});a.RendererStartingState=function(){this._name="RendererStartingState"};a.RendererStartingState.prototype=new a.RendererState;a.RendererStartingState.prototype.constructor=
a.RendererStartingState;a.RendererStartingState.instance=new a.RendererStartingState;a.Util.mixin(a.RendererStartingState.prototype,{notifyStarted:function(b){a.debug(this._name+" notifyStarted()");b.setRendererState(a.RendererStartedState.instance);b.getAdInstance().play()},stop:function(b){a.debug(this._name+" stop()");"function"===typeof b.getRenderer().stop&&(b.setRendererState(a.RendererCompletingState.instance),b.getRenderer().stop())}});a.RendererStartedState=function(){this._name="RendererStartedState"};
a.RendererStartedState.prototype=new a.RendererState;a.RendererStartedState.prototype.constructor=a.RendererStartedState;a.RendererStartedState.instance=new a.RendererStartedState;a.Util.mixin(a.RendererStartedState.prototype,{complete:function(b){a.debug(this._name+" complete()");b.setRendererState(a.RendererCompletingState.instance)},stop:function(b){a.debug(this._name+" stop()");"function"===typeof b.getRenderer().stop&&(b.setRendererState(a.RendererCompletingState.instance),!1===b.getRenderer().stop()&&
b.getAdInstance().fakeComplete())}});a.RendererCompletingState=function(){this._name="RendererCompletingState"};a.RendererCompletingState.prototype=new a.RendererState;a.RendererCompletingState.prototype.constructor=a.RendererCompletingState;a.RendererCompletingState.instance=new a.RendererCompletingState;a.Util.mixin(a.RendererCompletingState.prototype,{notifyCompleted:function(b){a.debug(this._name+" notifyCompleted()");b.setRendererState(a.RendererCompletedState.instance);b.getAdInstance().complete()}});
a.RendererCompletedState=function(){this._name="RendererCompletedState"};a.RendererCompletedState.prototype=new a.RendererState;a.RendererCompletedState.prototype.constructor=a.RendererCompletedState;a.RendererCompletedState.instance=new a.RendererCompletedState;a.RendererFailedState=function(){this._name="RendererFailedState"};a.RendererFailedState.prototype=new a.RendererState;a.RendererFailedState.prototype.constructor=a.RendererFailedState;a.RendererFailedState.instance=new a.RendererFailedState;
a.HTMLRenderer=function(){};a.HTMLRenderer.prototype={start:function(b){this.rendererController=b;b.getAdInstance().getSlot().getBase()?this._setupParameters()&&(this._render(),b.handleStateTransition(a.RENDERER_STATE_STARTED)):b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_INVALID_SLOT,errorInfo:"slot base is empty"})},pause:function(){this.log("pause");this.shouldEndAfterDuration&&this.timer&&this.timer.pause()},resume:function(){this.log("resume");
this.shouldEndAfterDuration&&this.timer&&this.timer.start()},stop:function(){this.log("stop isMRAIDAd:"+this.isMRAIDAd+" tpc:"+this._tpc+" interstitial:"+this.shouldKeepInterstitial);return this._stop()},_stop:function(){this.log("_stop isMRAIDAd:"+this.isMRAIDAd+" tpc:"+this._tpc+" interstitial:"+this.shouldKeepInterstitial);if(this.isMRAIDAd||this._tpc!=a.TIME_POSITION_CLASS_DISPLAY||this.shouldKeepInterstitial)this._cleanup(),this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED);
else return!1},resize:function(){var b=this.rendererController.getAdInstance(),c=b.getSlot().getBase();b.getSlot().getTimePositionClass()==a.TIME_POSITION_CLASS_OVERLAY?!this.isMRAIDAd||this.isMRAIDAd&&this.mraid.state==this.mraid.STATEDEFAULT?(b="_fw_ad_container_html_"+b.getSlot().getCustomId()+"_",b=document.getElementById(b),b.style.width=c.style.width||"100%",b.style.height=c.style.height||"100%",this._layoutOverlayAd(this.defaultAdElement)):this.log("Cannot resize an MRAID ad that is not in the default state"):
this.log("Cannot resize a non-overlay ad")},_cleanup:function(){this.log("_cleanup");if(this.timer)this.timer.stop(),this.timer=null;if(this.adLoadTimeoutTimer)this.adLoadTimeoutTimer.stop(),this.adLoadTimeoutTimer=null;window.removeEventListener?(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),window.removeEventListener("message",this.messageHandlerFunc,!1),window.removeEventListener("resize",this.viewportChangeFunc,!1),window.removeEventListener("scroll",this.viewportChangeFunc,
!1)):window.detachEvent&&(window.detachEvent("onmessage",this.messageHandlerFunc),window.detachEvent("onresize",this.viewportChangeFunc),window.detachEvent("onscroll",this.viewportChangeFunc));if(this.isMRAIDAd&&(this.mraid.inExpandedState()&&(this.log("stopping with expanded state, invoke close()"),this._mraidClose()),this.mraid.inDefaultState())){this.log("stopping with default state, invoke close()");this._mraidClose();return}var a;if(this.expandedAdElement){a=this.expandedAdElement.parentNode;
this.expandedAdElement._fw_closeButton&&a.removeChild(this.expandedAdElement._fw_closeButton);a.removeChild(this.expandedAdElement);if(this.expandedAdElement===this.defaultAdElement){if(this.defaultAdElementContainer===this.defaultAdElement)this.defaultAdElementContainer=null;this.defaultAdElement=null}this.expandedAdElement=null}if(this.expandedLightbox)a=this.expandedLightbox.parentNode,a.removeChild(this.expandedLightbox),this.expandedLightbox=null;this.rendererController.getAdInstance().getSlot().getTimePositionClass();
if(this.defaultAdElement){a=this.defaultAdElement.parentNode;var c=this.defaultAdElement;c.style.display="none";a!==this.rendererController.getAdInstance().getSlot().getBase()&&window.setTimeout(function(){for(var d=a&&a.childNodes||[],f=0;f<d.length;f++){var g=d[f];g===c&&a.removeChild(g)}},200);if(this.defaultAdElementContainer===this.defaultAdElement)this.defaultAdElementContainer=null;this.defaultAdElement=null}if(this.defaultAdElementContainer)a=this.defaultAdElementContainer.parentNode,a.removeChild(this.defaultAdElementContainer),
this.defaultAdElementContainer=null;this.shouldPauseContentWhenStart&&this.rendererController.requestContentStateChange(!1)},_setupParameters:function(){var b=this.rendererController,c=b.getAdInstance(),d=c.getSlot().getTimePositionClass();this._tpc=d;var f=c.getActiveCreativeRendition(),c=f.getBaseUnit(),f=f.getCreativeApi(),g;if(a.PLATFORM_NOT_SUPPORT_OVERLAY_AD&&d===a.TIME_POSITION_CLASS_OVERLAY)return b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_DEVICE_LIMIT,
errorInfo:"Overlay not supported on this device."}),!1;if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&(d===a.TIME_POSITION_CLASS_MIDROLL||d===a.TIME_POSITION_CLASS_PAUSE_MIDROLL))return b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"Midroll, pause_midroll not supported on this device."}),!1;if(a.PLATFORM_IS_IPHONE_IPOD)switch(d){case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_OVERLAY:return b.handleStateTransition(a.RENDERER_STATE_FAILED,
{errorModule:"HTMLRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"Midroll, pause_midroll and overlay ads are not supported on iPod, iPhone."}),!1;case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:b.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF)}this.adLoadTimeout=5;if(g=b.getParameter(a.PARAMETER_RENDERER_HTML_AD_LOAD_TIMEOUT))this.adLoadTimeout=0<Number(g)?Number(g):this.adLoadTimeout;this.shouldKeepInterstitial=!1;if(g=b.getParameter(a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE))this.shouldKeepInterstitial=
g===a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INTERSTITIAL;else if("string"===typeof c)this.shouldKeepInterstitial=c.toLowerCase()===a.PARAMETER_RENDERER_HTML_BASEUNIT_INTERSTITIAL;this.isInterstitialNow=this.shouldKeepInterstitial;this.shouldPauseContentWhenStart=!1;this.shouldPauseContentWhenExpandOrClick=!this.shouldKeepInterstitial&&(d===a.TIME_POSITION_CLASS_DISPLAY||d===a.TIME_POSITION_CLASS_OVERLAY);this.shouldBackgroundTransparent=!1;g=b.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_BACKGROUND_TRANSPARENT);
if("undefined"!==typeof g&&null!==g)this.shouldBackgroundTransparent=a.Util.str2bool(g);this.shouldEndAfterDuration=d!==a.TIME_POSITION_CLASS_DISPLAY;g=b.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_END_AFTER_DURATION);if("undefined"!==typeof g&&null!==g)this.shouldEndAfterDuration=a.Util.str2bool(g);this.coadScriptName=b.getParameter(a.PARAMETER_RENDERER_DISPLAY_COAD_SCRIPT_NAME);if(!this.coadScriptName)this.coadScriptName=b.getParameter("coad_script_name");this.primaryAnchor=b.getParameter(a.PARAMETER_RENDERER_HTML_PRIMARY_ANCHOR)||
"bc";this.marginWidth=b.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_WIDTH)||0;this.marginHeight=b.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_HEIGHT)||0;this.bootstrap=b.getParameter(a.PARAMETER_RENDERER_HTML_BOOTSTRAP);c=a.Util.getViewport();this.defaultExpandWidth=c.width;this.defaultExpandHeight=c.height;this.isMRAIDAd="MRAID-1.0"===f;this.mraid=new function(b){this.STATELOADING="loading";this.STATEDEFAULT="default";this.STATEEXPANDED="expanded";this.STATEHIDDEN="hidden";this._renderer=b;this._state=
this.STATELOADING;this._useCustomClose=!1;this.viewable=this.expandIsModal=!0;this._baseUrlExpanded=this._baseUrlDefault="";b=Object.defineProperty||function(a,b,c){c.get&&a.__defineGetter__(b,c.get);c.set&&a.__defineSetter__(b,c.set)};b(this,"baseUrl",{get:function(){return this.inExpandedState()?this._baseUrlExpanded||this._baseUrlDefault:this._baseUrlDefault},set:function(a){this.inExpandedState()?this._baseUrlExpanded=a:(this._baseUrlDefault=a,this._baseUrlExpanded="")}});b(this,"useCustomClose",
{get:function(){return this._useCustomClose},set:function(a){if(this._useCustomClose===!a)this._useCustomClose=!!a,this.pushData()}});b(this,"placementType",{get:function(){return this._renderer.shouldKeepInterstitial?"interstitial":"inline"}});b(this,"expandWidth",{get:function(){return this._renderer.requestedExpandWidth&&this._renderer.requestedExpandWidth<this._renderer.defaultExpandWidth?this._renderer.requestedExpandWidth:this._renderer.defaultExpandWidth}});b(this,"expandHeight",{get:function(){return this._renderer.requestedExpandHeight&&
this._renderer.requestedExpandHeight<this._renderer.defaultExpandHeight?this._renderer.requestedExpandHeight:this._renderer.defaultExpandHeight}});b(this,"state",{get:function(){return this._state},set:function(b){this.log("mraid.state change "+this.state+" => "+b);if(this.state!==b){this._renderer.shouldPauseContentWhenExpandOrClick&&(b===this.STATEEXPANDED?this._renderer.rendererController.requestContentStateChange(!0):this.inExpandedState()&&this._renderer.rendererController.requestContentStateChange(!1));
if(b===this.STATEEXPANDED)this._renderer.expandedAdElement?this._renderer.rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION}):(this._renderer.expandedAdElement=this._renderer.defaultAdElement,this._renderer.rendererController.processEvent({name:a.EVENT_AD_EXPAND})),this._renderer.presentInterstitial(),this._renderer.shouldEndAfterDuration&&this._renderer.timer.pause();else if(b===this.STATEDEFAULT)this._renderer.shouldKeepInterstitial?(this._renderer.expandedAdElement=this._renderer.defaultAdElement,
this._renderer.presentInterstitial()):(this.inExpandedState()&&(this._renderer.expandedAdElement!==this._renderer.defaultAdElement?this._renderer.rendererController.processEvent({name:a.EVENT_AD_CLOSE}):this._renderer.rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})),this._renderer.expandedAdElement=null,this._renderer.presentInline()),this._renderer.shouldEndAfterDuration&&this._renderer.timer.start();this._state=b;this.pushData();b===this.STATEHIDDEN&&this._renderer.stop()}}});this.inLoadingState=
function(){return this.state===this.STATELOADING};this.inDefaultState=function(){return this.state===this.STATEDEFAULT};this.inExpandedState=function(){return this.state===this.STATEEXPANDED};this.inHiddenState=function(){return this.state===this.STATEHIDDEN};this.pushData=function(){var a='mraid._Update("'+this.state+'", '+this.viewable+', "'+this.placementType+'", '+this.expandWidth+", "+this.expandHeight+", "+this.useCustomClose+", "+this.expandIsModal+")";this.log("mraid.pushData: going to invoke on iframe with "+
a);this._renderer.defaultAdElement?(this._renderer.defaultAdElement.contentWindow.postMessage("fwsdk-bounce:"+a,"*"),this._renderer.expandedAdElement&&this._renderer.expandedAdElement!==this._renderer.defaultAdElement&&this._renderer.expandedAdElement.contentWindow.postMessage("fwsdk-bounce:"+a,"*")):this.warn("_mraidPushData: no iframe suitable to send "+a)};this.log=function(a){this._renderer.log(a)};this.warn=function(a){this._renderer.warn(a)}}(this);this.onLoadFunc=a.Util.bind(this,function(){if(this.adLoadTimeoutTimer)this.adLoadTimeoutTimer.stop(),
this.adLoadTimeoutTimer=null;this.timer&&this.shouldEndAfterDuration&&this.timer.start()});this.touchMoveDisabler=function(a){a.preventDefault()};this.log("setting parameters, adLoadTimeout: "+this.adLoadTimeout+", isMRAIDAd: "+this.isMRAIDAd+", shouldKeepInterstitial: "+this.shouldKeepInterstitial+", shouldEndAfterDuration: "+this.shouldEndAfterDuration+", shouldPauseContentWhenStart: "+this.shouldPauseContentWhenStart+", shouldPauseContentWhenExpandOrClick: "+this.shouldPauseContentWhenExpandOrClick+
", shouldBackgroundTransparent: "+this.shouldBackgroundTransparent+", defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", coadScriptName: "+this.coadScriptName+", primaryAnchor: "+this.primaryAnchor+", marginWidth: "+this.marginWidth+", marginHeight: "+this.marginHeight+", bootstrap: "+this.bootstrap);if(this.shouldKeepInterstitial){if(d===a.TIME_POSITION_CLASS_OVERLAY)return b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",
errorCode:a.ERROR_INVALID_SLOT,errorInfo:"Interstitial ad is not supported on overlay slot."}),!1}else if(this.isMRAIDAd&&(!a.PLATFORM_IS_IPHONE_IPOD||d===a.TIME_POSITION_CLASS_DISPLAY))b.setCapability(a.EVENT_AD_ACCEPT_INVITATION,a.CAPABILITY_STATUS_ON),b.setCapability(a.EVENT_AD_CLOSE,a.CAPABILITY_STATUS_ON),b.setCapability(a.EVENT_AD_COLLAPSE,a.CAPABILITY_STATUS_ON),b.setCapability(a.EVENT_AD_EXPAND,a.CAPABILITY_STATUS_ON);return!0},_render:function(){this.log("_render");var b=this.rendererController,
c=b.getAdInstance(),d=c.getSlot(),f=d.getTimePositionClass(),g=d.getBase(),h=c.getActiveCreativeRendition(),i=h.getDuration(),j=h.getPrimaryCreativeRenditionAsset(),c=j.getUrl(),k=j.getContent();if(f===a.TIME_POSITION_CLASS_DISPLAY)g.innerHTML="";this.timer=new a.Timer(i,a.Util.bind(this,this._stop));if(this.coadScriptName&&"function"===typeof window[this.coadScriptName])this.defaultAdElement=window[this.coadScriptName](k,c,h.getHeight(),h.getWidth(),j.getMimeType(),d.getCustomId()),this.timer&&this.shouldEndAfterDuration&&
this.timer.start();else{i=document.createElement("span");i.id="_fw_ad_container_html_"+d.getCustomId()+"_";i.style.position="relative"===g.style.position?"absolute":"relative";i.style.display="inline-block";i.style.margin="0px";i.style.padding="0px";i.style.width=g.style.width||"100%";i.style.height=g.style.height||"100%";i.style.top=i.style.left="0px";g.appendChild(i);this.defaultAdElementContainer=i;if(!c&&!k){b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_NULL_ASSET});
this._stop();return}if("text/html_lit_nowrapper"==h.getContentType()||"text/html_lit_js_wc_nw"==h.getContentType()){if(this.isMRAIDAd||this.isInterstitialNow){b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_INVALID_VALUE});this._stop();return}if(!k){b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_NULL_ASSET});this._stop();return}this.defaultAdElement=i;this.defaultAdElement.innerHTML=k;for(var d=this.defaultAdElement.getElementsByTagName("script"),
m=document.getElementsByTagName("head")[0],g=0;g<d.length;++g)if(d[g].src){var l=document.createElement("script");if(d[g].charset)l.charset=d[g].charset;if(d[g].src)l.src=d[g].src;if(d[g].innerHTML)l.innerHTML=d[g].innerHTML;l.onload=l.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&m.removeChild(l)};m.appendChild(l)}else l=d[g].innerHTML,eval(l);this.presentInline();this.onLoadFunc();return}h=document.createElement("iframe");h.id="_fw_ad_container_iframe_"+
d.getCustomId()+"_"+Math.random();h.attachEvent?h.attachEvent("onload",this.onLoadFunc):h.onload=this.onLoadFunc;this.defaultAdElement=h;this.defaultAdElementContainer.appendChild(h);this._fillAdNode(h,c,k);if(this.isMRAIDAd)this.adLoadTimeoutTimer=new a.Timer(this.adLoadTimeout,a.Util.bind(this,function(){b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_TIMEOUT,errorModule:"HTMLRenderer",errorInfo:"Loading element timeout"});f!==a.TIME_POSITION_CLASS_DISPLAY?this.isMRAIDAd&&!this.mraid.inLoadingState()?
this._mraidClose():this._stop():this._stop()})),this.adLoadTimeoutTimer.start()}if(!this.defaultAdElement&&(d=g.getElementsByTagName("iframe"))&&0<d.length)this.defaultAdElement=d[d.length-1];if(this.defaultAdElement){this.defaultAdElement.frameBorder="0";if(this.shouldBackgroundTransparent)this.defaultAdElement.allowTransparency="true",this.defaultAdElement.style["background-color"]="rgba(255,255,255,0)";this.isInterstitialNow?(this.expandedAdElement=this.defaultAdElement,this.presentInterstitial()):
this.presentInline();this.messageHandlerFunc=a.Util.bind(this,this._onWindowMessageReceived);this.viewportChangeFunc=a.Util.bind(this,function(){this.viewportChangeFuncTimer&&window.clearTimeout(this.viewportChangeFuncTimer);this.viewportChangeFuncTimer=window.setTimeout(a.Util.bind(this,this._onViewportResizeScroll),200)});window.addEventListener?(window.addEventListener("message",this.messageHandlerFunc,!1),window.addEventListener("resize",this.viewportChangeFunc,!1),window.addEventListener("scroll",
this.viewportChangeFunc,!1)):window.attachEvent&&(window.attachEvent("onmessage",this.messageHandlerFunc),window.attachEvent("onresize",this.viewportChangeFunc),window.attachEvent("onscroll",this.viewportChangeFunc))}else this.isMRAIDAd&&(b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_UNKNOWN,errorModule:"HTMLRenderer",errorInfo:"Failed to find iframe in slotBase for MRAID ad"}),this._stop())},_layoutOverlayAd:function(a){this.log("_layoutOverlayAd");var c=this.rendererController.getAdInstance(),
d=c.getSlot(),f=d.getVideoDisplaySize().width,d=d.getVideoDisplaySize().height,g=c.getActiveCreativeRendition(),c=g.getWidth()||240,g=g.getHeight()||50;a.style.width=Math.min(c,f)+"px";a.style.height=Math.min(g,d)+"px";a.style.left=a.style.top=a.style.right=a.style.bottom="";switch(this.primaryAnchor){case "tl":case "lt":a.style.top=this.marginHeight+"px";a.style.left=this.marginWidth+"px";break;case "tr":case "rt":a.style.top=this.marginHeight+"px";a.style.right=this.marginWidth+"px";break;case "bl":case "lb":a.style.bottom=
this.marginHeight+"px";a.style.left=this.marginWidth+"px";break;case "br":case "rb":a.style.bottom=this.marginHeight+"px";a.style.right=this.marginWidth+"px";break;case "tc":case "ct":a.style.top=this.marginHeight+"px";a.style.left=0.5*Math.max(0,f-c)+"px";break;case "lm":case "ml":a.style.left=this.marginWidth+"px";a.style.top=0.5*Math.max(0,d-g)+"px";break;case "rm":case "mr":a.style.right=this.marginWidth+"px";a.style.top=0.5*Math.max(0,d-g)+"px";break;case "mc":case "cm":case "c":case "m":a.style.left=
0.5*Math.max(0,f-c)+"px";a.style.top=0.5*Math.max(0,d-g)+"px";break;default:case "bc":case "cb":a.style.bottom=this.marginHeight+"px",a.style.left=0.5*Math.max(0,f-c)+"px"}},_fillAdNode:function(b,c,d){this.log("_fillAdNode, url:"+c+", content:"+(d?"<omited>":"<empty>"));var f=this.rendererController;if(c)b.src=c;else if(d)b=b.contentWindow?b.contentWindow.document:b.contentDocument.document?b.contentDocument.document:b.contentDocument,b.open(),b.write(d),b.close();else return f.handleStateTransition(a.RENDERER_STATE_FAILED,
{errorModule:"HTMLRenderer",errorCode:a.ERROR_NULL_ASSET}),!1;return!0},presentInline:function(){this.log("presentInline");this.isInterstitialNow=!1;var b=this.defaultAdElement;if(b){var c=this.rendererController.getAdInstance(),d=c.getSlot(),f=d.getTimePositionClass(),g=d.getWidth(),h=d.getHeight(),i=d.getVideoDisplaySize().width,d=d.getVideoDisplaySize().height,j=c.getActiveCreativeRendition(),c=j.getWidth(),j=j.getHeight();b.scrolling="no";b.style.overflow="hidden";switch(f){case a.TIME_POSITION_CLASS_DISPLAY:b.style.position=
"";b.style.background=this.shouldBackgroundTransparent?"transparent":"";b.style.left="0px";b.style.top="0px";b.style.width=(c?c:g)+"px";b.style.height=(j?j:h)+"px";break;case a.TIME_POSITION_CLASS_OVERLAY:b.style.position="absolute";b.style.background=this.shouldBackgroundTransparent?"transparent":"white";this._layoutOverlayAd(b);break;default:b.style.position="absolute",b.style.background=this.shouldBackgroundTransparent?"transparent":"white",b.style.left="0px",b.style.top="0px",b.style.width=i+
"px",b.style.height=d+"px"}}},presentInterstitial:function(){this.log("presentInterstitial, defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", this.mraid.expandWidth: "+this.mraid.expandWidth+", this.mraid.expandHeight: "+this.mraid.expandHeight+", (Math.max(0, this.defaultExpandWidth - this.mraid.expandWidth) / 2) = "+Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+", (Math.max(0, this.defaultExpandHeight - this.mraid.expandHeight) / 2) = "+
Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2);if(this.expandedAdElement){this.isInterstitialNow=!0;document.addEventListener&&(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),document.addEventListener("touchmove",this.touchMoveDisabler,!1));var b=this.expandedAdElement.parentNode;if(!this.expandedLightbox)this.expandedLightbox=document.createElement("div"),this.expandedLightbox.style.background="black",this.expandedLightbox.style.opacity=0.8,this.expandedLightbox.style.position=
"fixed",this.expandedLightbox.style.top="0px",this.expandedLightbox.style.left="0px",this.expandedLightbox.style.zIndex=this.expandedLightbox.style["z-index"]=9999,b.appendChild(this.expandedLightbox);this.expandedLightbox.style.width=this.defaultExpandWidth+"px";this.expandedLightbox.style.height=this.defaultExpandHeight+"px";this.expandedAdElement.frameBorder="0";this.expandedAdElement.scrolling="no";this.expandedAdElement.style.position="fixed";this.expandedAdElement.style.overflow="hidden";this.expandedAdElement.style.top=
this.expandedAdElement.top=Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2+"px";this.expandedAdElement.style.left=this.expandedAdElement.left=Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+"px";this.expandedAdElement.style.width=this.expandedAdElement.width=this.mraid.expandWidth+"px";this.expandedAdElement.style.height=this.expandedAdElement.height=this.mraid.expandHeight+"px";this.expandedAdElement.style.zIndex=this.expandedAdElement.style["z-index"]=1E4;this.log("presentInterstitial, expanded ad element size: (top, left, width, height) = ("+
this.expandedAdElement.top+", "+this.expandedAdElement.left+", "+this.expandedAdElement.width+", "+this.expandedAdElement.height+")");if(this.isMRAIDAd){var c=this.expandedAdElement._fw_closeButton;if(!c)c=document.createElement("div"),c.addEventListener?c.addEventListener("click",a.Util.bind(this,function(){this._mraidClose()})):c.attachEvent&&c.attachEvent("onclick",a.Util.bind(this,function(){this._mraidClose()})),c.style.position="fixed",c.style.margin="0px",c.style.padding="0px",c.style.width=
"25px",c.style.height="25px",c.style.zIndex=c.style["z-index"]=10001,b.appendChild(c),this.expandedAdElement._fw_closeButton=c;c.style.top=this.expandedAdElement.style.top;c.style.left=Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+this.mraid.expandWidth-25+"px";c.innerHTML=this.mraid.useCustomClose?0<a.PLATFORM_ANDROID_VERSION?"   ":"":0<a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION?'<img style="width:25px; height:25px; border:0" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4xJREFUeNrMmjFv2kAUxw/IUAZUw4AqJjIxMAQJ9sIHgDYLUqfSBTowJBudAmOnNCNeAitLyVgxxNlBgk+QTKgb6UQHhr7nniNj8PmM3zk86XQZOPt+ee/e+9+dI4zQms1mGTpsb6EVXH42h/YHmqHrukH17kjAiWvQfYT2gfeH2BjaHfYA9hwqCABkobvik9eI/qkIMYB2A0BPSkG4By44hErrQfvhx0MRn/F/Cy3LwjH0yhfZdRSThOhyCI2FZ/iuRrFYjMxmMyMwCEDc8nB6LSsDTBZg7g4GAYj7ANmI0gpeMDEPTxwDhBRMzAXiGrqv7PgMYTSA+eWZtQACvfCTHbedQzYbu4LwOvHolp3q9TorlUpsuVyyfr/P1us16ezi8TirVqtmP5lMzPcIiuepvc5EHT+4doPIZDImhPV3q9UyX0hl+MxOp2O+I5/Ps1qt5pWat4py1CE7Gm4jnf99Sph9z5Lw9gWf845HhLJjtVqx0WhEDuMGgaElYVdbWYuTDbxGYcwiELreskQiwXK5HFssFmyz2ZBA4PoTrA9nFhtCFnu2PCJdL6bTKYlnCCCYfe4WyGc/I4PCEEK8zD3Cw+rxkPjGDIMp2Rl+otRMDGHZaZRvTQ8yv55RBGEKSwQ5C/IEWRiFEGhnMVj1naCbJa9slk6nVUKg/T2h2iyhZywZ4/RCMplUCWFW+hPBsQ0ZjFMhEEOY9SRKLUv3rRnFEHtFI4nhRPelX1xH2FQYOYjf9EsJ8qQSQqVqth8dkYGI6oQK1awExKvYUQlNL5CFSghq1exiCwQxVEOEAGPEYFPyG2QKniS+CWNTRL05w7DSdf2blX7HYe7siD0ztteRm7B3doQww5c9Ow+vspcKRvHXbrfJBCBBmOH13XdnZe95jcKzJmoVK/KMhPV2JAq/UDG8TgJVCEA3GAlvGG5a61JGpmM4UKtYJ4zEs7fmuu8Qu8vU3xEK12EqlXJV0FZIgTe6QhAOcx/kUEKxYUhVZGX8Oft/sX9sNudz2zHXW13wCm6B71m4F6AiwyuECnhj7mtjxQdUKPcrQdStCELoEZtnNO6ZwiuGU8Xr4wE/HwzgJVDY19T49cOlzA9jsk/EC0iQMQ/cM+9C8MIngOjLDjj0o5oGrzVZBWsBa8TA78Cgnznh3QQe6we9j0cpPnTe1IYG4kgIZR5273mvCdIohg6G6TzI5O32T4ABAPsBS28k7apdAAAAAElFTkSuQmCC">':
'<img style="width:25px; height:25px; border:0" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAwcHgiIGhlaWdodD0iNDAwcHgiIHZpZXdCb3g9IjAgMCA0MDAgNDAwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA0MDAgNDAwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48Y2lyY2xlIGZpbGw9IiM2NjY2NjYiIGN4PSIyMDAuMTM5IiBjeT0iMTk5Ljg2IiByPSIxOTcuODYiLz48cGF0aCBmaWxsPSIjRjBGMEYwIiBzdHJva2U9IiNGMEYwRjAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTExNC44NjUsMzAzLjY0NGMtNi4yMjYsNi4yMjctMTUuMzYzLDcuMTg2LTIwLjQwNywyLjE0NGwtMC41MjItMC41MjJjLTUuMDQzLTUuMDQzLTQuMDgzLTE0LjE4LDIuMTQ0LTIwLjQwN0wyODQuODYsOTYuMDc4YzYuMjI2LTYuMjI3LDE1LjM2Mi03LjE4NiwyMC40MDUtMi4xNDRsMC41MjIsMC41MjFjNS4wNDMsNS4wNDIsNC4wODMsMTQuMTc5LTIuMTQ0LDIwLjQwOEwxMTQuODY1LDMwMy42NDR6Ii8+PHBhdGggZmlsbD0iI0YwRjBGMCIgc3Ryb2tlPSIjRjBGMEYwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0zMDcuODE5LDI4OC42NjZjNS4xNTMsNS4xNTgsNS4wNDgsMTMuNjI0LTAuMjQxLDE4LjkxMWwwLDBjLTUuMjg4LDUuMjg5LTEzLjc1Miw1LjM5My0xOC45MDksMC4yNEw5MS45MDYsMTExLjA1NWMtNS4xNTYtNS4xNTYtNS4wNDgtMTMuNjIzLDAuMjQtMTguOTFsMCwwYzUuMjktNS4yODksMTMuNzU1LTUuMzk2LDE4LjkxMS0wLjI0MUwzMDcuODE5LDI4OC42NjZ6Ii8+PC9zdmc+">'}}},
_onWindowMessageReceived:function(b){if(this.defaultAdElement&&!(b.source!==this.defaultAdElement.contentWindow&&(this.expandedAdElement?b.source!==this.expandedAdElement.contentWindow:1))){this.log("_onWindowMessageReceived, event.data:"+b.data+", event.origin:"+b.origin);var c=b.data.toString().split(":");if(c&&2<=c.length&&"fwsdk-invoke"===c[0]){var d=c[1];if((c=c.slice(2))&&0<c.length){for(var f=0;f<c.length;f++)c[f]=decodeURIComponent(c[f]);1===c.length&&(c=c[0])}else c=null;if("iframe_ready"===
d){if(this.onLoadFunc&&b.source===this.defaultAdElement.contentWindow&&this.defaultAdElement!==this.expandedAdElement)this.onLoadFunc();if(c&&(c=a.Util.trim(c))&&this.isMRAIDAd)this.mraid.baseUrl=c;this.bootstrap&&b.source.postMessage("fwsdk-bounce:"+this.bootstrap,b.origin);b.source.postMessage('fwsdk-bounce:mraid._messagingModel = "postMessage"',b.origin);if(this.isMRAIDAd)b.source===this.defaultAdElement.contentWindow&&this.shouldPauseContentWhenStart&&this.rendererController.requestContentStateChange(!0),
this.mraid.inLoadingState()?this.mraid.state=this.mraid.STATEDEFAULT:this.expandedAdElement&&b.source===this.expandedAdElement.contentWindow&&this.mraid.pushData()}else this.isMRAIDAd?this._mraidMethods(d,c):"close"===d&&this._stop()}}},_mraidMethods:function(b,c){if(b&&this.isMRAIDAd)switch(this.log("_mraidMethods("+b+", "+c+")"),b){case "open":"string"===typeof c?this._mraidOpen(c):2<=c.length&&this._mraidOpen(c[0],a.Util.str2bool(c[1]));break;case "close":this._mraidClose();break;case "expand":this._mraidExpand(c);
break;case "useCustomClose":c&&0<c.length?this.mraid.useCustomClose=a.Util.str2bool(c):this.warn("Invalid parameter to useCustomClose");break;case "setExpandProperties":if(!c)break;this.requestedExpandWidth=Number(c[0]);this.requestedExpandHeight=Number(c[1]);if(!this.requestedExpandWidth||!this.requestedExpandHeight||this.requestedExpandWidth===this.defaultExpandWidth&&this.requestedExpandHeight===this.defaultExpandHeight)this.requestedExpandHeight=this.requestedExpandWidth=0;this.mraid.useCustomClose=
a.Util.str2bool(c[2]);(this.requestedExpandWidth!==this.mraid.expandWidth||this.requestedExpandHeight!==this.mraid.expandHeight)&&this.mraid.pushData();break;case "log":this.log("MRAID log:"+c);break;default:this.warn("Unknown MRAID function call: "+b+" with param:"+c)}},_mraidOpen:function(b,c){this.log("_mraidOpen("+b+"), baseUrl:"+this.mraid.baseUrl+", absolute Url"+(b=a.Util.getAbsoluteUrl(this.mraid.baseUrl,b)));var d=this.rendererController;d.getAdInstance();b&&"string"===typeof b&&0<b.length?
((c||"undefined"===typeof c)&&window.open(b),d.processEvent({name:a.EVENT_AD_CLICK,info:{showBrowser:!1,url:b}})):this.warn("_mraidOpen: url required for open")},_mraidClose:function(){this.log("_mraidClose, current state: "+this.mraid.state);if(this.mraid.inExpandedState()){window.removeEventListener&&document.removeEventListener("touchmove",this.touchMoveDisabler,!1);var a=this.expandedAdElement,c=this.expandedAdElement._fw_closeButton;this.expandedAdElement._fw_closeButton=null;var d=this.expandedAdElement.parentNode;
this.mraid.state=this.mraid.STATEDEFAULT;if(this.expandedLightbox)d.removeChild(this.expandedLightbox),this.expandedLightbox=null;if(a!==this.defaultAdElement)a.style.display="hidden",window.setTimeout(function(){d.removeChild(a)},50);d.removeChild(c)}else this.mraid.inDefaultState()?this.mraid.state=this.mraid.STATEHIDDEN:this.warn("_mraidClose: close() is only valid when in expanded/default state")},_mraidExpand:function(b){this.log("_mraidExpand, current state: "+this.mraid.state);if(this.mraid.inDefaultState())if(this.shouldKeepInterstitial)this.warn("_mraidExpand: expand() is only valid for inline ad");
else{if(b){var c=document.createElement("iframe");if(this.shouldBackgroundTransparent)c.allowTransparency="true",c.style["background-color"]="rgba(255,255,255,0)";(this.defaultAdElementContainer||this.defaultAdElement.parentNode).appendChild(c);this.expandedAdElement=c;this.log("_mraidExpand("+b+"), baseUrl:"+this.mraid.baseUrl+", absolute Url"+(b=a.Util.getAbsoluteUrl(this.mraid.baseUrl,b)));this._fillAdNode(c,b,null)}this.mraid.state=this.mraid.STATEEXPANDED;this.isInterstitialNow=!0;this._onViewportResizeScroll()}else this.warn("_mraidExpand: expand() is only valid when in default state")},
_onViewportResizeScroll:function(){var b=a.Util.getViewport();this.defaultExpandWidth=b.width;this.defaultExpandHeight=b.height;this.isInterstitialNow&&this.presentInterstitial()},log:function(b){var c=this.rendererController.getAdInstance().getSlot();a.log("HTMLRenderer["+c+"]\t"+b)},warn:function(b){var c=this.rendererController.getAdInstance().getSlot();a.warn("HTMLRenderer["+c+"]\t"+b)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return this.timer?this.timer.getPlayheadTime():
-1},getDuration:function(){return this.timer?this.timer.getDuration():-1}};a.HTMLRenderer.prototype.constructor=a.HTMLRenderer;a.Ad=function(){var b=null,c=[],d=!1,f=null,g=!1;return{isRequiredToShow:function(){return g},parse:function(h){if(h){b=h.adId||null;d=h.noLoad;f=h.adUnit;if(h.hasOwnProperty("required"))g=h.required;for(var i=0,h=h.creatives||[];i<h.length;i++){var j=h[i],k=new a.Creative;k.parse(j);c.push(k)}}},getSoAdUnit:function(){return f},getId:function(){return b},getNoLoad:function(){return d},
getCreative:function(a){for(var b=0;b<c.length;b++)if(c[b].getId()===a)return c[b];return null},addCreativeRendition:function(){var b=new a.Creative;c.push(b);return b}}};a.Creative=function(){var b=null,c=null,d=null,f={},g=[];return{getId:function(){return b},getBaseUnit:function(){return c},getDuration:function(){return d},getParameter:function(a){return f[a]},setParameter:function(a,b){null==b?delete f[a]:f[a]=b},parse:function(h){if(h){b=h.creativeId||null;c=h.baseUnit||null;d=1*h.duration;var i;
if(h.parameters)if(h.parameters.constructor===Array)for(var j=0,k=h.parameters||[];j<k.length;j++)i=k[j],f[i.name]=i.value;else"object"===typeof h.parameters&&(f=a.Util.copy(h.parameters));for(j=0,k=h.creativeRenditions||[];j<k.length;j++){i=k[j];h=new a.CreativeRendition;h.parse(i);h.setDuration(d);h.setBaseUnit(c);for(name in f)h.setParameter(name,f[name]);g.push(h)}}},getAllCreativeRenditions:function(){return g},addCreativeRendition:function(a){g.push(a)},getEligibleCreativeRenditionsForAdInstance:function(a){var b=
[],c=[],d,f;for(f=0;f<g.length;f++)d=g[f],d.getId()==a._creativeRenditionId&&d.getReplicaId()==a._replicaId&&b.push(d),""==d.getReplicaId()&&c.push(d);return 0==b.length?c:b},cloneForTranslation:function(){var g=new a.Creative;g.parse({creativeId:b,baseUnit:c,duration:d,parameters:a.Util.copy(f)});return g}}};a.CreativeRendition=function(){var b=null,c="None",d=null,f="",g=null,h=null,i=null,j=null,k=null,m=null,l={},n=null,q=[],C=null;return{getId:function(){return b},getCreativeApi:function(){return c},
setCreativeApi:function(a){c=a||"None"},getReplicaId:function(){return f},getContentType:function(){return g?g:n&&n.getContentType()?n.getContentType():null},setContentType:function(a){g=a},getWrapperType:function(){return h},setWrapperType:function(a){h=a},getWrapperUrl:function(){return i},setWrapperUrl:function(a){i=a},getBaseUnit:function(){return d},setBaseUnit:function(a){d=a},getPreference:function(){return j},setPreference:function(a){j=a},getWidth:function(){return k},setWidth:function(a){k=
a},getHeight:function(){return m},setHeight:function(a){m=a},getDuration:function(){return C},setDuration:function(a){C=a},getParameter:function(a){return l[a]},setParameter:function(a,b){null==b?delete l[a]:l[a]=b},getPrimaryCreativeRenditionAsset:function(){return n},getOtherCreativeRenditionAssets:function(){return q.slice()},addCreativeRenditionAsset:function(b,c){var d=new a.CreativeRenditionAsset;d.setName(b);c?n=d:q.push(d);return d},parse:function(d){if(d){b=d.creativeRenditionId||null;c=
d.creativeApi||"None";f=d.hasOwnProperty("adReplicaId")?d.adReplicaId:"";g=d.contentType||null;h=d.wrapperType||null;i=d.wrapperUrl||null;j=1*d.preference;k=1*d.width;m=1*d.height;for(var C,t=0,z=d.parameters||[];t<z.length;t++)C=z[t],l[C.name]=C.value;n=new a.CreativeRenditionAsset;n.parse(d.asset);for(t=0,z=d.otherAssets||[];t<z.length;t++)C=z[t],d=new a.CreativeRenditionAsset,d.parse(C),q.push(d)}}}};a.CreativeRenditionAsset=function(){var a=null,c=null,d=null,f=null,g=null,h=null;return{getName:function(){return a},
setName:function(c){a=c},getUrl:function(){return c},setUrl:function(a){c=a},getContent:function(){return d},setContent:function(a){d=a},getContentType:function(){return f},setContentType:function(a){f=a},getMimeType:function(){return g},setMimeType:function(a){g=a},getBytes:function(){return h},setBytes:function(a){h=a},parse:function(i){i&&(a=i.name||null,c=i.url||null,d=i.content||null,f=i.contentType||null,g=i.mimeType||null,h=1*i.bytes)}}};a.AdInstance=function(b){this._context=b;this._creativeRenditionId=
this._creativeId=this._soAdUnit=this._adId=this._slot=null;this._replicaId="";this._primaryCreativeRendition=this._creative=null;this._creativeRenditions=[];this._noLoad=!1;this._companionAdInstances=[];this._eventCallbacks=[];this._externalEventCallbackUrlsDictionary={};this._rendererController=new a.RendererController(b,this);this._timer=new a.Timer;this._metr=0;this._state=a.MediaInitState.instance;this._isStartSuccessfully=this._translated=this._isImpressionSent=this._isInitiatedSent=!1;this._lastDurationFromRenderer=
-1;this._slotCustomId=this._parentAdInstancesGroup=null;this._isSkipped=!1};a.AdInstance.prototype={};a.AdInstance.prototype.constructor=a.AdInstance;a.METR_MASK_QUARTILE=0;a.METR_MASK_MIDPOINT=1;a.METR_MASK_COMPLETE=2;a.METR_MASK_VOLUME=3;a.METR_MASK_SIZE=4;a.METR_MASK_CONTROL=5;a.METR_MASK_REWIND=6;a.METR_MASK_ACCEPT_INVITATION=7;a.METR_MASK_CLOSE=8;a.METR_MASK_MINIMIZE=9;a.METR_MASK_CLICK=10;a.AdInstance._metrDictionary={};a.AdInstance._metrDictionary[a.EVENT_AD_FIRST_QUARTILE]=a.AdInstance._metrDictionary[a.EVENT_AD_THIRD_QUARTILE]=
a.AdInstance._metrDictionary[a.EVENT_AD_QUARTILE]=1<<a.METR_MASK_QUARTILE|1<<a.METR_MASK_MIDPOINT|1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_MIDPOINT]=1<<a.METR_MASK_MIDPOINT|1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_COMPLETE]=1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_MUTE]=1<<a.METR_MASK_VOLUME;a.AdInstance._metrDictionary[a.EVENT_AD_UNMUTE]=1<<a.METR_MASK_VOLUME;a.AdInstance._metrDictionary[a.EVENT_AD_COLLAPSE]=1<<a.METR_MASK_SIZE;
a.AdInstance._metrDictionary[a.EVENT_AD_EXPAND]=1<<a.METR_MASK_SIZE;a.AdInstance._metrDictionary[a.EVENT_AD_PAUSE]=1<<a.METR_MASK_CONTROL;a.AdInstance._metrDictionary[a.EVENT_AD_RESUME]=1<<a.METR_MASK_CONTROL;a.AdInstance._metrDictionary[a.EVENT_AD_REWIND]=1<<a.METR_MASK_REWIND;a.AdInstance._metrDictionary[a.EVENT_AD_ACCEPT_INVITATION]=1<<a.METR_MASK_ACCEPT_INVITATION;a.AdInstance._metrDictionary[a.EVENT_AD_CLOSE]=1<<a.METR_MASK_CLOSE;a.AdInstance._metrDictionary[a.EVENT_AD_MINIMIZE]=1<<a.METR_MASK_MINIMIZE;
a.AdInstance._metrDictionary[a.EVENT_AD_CLICK]=1<<a.METR_MASK_CLICK;a.Util.mixin(a.AdInstance.prototype,{getAdId:function(){return this._adId},getSoAdUnit:function(){return this._soAdUnit},getEventCallbackUrls:function(b,c){var d=[],f=c===a.EVENT_TYPE_CLICK,g=c===a.EVENT_TYPE_CLICK_TRACKING,h=a.EventCallback.getEventCallback(this._eventCallbacks,b,g?a.EVENT_TYPE_CLICK:c);if(!h)return d;var i={};i[a.INFO_KEY_NEED_EMPTY_CT]=!0;f?h._showBrowser&&d.push(h.getUrl(i)):g?h._showBrowser||d.push(h.getUrl(i)):
d.push(h.getUrl(i));f||(d=d.concat(h.getTrackingUrls()));return d},addEventCallbackUrls:function(a,c,d){d&&this._isValidEventNameAndType(a,c)&&(this._externalEventCallbackUrlsDictionary[c+"-"+a]=this.getExternalEventCallbackUrls(a,c).concat(d||[]))},setClickThroughUrl:function(b,c){if(c&&this._isValidEventNameAndType(b,a.EVENT_TYPE_CLICK)){var d=this.getEventCallback(b,a.EVENT_TYPE_CLICK);if(d){if(!a.Util.isParameterInURL(d._url,a.URL_PARAMETER_KEY_CR))d._url=d._url+"&"+a.URL_PARAMETER_KEY_CR+"=";
d._url=a.Util.setParameterInURL(d._url,a.URL_PARAMETER_KEY_CR,c);d._showBrowser=!0}}},addCreativeRendition:function(){var b=new a.CreativeRendition;b.parse({creativeRenditionId:this._creativeRenditionId,preference:0});b.setBaseUnit(this._creative.getBaseUnit());b.setDuration(this._creative.getDuration());this._creativeRenditions.push(b);if(this.isPlaceholder())this._noLoad=!1;return b},getRendererController:function(){return this._rendererController},getSlot:function(){if(!this._slot)this._slot=this._context._adResponse.getSlotByCustomId(this._slotCustomId);
return this._slot},getCompanionSlots:function(){for(var a=[],c=0;c<this._companionAdInstances.length;c++)a.push(this._companionAdInstances[c]._slot);return a},getActiveCreativeRendition:function(){return this._primaryCreativeRendition},setActiveCreativeRendition:function(b){b?(-1==this._creativeRenditions.indexOf(b)&&this._creativeRenditions.push(cr),this._primaryCreativeRendition=b,this._creativeRenditionId=b.getId()):a.warn("AdInstance.setActiveCreativeRendition","rendition is null")},getAllCreativeRenditions:function(){var a=
this._creativeRenditions.slice();a.sort(function(a,b){return b.getPreference()-a.getPreference()});var c=a.indexOf(this._primaryCreativeRendition);-1<c&&(a.splice(c,1),a.unshift(this._primaryCreativeRendition));return a},getRenderableCreativeRenditions:function(){var a=this._creativeRenditions.slice().sort(function(a,b){return b.getPreference()-a.getPreference()}).filter(function(a){return this._rendererController.rendererMatch(a)},this),c=a.indexOf(this._primaryCreativeRendition);-1<c&&(a.splice(c,
1),a.unshift(this._primaryCreativeRendition));return a},getPlayheadTime:function(){var b=-1;if(this._rendererController.getRenderer()&&"function"===typeof this._rendererController.getRenderer().getPlayheadTime)try{b=this._rendererController.getRenderer().getPlayheadTime()}catch(c){a.warn("AdInstance.getPlayheadTime",c.description)}return b},getDuration:function(){var a=-1;if(this._rendererController.getRenderer()&&"function"===typeof this._rendererController.getRenderer().getDuration)this._lastDurationFromRenderer=
a=this._rendererController.getRenderer().getDuration();-1===a&&(a=-1<this._lastDurationFromRenderer?this._lastDurationFromRenderer:this.getActiveCreativeRendition().getDuration());return a},parse:function(b){if(b){this._adId=b.adId;this._creativeId=b.creativeId;this._creativeRenditionId=b.creativeRenditionId;this._replicaId=b.hasOwnProperty("replicaId")?b.replicaId:"";this._noLoad=this._context._adResponse.getAd(this._adId).getNoLoad();this._soAdUnit=this._context._adResponse.getAd(this._adId).getSoAdUnit();
this._creative=this._context._adResponse.getCreative(this._adId,this._creativeId);this._creativeRenditions=this._creative.getEligibleCreativeRenditionsForAdInstance(this);var c,d;for(c=0,d=b.eventCallbacks||[];c<d.length;c++){iter=d[c];var f=a.EventCallback.newEventCallback(this._context,iter.name,iter.type);if(f)f._adInstance=this,f.parse(iter),this._eventCallbacks.push(f)}for(c=0,d=b.companionAds||[];c<d.length;++c)if((iter=d[c])&&iter.adSlotCustomId)f=new a.AdInstance(this._context),f._slotCustomId=
iter.adSlotCustomId,f.parse(iter),this._companionAdInstances.push(f);for(c=0,d=b.fallbackAds||[];c<d.length;++c)iter=d[c],f=new a.AdInstance(this._context),this._parentAdInstancesGroup.push(f),f._slot=this._slot,f._parentAdInstancesGroup=this._parentAdInstancesGroup,f.parse(iter);if(0<this._creativeRenditions.length)this._primaryCreativeRendition=this._creativeRenditions[0]}},play:function(){a.log("AdInstance.play "+this._slotCustomId);this._timer.tick();this.processEvent(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION);
if(!this._isStartSuccessfully)a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION,{adInstance:this,slotCustomId:this._slotCustomId}),this._isStartSuccessfully=!0;this._state.play(this);if(this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]===a.MODULE_TYPE_RENDERER)for(var b=0;b<this._companionAdInstances.length;b++)this._companionAdInstances[b].isPlaceholder()||this._companionAdInstances[b].getSlot().playCompanionAds(this._companionAdInstances[b])},
pause:function(){a.log("AdInstance.pause "+this._slotCustomId);this._isStartSuccessfully?this._rendererController&&this._rendererController.pause():a.log("Ad hasn't started yet. Ignore.")},resume:function(){a.log("AdInstance.resume"+this._slotCustomId);this._isStartSuccessfully?this._rendererController&&this._rendererController.resume():a.log("Ad hasn't started yet. Ignore.")},skip:function(){a.log("AdInstance.skip");"VPAID"!=this.getActiveCreativeRendition().getCreativeApi()?(this._isSkipped=!0,
this.processEvent(a.EVENT_AD_SKIPPED,a.EVENT_TYPE_GENERIC),this.stop()):a.log("VPAID creative, skip has been implemented inside of VPAID")},stop:function(){a.log("AdInstance.stop");this._rendererController.stop()},fakeComplete:function(){if(this._slot.getTimePositionClass()===a.TIME_POSITION_CLASS_DISPLAY)this._isStartSuccessfully=!1,this._slot.playNextAdInstance()},complete:function(){this._isStartSuccessfully&&(this.processEvent(a.EVENT_AD_IMPRESSION_END,a.EVENT_TYPE_IMPRESSION),a.MODULE_TYPE_RENDERER===
this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION_END,{adInstance:this}));this._state.complete(this);this._rendererController._restorePlaceholdersForHybrid();this._rendererController.setRenderer(null);this._isStartSuccessfully=!1;this._slot.playNextAdInstance()},isStarted:function(){return this._isStartSuccessfully},onStartPlaying:function(){a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]?
this._isImpressionSent=!0:this._translated=!0},onCompletePlaying:function(){},onStartReplaying:function(){},onCompleteReplaying:function(){},getEventCallback:function(b,c){return a.EventCallback.getEventCallback(this._eventCallbacks,b,c)},processEvent:function(b,c,d,f){var g=!0,c=this.getEventCallback(b,c);b===a.EVENT_AD_IMPRESSION&&this._isStartSuccessfully&&(c=this.getEventCallback(a.EVENT_ERROR,a.EVENT_TYPE_ERROR),d={errorInfo:"Trying to send defaultImpression multiple times"},g=!1);c?f||c.process(d):
g=!1;b===a.EVENT_AD_CLICK&&this._context.dispatchEvent(a.EVENT_AD_CLICK,{adInstance:this});if(b!=a.EVENT_AD_IMPRESSION&&b!=a.EVENT_AD_IMPRESSION_END||a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE])f={subType:b,adInstance:this,slot:this._slot},b===a.EVENT_ERROR&&(f[a.INFO_KEY_ERROR_CODE]=d[a.INFO_KEY_ERROR_CODE],f[a.INFO_KEY_ERROR_INFO]=d[a.INFO_KEY_ERROR_INFO],f[a.INFO_KEY_ERROR_MODULE]=d[a.INFO_KEY_ERROR_MODULE]),this._context.dispatchEvent(a.EVENT_AD,
f);return g},setVolume:function(b){a.debug("AdInstance.setVolume("+b+")");this.isStarted()&&"function"===typeof this._rendererController.getRenderer().setVolume&&this._rendererController.getRenderer().setVolume(b)},setMetr:function(b,c){var d=a.AdInstance._metrDictionary[b];if(d)b===a.EVENT_AD_CLICK&&(c=!c),this._metr=c===a.CAPABILITY_STATUS_ON||!0===c?this._metr|d:this._metr&~d},getExternalEventCallbackUrls:function(a,c){return(this._externalEventCallbackUrlsDictionary[c+"-"+a]||[]).slice()},reset:function(){this._rendererController.reset();
for(var b=0;b<this._companionAdInstances.length;b++){var c=this._companionAdInstances[b];(c._state===a.MediaPlayingState.instance||c._state===a.MediaReplayingState.instance)&&c.stop();c._rendererController.reset()}},cloneForTranslation:function(){var b=new a.AdInstance(this._context);b._parent=this;b._adId=this._adId;b._creativeId=this._creativeId;b._creative=this._creative.cloneForTranslation();b._creativeRenditionId=this._creativeRenditionId;b._isInitiatedSent=this._isInitiatedSent;b._noLoad=this._noLoad;
b._slot=this.getSlot();b._soAdUnit=this.getSoAdUnit();for(var c=0;c<this._eventCallbacks.length;c++){var d=this._eventCallbacks[c].copy();d._adInstance=b;b._eventCallbacks.push(d)}b._externalEventCallbackUrlsDictionary=a.Util.copy(this._externalEventCallbackUrlsDictionary);for(c=0;c<this._companionAdInstances.length;c++)this._companionAdInstances[c].isPlaceholder()?b._companionAdInstances.push(this._companionAdInstances[c].cloneForTranslation()):b._companionAdInstances.push(this._companionAdInstances[c]);
return b},isPlaceholder:function(){return this._noLoad},setMediaState:function(a){this._state=a},_isValidEventNameAndType:function(b,c){return a.Util.isBlank(b)||a.Util.isBlank(c)?!1:c===a.EVENT_TYPE_CLICK||c===a.EVENT_TYPE_CLICK_TRACKING||c===a.EVENT_TYPE_IMPRESSION&&(b===a.EVENT_AD_IMPRESSION||b===a.EVENT_AD_FIRST_QUARTILE||b===a.EVENT_AD_MIDPOINT||b===a.EVENT_AD_THIRD_QUARTILE||b===a.EVENT_AD_COMPLETE)||c===a.EVENT_TYPE_STANDARD&&(b===a.EVENT_AD_PAUSE||b===a.EVENT_AD_RESUME||b===a.EVENT_AD_REWIND||
b===a.EVENT_AD_MUTE||b===a.EVENT_AD_UNMUTE||b===a.EVENT_AD_COLLAPSE||b===a.EVENT_AD_EXPAND||b===a.EVENT_AD_MINIMIZE||b===a.EVENT_AD_CLOSE||b===a.EVENT_AD_ACCEPT_INVITATION)||c===a.EVENT_TYPE_ERROR&&b===a.EVENT_ERROR},isPlayable:function(){var b;b=!(this._rendererController.getRendererState()==a.RendererFailedState.instance&&!this._isImpressionSent);if(!b)return a.debug("AdInstance.isPlayable returning false isImpressionSent:",this._isImpressionSent),b;(b=b&&!this._translated)||a.debug("AdInstance.isPlayable returning false translated:",
this._translated);return b},toString:function(){return"[AdInstance "+this._adId+"]"},getCompanionAdInstances:function(){for(var a=[],c=0;c<this._companionAdInstances.length;++c)this._companionAdInstances[c].isPlaceholder()||a.push(this._companionAdInstances[c]);return a},isRequiredToShow:function(){return this._context._adResponse.getAd(this._adId).isRequiredToShow()}});a.AdManager=function(){var b=this;this._context=this.newContext();this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,function(a){b.onRequestComplete(a)});
this._networkId=this._serverURL="";this._onRequestComplete=this._location=null};a.AdManager.prototype={getVersion:function(){if(a.version){var b=a.version.match(/^js-(\d)\.(\d)\.(\d).(\d)/)||a.version.match(/^js-(\d)\.(\d)\.(\d)/)||a.version.match(/^js-(\d)\.(\d)/);if(null!=b&&0<b.length){for(var c=0,d=0;d<b.length-1;d++)c+=b[b.length-d-1]<<(d<<3);return c}if(0===a.version.indexOf("js-master"))return 4294967295}return 0},setNetwork:function(b){a.debug("AdManager.setNetwork("+Array.prototype.slice.call(arguments).join(",")+
")");if(0<1*b){this._networkId=1*b;for(var c in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(c)){var d=a._instanceQueue[c];d&&d._videoAsset._videoPlayPending&&d._videoAsset.play()}}else a.warn("AdManager.setNetwork","valid networkId required")},setServerURL:function(b){a.debug("AdManager.setServerURL("+Array.prototype.slice.call(arguments).join(",")+")");a.warn("AdManager.setServerURL method is DEPRECATED, use AdManager.setServer instead.");this.setServer(b)},setServer:function(b){a.debug("AdManager.setServer("+
Array.prototype.slice.call(arguments).join(",")+")");if(!b||"string"!==typeof b)a.warn("AdManager.setServer","server url required");else{this._serverURL=b;for(var c in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(c)){var d=a._instanceQueue[c];d&&d._videoAsset._videoPlayPending&&d._videoAsset.play()}}},setLocation:function(b){a.debug("AdManager.setLocation("+Array.prototype.slice.call(arguments).join(",")+")");this._location=b},newContext:function(){a.debug("AdManager.newContext("+Array.prototype.slice.call(arguments).join(",")+
")");return new a.Context(this)},newContextWithContext:function(b){a.debug("AdManager.newContextWithContext("+Array.prototype.slice.call(arguments).join(",")+")");var c=this.cloneContext(b);c._temporalSlotBase=b._temporalSlotBase;b.getContentVideoElement()&&(c.setContentVideoElement(b.getContentVideoElement()),delete c._temporalSlotBase["_fw_contentVideo_"+b._instanceId]);c._videoDisplaySize=b._videoDisplaySize;c._overriddenAdRenderers=b._overriddenAdRenderers;c._currentContentPlayheadTime=b._currentContentPlayheadTime;
c.startSubsession(b._adRequest._subsessionToken);c.setRequestMode(b._adRequest._requestMode);c._adRequest._compatibleDimensions=b._adRequest._compatibleDimensions;c._videoAsset._state=b._videoAsset._state;c._videoAsset._callbackTimer=b._videoAsset._callbackTimer;c._videoAsset._videoPlayPending=b._videoPlayPending;c._videoAsset._requestedVideoViewUrl=b._videoAsset._requestedVideoViewUrl;c._videoAsset._delay=b._videoAsset._delay;c._videoAsset._durationType=b._videoAsset._durationType;var d=b._extensionManager.extensions,
f;for(f in d)c.loadExtension(d[f]);return this._context=c},setParameter:function(b,c,d){a.debug("AdManager.setParameter("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setParameter(b,c,d)},getParameter:function(a){return this._context.getParameter(a)},submitRequest:function(b,c){a.debug("AdManager.submitRequest()");b&&"function"===typeof b?this._onRequestComplete=b:a.warn("AdManager.submitRequest(): callback function required");this._context.submitRequest(c/1E3)},onRequestComplete:function(b){a.debug("AdManager.onRequestComplete("+
Array.prototype.slice.call(arguments).join(",")+")");if(this._onRequestComplete)this._onRequestComplete({success:b.success,response:b.response}),this._onRequestComplete=null},registerVideoDisplayBase:function(b){a.debug("AdManager.registerVideoDisplayBase("+Array.prototype.slice.call(arguments).join(",")+")");this._context.registerVideoDisplayBase(b)},setVideoAsset:function(b,c){a.debug("AdManager.setVideoAsset("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setVideoAsset(b,c)},
setSiteSection:function(b){a.debug("AdManager.setSiteSection("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setSiteSection(b)},addKeyValue:function(b,c){a.debug("AdManager.addKeyValue("+Array.prototype.slice.call(arguments).join(",")+")");this._context.addKeyValue(b,c)},setVideoDisplayCompatibleSizes:function(b){a.debug("AdManager.setVideoDisplayCompatibleSizes("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setVideoDisplayCompatibleSizes(b)},playSlots:function(b,
c){a.warn("AdManager.playSlots() has DEPRECATED, use tv.freewheel.SDK.Slot.Play() instead");a.debug("AdManager.playSlots("+b+")");"string"===typeof b&&(b=b.toUpperCase());this._playSlots(b,c)},_playSlots:function(b,c){"function"!==typeof c&&(c=function(){});if(this._context._adResponse){for(var d=[],f=this._context.getTemporalSlots(),g=0;g<f.length;++g){var h=f[g];(0.1>Math.abs(h.getTimePosition()-b)||b===h.getTimePositionClass())&&d.push(h)}if(0===d.length)a.warn("AdManager.playSlots","no slot matches",
b),c();else if(b===a.TIME_POSITION_CLASS_OVERLAY)for(g=0;g<d.length;g++)(function(a){if(!a._onContentVideoTimeUpdate){var b=this._context.getContentVideoElement(),c=a._onContentVideoTimeUpdate=function(){!b.paused&&!0!==b._fw_videoAdPlaying&&0<=b.currentTime-a.getTimePosition()&&1>b.currentTime-a.getTimePosition()&&(b.removeEventListener("timeupdate",c,!1),a._play(function(){var d=setInterval(function(){!b.paused&&2<Math.abs(b.currentTime-a.getTimePosition())&&(b.addEventListener("timeupdate",c,!1),
clearInterval(d))},1E3)}))};b.addEventListener("timeupdate",c,!1)}})(d[g]);else(function(){var a=d.shift();a?a._play(arguments.callee):c()})()}else a.warn("AdManager._playSlots","request is not completed"),c()},dispose:function(){a.debug("AdManager.dispose()");this._context.dispose();this._onRequestComplete=null},cloneContext:function(a){var c=this.newContext(),d=a._adRequest._capabilities._capabilities,f;for(f in d)d.hasOwnProperty(f)&&c.setCapability(f,d[f]);c.setProfile(a._adRequest._playerProfile);
c.setSiteSection(a._ss_id,a._ss_networkId,a._ss_pageViewRandom,a._ss_idType,a._ss_fallbackId);c.setVideoAsset(a._va_id,a._va_duration,a._va_networkId,a._va_location,a._va_autoPlayType,a._va_viewRandom,a._va_idType,a._va_fallbackId,a._va_durationType);c.setVisitor(a._adRequest._visitorCustomId,a._adRequest._visitorIpV4Address);return c}};a.AdManager.prototype.constructor=a.AdManager;a.AdRequest=function(b){this._context=b;this._capabilities=new a.Capabilities;this._keyValues=[];this._playerProfile=
"";this._compatibleDimensions=null;this._temporalSlots=[];this._siteSectionId=this._siteSectionCustomId="";this._siteSectionNetworkId=0;this._siteSectionFallbackId="";this._siteSectionViewRandom=0;this._requestMode=this._visitorIpV4Address=this._visitorCustomId="";this._subsessionToken=this._requestDuration=0;this._candidateAdIds=[];this._slotScanner=new a.PageSlotScanner(b);this._urlParams={};this._urlKeyValues=[];this._customInfo=""};a.AdRequest.prototype={setCapability:function(a,c){this._capabilities.setCapability(a,
c)},addKeyValue:function(b,c){if("string"!==typeof b||"string"!==typeof c||0===b.length)a.warn("AdRequest.addKeyValue:","key and value required");else{var d=encodeURIComponent(b)+"="+encodeURIComponent(c);0>this._keyValues.indexOf(d)&&this._keyValues.push(d)}},setProfile:function(b){"string"!==typeof b?a.warn("AdRequest.setProfile:","player profile required"):this._playerProfile=b},setVideoDisplayCompatibleSizes:function(b){if(!b||!b.length)a.warn("AdRequest.setVideoDisplayCompatibleSizes:","compatible dimensions required");
else{for(var c=[],d={},f=0;f<b.length;++f)if(a.debug("dimension is:",b[f].width,"X",b[f].height),0<b[f].width&&0<b[f].height){var g=b[f].width+","+b[f].height;null==d[g]&&(d[g]="",c.push(g))}if(0<c.length)this._compatibleDimensions=c.join("|")}},setSiteSection:function(b,c,d,f,g){if(b){switch(f){case a.ID_TYPE_FW:this._siteSectionId=b;break;case a.ID_TYPE_GROUP:this._siteSectionId="g"+b;break;default:this._siteSectionCustomId=b}if(0<1*c)this._siteSectionNetworkId=1*c;if(0<1*d)this._siteSectionViewRandom=
1*d;if("number"===typeof g&&0<g)this._siteSectionFallbackId=""+g;else if("string"===typeof g)this._siteSectionFallbackId=g.trim()}else a.warn("AdRequest.setSiteSection: id required")},setVisitor:function(b,c){if("string"!==typeof b)a.warn("AdRequest.setVisitor:","customId required");else if(this._visitorCustomId=b,"string"===typeof c&&""!==c)this._visitorIpV4Address=c},setRequestMode:function(b){b!==a.REQUEST_MODE_ON_DEMAND&&b!==a.REQUEST_MODE_LIVE?a.warn("AdRequest.setRequestMode:","unknown mode: "+
b):(this._requestMode=b,this._requestMode==a.REQUEST_MODE_LIVE&&0==this._subsessionToken&&this.setSubsessionToken(1E4*Math.random()+1))},setRequestDuration:function(b){"number"!==typeof b?a.warn("AdRequest.setRequestDuration:","request duration required"):(0>b&&(a.warn("AdRequest.setRequestDuration:","requestDuration is negative, reset it to 0"),b=0),this._requestDuration=b)},addCandidateAd:function(b){"number"!==typeof b?a.warn("AdRequest.addCandidateAd:","candidate ad ID required"):0>b?a.warn("AdRequest.addCandidateAd",
"invalid ad ID, ignore"):this._candidateAdIds.push(b)},addTemporalSlot:function(b,c,d,f,g,h,i,j){if(a.Util.isBlank(b)||a.Util.isBlank(c)||0>d)a.warn("AdRequest.addTemporalSlot:","invalid parameters");else{for(var k=0;k<this._temporalSlots.length;k++)if(this._temporalSlots[k].getCustomId()===b){a.warn("AdRequest.addTemporalSlot:","slot is already existed, ignored");return}k=new a.Slot(this._context);k.setCustomId(b);k.setAdUnit(c);k.setTimePosition(d);k.setSlotProfile(f);k.setCuepointSequence(1*g);
k.setMaxDuration(h);k.setMinDuration(i);k.setAcceptContentType(j);this._temporalSlots.push(k)}},setSubsessionToken:function(a){this._subsessionToken=a},scanPageSlots:function(){this._slotScanner.scanPageSlots()},generateTypeBRequestUrl:function(){var b=this._context._adManager._serverURL.split("?"),c=b[0],d=[/fwmrm\.net$/,/fwmrm\.net\/$/,/fwmrm\.net\/ad$/,/fwmrm\.net\/ad\/$/,/fwmrm\.net\/ad\/g$/,/fwmrm\.net\/ad\/g\/$/,/fwmrm\.net\/ad\/g\/1$/];if(0===c.indexOf("http://")||0===c.indexOf("https://"))for(var f=
0;f<d.length;++f)if(c.match(d[f])){c=c.slice(0,c.indexOf("fwmrm.net")+9)+"/ad/g/1";break}this.parseQueryStr(b.slice(1).join("?"));b=this.generateGlobalParametersQueryStr()+";"+this.generateKeyValuesStr()+";";if(!this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION)||1!=this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION))b+=this.generateSlotsTypeBStr();a.Util.isBlank(this._customInfo)||(b+=";"+this._customInfo);return c+"?"+b},generateVideoViewRequestUrlWithDummyContextInstanceId:function(b){this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,
a.CAPABILITY_STATUS_ON);this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_ON);var c=this.generateTypeBRequestUrl(),c=a.Util.setParameterInURL(c,"cbfn","tv.freewheel.SDK._instanceQueue['Context_"+b+"']._videoAsset.requestComplete");a.debug("generateVideoViewRequestUrlWithDummyContextInstanceId():"+c);this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET);this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_UNSET);
return c},parseQueryStr:function(b){a.debug("AdRequest.parseQueryStr("+Array.prototype.slice.call(arguments).join(",")+")");this._urlParams={};this._urlKeyValues=[];this._customInfo="";if(b){";"===b.charAt(b.length-1)&&(b=b.substring(0,b.length-1));var c=b.split(";"),d,f;if(c[0]){d=c[0].split("&");for(f=0;f<d.length;++f){var g=d[f].split("=");2===g.length&&(this._urlParams[g[0]]=g[1])}}if(c[1]){d=c[1].split("&");for(f=0;f<d.length;++f)this._urlKeyValues.push(d[f])}if(c[2])this._customInfo=c.slice(2).join(";")}},
generateGlobalParametersQueryStr:function(){a.debug("AdRequest.generateGlobalParametersQueryStr");for(var b=this._context.getParameter("wrapperVersion"),b=[["prof",this._playerProfile,"string"],["nw",this._context._adManager._networkId,"number"],["caid",this._context._videoAsset._customId,"string"],["asid",this._context._videoAsset._id,"string"],["vdur",this._context._videoAsset._duration,"number"],["asnw",this._context._videoAsset._networkId,"number"],["asml",this._context._videoAsset._location,
"string"],["vprn",this._context._videoAsset._viewRandom,"number"],["afid",this._context._videoAsset._fallbackId,"string"],["vdty",this._context._videoAsset._durationType,"string"],["vtpo",this._context._videoAsset._currentTpos,"number"],["csid",this._siteSectionCustomId,"string"],["ssid",this._siteSectionId,"string"],["ssnw",this._siteSectionNetworkId,"number"],["pvrn",this._siteSectionViewRandom,"number"],["sfid",this._siteSectionFallbackId,"string"],["vcid",this._visitorCustomId,"string"],["mode",
this._requestMode,"string"],["vrdu",this._requestDuration,"number"],["ssto",this._subsessionToken,"number"],["cd",this._compatibleDimensions||this.detectScreenDimension(),"string"],["vclr",a.version+(b?","+b:""),"string"],["resp",a.PLATFORM_SEND_REQUEST_BY_FORM?"json2":"json","string"],["orig",window.location.protocol+"//"+window.location.host,"string"],["cbfn","tv.freewheel.SDK._instanceQueue['Context_"+this._context._instanceId+"'].requestComplete","string"],["vip",this._visitorIpV4Address,"string"],
["cana",this._candidateAdIds.join(","),"string"]],c=0;c<b.length;c++){var d=b[c];switch(d[2]){case "string":a.Util.isBlank(d[1])||(this._urlParams[d[0]]=encodeURIComponent(d[1]));break;case "number":0<d[1]&&(this._urlParams[d[0]]=d[1])}}var b="",f;for(f in this._urlParams)this._urlParams.hasOwnProperty(f)&&(b+=f+"="+this._urlParams[f]+"&");b=b.substring(0,b.length-1);0<this._slotScanner._candidateAds.length&&(null==this._capabilities._capabilities[a.CAPABILITY_CHECK_COMPANION]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_COMPANION,
a.CAPABILITY_STATUS_ON),null==this._capabilities._capabilities[a.CAPABILITY_CHECK_TARGETING]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_TARGETING,a.CAPABILITY_STATUS_OFF));!this._context._videoAsset._eventCallback&&!this._context._videoAsset._requestedVideoViewUrl&&(this._context._videoAsset._id||this._context._videoAsset._customId)&&this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_ON);this._capabilities._capabilities[a.CAPABILITY_DISPLAY_REFRESH]&&this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,
a.CAPABILITY_STATUS_OFF);b=this._capabilities.parseCapabilities(b);this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET);f="";switch(this._context._videoAsset._autoPlayType){case a.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED:f="+play+uapl";break;case a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE:f="-play";break;default:f="+play-uapl"}return b=b.replace(/flag=/,"flag="+encodeURIComponent(f))},generateKeyValuesStr:function(){a.debug("AdRequest.generateKeyValuesStr");for(var b=a.Util.flashVersion(),
b=this._keyValues.concat(["_fw_h_x_flash_version="+encodeURIComponent(b),"_fw_dpr="+(void 0===window.devicePixelRatio?"1":window.devicePixelRatio.toFixed(2).toString())]),c=0;c<this._urlKeyValues.length;c++){var d=this._urlKeyValues[c];0>b.indexOf(d)&&b.push(d)}(c=this._context._adManager._location)&&b.push("ltlg="+encodeURIComponent(Math.round(1E4*c.coords.latitude)/1E4+","+Math.round(1E4*c.coords.longitude)/1E4));return b.join("&")},generateSlotsTypeBStr:function(){a.debug("AdRequest.generateSlotsTypeBStr");
for(var b="",c=[],d=0;d<this._temporalSlots.length;d++){for(var f=this._temporalSlots[d],f=[["slid",f.getCustomId(),"string"],["slau",f.getAdUnit(),"string"],["ptgt","a","string"],["tpos",f.getTimePosition(),"number"],["cpsq",f.getCuepointSequence(),"number"],["envp",f.getSlotProfile(),"string"],["maxd",f.getMaxDuration(),"number"],["mind",f.getMinDuration(),"number"],["prct",f.getAcceptContentType(),"string"]],g=[],h=0;h<f.length;h++){var i=f[h];switch(i[2]){case "string":a.Util.isBlank(i[1])||g.push(i[0]+
"="+encodeURIComponent(i[1]));break;case "number":-1<["cpsq","maxd","mind"].indexOf(i[0])?0<i[1]&&g.push(i[0]+"="+i[1]):0<=i[1]&&g.push(i[0]+"="+i[1])}}c.push(g.join("&"))}0<c.length&&(b=c.join(";")+";");return b+=this._slotScanner.slotsToTypeBStr()},detectScreenDimension:function(){a.debug("AdRequest.detectScreenDimension:",screen.width+","+screen.height);return screen.width+","+screen.height}};a.AdResponse=function(a){this._context=a};a.AdResponse.prototype={};a.AdResponse.prototype.constructor=
a.AdResponse;a.Util.mixin(a.AdResponse.prototype,{parse:function(b,c){this._data=b;this._temporalSlots=[];this._videoPlayerNonTemporalSlots=[];this._siteSectionNonTemporalSlots=[];this._profileParameters={};this._ads=[];this._siteSectionCustomId=a.Util.getObject("siteSection.customId",b)||"";this._adRenderers=[];var d,f,g;f=a.Util.getObject("parameters",b)||[];for(d=0;d<f.length;++d)g=f[d],this._profileParameters[g.name]=g.value;this._adRenderers=a.Util.getObject("rendererManifest.adRenderers.adRenderer",
b)||[];for(d=0;d<this._adRenderers.length;d++)if("undefined"!==typeof this._adRenderers[d].adUnit)this._adRenderers[d].baseUnit=this._adRenderers[d].adUnit,delete this._adRenderers[d].adUnit;f=a.Util.getObject("ads.ads",b)||[];for(d=0;d<f.length;++d)g=new a.Ad(this._context),g.parse(f[d]),this._ads.push(g);f=a.Util.getObject("siteSection.videoPlayer.videoAsset.adSlots",b)||[];for(d=0;d<f.length;++d)g=new a.Slot(this._context),g.setType(a.SLOT_TYPE_TEMPORAL),g.setBase(c),g.parse(f[d]),this._temporalSlots.push(g);
f=a.Util.getObject("siteSection.videoPlayer.adSlots",b)||[];for(d=0;d<f.length;++d)g=new a.Slot(this._context),g.setType(a.SLOT_TYPE_VIDEOPLAYER_NONTEMPORAL),g.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),g.parse(f[d]),this._initSlotData(g),this._videoPlayerNonTemporalSlots.push(g);f=a.Util.getObject("siteSection.adSlots",b)||[];for(d=0;d<f.length;++d)g=new a.Slot(this._context),g.setType(a.SLOT_TYPE_SITESECTION_NONTEMPORAL),g.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),g.parse(f[d]),
this._initSlotData(g),this._siteSectionNonTemporalSlots.push(g);this._context._videoAsset.parse(a.Util.getObject("siteSection.videoPlayer.videoAsset",b)||{})},getCreative:function(a,c){var d=this.getAd(a);return d?d.getCreative(c):null},getAd:function(a){for(var c=0;c<this._ads.length;c++){var d=this._ads[c];if(d.getId()===a)return d}return null},getTemporalSlots:function(){return this._temporalSlots},getSiteSectionNonTemporalSlots:function(){return this._siteSectionNonTemporalSlots},getVideoPlayerNonTemporalSlots:function(){return this._videoPlayerNonTemporalSlots},
getSiteSectionCustomId:function(){return this._siteSectionCustomId},getSlotByCustomId:function(b){for(var c=0;c<this._temporalSlots.length;++c)if(this._temporalSlots[c].getCustomId()===b)return this._temporalSlots[c];for(c=0;c<this._videoPlayerNonTemporalSlots.length;++c)if(this._videoPlayerNonTemporalSlots[c].getCustomId()===b)return this._videoPlayerNonTemporalSlots[c];for(c=0;c<this._siteSectionNonTemporalSlots.length;++c)if(this._siteSectionNonTemporalSlots[c].getCustomId()===b)return this._siteSectionNonTemporalSlots[c];
a.warn("getSlotByCustomId(): not found",b);return null},_initSlotData:function(b){for(var c=!1,d=0;d<this._context._adRequest._slotScanner._knownSlots.length;d++){var f=this._context._adRequest._slotScanner._knownSlots[d];if(b.getCustomId()===f.id&&f.element){b.setWidth(f.width);b.setHeight(f.height);b.setBase(f.element);b.setAcceptCompanion(f.acceptCompanion);b.setInitialAdOption(f.initialAdOption);c=!0;break}}c||a.warn("Failed to init slot "+b.getCustomId());return c}});a.Capabilities=function(){this._capabilities=
{};this.init()};a.Capabilities.prototype={init:function(){for(var b=[a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_MULTIPLE_CREATIVE_RENDITIONS,a.CAPABILITY_FALLBACK_UNKNOWN_ASSET,a.CAPABILITY_FALLBACK_UNKNOWN_SITE_SECTION,a.CAPABILITY_FALLBACK_ADS,a.CAPABILITY_SLOT_CALLBACK,a.CAPABILITY_NULL_CREATIVE,a.CAPABILITY_AUTO_EVENT_TRACKING,a.CAPABILITY_RENDERER_MANIFEST],c=0;c<b.length;c++)this._capabilities[b[c]]=a.CAPABILITY_STATUS_ON},setCapability:function(a,c){this._capabilities[a]=c},getCapability:function(a){return this._capabilities[a]},
parseCapabilities:function(b){var c="",d;for(d in this._capabilities)if(this._capabilities.hasOwnProperty(d)){switch(this._capabilities[d]){case a.CAPABILITY_STATUS_ON:c+="+"+d;break;case a.CAPABILITY_STATUS_OFF:c+="-"+d}b=b.replace(RegExp("(%2B|-|\\+)"+d,"g"),"")}c=encodeURIComponent(c);return b=-1<b.indexOf("flag=")?b.replace(/flag=/,"flag="+c):b+("&flag="+c)}};a.ContentVideoExtension=function(){this.autoSourceRestore=this.respondPauseResume=!0;this._originalTime=0;this._contentVideoControls=this._contentVideoSrc=
null};a.ContentVideoExtension.prototype={_isEnabled:function(){var b=this._context.getParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED);return(null===b||!0===a.Util.str2bool(b))&&null!==this._context.getContentVideoElement()},_getBooleanParameter:function(b,c){var d=this._context.getParameter(b);null==d&&(d=c);return a.Util.str2bool(d)},init:function(b){a.debug("ContentVideoExtension.init(context)");this._context=b;this._fixContentVideoCurrentTime=a.Util.bind(this,function(){if(!(0>=this._context.getContentVideoElement().currentTime||
0>=this._context.getContentVideoElement().seekable.length))if(this._context.getContentVideoElement().removeEventListener("timeupdate",this._fixContentVideoCurrentTime,!1),0<this._context.getContentVideoElement().currentTime&&1>this._context.getContentVideoElement().currentTime&&1<this._originalTime){a.log("ContentVideoExtension: seeking to original time",this._originalTime);try{this._context.getContentVideoElement().currentTime=this._originalTime}catch(b){a.warn("ContentVideoExtension: seek error")}}});
this._pause=a.Util.bind(this,function(){if(this._isEnabled()){if(this._respondPauseResume())a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_PAUSE_REQUEST pausing content video",this._context.getContentVideoElement().src),this._originalTime=this._context.getContentVideoElement().currentTime,this._context.getContentVideoElement().pause()}else a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});this._resume=a.Util.bind(this,function(){this._isEnabled()?this._respondPauseResume()&&
(a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_RESUME_REQUEST resume content video",this._context.getContentVideoElement().src),this._context._videoAsset&&(null==this._context._videoAsset._state||this._context._videoAsset._state===a.VIDEO_STATE_COMPLETED)?a.warn("ContentVideoExtension: video state is uninitialized or completed, skip resume."):(a.log("ContentVideoExtension: resume content video"),this._context.getContentVideoElement().play(),a.PLATFORM_AUTO_SEEK_AFTER_MIDROLL&&!0===this._getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SEEK_BACK,
!0)&&this._context.getContentVideoElement().addEventListener("timeupdate",this._fixContentVideoCurrentTime,!1))):a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});this._onAttach=a.Util.bind(this,function(b){if(this._isEnabled()){if(this._autoSourceRestore())switch(b.slot.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: store current content video src",this._context.getContentVideoElement().src),this._contentVideoSrc=
this._context.getContentVideoElement().src,this._contentVideoControls=this._context.getContentVideoElement().controls,this._context.getContentVideoElement().paused||this._context.getContentVideoElement().pause()}}else a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});this._onDetach=a.Util.bind(this,function(b){if(this._isEnabled()){if(this._autoSourceRestore())switch(b=b.slot.getTimePositionClass(),b){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: restore content video src to",
this._contentVideoSrc);if(this._context.getContentVideoElement().src!==this._contentVideoSrc)this._context.getContentVideoElement().src=this._contentVideoSrc;this._context.getContentVideoElement().controls=this._contentVideoControls;b===a.TIME_POSITION_CLASS_PREROLL&&this._context.getContentVideoElement().load()}}else a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});a.debug("ContentVideoExtension: enabling content video pause resume request handling.");this._context.addEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,
this._pause);this._context.addEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,this._resume);a.debug("ContentVideoExtension: enabling content video source management.");this._context.addEventListener(a.EVENT_SLOT_STARTED,this._onAttach);this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onDetach)},_respondPauseResume:function(){return this._getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_RESPOND_PAUSE_RESUME,!0)},_autoSourceRestore:function(){return this._getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SOURCE_RESTORE,
!0)},dispose:function(){a.debug("ContentVideoExtension.dispose()");if(this._context)this._context.removeEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,this._pause),this._context.removeEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,this._resume),this._context.removeEventListener(a.EVENT_SLOT_STARTED,this._onAttach),this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onDetach),this._context=null}};a.ContentVideoExtension.prototype.constructor=a.ContentVideoExtension;a._instanceCounter=
0;a._instanceQueue={};a.Context=function(b){this._adManager=b;this._eventDispatcher=new a.EventDispatcher;this._adRequest=new a.AdRequest(this);this._adResponse=null;this._videoAsset=new a.VideoAsset(this);this._temporalSlotBase=null;this._videoDisplaySize={};this._globalLevelParameterDictionary={};this._overrideLevelParameterDictionary={};this._rendererManifest={};this._overriddenAdRenderers=[];this._extensionManager=new a.ExtensionManager(this);this._totalSetDisplaySizeCount=this._autoSetDisplaySizeCount=
this._requestState=0;this._instanceId=a._instanceCounter;a._instanceQueue["Context_"+a._instanceCounter]=this;a._instanceCounter++;this._contentVideoAttached=!1;this._currentContentPlayheadTime=0;this._ss_id="";this._ss_networkId=this._ss_pageViewRandom=0;this._ss_idType=a.ID_TYPE_CUSTOM;this._va_location=this._va_networkId=this._va_duration=this._va_id=this._ss_fallbackId="";this._va_autoPlayType=a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED;this._va_fallbackId="";this._va_viewRandom=0;this._va_idType=a.ID_TYPE_CUSTOM;
this._va_durationType=a.VIDEO_ASSET_DURATION_TYPE_EXACT;this._isRefreshRequest=!1;this._refreshSlots=[];this._adVolume=1;this._onVolumeChange=this.__onVolumeChange.bind(this)};a.Context.prototype={getAdVolume:function(){return this._adVolume},setAdVolume:function(b){a.debug("Context.setAdVolume",b);if(this.getContentVideoElement())if("number"!==typeof b||0>b||1<b)a.debug("Invalid volume: "+b);else if((a.PLATFORM_IS_IPHONE_IPOD||a.PLATFORM_IS_IPAD)&&0<b&&1>b)a.debug("iOS doesn't allow volume values other than 0 and 1, ignore.");
else if(b==this._adVolume)a.debug("Volume did not change, ignore.");else{this._adVolume=b;for(var b=this.getTemporalSlots(),c=0;c<b.length;++c){var d=b[c];if(d.getType()==a.SLOT_TYPE_TEMPORAL&&d.getState()!==a.MediaInitState.instance&&d.getState()!==a.MediaEndState.instance){(b=d.getCurrentAdInstance())&&b.setVolume(this._adVolume);break}}}else a.debug("No video element set, ignore.")},__onVolumeChange:function(){a.debug("Context._onVolumeChange(): video element is muted: "+this.getContentVideoElement().muted);
0==this._adVolume?this.setAdVolume(this.getContentVideoElement().volume):this.setAdVolume(this.getContentVideoElement().muted?0:this.getContentVideoElement().volume)},addRenderer:function(a,c,d,f,g,h,i){this._overriddenAdRenderers.push({url:a,baseUnit:c,contentType:d,creativeApi:h,slotType:f,soAdUnit:g,parameter:i})},setCapability:function(b,c){a.debug("Context.setCapability",b,c);this._adRequest.setCapability(b,c)},addKeyValue:function(b,c){a.debug("Context.addKeyValue",b,c);this._adRequest.addKeyValue(b,
c)},setParameter:function(b,c,d){a.debug("Context.setParameter",b,c,d);var f=null;if(d===a.PARAMETER_LEVEL_GLOBAL)f=this._globalLevelParameterDictionary;else if(d===a.PARAMETER_LEVEL_OVERRIDE)f=this._overrideLevelParameterDictionary;else return;null==c?delete f[b]:f[b]=c},getParameter:function(a){return!a?null:this._overrideLevelParameterDictionary.hasOwnProperty(a)?this._overrideLevelParameterDictionary[a]:this._adResponse&&this._adResponse._profileParameters.hasOwnProperty(a)?this._adResponse._profileParameters[a]:
this._globalLevelParameterDictionary.hasOwnProperty(a)?this._globalLevelParameterDictionary[a]:null},setVideoState:function(b){a.debug("Context.setVideoState",b);this._videoAsset.setVideoState(b)},registerVideoDisplayBase:function(b){a.debug("Context.registerVideoDisplayBase",b);if(!b||"string"!==typeof b)a.warn("Context.registerVideoDisplayBase","id required");else{if(this._temporalSlotBase&&this._temporalSlotBase.id===b){a.debug("Context.registerVideoDisplayBase","register the same display base, will only change size");
var c=this._temporalSlotBase.getElementsByTagName("video")}else{this._temporalSlotBase=document.getElementById(b);if(!this._temporalSlotBase){a.warn("Context.registerVideoDisplayBase","could not get element",b);return}c=this._temporalSlotBase.getElementsByTagName("video");if(0===c.length){a.warn("Context.registerVideoDisplayBase","could not get video element from",b);this._temporalSlotBase=null;return}this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=c[0];this.getContentVideoElement().addEventListener("volumechange",
this._onVolumeChange);this._adVolume=c[0].muted?0:c[0].volume}this._setVideoDisplaySizeByContentVideo(c[0])}},setContentVideoElement:function(b){a.debug("Context.setContentVideoElement()");!b||!b.parentNode?a.warn("Context.setContentVideoElement","contentVideo and contentVideo.parentNode is required"):(this._temporalSlotBase=b.parentNode,this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]===b?a.debug("Context.setContentVideoElement","set the same video in same div, will only change size"):
(this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=b,this.getContentVideoElement().addEventListener("volumechange",this._onVolumeChange),this._adVolume=this.getContentVideoElement().muted?0:this.getContentVideoElement().volume),this._setVideoDisplaySizeByContentVideo(b))},getContentVideoElement:function(){return!this._temporalSlotBase?(a.warn("SlotBase is null"),null):this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]},setVideoDisplaySize:function(b,c,d,f,g){a.debug("Context.setVideoDisplaySize("+
Array.prototype.slice.call(arguments).join(",")+")");this._totalSetDisplaySizeCount++;this._videoDisplaySize={left:b,top:c,width:d,height:f,position:g};for(var h=this.getTemporalSlots(),i=0;i<h.length;++i){var j=h[i];if(j.getState()===a.MediaPlayingState.instance||j.getState()===a.MediaReplayingState.instance){if(h=j.getCurrentAdInstance())(h=h.getRendererController().getRenderer())&&h.resize?h.resize():a.debug("renderer do not support resize");break}}},getVideoDisplaySize:function(){function a(b){b=
parseInt(b,10);isNaN(b)&&(b=0);return b}this._videoDisplaySize.left=a(this._videoDisplaySize.left);this._videoDisplaySize.right=a(this._videoDisplaySize.right);this._videoDisplaySize.width=a(this._videoDisplaySize.width);this._videoDisplaySize.height=a(this._videoDisplaySize.height);return this._videoDisplaySize},setVideoDisplayCompatibleSizes:function(b){a.debug("Context.setVideoDisplayCompatibleSizes",b);this._adRequest.setVideoDisplayCompatibleSizes(b)},setProfile:function(b){a.debug("Context.setProfile",
b);this._adRequest.setProfile(b)},setVideoAsset:function(b,c,d,f,g,h,i,j,k){a.debug("Context.setVideoAsset("+Array.prototype.slice.call(arguments).join(",")+")");this._videoAsset.setVideoAsset(b,c,d,f,g,h,i,j,k);this._va_id=b;this._va_duration=c;this._va_networkId=d;this._va_location=f;this._va_autoPlayType=g;this._va_viewRandom=h;this._va_idType=i;this._va_fallbackId=j;this._va_durationType=k},setVideoAssetCurrentTimePosition:function(b){a.debug("Context.setVideoAssetCurrentTimePosition("+b+")");
this._videoAsset.setVideoAssetCurrentTimePosition(b)},setSiteSection:function(b,c,d,f,g){a.debug("Context.setSiteSection("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.setSiteSection(b,c,d,f,g);this._ss_id=b;this._ss_networkId=c;this._ss_pageViewRandom=d;this._ss_idType=f;this._ss_fallbackId=g},setVisitor:function(b,c){a.debug("Context.setVisitor("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.setVisitor(b,c)},startSubsession:function(b){a.debug("Context.startSubsession("+
b+")");this._adRequest.setSubsessionToken(b)},setRequestMode:function(b){a.debug("Context.setRequestMode("+b+")");this._adRequest.setRequestMode(b)},setRequestDuration:function(b){a.debug("Context.setRequestDuration("+b+")");this._adRequest.setRequestDuration(b)},addCandidateAd:function(b){a.debug("Context.addCandidateAd("+b+")");this._adRequest.addCandidateAd(b)},addTemporalSlot:function(b,c,d,f,g,h,i,j){a.debug("Context.addTemporalSlot("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.addTemporalSlot(b,
c,d,f,g,h,i,j)},getTemporalSlots:function(){return this._adResponse?this._adResponse._temporalSlots.slice():[]},getSlotByCustomId:function(a){return this._adResponse?this._adResponse.getSlotByCustomId(a):null},getSlotsByTimePositionClass:function(a){var c=[];if(this._adResponse){for(var d=0;d<this._adResponse._temporalSlots.length;d++)this._adResponse._temporalSlots[d].getTimePositionClass()===a&&c.push(this._adResponse._temporalSlots[d]);for(d=0;d<this._adResponse._siteSectionNonTemporalSlots.length;d++)this._adResponse._siteSectionNonTemporalSlots[d].getTimePositionClass()===
a&&c.push(this._adResponse._siteSectionNonTemporalSlots[d]);for(d=0;d<this._adResponse._videoPlayerNonTemporalSlots.length;d++)this._adResponse._videoPlayerNonTemporalSlots[d].getTimePositionClass()===a&&c.push(this._adResponse._videoPlayerNonTemporalSlots[d])}return c},submitRequest:function(b){a.debug("Context.submitRequest",b);this.dispatchEvent(a.EVENT_REQUEST_INITIATED,{});if(this._requestState)a.warn("Context.submitRequest: request already submitted");else if(a.Util.isBlank(this._adManager._serverURL))a.warn("Context.submitRequest: serverURL is not set");
else{this._requestState=1;this._adRequest.scanPageSlots();if(this._isRefreshRequest){for(var c={},d=[],f=0;f<this._refreshSlots.length;f++){var g=this._refreshSlots[f];if(void 0!=this._adRequest._slotScanner._slots[g]){c[g]=this._adRequest._slotScanner._slots[g];for(var h=c[g].split("&"),i=0;i<h.length;i++)-1!==h[i].search("flag")&&(h[i]="flag=-cmpn");c[g]=h.join("&")}for(i=0;i<this._adRequest._slotScanner._knownSlots.length;i++)if(this._adRequest._slotScanner._knownSlots[i].id==g)h=this._adRequest._slotScanner._knownSlots[i],
h.acceptCompanion=!1,h.initialAdOption=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,d.push(h)}this._adRequest._slotScanner._slots=c;this._adRequest._slotScanner._knownSlots=d}if(this.getParameter(a.PARAMETER_ENABLE_FORM_TRANSPORT))a.debug("Context.submitRequest: enabling Safari transport mechanism globally"),a.PLATFORM_SEND_REQUEST_BY_FORM=!0;c=this._adManager._serverURL;".js"!==c.substring(c.length-3,c.length)&&(c=this._adRequest.generateTypeBRequestUrl());var j=this;if("number"!==typeof b||0>=b||!b)b=5;
setTimeout(function(){1===j._requestState&&(a.warn("Context.submitRequest: request timeout"),j.requestComplete(null))},1E3*b);a.log("Context.submitRequest: sending request to",c,"timeout",b);a.PLATFORM_SEND_REQUEST_BY_FORM?(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(c,this._instanceId,!0),j._onMessagePosted=function(a){"object"===typeof a.data&&a.data.hasOwnProperty("cbfn")&&-1<a.data.cbfn.indexOf("['Context_"+j._instanceId+"']")&&j.requestComplete(a.data.response)},window.addEventListener("message",
j._onMessagePosted,!1)):a.Util.pingURLWithScript(c)}},requestComplete:function(b){if(1!==this._requestState)a.warn("ad request complete after timeout"),this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1});else{this._requestState=2;a.debug("Context.requestComplete");if(a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var c=document.getElementById("_fw_request_iframe_"+this._instanceId);document.body.removeChild(c)}if(null!==b){a._instanceQueue["Context_"+
this._instanceId]=null;this._adResponse=new a.AdResponse(this);this._adResponse.parse(b,this._temporalSlotBase);a.log("Ad request succeeded");for(var c=(this._adResponse._profileParameters.autoloadExtensions||"").split(","),d=0;d<c.length;d++){var f=c[d].trim();a.log("Loading extension: "+f);this.loadExtension(f)}this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!0,response:b});c=this._adResponse.getSiteSectionNonTemporalSlots();for(b=0;b<c.length;++b)a.log("Auto play site section nonTemporal slots"),
c[b].play();c=this._adResponse.getVideoPlayerNonTemporalSlots();for(b=0;b<c.length;++b)a.log("Auto play video player nonTemporal slots"),c[b].play()}else a.warn("Ad request failed"),this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1})}},addEventListener:function(b,c){a.debug("Context.addEventListener",b);this._eventDispatcher.addEventListener(b,c)},removeEventListener:function(b,c){a.debug("Context.removeEventListener",b);this._eventDispatcher.removeEventListener(b,c)},dispatchEvent:function(b,
c){a.log("Context.dispatchEvent",b);if(b===a.EVENT_SLOT_STARTED){var d=c.slot.getTimePositionClass();if(d===a.TIME_POSITION_CLASS_PREROLL||d===a.TIME_POSITION_CLASS_MIDROLL||d===a.TIME_POSITION_CLASS_POSTROLL)this._contentVideoAttached=!0,this._markCurrentContentPlayheadTime()}else if(b===a.EVENT_SLOT_ENDED&&(d=c.slot.getTimePositionClass(),d===a.TIME_POSITION_CLASS_PREROLL||d===a.TIME_POSITION_CLASS_MIDROLL||d===a.TIME_POSITION_CLASS_POSTROLL))this._contentVideoAttached=!1;c=c||{};c.type=b;c.target=
this;this._eventDispatcher.dispatchEvent(c)},dispose:function(){a.debug("Context.dispose");this.setVideoState(a.VIDEO_STATE_STOPPED);if(this._adResponse){if(this._temporalSlotBase){for(var b=0,c=this._adResponse._temporalSlots||[];b<c.length;++b){var d=c[b];if(d._onContentVideoTimeUpdate){var f=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId];f&&f.removeEventListener("timeupdate",d._onContentVideoTimeUpdate,!1);d._onContentVideoTimeUpdate=null}}this.getContentVideoElement().removeEventListener("volumechange",
this._onVolumeChange);this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=null}this._isRefreshRequest=!1;this._refreshSlots=[];this._extensionManager.dispose();this._extensionManager=null}},loadExtension:function(a){this._extensionManager.load(a,this)},_markCurrentContentPlayheadTime:function(){var a=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime;if(0<a)this._currentContentPlayheadTime=a},_getContentPlayheadTime:function(){var a=-1;if(!this._contentVideoAttached)a=
this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime;return 0<a?a:this._currentContentPlayheadTime},_setVideoDisplaySizeByContentVideo:function(a){if(this._autoSetDisplaySizeCount===this._totalSetDisplaySizeCount){var c=a.style.left,d=a.style.top,f=a.offsetWidth?a.offsetWidth:a.style.pixelWidth,g=a.offsetHeight?a.offsetHeight:a.style.pixelHeight,a=a.style.position;this._autoSetDisplaySizeCount++;this.setVideoDisplaySize(c,d,f,g,a)}},_replacePageSlot:function(b,c){navigator.userAgent.match(/MSIE/);
var d=null!=navigator.userAgent.match(/Firefox/);a.debug("fw replace %s",b);var f,g,h;try{f=document.getElementById(b)?document:parent.document.getElementById(b)?parent.document:null,g=document.getElementById(b)?"window":parent.document.getElementById(b)?"parent":null}catch(i){g=f=null}if(!f)for(var j=0;j<window.frames.length;j++)try{if(window.frames[j].document.getElementById(b))f=window.frames[j].document,g="window.frames["+j+"]"}catch(k){a.debug(k)}g&&(h=g+".document");a.debug("fw replacing slot %s in frame %s",
b,h);if(!f)throw"Slot element not found: "+b;j=f.getElementById("_fw_container_"+b);j.innerHTML=c;for(var j=j.getElementsByTagName("script"),m=f.getElementsByTagName("head")[0],l=0;l<j.length;++l)if(d||j[l].src){var n=f.createElement("script");if(j[l].charset)n.charset=j[l].charset;if(j[l].src)n.src=j[l].src;if(j[l].innerHTML)n.innerHTML=j[l].innerHTML;n.onload=n.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&m.removeChild(n)};a.debug("fw append script for %s",
b);m.appendChild(n)}else n=j[l].innerHTML,n=n.replace(/var fw_scope = document;/,"var fw_scope="+h+";"),n=n.replace(/var fw_scope_window = window;/,"var fw_scope_window="+g+";"),a.debug("fw eval in %s for %s, %s",h,b,n),eval(n);a.debug("fw finish replace %s",b)}};a.Context.prototype.constructor=a.Context;a.DisplayRefreshExtension=function(){this.REFRESH_TYPE_NONE="refresh_none";this.REFRESH_TYPE_AD="refresh_ad";this.REFRESH_TYPE_TIME="refresh_time";this.REPLACE_TYPE_NONE="replace_none";this.REPLACE_TYPE_BLANK=
"replace_blank";this.REPLACE_TYPE_AD="replace_ad";this._subContext=null;this._displaySlots=[];this._companionSlots=[];this._keyValues=[];this._globalParameters=[];this._overrideParameters=[];this._refreshType=this.REFRESH_TYPE_NONE;this._replaceType=this.REPLACE_TYPE_NONE;this._refreshInterval=0;this._refreshTimer=null;this._firstTemporalAd=!0;this._REQUEST_TIME_OUT=5};a.DisplayRefreshExtension.prototype={init:function(b){this._context=b;a.debug("DisplayRefreshExtension.init(context)");this._onRendererEvent=
a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._onRendererEvent()");b.subType===a.EVENT_AD_IMPRESSION&&this._onAdStarted(b)});this._onSlotEnded=a.Util.bind(this,function(b){var d=b.slot.getTimePositionClass(),b=b.slot;a.debug("DisplayRefreshExtension._onSlotEnded()",b,d);if(!(null==b||d==a.TIME_POSITION_CLASS_DISPLAY||0==b.getAdInstances().length))if(this._refreshType==this.REFRESH_TYPE_AD)this._resetSubContext(),this._refreshSlots(this._displaySlots);else if(this._refreshType==this.REFRESH_TYPE_TIME){this._resetSubContext();
this._refreshSlots(this._displaySlots);var f=this;this._refreshTimer=setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()");f._resetSubContext();f._refreshSlots(f._displaySlots)},1E3*this._refreshInterval)}});this._onRequestComplete=a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._onRequestComplete()");if(b.success){switch(this._context.getParameter("refreshType")){case "ad":this._refreshType=this.REFRESH_TYPE_AD;break;case "time":this._refreshInterval=this._context.getParameter("refreshInterval");
this._refreshType=0<this._refreshInterval?this.REFRESH_TYPE_TIME:this.REFRESH_TYPE_NONE;break;default:this._refreshType=this.REFRESH_TYPE_NONE}switch(this._context.getParameter("replaceMissingCompanion")){case "blank":this._replaceType=this.REPLACE_TYPE_BLANK;break;case "ad":this._replaceType=this.REPLACE_TYPE_AD;break;default:this._replaceType=this.REPLACE_TYPE_NONE}if(this._refreshType!=this.REFRESH_TYPE_NONE||this._replaceType!=this.REPLACE_TYPE_NONE){if(this._displaySlots=this._context.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),
this._companionSlots=this._displaySlots.filter(function(a){return a.getAcceptCompanion()}),this._keyValues=this._context._adRequest._keyValues,this._globalParameters=this._context._globalLevelParameterDictionary,this._overrideParameters=this._context._overrideLevelParameterDictionary,this._firstTemporalAd=!0,this._context.addEventListener(a.EVENT_AD,this._onRendererEvent),this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._refreshType==this.REFRESH_TYPE_TIME){var d=this;this._refreshTimer=
setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()");d._resetSubContext();d._refreshSlots(d._displaySlots)},1E3*this._refreshInterval)}}else this._refreshTimer&&clearInterval(this._refreshTimer)}else a.debug("DisplayRefreshExtension: request complete failed")});this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete)},_resetSubContext:function(){a.debug("DisplayRefreshExtension._resetSubContext()");this._subContext=this._context._adManager.cloneContext(this._context);
this._subContext._displayRefreshExtension.dispose();this._subContext._videoStateExtension.dispose();this._subContext.setCapability(a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_STATUS_OFF);this._subContext.setCapability(a.CAPABILITY_DISPLAY_REFRESH,a.CAPABILITY_STATUS_ON);this._playRefreshedSlots=a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._playRefreshedSlots()");if(b.success)for(var b=this._subContext.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),c=0;c<b.length;c++)b[c].play();
else a.debug("DisplayRefreshExtension._playRefreshedSlots(): subContext refresh request error:",b)});this._subContext.addEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots);for(var b=this._subContext._adRequest._keyValues,c=0;c<this._keyValues.length;c++)0>b.indexOf(this._keyValues[c])&&b.push(this._keyValues[c]);for(var d in this._globalParameters)this._globalParameters.hasOwnProperty(d)&&this._subContext.setParameter(d,this._globalParameters[d],a.PARAMETER_LEVEL_GLOBAL);for(d in this._overrideParameters)this._overrideParameters.hasOwnProperty(d)&&
this._subContext.setParameter(d,this._overrideParameters[d],a.PARAMETER_LEVEL_OVERRIDE)},_onAdStarted:function(b){a.debug("DisplayRefreshExtension._onAdStarted()");var c=b.adInstance.getSlot();a.debug("DisplayRefreshExtension._onAdStarted(): slot: ",c," | timePositionClass:",c.getTimePositionClass());if(!(null==c||c.getTimePositionClass()==a.TIME_POSITION_CLASS_DISPLAY))if(this._resetSubContext(),this._refreshTimer&&clearInterval(this._refreshTimer),this._replaceType!=this.REPLACE_TYPE_NONE)for(var b=
b.adInstance,c=c.getAdInstances(),d=0;d<c.length;d++)b.getAdId()===c[d].getAdId()&&this._checkMissingCompanionForAd(b)},_checkMissingCompanionForAd:function(b){a.debug("DisplayRefreshExtension._checkMissingCompanionForAd()",b);for(var c=this._companionSlots.slice(),b=b.getCompanionAdInstances(),d=0;d<b.length;d++){var f=c.indexOf(b[d].getSlot());-1<f&&c.splice(f,1)}if(this._firstTemporalAd)this._firstTemporalAd=!1,c=c.filter(function(b){if(!(b.getInitialAdOption()==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY||
b.getInitialAdOption()==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE||b.getInitialAdOption()==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE||b.getInitialAdOption()==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE||b.getInitialAdOption()==a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL))return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial false in slot ",b.getCustomId()),!0;for(var c=b.getAdInstances(),
d=0;d<c.length;d++)if(!c[d].isPlaceholder())return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): first companion found in slot ",b.getCustomId()),!1;a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial true, no ad in slot ",b.getCustomId());return!0});if(this._replaceType==this.REPLACE_TYPE_BLANK)for(d=0;d<c.length;d++)c[d].stop(),this._subContext._replacePageSlot(c[d].getCustomId(),"");else this._replaceType==this.REPLACE_TYPE_AD&&this._refreshSlots(c)},
_refreshSlots:function(b){a.debug("DisplayRefreshExtension._refreshSlots()",b);if(!(null==b||0==b.length)){for(var c=0;c<b.length;c++)b[c].stop(),this._subContext._refreshSlots.push(b[c].getCustomId());this._subContext._isRefreshRequest=!0;this._subContext.submitRequest(this._REQUEST_TIME_OUT)}},dispose:function(){a.debug("DisplayRefreshExtension.dispose()");if(this._context)this._context.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete),this._context.removeEventListener(a.EVENT_SLOT_ENDED,
this._onSlotEnded),this._context.removeEventListener(a.EVENT_AD,this._onRendererEvent),this._context=null;if(this._subContext)this._subContext.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots),this._subContext=null;this._displaySlots=[];this._companionSlots=[];this._keyValues=[];this._globalParameters=[];this._overrideParameters=[];this._refreshType=this.REFRESH_TYPE_NONE;this._replaceType=this.REPLACE_TYPE_NONE;this._refreshInterval=0;this._refreshTimer&&clearInterval(this._refreshTimer);
this._refreshTimer=null;this._firstTemporalAd=!0}};a.DisplayRefreshExtension.prototype.constructor=a.DisplayRefreshExtension;a.EventCallback=function(a){this._url=this._name=this._type=null;this._showBrowser=!1;this._trackingUrls=[];this._adInstance=this._slot=null;this._context=a};a.EventCallback.prototype={};a.EventCallback.prototype.constructor=a.EventCallback;a.EventCallback.getEventCallback=function(b,c,d){for(var f,g=0;g<b.length;g++)if(f=b[g],f._name===c&&f._type===d)return f;for(g=0;g<b.length;g++)if(f=
b[g],f._type===a.EVENT_TYPE_GENERIC){if(c=a.EventCallback.newEventCallback(f._context,c,d))c._url=f._url,c._slot=f._slot,c._adInstance=f._adInstance,b.push(c);return c}return null};a.EventCallback.newEventCallback=function(b,c,d){var f=null;if(d===a.EVENT_TYPE_GENERIC)f=new a.EventCallback(b);else if(d===a.EVENT_TYPE_ERROR)f=new a.ErrorEventCallback(b);else if(d===a.EVENT_TYPE_CLICK)f=new a.AdClickEventCallback(b);else if(d===a.EVENT_TYPE_STANDARD)f=new a.AdStandardEventCallback(b);else if(c===a.EVENT_SLOT_IMPRESSION||
c===a.EVENT_SLOT_END)f=new a.SlotImpressionEventCallback(b);else if(c===a.EVENT_AD_IMPRESSION||c===a.EVENT_AD_IMPRESSION_END)f=new a.AdImpressionEventCallback(b);else if(c===a.EVENT_VIDEO_VIEW)f=new a.VideoViewEventCallback(b);else if(c===a.EVENT_RESELLER_NO_AD)f=new a.ResellerNoAdEventCallback(b);else if(c===a.EVENT_AD_FIRST_QUARTILE||c===a.EVENT_AD_MIDPOINT||c===a.EVENT_AD_THIRD_QUARTILE||c===a.EVENT_AD_COMPLETE)f=new a.AdQuartileEventCallback(b);else return null;f._name=c;f._type=d;return f};a.EventCallback.getShortType=
function(b){var c="";switch(b){case a.EVENT_TYPE_IMPRESSION:c=a.SHORT_EVENT_TYPE_IMPRESSION;break;case a.EVENT_TYPE_CLICK:c=a.SHORT_EVENT_TYPE_CLICK;break;case a.EVENT_TYPE_STANDARD:c=a.SHORT_EVENT_TYPE_STANDARD;break;case a.EVENT_TYPE_ERROR:c=a.SHORT_EVENT_TYPE_ERROR}return c};a.Util.mixin(a.EventCallback.prototype,{parse:function(a){if(a){this._usage=a.use;this._type=a.type;this._name=a.name;this._url=a.url;this._showBrowser=a.showBrowser;this._trackingUrls=[];for(var c=0,a=a.trackingUrls||[];c<
a.length;c++)this._trackingUrls.push(a[c].value)}},copy:function(){var a=new this.constructor(this._context);a._type=this._type;a._name=this._name;a._url=this._url;a._showBrowser=this._showBrowser;a._trackingUrls=this._trackingUrls.slice();a._slot=this._slot;a._adInstance=this._adInstance;return a},getUrl:function(b){var c=this._replaceMacrosInUrl(this._url);this._name===a.EVENT_AD_MEASUREMENT?(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_ET,a.SHORT_EVENT_TYPE_IMPRESSION),c=a.Util.setParameterInURL(c,
a.URL_PARAMETER_KEY_CONCRETE_EVENT_ID,b[a.INFO_KEY_CONCRETE_EVENT_ID])):c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_ET,a.EventCallback.getShortType(this._type));c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CN,this._name);this._adInstance&&0<this._adInstance._creativeRenditionId&&(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CREATIVE_RENDITION_ID,this._adInstance._creativeRenditionId));return c},getTrackingUrls:function(){var b=this._trackingUrls;if(this._adInstance){var c=this._type;
if(c===a.EVENT_TYPE_CLICK)c=a.EVENT_TYPE_CLICK_TRACKING;b=b.concat(this._adInstance.getExternalEventCallbackUrls(this._name,c))}for(var c=[],d=0;d<b.length;d++){var f=a.Util.trim(this._replaceMacrosInUrl(b[d]));a.Util.isBlank(f)||c.push(f)}return c},process:function(b){b=b||{};this._processTrackingUrls();a.Util.pingURL(this.getUrl(b))},_processTrackingUrls:function(){this._shouldSkipSendingTrackingAndExternalUrls()||a.Util.pingURLs(this.getTrackingUrls())},_shouldSkipSendingTrackingAndExternalUrls:function(){return!1},
_needEmptyCT:function(b){var c=!1;b&&!0===b[a.INFO_KEY_NEED_EMPTY_CT]&&(c=!0);return c},_getAdPlayheadTime:function(){var a=-1;this._adInstance&&(a=this._adInstance.getPlayheadTime());return a},_getCreativeAssetLocation:function(){var a=null;this._adInstance&&this._adInstance.getActiveCreativeRendition()&&this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset()&&(a=this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset().getUrl());return a},_getParameter:function(a){var c=
null;return c=this._adInstance?this._adInstance._rendererController.getParameter(a):this._slot?this._slot.getParameter(a):this._context.getParameter(a)},_replaceMacrosInUrl:function(b){if(a.Util.isBlank(b))return b;var b=b.replace(/#(ce?)\{([^\}]+)\}/g,a.Util.bind(this,function(b,c,d){b="ce"===c;c=null;switch(d){case "ad.playheadTime":d=this._getAdPlayheadTime();c=0<=d?Math.round(d)+"":"";break;case "content.playheadTime":d=this._context._getContentPlayheadTime();c=0<=d?Math.round(d)+"":"";break;
case "creative.assetLocation":c=this._getCreativeAssetLocation();break;default:0===d.indexOf("parameter.")&&(c=this._getParameter(d.substr(10)))}a.Util.isBlank(c)&&(c="");return b?encodeURIComponent(c):c})),c="";try{c=a.Util.getParameterInURL(b,a.URL_PARAMETER_KEY_CR)}catch(d){return a.warn(d),b}a.Util.isBlank(c)||(b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_CR,this._replaceMacrosInUrl(c)));return b}});a.AdClickEventCallback=function(b){a.EventCallback.call(this,b)};a.AdClickEventCallback.prototype=
new a.EventCallback;a.AdClickEventCallback.prototype.constructor=a.AdClickEventCallback;a.Util.mixin(a.AdClickEventCallback.prototype,{getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b);b[a.INFO_KEY_URL]&&(a.Util.isParameterInURL(c,a.URL_PARAMETER_KEY_CR)||(c=c+"&"+a.URL_PARAMETER_KEY_CR+"="),c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CR,b[a.INFO_KEY_URL]));return c},process:function(b){var b=b||{},c=this.getUrl(b),d=!0===this._showBrowser,d=b.hasOwnProperty(a.INFO_KEY_SHOW_BROWSER)?
!0===b[a.INFO_KEY_SHOW_BROWSER]:d;b[a.INFO_KEY_URL]&&(d=!0);d&&!a.Util.isBlank(c)?(window.open(c),this._processTrackingUrls()):a.EventCallback.prototype.process.call(this,b)}});a.AdImpressionEventCallback=function(b){a.EventCallback.call(this,b)};a.AdImpressionEventCallback.prototype=new a.EventCallback;a.AdImpressionEventCallback.prototype.constructor=a.AdImpressionEventCallback;a.Util.mixin(a.AdImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==
a.INIT_VALUE_ONE},_getInitValue:function(){return this._adInstance.getSlot().isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b),c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);this._name!==a.EVENT_AD_IMPRESSION&&(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(b)?"":this._adInstance._timer.tick()));return c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},
process:function(b){if(a.MODULE_TYPE_TRANSLATOR!==this._adInstance.getRendererController().getRenderer().info()[a.INFO_KEY_MODULE_TYPE])a.EventCallback.prototype.process.call(this,b),this._processed=!0}});a.AdQuartileEventCallback=function(b){a.EventCallback.call(this,b)};a.AdQuartileEventCallback.prototype=new a.EventCallback;a.AdQuartileEventCallback.prototype.constructor=a.AdQuartileEventCallback;a.Util.mixin(a.AdQuartileEventCallback.prototype,{getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,
b),c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);return c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(b)?"":this._adInstance._timer.tick())},process:function(b){if(!this._processed)a.EventCallback.prototype.process.call(this,b),this._processed=!0}});a.AdStandardEventCallback=function(b){a.EventCallback.call(this,b)};a.AdStandardEventCallback.prototype=new a.EventCallback;a.AdStandardEventCallback.prototype.constructor=a.AdStandardEventCallback;
a.ErrorEventCallback=function(b){a.EventCallback.call(this,b)};a.ErrorEventCallback.prototype=new a.EventCallback;a.ErrorEventCallback.prototype.constructor=a.ErrorEventCallback;a.Util.mixin(a.ErrorEventCallback.prototype,{getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b),d=b[a.INFO_KEY_ERROR_CODE];if(!d)d=a.ERROR_UNKNOWN;var f=b[a.INFO_KEY_ERROR_INFO];f||(f="");(b=b[a.INFO_KEY_ERROR_MODULE])||(b="");c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CN,d);return c=a.Util.setParameterInURL(c,
a.URL_PARAMETER_KEY_KEY_VALUE,encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_MODULE)+"="+encodeURIComponent(b)+"&"+encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_INFO)+"="+a.PLATFORM_ID+"/"+encodeURIComponent(f))}});a.ResellerNoAdEventCallback=function(b){a.EventCallback.call(this,b)};a.ResellerNoAdEventCallback.prototype=new a.EventCallback;a.ResellerNoAdEventCallback.prototype.constructor=a.ResellerNoAdEventCallback;a.Util.mixin(a.ResellerNoAdEventCallback.prototype,{});a.SlotImpressionEventCallback=
function(b){a.EventCallback.call(this,b)};a.SlotImpressionEventCallback.prototype=new a.EventCallback;a.SlotImpressionEventCallback.prototype.constructor=a.SlotImpressionEventCallback;a.Util.mixin(a.SlotImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._slot.isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(b){b=a.EventCallback.prototype.getUrl.call(this,
b);return b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},process:function(b){a.EventCallback.prototype.process.call(this,b);this._processed=!0}});a.VideoViewEventCallback=function(b){a.EventCallback.call(this,b)};a.VideoViewEventCallback.prototype=new a.EventCallback;a.VideoViewEventCallback.prototype.constructor=a.VideoViewEventCallback;a.Util.mixin(a.VideoViewEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==
a.INIT_VALUE_ONE},_getInitValue:function(){return!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_ZERO},_getCTValue:function(){return this._context._videoAsset.getPlayheadTime()},getUrl:function(b){b=a.EventCallback.prototype.getUrl.call(this,b);b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_INIT,this._getInitValue());return b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_CT,this._getCTValue())},_shouldSkipSendingTrackingAndExternalUrls:function(){return this._processed},process:function(b){a.EventCallback.prototype.process.call(this,
b);this._processed=!0}});a.EventDispatcher=function(){this._listeners={}};a.EventDispatcher.prototype={addEventListener:function(a,c){"undefined"===typeof this._listeners[a]&&(this._listeners[a]=[]);this._listeners[a].push(c)},dispatchEvent:function(b){"string"===typeof b&&(b={type:b});if(!b.target)b.target=this;if(b.type&&this._listeners[b.type]instanceof Array)for(var c=this._listeners[b.type],d=0,f=c.length;d<f;d++)try{c[d]&&c[d].call(this,b)}catch(g){a.warn("EventDispatcher.dispatchEvent",b.type,
g)}},removeEventListener:function(a,c){if(this._listeners[a]instanceof Array){var d=this._listeners[a];if(null==c)this._listeners[a]=[];else for(var f=0,g=d.length;f<g;f++)if(d[f]===c){d.splice(f,1);break}}}};a.EventDispatcher.prototype.constructor=a.EventDispatcher;a.ExtensionManager=function(b){this._extensions={};this._context=b;this._surveyExtension=new a.SurveyExtension;this._surveyExtension.init(b);this._videoStateExtension=new a.VideoStateExtension;this._videoStateExtension.init(b);this._displayRefreshExtension=
new a.DisplayRefreshExtension;this._displayRefreshExtension.init(b);this._contentVideoExtension=new a.ContentVideoExtension;this._contentVideoExtension.init(b)};a.ExtensionManager.prototype={_scriptLoaded:function(b){var c="Unknown error.";null==this._extensions[b]?this._loadFail(b,"Extension supposed to be loaded but not found"):(c=a.Util.getObject(b),"function"!==typeof c?this._loadFail(b,"Script loaded but extension class not found"):(c=new c,"function"===typeof c.init&&"function"===typeof c.dispose?
(a.log("Extension loaded: "+b),c.init(this._context),this._context.dispatchEvent(a.EVENT_EXTENSION_LOADED,{success:!0,moduleName:b})):this._loadFail(b,"Extension loaded but is not supported")))},_getExtensionNameFromUrl:function(a){for(var c=/(?!.*\.{2})(?:[\\/\?=#])([a-z][\w\.]+)(?:\.js(#|\?|$))/gi,d,f;d=c.exec(a);)f=d;return f?f[1]:null},_loadFail:function(b,c){a.log("Extension failed to load. "+b+" : "+c);this._context.dispatchEvent(a.EVENT_EXTENSION_LOADED,{success:!1,errorVal:c,moduleName:b})},
load:function(b){if(b){var c=this._getExtensionNameFromUrl(b);if(null===c)this._loadFail(c,"Extension name not exsit in the Url. Url: "+b);else if(this._extensions[c]===b)a.log("Extension is already loaded"),this._loadFail(c,"Extension is already loaded");else{var d=1*this._context.getParameter("moduleLoadTimeout")||6E4,f=!1,g=this,h=window.setTimeout(function(){f=!0;g._loadFail(c,"Timeout occured while loading extension. Url: "+b)},d);a.Util.lazyJavaScriptLoad(b,function(){a.log("async load extension successful, URL:"+
b);window.clearTimeout(h);f?(a.debug("Extension loaded after timeout, do nothing."),g._loadFail(c,"Timeout occured while loading extension. Url: "+b)):(g._extensions[c]=b,g._scriptLoaded(c))})}}else this._loadFail(c,"Url cannot be empty")},dispose:function(){this._extensions=null;this._surveyExtension.dispose();this._surveyExtension=null;this._displayRefreshExtension.dispose();this._displayRefreshExtension=null;this._videoStateExtension.dispose();this._videoStateExtension=null;this._contentVideoExtension.dispose();
this._context=this._contentVideoExtension=null}};a.ExtensionManager.prototype.constructor=a.ExtensionManager;a.HTMLAdGenerator={log:function(b){a.log("HTMLAdGenerator\t"+b)},getExtension:function(a){return!a?"":(a=a.match(/^[^?]+\/[^?.]*(\.\w+)+/))?a[a.length-1].slice(1):""},generateAd:function(b,c,d,f,g,h,i){a.HTMLAdGenerator.log("generatorAd("+[].slice.call(arguments,0).join(",")+")");var j=h,k=!1;null==j&&(k=!0,j=a.HTMLAdGenerator.getExtension(b).toLowerCase());switch(j){case "jpeg":case "jpg":case "gif":case "png":case "image/jpeg":case "image/jpg":case "image/gif":case "image/png":case "image/bmp":j=
a.HTMLAdGenerator.generateImageHTML(b,c);break;case "swf":case "application/x-shockwave-flash":j=a.HTMLAdGenerator.generateFlashHTML(b,c,d,f,g);break;case "script":case "js":case "text/javascript":case "text/js_ref":case "application/x-javascript":j=a.HTMLAdGenerator.generateScriptHTML(b,d,f,g);break;case "iframe":case "html":case "htm":case "text/html":case "text/html_doc_ref":case "text/html_lit_nowrapper":case "text/html_doc_lit_mobile":j=a.HTMLAdGenerator.generateIFrameHTML(b,c,d,f,g);break;default:j=
k?a.HTMLAdGenerator.generateIFrameHTML(b,c,d,f,g):a.HTMLAdGenerator.generateAd(b,c,d,f,g,null,i)}return"text/html_doc_lit_mobile"===i?a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(j):j},generateImageHTML:function(b,c){a.HTMLAdGenerator.log("generateImageHTML");var d=null;return c?'<a href="'+c+'" target="_blank"><img src="'+b+'" border="0" /></a>':'<img src="'+b+'" border="0" />'},generateFlashHTML:function(b,c,d,f,g){a.HTMLAdGenerator.log("generateFlashHTML");var h=b;c&&0<c.length&&(h+=-1===b.indexOf("?")?
"?":"&",h+="clickTag="+encodeURIComponent(c));return'<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"WIDTH="'+f+'" HEIGHT="'+g+'" id="'+d+'_external_ad">'+('<PARAM NAME=movie VALUE="'+h+'"/>')+'<PARAM NAME=quality VALUE=high/><PARAM NAME=bgcolor VALUE=#FFFFFF/><PARAM NAME="allowScriptAccess" VALUE="always"/><PARAM NAME="loop" VALUE="true"/>'+('<EMBED src="'+h+'" ')+('quality=high bgcolor=#FFFFFF WIDTH="'+
f+'" HEIGHT="'+g+'"NAME="'+d+'_external_video" ALIGN="" TYPE="application/x-shockwave-flash"PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED></OBJECT>')},generateIFrameHTML:function(b,c,d,f,g){a.HTMLAdGenerator.log("generateIFrameHTML");return'<iframe height="'+g+'" width="'+f+'" frameborder="0" scrolling="no" allowtransparency="true" leftmargin="0" rightmargin="0" marginwidth="0" marginheight="0" src="'+b+'"></iframe>'},docLitToHTMLLit:function(b,c,d,f){a.HTMLAdGenerator.log("docLitToHTMLLit");
return'<iframe id="_fw_frame_'+c+'" width="'+d+'" height="'+f+'" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe><script language="javascript" type="text/javascript" id="_fw_container_js_'+c+"\">if(!fw_targets) {var fw_targets = [];}var _fw_wr;var fw_scope = document;var fw_content = '"+a.Util.encodeToHex(b)+"';var trgtFrm = fw_scope.getElementById(\"_fw_frame_"+c+'");trgtFrm = (trgtFrm.contentWindow) ? trgtFrm.contentWindow : (trgtFrm.contentDocument.document) ? trgtFrm.contentDocument.document : trgtFrm.contentDocument;fw_targets["'+
c+'"] = trgtFrm;if(navigator.userAgent.match(/\\bMSIE\\b/) || navigator.userAgent.match(/\\bOpera\\b/)){trgtFrm.document.open();trgtFrm.document.write(fw_content);setTimeout(function(){fw_close(fw_targets["'+c+'"])}, 7500);} else if (navigator.userAgent.match(/\\bFirefox\\b/)) {if(true && fw_content.length < 2000){var ec = escape(fw_content);var fw_iframe_url = "http://m2.feiwei.tv/g/lib/template/echo.html?s="+ec;fw_scope.getElementById("_fw_frame_'+c+'").src = fw_iframe_url;} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}function fw_close(theFrame){theFrame.document.close();}<\/script>'},
htmlLitToDocLit:function(b){a.HTMLAdGenerator.log("htmlLitToDocLit");return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>Advertisement</title></head><body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">'+b+"</body></html>"},wrapUnsafeHTML:function(b,c,d,f){return a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(a.HTMLAdGenerator.docLitToHTMLLit(a.HTMLAdGenerator.htmlLitToDocLit(b),c,d,f))},wrapJSCode:function(b,
c,d,f){return a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript">'+b+"<\/script>",c,d,f)},generateScriptHTML:function(b,c,d,f){a.HTMLAdGenerator.log("generateScriptHTML");return a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript" src="'+b+'"><\/script>',c,d,f)},htmlLitToHTMLDocLitMobile:function(b){a.HTMLAdGenerator.log("htmlLitToHTMLDocLitMobile");return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta name = "viewport" content = "initial-scale = 1.0, target-densitydpi = device-dpi" /><title>Advertisement</title><script type="text/javascript">window._fw_page_url = "";<\/script></head><body style="margin:0px;background-color:transparent;">'+
b+"</body></html>"}};a.NullRenderer=function(){};a.NullRenderer.prototype={start:function(b){b.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);b.handleStateTransition(a.RENDERER_STATE_STARTED);b.handleStateTransition(a.RENDERER_STATE_COMPLETED)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return-1},getDuration:function(){return-1}};a.NullRenderer.prototype.constructor=a.NullRenderer;a.PageSlotScanner=function(a){this.OPTION_INIT=1;this.OPTION_FCAI=
2;this.OPTION_NIIC=4;this.OPTION_NOSA=8;this.OPTION_NSIT=16;this._knownSlots=[];this._slots={};this._candidateAds=[];this._slotOptionFound=!1;this._context=a};a.PageSlotScanner.prototype={isSlotDuplicate:function(a){for(var c=0;c<this._knownSlots.length;++c)if(this._knownSlots[c].id===a)return!0;return!1},findPageSlotByScope:function(b){var c=b.document;if(c){var d,f=/(^|\s)_fwph(\s|$)/,g=c.getElementsByTagName("span");if(!b._fw_admanager)b._fw_admanager={};b._fw_admanager.pageScanState=!0;for(b=
0;b<g.length;++b){var h;d=g[b];if(f.test(d.className)&&(d=d.getAttribute("id"),(h=c.getElementById("_fw_input_"+d))&&!this.isSlotDuplicate(d)))if(h=h.getAttribute("value")){";"!==h.charAt(h.length-1)&&(h+=";");h=h.split(";");var i=h[h.length-2],j=!1;-1!==i.search("lo=i")&&(j=!0);var k=!1;-1!==i.search("prct=")&&(k=!0);0>i.search("flag=")&&(i+="&flag=");0>i.search("ptgt=")&&(i="ptgt=s&"+i);h=[];for(var m=i.split("&"),l,n,q,i=!0,C=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,o=0;o<m.length;++o)if(l=m[o].split("="),
2===l.length){l[1]=decodeURIComponent(l[1]);if("ssct"===l[0])if(k)continue;else k=!0,l[0]="prct";"flag"===l[0]?(-1===l[1].search(/[-\+]cmpn/)&&(l[1]+="+cmpn"),"+"!==l[1].charAt(0)&&"-"!==l[1].charAt(0)&&(l[1]="+"+l[1]),j&&-1===l[1].search("-init")&&(l[1]+="-init"),-1!==l[1].search("-nrpl")&&(l[1]=l[1].replace("-nrpl","+cmpn")),-1!==l[1].search("-cmpn")&&(i=!1),C=this._getInitialOption(l[1]),this._slotOptionFound||(C=j?a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL:a.SLOT_OPTION_INITIAL_AD_STAND_ALONE)):"w"===
l[0]?n=Number(l[1]):"h"===l[0]?q=Number(l[1]):"cana"===l[0]&&this._addCandidateAds(l[1]);l=encodeURIComponent(l[0])+"="+encodeURIComponent(l[1]);h.push(l)}k||(j=this._context.getParameter(a.PARAMETER_PAGE_SLOT_CONTENT_TYPE)||"text/html_doc_lit_mobile,text/html_doc_ref",h.push("prct="+encodeURIComponent(j)));(j=c.getElementById("_fw_container_"+d))?(this._slots[d]=h.join("&")+";",this._knownSlots.push({id:d,width:n,height:q,element:j,acceptCompanion:i,initialAdOption:C})):a.warn("Failed to find container for slot "+
d)}}}},scanPageSlots:function(){for(var b=0;b<window.frames.length;++b)try{a.debug("scanPageSlots in frame",b),this.findPageSlotByScope(window.frames[b])}catch(c){}try{window.parent&&window.parent!==window&&(a.debug("scanPageSlots in parent frame"),this.findPageSlotByScope(window.parent))}catch(d){}try{a.debug("scanPageSlots in current window"),this.findPageSlotByScope(window)}catch(f){}},slotsToTypeBStr:function(){var a="",c;for(c in this._slots)if(this._slots.hasOwnProperty(c)){var d=this._slots[c];
-1===d.search("slid=")&&(d="slid="+encodeURIComponent(c)+"&"+d);a+=d;";"!==a.charAt(a.length-1)&&(a+=";")}a&&(a=a.substring(0,a.length-1));return a},_addCandidateAds:function(a){for(var a=a.split(","),c=0;c<a.length;c++){var d=parseInt(a[c],10);0<d&&this._candidateAds.push(d)}},_parseFlags:function(a){for(var c=[],d=[],f="",g=!0,a=a+"+",h=0;h<a.length;++h){var i=a.charAt(h);switch(i){case "+":case "-":""!=f&&(g?c.push(f):d.push(f),f="");g="+"==i;break;default:f+=i}}return[c,d]},_getInitialOption:function(b){for(var c=
!1,d=0,b=this._parseFlags(b),f=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,g=0;g<b.length;++g)for(var h=0;h<b[g].length;++h)switch(b[g][h].toString().toLowerCase()){case "init":d=0==g?d&~this.OPTION_INIT:d|this.OPTION_INIT;c=!0;break;case "fcai":d=0==g?d|this.OPTION_FCAI:d&~this.OPTION_FCAI;c=!0;break;case "niic":d=0==g?d|this.OPTION_NIIC:d&~this.OPTION_NIIC;c=!0;break;case "nosa":d=0==g?d|this.OPTION_NOSA:d&~this.OPTION_NOSA;c=!0;break;case "nsit":d=0==g?d|this.OPTION_NSIT:d&~this.OPTION_NSIT,c=!0}switch(d){case 0:if(c)f=
a.SLOT_OPTION_INITIAL_AD_STAND_ALONE;break;case 1:f=a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL;break;case 3:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY;break;case 2:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE;break;case 6:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE;break;case 8:f=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE;break;case 10:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE;break;case 16:f=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE_IF_TEMPORAL;break;case 18:f=
a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL;break;default:f=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE}this._slotOptionFound=c;return f}};a.PageSlotScanner.prototype.constructor=a.PageSlotScanner;a.RendererController=function(b,c){var d=null,f=null,g={},h=a.RendererInitState.instance,i={},j=[],k=0;return{getAdInstance:function(){return c},getContext:function(){return b},getRendererState:function(){return h},processEvent:function(b){var d=b.name;if(d===a.RENDERER_STATE_STARTED||
d===a.RENDERER_STATE_COMPLETING||d===a.RENDERER_STATE_COMPLETED||d===a.RENDERER_STATE_FAILED)this.handleStateTransition(d,b.info);else{var f=this._inferEventType(d);if(f&&(f===a.EVENT_TYPE_CLICK&&b.info&&b.info[a.INFO_KEY_CUSTOM_EVENT_NAME]&&(d=b.info[a.INFO_KEY_CUSTOM_EVENT_NAME]),d!==a.EVENT_AD_MEASUREMENT||b.info[a.INFO_KEY_CONCRETE_EVENT_ID])){var g=d===a.EVENT_AD_INITIATED||d===a.EVENT_AD_BUFFERING_START||d===a.EVENT_AD_BUFFERING_END||d===a.EVENT_AD_VOLUME_CHANGE||b.info&&b.info.hasOwnProperty("apiOnly")&&
b.info.apiOnly;c.processEvent(d,f,b.info,g)}}},handleStateTransition:function(b,d){switch(b){case a.RENDERER_STATE_STARTED:h.notifyStarted(this);break;case a.RENDERER_STATE_COMPLETING:h.complete(this);break;case a.RENDERER_STATE_COMPLETED:h.complete(this);h.notifyCompleted(this);break;case a.RENDERER_STATE_FAILED:c.getSlot()._clearScheduledAdInstance();d||(d={});a.warn("FAIL",d.errorModule,d.errorCode,d.errorInfo);var f=c.processEvent(a.EVENT_ERROR,a.EVENT_TYPE_ERROR,d);f||a.debug("No EVENT_ERROR callback found");
if(d)switch(d[a.INFO_KEY_ERROR_CODE]){case a.ERROR_NO_AD_AVAILABLE:case a.ERROR_PARSE:(f=c.processEvent(a.EVENT_RESELLER_NO_AD,a.EVENT_TYPE_IMPRESSION))||a.debug("No EVENT_RESELLER_NO_AD callback found.")}h.fail(this);break;default:a.debug("Unknown event received",b)}},setCapability:function(a,b){c.setMetr(a,b)},getVersion:function(){return b._adManager.getVersion()},getParameter:function(a){if(!a)return null;if(b._overrideLevelParameterDictionary.hasOwnProperty(a))return b._overrideLevelParameterDictionary[a];
if(c.getActiveCreativeRendition()&&"undefined"!==typeof c.getActiveCreativeRendition().getParameter(a))return c.getActiveCreativeRendition().getParameter(a);var d=c._creative;return d&&"undefined"!==typeof d.getParameter(a)?d.getParameter(a):"undefined"!==typeof c.getSlot().getParameter(a)?c.getSlot().getParameter(a):b._adResponse._profileParameters.hasOwnProperty(a)?b._adResponse._profileParameters[a]:b._globalLevelParameterDictionary.hasOwnProperty(a)?b._globalLevelParameterDictionary[a]:g&&g.hasOwnProperty(a)?
g[a]:null},getCompanionSlots:function(){for(var a=[],b=c._companionAdInstances,d=0;d<b.length;d++)b[d].isPlaceholder()&&a.push(b[d].getSlot());return a},createNullDrivingAdInstance:function(){var a=c.getSlot().scheduleAdInstance();a.addCreativeRendition().setContentType("null/null");return a},scheduleAdInstances:function(a){var b,d=[],f=null,a=a||[];if(0===a.length)return d;for(b=0;b<a.length;b++)a[b].getCustomId()===c.getSlot().getCustomId()&&(f=c.getSlot().scheduleAdInstance());if(!f)if(this.isTranslator())f=
this.createNullDrivingAdInstance();else if(this.isRenderer())f=c;else return d;for(var g=0;g<a.length;g++){if(a[g].getCustomId()===c.getSlot().getCustomId())f!==c&&d.push(f);else for(var h=0,k=f._companionAdInstances;h<k.length;h++)if(b=k[h],a[g]===b.getSlot()){if(this.isTranslator())d.push(b);else if(this.isRenderer()&&b.isPlaceholder()){var t=b.cloneForTranslation();f===c&&(i[t]=b);k[h]=t;d.push(t);j.push(t)}break}d.length<=g&&d.push(null)}return d},commitAdInstance:function(){if(this.isRenderer()&&
c.isStarted()){for(var b=0;b<j.length;b++){var d=j[b];d&&d.getSlot().playCompanionAds(d)}j=[]}else a.warn("Skipping RendererController.commitAdInstance when called with driving ad not started or completed.")},isRenderer:function(){return d&&a.MODULE_TYPE_RENDERER===d.info()[a.INFO_KEY_MODULE_TYPE]},isTranslator:function(){return d&&a.MODULE_TYPE_TRANSLATOR===d.info()[a.INFO_KEY_MODULE_TYPE]},playable:function(){return h===a.RendererInitState.instance},reset:function(){h=a.RendererInitState.instance},
play:function(){for(var a=c.getRenderableCreativeRenditions()||[],b=null,d=0;d<a.length;d++){var f=a[d];if(b=this._matchRendererClassName(f)){c.setActiveCreativeRendition(f);break}}0===k&&this._actualPlay(b)},_actualPlay:function(b){(f=a.Util.getObject(b)||a.Util.getObject(v+"."+b))&&(d=new f);d?h.start(this):this.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Renderer class <"+b+"> not found"})},dispatchEvent:function(a,c){b.dispatchEvent(a,c)},requestContentStateChange:function(b){b?
this.dispatchEvent(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST):this.dispatchEvent(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST)},getRenderer:function(){return d},setRenderer:function(a){d=a},setRendererState:function(a){h=a},getContentVideoElement:function(){return b.getContentVideoElement()},_restorePlaceholdersForHybrid:function(){if(i&&this.isRenderer()){for(var a=[],b=0;b<c._companionAdInstances.length;b++){var d=c._companionAdInstances[b],f=i[d];f?a.push(f):a.push(d)}c._companionAdInstances=a}0<j.length&&this.isRenderer()&&
(j=[])},rendererMatch:function(b){return f?f===a.Util.getObject(this._matchRendererClassName(b)):!0},_matchRendererClassName:function(d){function f(b,c,d){a.debug("matching "+b+" within "+c);if(!c)return!0;c=c.split(",");c[c.length-1]||c.pop();if(d){b=b.toLowerCase();for(d=0;d<c.length;d++)if(b==c[d].toLowerCase())return!0;a.debug("not match");return!1}(c=0<=c.indexOf(b))||a.debug("not match");return c}var i=d.getPrimaryCreativeRenditionAsset().getContentType(),h=d.getContentType(),j=d.getWrapperType(),
o=d.getCreativeApi(),J=d.getBaseUnit(),t=c.getSoAdUnit(),z=c.getSlot();z.getType();z=z.getTimePositionClass();a.debug("match renderer for creativeRendition:"+d.getId());if(a.Util.isBlank(h)&&a.Util.isBlank(j))return a.warn("renderer not match due to both contentType and wrapperType are empty"),null;var s=b._rendererManifest["*"];s||(s=b._rendererManifest[j]);s||(s=b._rendererManifest[h]);if(!s)for(var L=b._overriddenAdRenderers.concat(b._adResponse._adRenderers),I=0;I<L.length;I++){var r=L[I],w=!r.contentType;
w||(j?w=f(j,r.contentType,!0):(i&&(w=f(i,r.contentType,!0)),w||(w=f(h,r.contentType,!0))));if(w)if((w=!r.creativeApi)||(w=f(o,r.creativeApi)),w)if(r.baseUnit&&!f(J,r.baseUnit))a.debug("can't match renderer "+r.url+" due to baseUnit not match for creativeRendition:"+d.getId());else if(r.soAdUnit&&!f(t,r.soAdUnit))a.debug("can't match renderer "+r.url+" due to soAdUnit not match for creativeRendition:"+d.getId());else if(r.slotType&&!f(z.toUpperCase(),r.slotType.toUpperCase()))a.debug("can't match renderer "+
r.url+" due to slotType not match for creativeRendition:"+d.getId());else{if(a.debug("renderer "+r.url+" matched for creativeRendition:"+d.getId()),r.url){s=r.url;d=s.indexOf("?");-1!==d&&(s=s.substring(0,d));d=s.lastIndexOf("/");-1!==d&&(s=s.substring(d+1));d=s.lastIndexOf(".js");-1!==d&&(s=s.substring(0,d));var F={};if(r.parameter){d=[].concat(r.parameter);for(i=0;i<d.length;i++)if(d[i].hasOwnProperty("name"))F[d[i].name]=d[i].value;else for(var y in d[i])d[i].hasOwnProperty(y)&&(F[y]=d[i][y])}a.Util.getObject(v+
"."+s)&&(s=v+"."+s);if(a.Util.getObject(s))g=F,k=0;else{if(0<k)break;var u=this;y=1*this.getContext().getParameter("moduleLoadTimeout")||6E4;k=window.setTimeout(function(){k=-1;u.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Load renderer timeout, URL:"+r.url})},y);a.Util.lazyJavaScriptLoad(r.url,function(){a.log("async load renderer successful, URL:"+r.url);-1===k?a.debug("renderer loaded after timeout. WILL NOT PLAY."):(window.clearTimeout(k),k=0,g=F,u._actualPlay(s))})}break}}else a.debug("can't match renderer "+
r.url+" due to creative api not match for creativeRendition:"+d.getId());else a.debug("can't match renderer "+r.url+" due to contentType not match for creativeRendition:"+d.getId())}return s?s:!a.Util.isBlank(j)?null:"null/null"===h?v+".NullRenderer":null},_inferEventType:function(b){return b===a.EVENT_ERROR?a.EVENT_TYPE_ERROR:b===a.EVENT_AD_CLICK?a.EVENT_TYPE_CLICK:b===a.EVENT_AD_IMPRESSION||b===a.EVENT_AD_FIRST_QUARTILE||b===a.EVENT_AD_MIDPOINT||b===a.EVENT_AD_THIRD_QUARTILE||b===a.EVENT_AD_COMPLETE||
b===a.EVENT_RESELLER_NO_AD?a.EVENT_TYPE_IMPRESSION:b===a.EVENT_AD_PAUSE||b===a.EVENT_AD_RESUME||b===a.EVENT_AD_REWIND||b===a.EVENT_AD_MUTE||b===a.EVENT_AD_UNMUTE||b===a.EVENT_AD_COLLAPSE||b===a.EVENT_AD_EXPAND||b===a.EVENT_AD_MINIMIZE||b===a.EVENT_AD_CLOSE||b===a.EVENT_AD_ACCEPT_INVITATION?a.EVENT_TYPE_STANDARD:b===a.EVENT_AD_MEASUREMENT||b==a.EVENT_AD_VOLUME_CHANGE||b===a.EVENT_AD_BUFFERING_START||b===a.EVENT_AD_BUFFERING_END||a.EVENT_AD_INITIATED?a.EVENT_TYPE_GENERIC:null},pause:function(){a.log("RendererController.pause");
d&&"function"===typeof d.pause?d.pause():a.log("Renderer.pause() is not implemented.")},resume:function(){a.log("RendererController.resume");d&&"function"===typeof d.resume?d.resume():a.log("Renderer.resume() is not implemented.")},stop:function(){a.log("RendererController.stop");0<k&&(k=-1);h.stop(this)}}};a.RenditionSelector=function(a,c,d,f){this._targetByterate=a;this._arWeight=c;this._pxWeight=d;this._conversionFactor=f};a.RenditionSelector.prototype={getBestFitRendition:function(b,c,d){var f=
this;b.reverse();b=b.filter(function(b){return b&&b.getPrimaryCreativeRenditionAsset()&&(b.getPrimaryCreativeRenditionAsset().getUrl()||b.getPrimaryCreativeRenditionAsset().getContent())&&a.Util.canPlayVideoType(b.getPrimaryCreativeRenditionAsset().getMimeType())}).sort(function(a,b){return f.getBitrate(a)-f.getBitrate(b)});if(!b.length)return null;var g=Number.MAX_VALUE,h=b.filter(function(a){a=f.getBitrate(a);g=a<g?a:g;return a<=f._targetByterate});h.length||(h=b.filter(function(a){return f.getBitrate(a)<=
g}));return h.sort(function(a,b){return f.compareVisualMetrics(a,b,c,d)}).pop()},compareVisualMetrics:function(a,c,d,f){var g=this.calculateVisualRatios(a.getWidth(),a.getHeight(),d,f),f=this.calculateVisualRatios(c.getWidth(),c.getHeight(),d,f);if(!g&&f)return-1;if(g&&!f)return 1;if(g&&f){var d=this._conversionFactor*this._arWeight*Math.log(g.arRatio),h=this._pxWeight*Math.log(g.pixelation),g=this._conversionFactor*this._arWeight*Math.log(f.arRatio),f=this._pxWeight*Math.log(f.pixelation),d=this.findDistance(d,
h,0,0),g=this.findDistance(g,f,0,0);if(g!=d)return g-d}return a.getPreference()-c.getPreference()},calculateVisualRatios:function(a,c,d,f){if(0<a&&0<c&&0<d&&0<f){var g=a/c,h=d/f;g>h?f=d/g:d=f*g;return{arRatio:g/h,pixelation:a*c/(d*f)}}return null},findDistance:function(a,c,d,f){return isNaN(a)||isNaN(d)||isNaN(c)||isNaN(f)?NaN:Math.sqrt(Math.pow(d-a,2)+Math.pow(f-c,2))},getBitrate:function(a){var c=a.getDuration();return(a=a.getPrimaryCreativeRenditionAsset().getBytes())&&c&&!isNaN(a)&&!isNaN(c)&&
0<a&&0<c?8*a/1E3/c:-1}};a.RenditionSelector.prototype.constructor=a.RenditionSelector;a.Slot=function(b){var c="",d=null,f=null,g=null,h=null,i=[],j=[],k={},m=null,l=a.MediaInitState.instance,n=0,q=null,C,o,J,t,z,s,v=0,I=0,r=[],w=!1,F=!1,y=!0,u=[],A,H;return{getSlotProfile:function(){return f},setSlotProfile:function(a){f=a},setMediaState:function(a){l=a},setParameter:function(a,b){null===b?delete k[a]:k[a]=b},getParameter:function(a){if(a&&k.hasOwnProperty(a))return k[a]},getAdCount:function(){return i.length},
setCustomId:function(a){c=a},getCustomId:function(){return c},setAdUnit:function(a){z=a},getAdUnit:function(){return z},setType:function(a){d=a},getType:function(){return d},setTimePosition:function(a){o=a},getTimePosition:function(){return o},setTimePositionClass:function(a){q=a&&a.toUpperCase()},getTimePositionClass:function(){return q},setWidth:function(a){J=a},getWidth:function(){return q!==a.TIME_POSITION_CLASS_DISPLAY?J?J:b.getVideoDisplaySize().width:J},setHeight:function(a){t=1*a},getHeight:function(){return q!==
a.TIME_POSITION_CLASS_DISPLAY?t?t:b.getVideoDisplaySize().height:t},setBase:function(a){C=a},getBase:function(){return C},setCuepointSequence:function(a){s=1*a?1*a:0},getCuepointSequence:function(){return s},getVideoDisplaySize:function(){return b.getVideoDisplaySize()},setMaxDuration:function(a){v=1*a?1*a:0},getMaxDuration:function(){return v},setMinDuration:function(a){I=1*a?1*a:0},getMinDuration:function(){return I},setAcceptContentType:function(a){if(a&&a.trim()){acceptContentTypeRaw=a.split(",");
for(a=0;a<acceptContentTypeRaw.length;a++)r.push(acceptContentTypeRaw[a].trim())}},getAcceptContentType:function(){return r.join(",")},parse:function(d){if(d){c=d.customId;o=1*d.timePosition;q=d.timePositionClass&&d.timePositionClass.toUpperCase()||q;z=d.adUnit;for(var f,g=0,h=d.eventCallbacks||[];g<h.length;g++){f=h[g];var k=a.EventCallback.newEventCallback(b,f.name,f.type);if(k)k._slot=this,k.parse(f),j.push(k)}for(g=0,h=d.selectedAds||[];g<h.length;g++)f=h[g],d=[],k=new a.AdInstance(b),d.push(k),
k._slot=this,k._slotCustomId=c,k._parentAdInstancesGroup=d,k.parse(f),i.push(d)}},getCurrentAdInstance:function(){return g},isPauseSlot:function(){return q===a.TIME_POSITION_CLASS_PAUSE_MIDROLL},play:function(b){for(var c=this.getAdInstances(),d=0;d<c.length;d++)c[d]._isSkipped=!1;q===a.TIME_POSITION_CLASS_DISPLAY&&!y?(a.log("Slot is invisible. Push the play operation to the queue."),u.push({operation:this.play,argument:b})):(a.log("Slot.play",q),w=!1,q===a.TIME_POSITION_CLASS_DISPLAY&&1<i.length&&
i.splice(0,i.length-1),this._play(b))},stop:function(){a.log("Slot.stop",q);q===a.TIME_POSITION_CLASS_DISPLAY&&(u=[]);l===a.MediaInitState.instance||l===a.MediaEndState.instance?a.log("Slot.stop, not start or already end, ignore"):(w=!0,g?g.stop():a.warn("Slot.stop, no _currentAdInstance, ignore"))},pause:function(){a.log("Slot.pause");q!==a.TIME_POSITION_CLASS_DISPLAY?g&&g.pause():a.log("Not a temporal slot. Ignore.")},resume:function(){a.log("Slot.resume");q!==a.TIME_POSITION_CLASS_DISPLAY?g&&g.resume():
a.log("Not a temporal slot. Ignore.")},skipCurrentAd:function(){a.log("Slot.skipCurrentAd ",g);g?g.skip():a.log("Slot.skipCurrentAd, no _currentAdInstance, ignore")},setVisible:function(b){if(q!==a.TIME_POSITION_CLASS_DISPLAY)a.log("Slot.setVisible is only for display ads.");else if(a.log("Slot.setVisible",b),y!=b&&(y=b))for(;0<u.length;)op=u.pop(),op.operation&&op.operation.call(this,op.argument)},_play:function(a){m=m||a;l.play(this)},onStartPlaying:function(){this._onStartPlaying()},onStartReplaying:function(){this._onStartPlaying()},
onCompletePlaying:function(){this._onCompletePlaying()},onCompleteReplaying:function(){this._onCompletePlaying()},playNextAdInstance:function(){a.log("Slot.playNextAdInstance ",q);this._playNextAdInstance()||l.complete(this)},scheduleAdInstance:function(){return h=g.cloneForTranslation()},_clearScheduledAdInstance:function(){h=null},_onStartPlaying:function(){var b=a.EventCallback.getEventCallback(j,a.EVENT_SLOT_IMPRESSION,a.EVENT_TYPE_IMPRESSION);b&&b.process();this.dispatchSlotEvent(a.EVENT_SLOT_STARTED);
this.playNextAdInstance()},dispatchSlotEvent:function(a){F||b.dispatchEvent(a,{slot:this})},_onCompletePlaying:function(){m&&m();m=null;u=[];var b=a.EventCallback.getEventCallback(j,a.EVENT_SLOT_END,a.EVENT_TYPE_IMPRESSION);b&&b.process();g=null;this.dispatchSlotEvent(a.EVENT_SLOT_ENDED)},_playNextAdInstance:function(){if(w||l!==a.MediaPlayingState.instance&&l!==a.MediaReplayingState.instance)return!1;this._commitScheduledAdInstance();g=this._nextPlayableAdInstance();if(!g)return!1;g.reset();if(!g._isInitiatedSent)g.getRendererController().processEvent({name:a.EVENT_AD_INITIATED}),
g._isInitiatedSent=!0;g.getRendererController().play();return!0},_commitScheduledAdInstance:function(){if(h){var a=g._parentAdInstancesGroup.indexOf(g);if(0<=a)h._parentAdInstancesGroup=g._parentAdInstancesGroup,g._parentAdInstancesGroup.splice(a,1,h),h=null}},_nextPlayableAdInstance:function(){var b=-1;if(g){var c=g._parentAdInstancesGroup,d=c.indexOf(g),b=i.indexOf(c);0<=b&&0<=d&&(g._isImpressionSent||g._isSkipped||d==c.length-1)&&b++}else b=0;if(0>b||b>=i.length)return null;if(l===a.MediaPlayingState.instance){c=
i[b];for(d=0;d<c.length;d++){var f=c[d];if(f.getRendererController().playable())return f}}else if(l===a.MediaReplayingState.instance)for(;b<i.length;b++){c=i[b];for(d=0;d<c.length;d++)if(f=c[d],f._isImpressionSent)return f;for(d=0;d<c.length;d++)if(f=c[d],f.getRendererController().getRendererState()!==a.RendererFailedState.instance&&!f._translated)return f}return null},toString:function(){return"[Slot "+c+"]"},getAdInstances:function(){for(var a=[],b=0;b<i.length;++b)for(var c=i[b],d=0;d<c.length;++d){var f=
c[d];if(f.isPlayable()){a.push(f);break}}return a},getPlayheadTime:function(){for(var a=0,b=this.getAdInstances(),c=0;c<b.length;++c)if(b[c]===g){b=g.getPlayheadTime();-1<b&&(a+=b);break}else{var d=b[c].getDuration();-1<d&&(a+=d)}n&&a>n&&(a=n);return a},getTotalDuration:function(){if(d!=a.SLOT_TYPE_TEMPORAL)return-1;for(var b=0,c=this.getAdInstances(),f=0;f<c.length;++f){var g=c[f].getDuration();-1<g&&(b+=g)}return n=b},playCompanionAds:function(b){a.log("Slot.playCompanionAds");var c=[];b._parentAdInstancesGroup=
c;c.push(b);i.push(c);F=!0;g&&this.stop();this.play()},getState:function(){return l},setAcceptCompanion:function(a){A=a},getAcceptCompanion:function(){return A},setInitialAdOption:function(a){H=a},getInitialAdOption:function(){return H}}};a.SurveyExtension=function(){this._surveyPingedIds=[]};a.SurveyExtension.prototype={init:function(b){this._context=b;a.log("SurveyExtension.init("+Array.prototype.slice.call(arguments).join(",")+")");this._onAdStarted=a.Util.bind(this,function(b){this._parameters=
this._getParameters();if(this._parameters.enabled){a.log("SurveyExtension.onAdStarted()");var d=b.adInstance;if(-1<this._surveyPingedIds.indexOf(d.getAdId()))a.log("won't pingback survey since it has been pinged back");else{var f=d._creative.getParameter("_fw_survey_url");if(f)try{a.log("append"+f+" to head");var g=document.getElementsByTagName("head")[0],h=document.createElement("script");h.setAttribute("type","text/javascript");h.setAttribute("src",f);g.appendChild(h);this._surveyPingedIds.push(d.getAdId())}catch(i){a.warn("Append survey to head",
b.type,e)}}}});this._context.addEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted)},dispose:function(){a.log("SurveyExtension.dispose()");this._context.removeEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted);this._parameters=this._onAdStarted=null},_getParameters:function(){var b={};b.enabled="false"!=this._context.getParameter(a.PARAMETER_EXTENSION_SURVEY_ENABLED);a.log(b);return b}};a.SurveyExtension.prototype.constructor=a.SurveyExtension;a.Timer=function(a,c){this._lastTickDate=new Date;
this._duration=a||-1;this._playheadTime=-1;this._callback=c;this._state=-1};a.Timer.prototype={};a.Timer.prototype.constructor=a.Timer;a.Util.mixin(a.Timer.prototype,{tick:function(){var a=new Date,c=Math.round((a.getTime()-this._lastTickDate.getTime())/1E3);this._lastTickDate=a;return c},start:function(){if(0!==this._state){if(2===this._state||-1===this._playheadTime)this._playheadTime=0;this._state=0;this._timeStamp=new Date;if(this._timeouter)window.clearTimeout(this._timeouter),this._timeouter=
null;var a=this,c=1E3*(this._duration-this._playheadTime);if(!(0>c))this._timeouter=window.setTimeout(function(){a.stop();a._playheadTime=a._duration;a._callback&&a._callback()},c)}},pause:function(){if(0===this._state){this._state=1;if(this._timeouter)window.clearTimeout(this._timeouter),this._timeouter=null;this._playheadTime=(new Date-this._timeStamp)/1E3+this._playheadTime}},stop:function(){this._state=2;if(this._timeouter)window.clearTimeout(this._timeouter),this._timeouter=null;this._playheadTime=
(new Date-this._timeStamp)/1E3+this._playheadTime},getPlayheadTime:function(){return 0===this._state?(new Date-this._timeStamp)/1E3+this._playheadTime:this._playheadTime},getCTValue:function(){return(new Date-this._timeStamp)/1E3},getDuration:function(){return this._duration}});a.VastTranslator=function(){this._rendererController=this._request=null};a.VastTranslator.prototype={start:function(b){function c(b){a.log("VastTranslator\t"+b)}function d(b){a.warn("VastTranslator\t"+b)}function f(a,b){if(a)if(a.length&&
"string"!==typeof a)for(var c=0;c<a.length;c++)b(a[c].value);else a.value&&b(a.value)}function g(a,b){f(b,function(b){b&&a.push(b)})}function h(b){if(!b)return!1;for(var c=0;c<w.length;c++)if(a.Util.trim(w[c]).toLowerCase()===a.Util.trim(b).toLowerCase())return!0;return!1}function i(b){if(!b)return null;"string"!==typeof b&&(b=b.toString());b=a.Util.trim(b);return-1<b.indexOf("://")?b:null}function j(a){this.code=this.url=null;this.height=this.width=NaN;this.resourceType=this.creativeType=null;this.bitrate=
NaN;this.creativeApi=null;this.ad=a;this.clickThrough=null;this.clickTrackings=[];this.customClicks=[];this.creativeData=null}function k(){this.creativeView=[];this.start=[];this.firstQuartile=[];this.midpoint=[];this.thirdQuartile=[];this.complete=[];this.mute=[];this.unmute=[];this.pause=[];this.rewind=[];this.resume=[];this.replay=[];this.fullscreen=[];this.expand=[];this.collapse=[];this.acceptInvitation=[];this.stop=[]}function m(a){this._impressions=[];this.clickThrough=null;this.clickTrackings=
[];this.customClicks=[];this.creativeData=null;this.sequence=-1;this.vastRenditions=[];this.duration=NaN;this.adp=a;this.isDrivingAd=!1}function l(a){m.call(this,a)}function n(a){m.call(this,a)}function q(a){m.call(this,a)}function C(){}function o(a,b,d,f){if(a&&f&&0<f.length){c("augmentCallbacks("+b+", "+d+", "+f+")");for(var g=a.getEventCallbackUrls(b,d),h=0;h<g.length;h++)-1<f.indexOf(g[h])&&(c("augmentCallbacks() url = "+g[h]),f.unshift(g[h]));a.addEventCallbackUrls(b,d,f)}else c("augmentCallbacks("+
b+", "+d+", "+f+"), empty callbacks")}function v(b,d){c("initErrorTrackings()");if(b&&d){for(var f=d.errorTrackings,g=0;g<f.length;g++)-1<f[g].search("[ERRORCODE]")&&(f[g]=f[g].replace("[ERRORCODE]","900"));o(b,a.EVENT_ERROR,a.EVENT_TYPE_ERROR,d.errorTrackings)}}function t(b,d){c("initTrackingEvents()");d&&b&&(o(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,d.creativeView),o(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,d.start),o(b,a.EVENT_AD_FIRST_QUARTILE,a.EVENT_TYPE_IMPRESSION,d.firstQuartile),
o(b,a.EVENT_AD_MIDPOINT,a.EVENT_TYPE_IMPRESSION,d.midpoint),o(b,a.EVENT_AD_THIRD_QUARTILE,a.EVENT_TYPE_IMPRESSION,d.thirdQuartile),o(b,a.EVENT_AD_COMPLETE,a.EVENT_TYPE_IMPRESSION,d.complete),o(b,a.EVENT_AD_MUTE,a.EVENT_TYPE_STANDARD,d.mute),o(b,a.EVENT_AD_UNMUTE,a.EVENT_TYPE_STANDARD,d.unmute),o(b,a.EVENT_AD_PAUSE,a.EVENT_TYPE_STANDARD,d.pause),o(b,a.EVENT_AD_RESUME,a.EVENT_TYPE_STANDARD,d.resume),o(b,a.EVENT_AD_REWIND,a.EVENT_TYPE_STANDARD,d.rewind),o(b,a.EVENT_AD_EXPAND,a.EVENT_TYPE_STANDARD,d.fullscreen),
o(b,a.EVENT_AD_COLLAPSE,a.EVENT_TYPE_STANDARD,d.collapse),o(b,a.EVENT_AD_EXPAND,a.EVENT_TYPE_STANDARD,d.expand),o(b,a.EVENT_AD_CLOSE,a.EVENT_TYPE_STANDARD,d.stop),o(b,a.EVENT_AD_ACCEPT_INVITATION,a.EVENT_TYPE_STANDARD,d.acceptInvitation))}function z(b,d,f,g,h){c("initClickAndImpressionEvents");if(b){d&&b.setClickThroughUrl(a.EVENT_AD_CLICK,d);f&&0<f.length&&o(b,a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK_TRACKING,f);if(g&&0<g.length)for(d=0;d<g.length;d++)g[d].url&&o(b,g[d].id,a.EVENT_TYPE_CLICK_TRACKING,
[g[d].url]);h&&o(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,h)}}function s(a,b){c("initTemporalAdInstance");a||d("initTemporalAdInstance: Invalid adInstance");if(b.selectedDrivingAd){b.surveyUrl&&a._creative.setParameter("_fw_survey_url",b.surveyUrl);var f=b.selectedDrivingAd,g=b.selectedDrivingRenditions;c("vastRenditions:"+g);for(var i=H===F,j=0;j<g.length;j++){var k=g[j],l=a.addCreativeRendition(),p=l.addCreativeRenditionAsset("VAST_CRA",!0),m;a:switch(m=k.creativeType,m){case "video/mp4":m=
"video/mp4-h264";break a;case "video/3gp":m="video/3gpp";break a}c("initTemporalAdInstance() set rendition/asset [vastRd.creativeApi,vastAd.duration,vastRd.width,vastRd.height,vastRd.url,assetContentType,vastRd.creativeType] =  "+[k.creativeApi,f.duration,k.width,k.height,k.url,m,k.creativeType]);l.setCreativeApi(k.creativeApi);isNaN(f.duration)||l.setDuration(f.duration);k.width&&!isNaN(k.width)&&l.setWidth(k.width);k.height&&!isNaN(k.height)&&l.setHeight(k.height);k.url&&p.setUrl(k.url);k.code&&
p.setContent(k.code);p.setMimeType(k.creativeType);"static"===k.resourceType&&"text/html"===k.creativeType?p.setContentType("text/html_doc_ref"):"application/x-javascript"===k.creativeType||"application/javascript"===k.creativeType?p.setContentType("text/js_ref"):"iframe"===k.resourceType?p.setContentType("text/html_doc_ref"):"text/html"===k.creativeType||"text/html_doc_ref"===k.creativeType?p.setContentType("text/html_doc_ref"):"text/html_doc_lit_mobile"===k.creativeType?p.setContentType("text/html_doc_lit_mobile"):
i||h(m)?(p.setContentType("text/html_doc_lit_mobile"),p.setUrl(null),p.setContent(L(a,A.getCustomId(),f,k,"text/html_doc_lit_mobile"))):p.setContentType(m);f.creativeData&&0!==f.creativeData.length&&(c("initTemporalAdInstance(), set asset parameter VPAID_creativeData:"+f.creativeData),l.setParameter("VPAID_creativeData",f.creativeData));if(!i&&!h(m))k=k.bitrate,!isNaN(k)&&0<k&&p.setBytes(1E3*k*f.duration/8);m=D;p=N;k=!1;if(l.getContentType()&&m){var n=l.getContentType().toLowerCase(),o=m.toLowerCase();
if(n==o)k=!0;else if(0==n.indexOf("video/mp4")&&0==o.indexOf("video/mp4")||"application/javascript"==o&&"text/js_ref"==n)l.setContentType(m),k=!0}m=!1;l.getCreativeApi()&&p&&(n=l.getCreativeApi().toLowerCase(),o=p.toLowerCase(),n==o?m=!0:0==n.indexOf("mraid")&&0==o.indexOf("mraid")&&(m=!0,l.setCreativeApi(p)));k&&m?l.setPreference(10):m?l.setPreference(6):k?l.setPreference(5):l.setPreference(0);c("adjustMatchedRendition "+l.getId()+", contentType "+l.getContentType()+", creativeAPI "+l.getCreativeApi()+
", preference "+l.getPreference())}t(a,f.trackingEvents);v(a,b);z(a,i?g[0].clickThrough:f.clickThrough,f.clickTrackings,f.customClicks,f.impressions)}else{var l=a.addCreativeRendition();l.setContentType("null/null");var p=l.addCreativeRenditionAsset("VAST_CRA",!0);p.setContentType("null/null")}}function L(b,d,f,g,h){c("getCoadHTML, ad id = "+b.getAdId());return g.url&&0<g.url.length?((f=g.clickThrough)&&0<f.length&&b.setClickThroughUrl(a.EVENT_AD_CLICK,f),b=b.getEventCallbackUrls(a.EVENT_AD_CLICK,
a.EVENT_TYPE_CLICK)[0],a.HTMLAdGenerator.generateAd(g.url,b,d,g.width,g.height,g.creativeType,h)):g.code&&0<g.code.length?"script"===g.resourceType||"text/javascript"===g.resourceType||"text/js_ref"===g.resourceType||"application/x-javascript"===g.resourceType?a.HTMLAdGenerator.wrapJSCode(g.code,d,g.width,g.height):a.HTMLAdGenerator.wrapUnsafeHTML(g.code,d,g.width,g.height):null}function I(b,d,f,g){c("initPageAdInstance ad:"+d.getAdId());var h=f.vastRenditions[0];if(h.url||h.code){var i=d.addCreativeRendition(),
j=i.addCreativeRenditionAsset("VAST_CRA",!0);i.setCreativeApi(h.creativeApi);i.setWidth(h.width);i.setHeight(h.height);"static"===h.resourceType&&"text/html"===h.creativeType?(j.setContentType("text/html_doc_ref"),j.setUrl(h.url)):"iframe"===h.resourceType?(j.setContentType("text/html_doc_ref"),j.setUrl(h.url)):"HTML"===h.resourceType?(j.setContentType("text/html_doc_lit_mobile"),j.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(h.code,b.getCustomId(),h.width,h.height))):(j.setContentType("text/html_doc_lit_mobile"),
j.setContent(L(d,b.getCustomId(),f,h,"text/html_doc_lit_mobile")));j.setMimeType("text/html")}else c("initPageAdInstance will add a tracking only companion ad");t(d,f.trackingEvents);v(d,g);z(d,h.clickThrough,h.clickTrackings,h.customClicks,f.impressions)}function r(d){if(200==d.status)if(d.responseXML){var f=(new C).parseAdData(d.responseXML);if(f){c("scheduleVastAds");if(!f||0===f.length)c("no ads for scheduleVastAds");else if(d=f[0].selectedPackage,f=f[0].redirectPackage,!d&&!f)c("scheduleVastAds(), no ads from vast response!!!"),
u.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE);else if(!d&&f){c("scheduleVastAds(), no ads scheduled, redirect to downstream Secondary Ad Server");c("scheduleRedirect");var d=[],g=[];d.push(A);g.push({});for(var h=K,i=f.selectedCompanionAds,j=0;j<h.length;j++){var k=h[j];i&&i[k.getCustomId()]&&(d.push(k),g.push(i[k.getCustomId()]))}if((h=b.scheduleAdInstances(d))&&0<h.length)i=h[0],j=i.addCreativeRendition(),j.setWrapperUrl(a.Util.transformUrlToProxy(f.tagUrl)),j.setWrapperType(P),j.setContentType(D),
j.setCreativeApi(N),t(i,f.getTrackingEventsOfWrapper()),v(i,f),z(i,f.getClickThroughOfWrapper(),f.getClickTrackingsOfWrapper(),f.getCustomClicksOfWrapper(),f.getImpressionOfWrapper());c("scheduleRedirect, schedule companion for redirect ad ",f);for(j=1;j<h.length;j++)if(i=h[j])k=g[j],k instanceof q&&I(d[j],i,k,f)}else if(d){c("scheduleVastAds(), ads returned from vast response, going to schedule them");d.selectedDrivingAd?(c("scheduleVastAds(), ads returned from vast response, going to schedule them with driving ad"),
d.selectedDrivingAd.isDrivingAd=!0):c("scheduleVastAds(), ads returned from vast response, going to schedule them without driving ad");c("scheduleAdPackage()");f=[];g=[];f.push(A);d.selectedDrivingAd&&g.push(d.selectedDrivingAd);h=K;i=d.selectedCompanionAds;for(j=0;j<h.length;j++)k=h[j],i&&i[k.getCustomId()]&&(f.push(k),g.push(i[k.getCustomId()]));i=b.scheduleAdInstances(f);if(0<i.length){c("scheduleAdPackage, scheduled "+i.length+" ads"+d.selectedDrivingAd?"":", 1 of it is nullAd for pure companion ad schedule");
d.selectedDrivingAd||c("Driving ad is not selected, will create a dummy null ad.");d.selectedDrivingAd||(f.shift(),s(i.shift(),d));for(j=0;j<i.length;j++)if(k=i[j]){var l=g[j];l instanceof q?I(f[j],k,l,d):s(k,d)}!d.selectedDrivingAd&&0<h.length&&0<d.companionAds.length&&0===g.length&&(c("found empty companion slots and companion ads in package, but none of them matches slot size"),u.onTranslatorFailed(a.ERROR_UNMATCHED_SLOT_SIZE))}else c("scheduleAdPackage, no ad scheduled.")}u._request=null;b.handleStateTransition(a.TRANSLATOR_STATE_STARTED);
b.handleStateTransition(a.TRANSLATOR_STATE_COMPLETED)}}else u.onTranslatorFailed(a.ERROR_PARSE,"wrapperUrl="+p);else if(400<=d.status)u.onTranslatorFailed(a.ERROR_IO,"wrapperUrl="+p)}this._rendererController=b;var w="image/gif,image/jpeg,image/png,text/html,text/javascript,text/html_doc_ref,text/html_doc_lit_mobile,application/x-javascript,application/javascript".split(","),F=4,y=b.getAdInstance(),u=this,A=y.getSlot(),H=function(){if(!A)return 1;switch(A.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return 2;
case a.TIME_POSITION_CLASS_OVERLAY:return F;case a.TIME_POSITION_CLASS_DISPLAY:return A&&!A.getBase()?8:1;default:return 1}}(),K=b.getCompanionSlots().filter(function(b){if(!b)return!1;switch(b.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return!1;default:return!0}});c("Checking CompanionSlots, length = "+K.length+", rendererController.getCompanionSlots().length = "+b.getCompanionSlots().length+
", AdInstance.getCompanionSlots.length = "+y.getCompanionSlots().length);var D=y.getActiveCreativeRendition().getContentType(),N=y.getActiveCreativeRendition().getCreativeApi()||"None";this.log("ExpectedDrivingContentType:"+D+", ExpectedDrivingAPI:"+N);var P=y.getActiveCreativeRendition().getWrapperType();j.prototype={init:function(a,b,c,d,f,g,h,i){this.log("init("+[].slice.call(arguments,0).join(",")+")");this.url=a;this.width=1*b;this.height=1*c;this.creativeType=d;this.resourceType=f;this.bitrate=
g;var j;j=h;if(!j||0===j.length)j="None";else{var k="";switch(j.toLowerCase()){case "flashvar":case "flashvars":k="clickTag";break;case "vpaid":k="VPAID";break;case "mraid":k="MRAID-1.0";break;default:k=j}j=k}this.creativeApi=j;this.code=i||null},log:function(b){a.log("VastTranslator.VastRendition\t"+b)},toString:function(){var a=[],b;for(b in this)this.hasOwnProperty(b)&&"function"!==typeof this[b]&&"ad"!==b&&a.push(b+":"+this[b]);return a.join(",")}};j.prototype.constructor=j;m.prototype={parse:function(b){this.log("parse()");
if(b.Duration)if(b.Duration.value){var c=/(\d+):(\d+):(\d+)/.exec(b.Duration.value);c?this.duration=3600*c[1]+60*c[2]+1*c[3]:this.warn("Failed to parse duration value for creative "+b)}else this.warn("No duration value set for creative "+b);if(b.VideoClicks)b.VideoClicks=[].concat(b.VideoClicks),a.Util.forEachOnArray(b.VideoClicks,function(a){if(a.ClickThrough&&a.ClickThrough.value)this.clickThrough=i(a.ClickThrough.value);if(a.ClickTracking){a.ClickTracking=[].concat(a.ClickTracking);for(var b=0;b<
a.ClickTracking.length;b++){var c=i(a.ClickTracking[b].value);c&&this.clickTrackings.push(c)}}if(a.CustomClick){a.CustomClick=[].concat(a.CustomClick);for(b=0;b<a.CustomClick.length;b++){var d=null;a.CustomClick[b]["@attributes"]&&(d=a.CustomClick[b]["@attributes"].id);(c=i(a.CustomClick[b].value))&&this.customClicks.push({id:d,url:c})}}},this);if(b.MediaFiles&&b.MediaFiles.MediaFile)b.MediaFiles.MediaFile=[].concat(b.MediaFiles.MediaFile),a.Util.forEachOnArray(b.MediaFiles.MediaFile,function(a){var b=
i(a.value),c=NaN,d=NaN,f=null,g="None",h=NaN;if(a["@attributes"])c=a["@attributes"].width||NaN,d=a["@attributes"].height||NaN,f=a["@attributes"].type,g=a["@attributes"].apiFramework||"None",h=a["@attributes"].bitrate||NaN;b&&-1!==b.indexOf(":")?(a=new j(this),a.init(b,c,d,f,"",h,g,null),a.clickThrough=this.clickThrough,this.vastRenditions.push(a),(isNaN(c)||isNaN(d))&&this.log("continue with missing [width,height]"+[c,d])):this.warn("will ignore this mediaFile because some required field is missing [url,width,height]:"+
[b,c,d])},this);b.TrackingEvents&&this.parseTrackingEvents(b.TrackingEvents,this.setTrackingEvents());if(b.AdParameters)this.log("parse() get a AdParameters:"+b.AdParameters.value),this.creativeData=b.AdParameters.value;if(b.Companion)b.Companion=[].concat(b.Companion),a.Util.forEachOnArray(b.Companion,function(b){var c=null,d=null,f="",g="",k=null,G=null,l=!1;b.CompanionClickThrough&&(g=i(b.CompanionClickThrough.value));if(b.StaticResource)c=i(b.StaticResource.value),b.StaticResource["@attributes"]&&
(d=b.StaticResource["@attributes"].creativeType),f="static";if(b.IFrameResource&&(c=i(b.IFrameResource.value)))d="text/html_doc_ref",f="iframe";if(b.HTMLResource&&(k=b.HTMLResource["#cdata-section"]||"",k=a.Util.trim(k)))d="text/html_doc_lit_mobile",f="HTML";if(b.TrackingEvents)G=b.TrackingEvents;var E=new q(this.adp);E.sequence=this.sequence;E.clickThrough=g;G&&E.parseTrackingEvents(G,E.setTrackingEvents());if(b["@attributes"]){var G=b["@attributes"].width||NaN,p=b["@attributes"].height||NaN,b=b["@attributes"].apiFramework||
"None";if((c&&-1!==c.indexOf(":")||k)&&!isNaN(G)&&!isNaN(p)&&h(d)||this.adp.isWrapper){var m=new j(E);m.init(c,G,p,d,f,NaN,b,k);m.clickThrough=g;E.vastRenditions.push(m)}else l=!0,this.warn("will ignore this rendition because some required fields is missing or incompatible [creativeType,url,code,width,height]:"+[d,c,k,G,p])}else this.adp.isWrapper||(l=!0,this.warn("for InLine ad package, No attributes found for the Companion ads:"+b));l?this.adp.isWrapper&&this.adp.companionAds.push(E):this.adp.companionAds.push(E)},
this);if(b.NonLinear)b.NonLinear=[].concat(b.NonLinear),a.Util.forEachOnArray(b.NonLinear,function(b){var c=null,d=null,f="",g="",k="",G=null,l=!1;if(b.AdParameters)k=b.AdParameters.value;b.NonLinearClickThrough&&(g=i(b.NonLinearClickThrough.value));if(b.StaticResource)c=i(b.StaticResource.value),b.StaticResource["@attributes"]&&(d=b.StaticResource["@attributes"].creativeType),f="static";b.IFrameResource&&(c=i(b.IFrameResource.value),d="text/html_doc_ref",f="iframe");b.HTMLResource&&(G=b.HTMLResource["#cdata-section"]||
"",G=a.Util.trim(G),d="text/html_doc_lit_mobile",f="HTML");var E=new n(this.adp);E.sequence=this.sequence;E.clickThrough=g;E._trackingEvents=this._trackingEvents;if(k)E.creativeData=k;if(b["@attributes"]){var k=b["@attributes"].width||NaN,p=b["@attributes"].height||NaN,b=b["@attributes"].apiFramework||"None";if((c||G)&&!isNaN(k)&&!isNaN(p)&&h(d)){var m=new j(E);m.init(c,k,p,d,f,NaN,b,G);m.clickThrough=g;E.vastRenditions.push(m)}else l=!0,this.warn("will ignore this rendition because some required fields is missing or incompatible:[creativeType,url,code,width,height]:"+
[d,c,G,k,p])}else this.adp.isWrapper||(l=!0,this.warn("for InLine ad package, No attributes found for the NonLinear ads:"+b));this.adp.nonLinearAds.push(E);l?this.adp.isWrapper&&this.adp.nonLinearAds.push(E):this.adp.nonLinearAds.push(E)},this)},parseLinears:function(a){2!=H?this.log("TargetAdType != TARGET_LINEAR, skipping parse"):this.parse(a)},parseNonLinears:function(a){H!==F?this.log("TargetAdType != TARGET_NONLINEAR, skipping parse"):this.parse(a)},parseCompanionAds:function(a){this.parse(a)},
setTrackingEvents:function(){if(!this._trackingEvents)this._trackingEvents=new k;return this._trackingEvents},parseTrackingEvents:function(b,c){this.log("parseTrackingEvents");if(b.Tracking)b.Tracking=[].concat(b.Tracking),a.Util.forEachOnArray(b.Tracking,function(a){var b=a["@attributes"].event;if(a=i(a.value))switch(b){case "creativeView":case "start":case "firstQuartile":case "midpoint":case "thirdQuartile":case "complete":case "mute":case "unmute":case "pause":case "resume":case "rewind":case "replay":case "fullscreen":case "expand":case "collapse":case "acceptInvitation":case "stop":c[b].push(a);
break;case "close":c.stop.push(a)}},this)},toString:function(){return this.constructor.name+", renditions:"+this.vastRenditions},log:function(b){a.log("VastTranslator."+this.constructor.name+"\t"+b)},warn:function(b){a.warn("VastTranslator."+this.constructor.name+"\t"+b)}};var B=Object.defineProperty||function(a,b,c){c.get&&a.__defineGetter__(b,c.get);c.set&&a.__defineSetter__(b,c.set)};B(m.prototype,"trackingEvents",{get:function(){this.log("get trackingEvents()");return this._trackingEvents?this._trackingEvents:
this.isDrivingAd?this.adp.trackingEvents:null}});B(m.prototype,"impressions",{set:function(a){this._impressions=a},get:function(){return this.isDrivingAd?this._impressions.concat(this.adp.impressions):this._impressions}});m.prototype.constructor=m;l.prototype=new m;l.prototype.constructor=l;n.prototype=new m;n.prototype.constructor=n;q.prototype=new m;q.prototype.getPrimaryRendition=function(){return this.vastRenditions[0]||null};B(q.prototype,"impressions",{get:function(){return 8===H?this._impressions.concat(this.adp.impressions):
this._impressions}});q.prototype.constructor=q;var M=function(){this.impressions=[];this.errorTrackings=[];this.linearAds=[];this.nonLinearAds=[];this.companionAds=[];this.extensions=[];this.tagUrl="";this.isWrapper=!1;this.surveyUrl=null;this.selectedDrivingRenditions=[];this.selectedDrivingAd=null;this.selectedCompanionAds={}};M.prototype={parse:function(a){this.log("parse("+a+")");if(a)if(!a.Creatives||!this.isWrapper&&!a.Creatives.Creative)this.warn("parse(): no creative found");else{g(this.impressions,
a.Impression);g(this.extensions,a.Extensions);g(this.errorTrackings,a.Error);if(this.isWrapper&&a.VASTAdTagURI)this.tagUrl=a.VASTAdTagURI.value||"";if(a.Survey&&a.Survey.value&&0<a.Survey.value.length)this.surveyUrl=a.Survey.value;a.Creatives.Creative=a.Creatives.Creative?[].concat(a.Creatives.Creative):[];for(var b=0;b<a.Creatives.Creative.length;b++){var c=a.Creatives.Creative[b],d=-1,f;c["@attributes"]&&(d=c["@attributes"].sequence||-1,d*=1);if(c.Linear)f=new l(this),f.sequence=d,f.parseLinears(c.Linear),
this.linearAds.push(f);else if(c.NonLinearAds)f=new n(this),f.sequence=d,f.parseNonLinears(c.NonLinearAds);else if(c.CompanionAds)f=new q(this),f.sequence=d,f.parseCompanionAds(c.CompanionAds)}}else this.warn("parse(): empty adpackage")},testAndUpdatePackageForTemporalSlot:function(a){this.log("testAndUpdatePackageForTemporalSlot("+a+")");a=a?this.linearAds:this.nonLinearAds;if(1>a.length)return!1;this.log("testAndUpdatePackageForTemporalSlot(), ads.length = "+a.length+"");var b=!1;if(!b)for(var c=
0;c<a.length;c++){var d=this.findRenditionGroupByContentType(a[c]);if(0<d.length){this.log("testAndUpdatePackageForTemporalSlot() : found driving ad and renditions group: "+d);this.selectedDrivingRenditions=d;this.selectedDrivingAd=a[c];b=!0;break}}return b},testAndUpdatePackageForPageSlots:function(a){var b=!1,c=this.companionAds,d=K.slice(0),f=null;this.log("testAndUpdatePackageForPageSlots("+a+"), ads are "+c.join(",")+", slots are "+d.join(","));if(a){if(f=this.matchAdsToSlots(c,d),0<f.length){b=
!0;for(a=0;a<f.length;a++)c=f[a],d=c.ad,this.selectedCompanionAds[c.slot.getCustomId()]=d}}else f=this.matchAdsToSlots(c,[A]),1===f.length?(b=!0,this.selectedDrivingAd=f[0].ad):this.selectedDrivingAd=null;return b},renditionFitsInSlot:function(a,b){return!a?!1:a.width<=b.getWidth()&&a.height<=b.getHeight()},calcDeadSpaceRatio:function(a,b){var c=a.getPrimaryRendition();if(!c)return!1;this.log("ad w,h  slot w,h"+[c.width,c.height,b.getWidth(),b.getHeight()]);return!this.renditionFitsInSlot(c,b)?1:
1-c.width*c.height/b.getWidth()*b.getHeight()},matchAdsToSlots:function(a,b){this.log("matchAdsToSlots(ads="+a.join(",")+", slots="+b.join(",")+")");for(var c=[],d=null,f=null,g=1,h=0;h<a.length;h++)for(var i=a[h],j=0;j<b.length;j++){var k=b[j],l=this.calcDeadSpaceRatio(i,k);l<g&&(d=i,f=k,g=l)}null!==d&&(c.push({ad:d,slot:f}),a.splice(a.indexOf(d),1),b.splice(b.indexOf(f),1),c=c.concat(this.matchAdsToSlots(a,b)));this.log("matchAdsToSlots: winningAd:"+d+" winningSlot:"+f+" ratio:"+g);return c},getAllRenditions:function(a){return a.vastRenditions},
findRenditionGroupByContentType:function(b){this.log("findRenditionGroupByContentType:"+b);var c=[];if(b instanceof l&&isNaN(b.duration))return this.warn("findRenditionGroupByContentType(), duration of linear ad is NaN, will not used for scheduling"),c;for(var d=this.getAllRenditions(b),f=0;f<d.length;f++){var g=d[f];if(b instanceof l){if(null==g.creativeType||""==a.Util.trim(g.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+g.creativeType+" not supported for linearAd");
continue}}else if(!h(g.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+g.creativeType+" not supported for non-linearAd");continue}c.push(g)}return c},formalizeString:function(b){return!b?"":a.Util.trim(b).toLowerCase()},getAdsByTargetType:function(){this.log("getAdsByTargetType");var a=[];switch(H){case 8:a=this.companionAds;break;case 2:a=this.linearAds;break;case F:a=this.nonLinearAds}for(var b=0;b<a.length;b++)a[b].isDrivingAd=!0;return a},getImpressionOfWrapper:function(){this.log("getImpressionOfWrapper");
for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d&&d._impressions&&0<d._impressions.length){b=d._impressions;break}}if(!b)b=this.impressions;return b},getTrackingEventsOfWrapper:function(){this.log("getTrackingEventsOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d&&d._trackingEvents){b=d._trackingEvents;break}}return b},getClickThroughOfWrapper:function(){this.log("getClickThroughOfWrapper");for(var a=this.getAdsByTargetType(),
b=null,c=0;c<a.length;c++){var d=a[c];if(d){if(d.clickThrough)b=d.clickThrough;for(var d=d.vastRenditions,f=0;f<d.length;f++){var g=d[f];if(g.clickThrough){b=g.clickThrough;break}}if(b)break}}return b},getClickTrackingsOfWrapper:function(){this.log("getClickTrackingsOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){if(d.clickTrackings&&0<d.clickTrackings.length)b=d.clickTrackings;for(var d=d.vastRenditions,f=0;f<d.length;f++){var g=d[f];if(g.clickTrackings&&
0<g.clickTrackings.length){b=g.clickTrackings;break}}if(b)break}}return b},getCustomClicksOfWrapper:function(){this.log("getCustomClicksOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){if(d.customClicks&&0<d.customClicks.length)b=d.customClicks;for(var d=d.vastRenditions,f=0;f<d.length;f++){var g=d[f];if(g.customClicks&&0<g.customClicks.length){b=g.customClicks;break}}if(b)break}}return b},testWrapperForRedirect:function(){this.log("testAndUpdateWrapperForRedirect()");
return this.tagUrl&&0<this.tagUrl.length},log:function(b){a.log("VastTranslator.VastAdPackage\t"+b)},warn:function(b){a.warn("VastTranslator.VastAdPackage\t"+b)}};M.prototype.constructor=M;C.prototype={getVastVersion:function(a){this.log("getVastVersion("+a+")");return a?0===a.indexOf("3.")?3:0===a.indexOf("2.")?2:0===a.indexOf("1.")?1:-1:-1},parseAdData:function(b){this.log("parseAdData()");var c={},d;c.selectedPackage=null;c.redirectPackage=null;var f=a.Util.xmlToJson(b);if(!f||!f.VAST||!f.VAST["@attributes"]||
2!==this.getVastVersion(f.VAST["@attributes"].version))u.onTranslatorFailed(a.ERROR_PARSE);else{if(f.VAST.Ad){f.VAST.Ad=[].concat(f.VAST.Ad);var g=[],b=[],h;for(d=0;d<f.VAST.Ad.length;d++)h=new M,h.isWrapper=!!f.VAST.Ad[d].Wrapper,h.isWrapper?(h.parse(f.VAST.Ad[d].Wrapper),b.push(h)):(h.parse(f.VAST.Ad[d].InLine),g.push(h));f=!1;if(0===g.length&&0===b.length)return this.log("parseAdData(): no ads from vast response!!!"),[c];this.log("parseAdData(): "+g.length+"inline ads, "+b.length+" wrapper ads.");
h=null;for(d=0;d<g.length;d++)if(this.selectUsableAdsForDrivingSlot(g[d])){this.log("parseAdData(): package for driving slot is found!!!");h=g[d];break}d=0<K.length&&y.getSlot().getTimePositionClass()!==a.TIME_POSITION_CLASS_DISPLAY;if(h)d&&this.selectUsableAdsCompanionSlots(h)&&this.log("parseAdData(): companion ads are found for companion slots, with driving slot"),c.selectedPackage=h;else if(d){d=!1;for(var i=0;i<g.length;i++)if(h=g[i],this.selectUsableAdsCompanionSlots(h))this.log("parseAdData(): companion ads are found for companion slots,without driving slot"),
c.selectedPackage=h,d=!0;d||(this.log("parseAdData(): companion ads are not found for companion slots,without driving slot"),f=!0)}else this.log("parseAdData(): no usable ads found in vast response!!!"),f=!0;if(f&&0<b.length)for(g=0;g<b.length;g++)if(this.testWrapperForRedirect(b[g])){c.redirectPackage=b[g];this.selectUsableAdsCompanionSlots(b[g])&&this.log("parseAdData(): companion ads are found for wrapper ad");break}return[c]}u.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE)}},selectUsableAdsForDrivingSlot:function(a){this.log("selectUsableAdsForDrivingSlot()");
var b=!0;switch(H){case 2:b=this.testAndUpdatePackageForTemporalSlot(a,!0);break;case F:b=this.testAndUpdatePackageForTemporalSlot(a,!1);break;case 8:b=this.testAndUpdatePackageForPageSlots(a,!1);break;default:b=!1}return b},selectUsableAdsCompanionSlots:function(a){this.log("selectUsableAdsCompanionSlots(pk)");return this.testAndUpdatePackageForPageSlots(a,!0)},testAndUpdatePackageForTemporalSlot:function(a,b){this.log("testAndUpdatePackageForTemporalSlot(pk,isLinear), isLinear = "+b);return a.testAndUpdatePackageForTemporalSlot(b)},
testAndUpdatePackageForPageSlots:function(a,b){this.log("testAndUpdatePackageForPageSlots(pk,isCompanion) isCompanion = "+b);return a.testAndUpdatePackageForPageSlots(b)},testWrapperForRedirect:function(a){this.log("testWrapperForRedirect(pk)");return a.testWrapperForRedirect()},log:function(b){a.log("VastTranslator.VastParser\t"+b)},warn:function(b){a.warn("VastTranslator.VastParser\t"+b)}};var p=y.getActiveCreativeRendition().getWrapperUrl(),B=y.getActiveCreativeRendition().getWrapperType();c("AdInstance.getActiveCreativeRendition().getWrapperUrl()="+
p+", getWrapperType()="+B);if("external/vast-2"!==B)u.onTranslatorFailed(a.ERROR_NO_RENDERER,"wrapperType="+B);else if(!p||0===p.length)u.onTranslatorFailed(a.ERROR_NULL_ASSET,"wrapperUrl="+p);else{B=b.getParameter("translator.vast.asyncLoad");B=!0===a.Util.str2bool(B);c("will load vast xml, asyncAjax:"+B);var Q=b.getParameter("translator.vast.loadWithCookie"),Q=!0===a.Util.str2bool(Q),x=null;try{window.XDomainRequest?(x=new XDomainRequest,B=!0):(x=new XMLHttpRequest,x.withCredentials=Q),u._request=
x,B?(x.open("GET",p),window.XDomainRequest?x.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(x.responseText);x.responseXML=a;x.status=200;r(x)}:x.onreadystatechange=function(){4==x.readyState&&r(x)},x.onerror=function(){if(window.XDomainRequest)x.status=0;0==x.status?(d("CORS error"),u.onTranslatorFailed(a.ERROR_SECURITY,"wrapperUrl="+p)):(d("exception:"+x.statusText),u.onTranslatorFailed(a.ERROR_UNKNOWN,x.statusText))},x.send()):(x.open("GET",p,!1),x.send(),r(x))}catch(O){B=
!1;if(window.XMLHttpRequestException){if(O instanceof XMLHttpRequestException)switch(O.code){case XMLHttpRequestException.NETWORK_ERR:B=!0}}else O.code===DOMException.NETWORK_ERR&&(d("CORS in IE10"),B=!0);B?(d("CORS error:"+O),u.onTranslatorFailed(a.ERROR_SECURITY,"wrapperUrl="+p)):(d("exception:"+O),u.onTranslatorFailed(a.ERROR_UNKNOWN,O))}}},info:function(){return{moduleType:a.MODULE_TYPE_TRANSLATOR}},log:function(b){a.log("VastTranslator\t"+b)},warn:function(b){a.warn("VastTranslator\t"+b)},getPlayheadTime:function(){return-1},
getDuration:function(){return-1},stop:function(){a.debug("VastTranslator stop");this._request&&(this._request.abort(),a.log("VastTranslator Stop: request aborted"));this._request=null;this._rendererController&&this._rendererController.handleStateTransition(a.TRANSLATOR_STATE_COMPLETED)},onTranslatorFailed:function(b,c){if(this._request)this._request=null;c?this._rendererController.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:b,errorInfo:c}):this._rendererController.handleStateTransition(a.TRANSLATOR_STATE_FAILED,
{errorModule:"VastTranslator",errorCode:b})}};a.VastTranslator.prototype.constructor=a.VastTranslator;a.VideoAsset=function(b){this._defaultTimeouts=[5,10,15,30,60,120,180,300];this._context=b;this._internalState=a.MediaInitState.instance;this._eventCallback=this._state="";this._callbackTimer=null;this._requestedVideoViewUrl=this._videoPlayPending=!1;this._dummyInstanceId="";this._delay=0;this._location=this._networkId=this._duration=this._customId=this._id="";this._autoPlayType=null;this._fallbackId=
"";this._viewRandom=0;this._durationType=null;this._currentTpos=0};a.VideoAsset.prototype={setVideoAsset:function(b,c,d,f,g,h,i,j,k){if(b){var m=!1;switch(i){case a.ID_TYPE_FW:m=this._id!=b;this._id=b;break;case a.ID_TYPE_GROUP:m=this._id!="g"+b;this._id="g"+b;break;default:m=this._customId!=b,this._customId=b}if(m)this._eventCallback="";if("number"===typeof c)this._duration=Math.round(10*c)/10;if(0<1*d)this._networkId=1*d;if("string"===typeof f)this._location=f;if("number"===typeof g)this._autoPlayType=
g;if(0<1*h)this._viewRandom=1*h;if("number"===typeof j&&0<j)this._fallbackId=""+j;else if("string"===typeof j)this._fallbackId=j.trim();if(k===a.VIDEO_ASSET_DURATION_TYPE_EXACT||k===a.VIDEO_ASSET_DURATION_TYPE_VARIABLE)this._durationType=k;this._videoPlayPending&&this.play()}else a.warn("AdRequest.setVideoAsset","id is required.")},setVideoAssetCurrentTimePosition:function(b){!b||0>b?a.warn("AdRequest.setVideoAssetCurrentTimePosition","valid timePosition is required"):this._currentTpos=b},setVideoState:function(b){b===
a.VIDEO_STATE_PLAYING?(this._state===a.VIDEO_STATE_PAUSED&&this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_RESUMED),this.play()):b===a.VIDEO_STATE_PAUSED||b===a.VIDEO_STATE_STOPPED?(this.pause(),b===a.VIDEO_STATE_PAUSED&&this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_PAUSED)):b===a.VIDEO_STATE_COMPLETED&&this.complete();this._state=b},callback:function(b){this._eventCallback?this._eventCallback.process():b=!0;if(!b)(b=this._defaultTimeouts.shift())||(b=300),this._callbackTimer=new a.Timer(b,
a.Util.bind(this,this.callback)),this._callbackTimer.start()},getPlayheadTime:function(){var a=this._delay;this._delay=0;a+=this._callbackTimer?this._callbackTimer.getCTValue():0;return Math.floor(a)},play:function(){if(!this._context._adManager._serverURL||!this._context._adManager._networkId||!this._id&&!this._customId){if(a.warn("Server URL or Network ID or Video Asset id/customId is not set, pend video asset play request."),this._videoPlayPending=!0,!this._callbackTimer)this._callbackTimer=new a.Timer,
this._callbackTimer.tick()}else if(this._eventCallback)this._videoPlayPending=!1,this._internalState.play(this);else if(!this._requestedVideoViewUrl&&(this._requestedVideoViewUrl=!0,this.requestForVideoViewCallback(),!this._callbackTimer))this._callbackTimer=new a.Timer,this._callbackTimer.tick()},pause:function(){this._internalState.pause(this)},complete:function(){this._internalState.complete(this)},onStartPlaying:function(){this.callback()},onStartReplaying:function(){this.callback()},onPausePlaying:function(){this.callback(!0);
this._callbackTimer.pause()},onResumePlaying:function(){this._callbackTimer.start()},onCompletePlaying:function(){this.callback(!0);this._callbackTimer.stop();this._callbackTimer=null;this._eventCallback="";this._requestedVideoViewUrl=!1},onCompleteReplaying:function(){this.onCompletePlaying()},setMediaState:function(a){this._internalState=a},requestForVideoViewCallback:function(){var b=new a.Context(this._context._adManager);b._videoAsset=this;this._dummyInstanceId=b._instanceId;var b=this._context._adRequest.generateVideoViewRequestUrlWithDummyContextInstanceId(b._instanceId),
c=this;a.PLATFORM_SEND_REQUEST_BY_FORM?(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(b,this._dummyInstanceId,!0),c._onMessagePosted=function(a){"object"===typeof a.data&&a.data.hasOwnProperty("cbfn")&&-1<a.data.cbfn.indexOf("['Context_"+this._dummyInstanceId+"']")&&c.requestComplete(a.data.response)},window.addEventListener("message",c._onMessagePosted,!1)):a.Util.pingURLWithScript(b)},requestComplete:function(b){this._delay=this._callbackTimer.tick();this._callbackTimer=null;
if(a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var c=document.getElementById("_fw_request_iframe_"+this._dummyInstanceId);document.body.removeChild(c)}null!==b?(a._instanceQueue["Context_"+this._dummyInstanceId]=null,this.parse(a.Util.getObject("siteSection.videoPlayer.videoAsset",b)||{}),this.play()):a.warn("Failed to get video view callback url.")},parse:function(b){if(b){this._customId=b.customId;this._networkId=parseInt(b.networkId);for(var c=
0,d=b.eventCallbacks||[];c<d.length;c++){var b=d[c],f=a.EventCallback.newEventCallback(this._context,b.name,b.type);if(f&&b.name===a.EVENT_VIDEO_VIEW){f.parse(b);this._eventCallback=f;a.debug("Parsed video view url: "+this._eventCallback._url);break}}}}};a.VideoRenderer=function(){this._adVideo=null;this._duration=this._playheadTime=-1;this._dragging=this._stopInvoked=this._isEnded=!1;this._volume=1;this._rendererController=null;this._isBuffering=!1};a.VideoRenderer.prototype={pause:function(){this._rendererController&&
this._rendererController.processEvent({name:a.EVENT_AD_PAUSE});this._adVideo&&!this._adVideo.paused&&this._adVideo.pause()},resume:function(){this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_RESUME});this._adVideo&&this._adVideo.paused&&this._adVideo.play()},start:function(b){this._rendererController=b;var c=b.getAdInstance(),d=c.getSlot(),f=this,g=!1,h=!1;if(a.PLATFORM_NOT_SUPPORT_VIDEO_AD)b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",
errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:d.getTimePositionClass()});else if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&d.getTimePositionClass()===a.TIME_POSITION_CLASS_MIDROLL)b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"midroll"});else{a.log("VideoRenderer.start",d.getTimePositionClass(),c);var i=b.getContentVideoElement(),j=d.getVideoDisplaySize().width,k=d.getVideoDisplaySize().height,m=c.getRenderableCreativeRenditions(),l=(j=(new a.RenditionSelector(b.getParameter(a.PARAMETER_DESIRED_BITRATE)||
1E3,b.getParameter("arWeight")||1,b.getParameter("pxWeight")||1,0.2)).getBestFitRendition(m,j,k))?j.getPrimaryCreativeRenditionAsset():null;if(!l&&m.length)b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"no compatible asset"});else if(!l||!l.getUrl())b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorCode:a.ERROR_NULL_ASSET});else{c.setActiveCreativeRendition(j);a.log("VideoRenderer.start selected rendition is:",
l.getUrl());b.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON);b.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);b.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);var n=!a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO;n||b.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);var q=a.PLATFORM_EVENT_CLICK,v=a.MOBILE_EVENT_DRAG;a.debug("VideoRenderer","use content video element");i.controls=!1;this._adVideo=i;var o=null,J=null,t=null;this._volume=b.getContext().getAdVolume();this._adVideo.volume=
this._volume;this._adVideo.muted=0==this._volume;var z=function(b){a.debug("VideoRenderer.checkTimeUpdate timeout");P(b)},s=function(){J&&(clearTimeout(J),J=null)},L=a.Util.bind(this,function(c){a.debug("onAdVideoBufferEmpty(): Ad video event "+c.type);c=b.getParameter(a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED);null==c||"undefined"===typeof c||!1===a.Util.str2bool(c)||(a.debug("play the ad immediately after the stalled event"),i&&i._fw_videoAdPlaying&&i.play())}),I=function(c){if(!this._isBuffering)this._isBuffering=
!0,b.processEvent({name:a.EVENT_AD_BUFFERING_START}),a.debug("onAdVideoBufferingStarted(): Ad video event "+c.type)},r=function(c){if(this._isBuffering)this._isBuffering=!1,b.processEvent({name:a.EVENT_AD_BUFFERING_END}),a.debug("onAdVideoBufferingEnded(): Ad video event "+c.type)},c=b.getParameter(a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT),w=null;c&&(w=document.getElementById(c));w||(w=i);var F=a.Util.bind(this,function(c){if(i.paused&&a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED)i.play();
else{var d=b.getParameter(a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION);null==d&&(d="true");if(!1!==a.Util.str2bool(d))h?(a.debug("Ad video event "+c.type),this._dragging?this._dragging=!1:b.processEvent({name:a.EVENT_AD_CLICK})):a.debug("Ad not started, ignore click.")}}),y=a.Util.bind(this,function(b){a.debug("Ad video event "+b.type);this._dragging=!0}),u,A,H=function(c){a.debug("Ad video event "+c.type+" ended: "+i.ended+" playing:"+i._fw_videoAdPlaying);if(i.ended&&0.2>Math.abs(i.duration-i.currentTime)||
!i._fw_videoAdPlaying)u=setTimeout(function(){a.warn("Force ad video end bc ad paused with ended = true");c.type="ended";A(c)},200);else{var d=b.getParameter(a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE);null==d&&(d="true");!1===a.Util.str2bool(d)?a.debug("Pause controls disabled"):i.controls=!0;s()}},K=function(b){a.debug("Ad video event "+b.type);i.controls=!1},D=0,N=function(){s();if(!i.paused){var c=b.getParameter(a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT)||8E3;J=setTimeout(z,
c,c+"ms timeout when playing")}if(!h){h=!0;f._playheadTime=i.currentTime;if(0>f._playheadTime)f._playheadTime=0;o&&(clearTimeout(o),o=null);f._quartileTimerId=setInterval(function(){var c=i.currentTime,d=i.duration;if(0<c)f._playheadTime=c;if(0<d)f._duration=d;if(!("number"!==typeof c||"number"!==typeof d||t))if(c>=0.25*d&&1>D&&(b.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),D=1),c>=0.5*d&&2>D&&(b.processEvent({name:a.EVENT_AD_MIDPOINT}),D=2),c>=0.75*d&&3>D)clearInterval(f._quartileTimerId),f._quartileTimerId=
null,b.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),D=3},1E3);b.handleStateTransition(a.RENDERER_STATE_STARTED)}};this.dispose=a.Util.bind(this,function(){A()});A=function(c){var d=t;c&&c.type&&(a.debug("Ad video event "+c.type),"error"===c.type&&(a.warn(c.target.src),a.warn(c.target.currentSrc),r()));s();o&&(clearTimeout(o),o=null);n&&(w.removeEventListener(q,F,!1),w.removeEventListener(v,y,!1));u&&(clearTimeout(u),u=null);i.removeEventListener("ended",A,!1);i.removeEventListener("error",A,!0);
i.removeEventListener("pause",H,!1);i.removeEventListener("playing",K,!1);i.removeEventListener("timeupdate",N,!1);i.removeEventListener("stalled",L,!1);i.removeEventListener("waiting",I,!1);i.removeEventListener("canplay",r,!1);i.paused||(a.debug("try pausing video before complete"),i.pause());c&&"error"===c.type&&(d="video error",(c=i.error||c.target.error)&&(d="error:"+c+",code:"+c.code));if(!d)f._isEnded=!0;a.log("VideoRenderer.complete");if(!g){g=!0;delete i._fw_videoAdPlaying;f._adVideo=null;
if(f._quartileTimerId)clearInterval(f._quartileTimerId),f._quartileTimerId=null;d?b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorInfo:d}):(f._stopInvoked||(i.currentTime>=0.25*i.duration&&1>D&&(b.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),D=1),i.currentTime>=0.5*i.duration&&2>D&&(b.processEvent({name:a.EVENT_AD_MIDPOINT}),D=2),i.currentTime>=0.75*i.duration&&3>D&&(b.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),D=3),i.currentTime>=i.duration-0.5&&4>D&&(b.processEvent({name:a.EVENT_AD_COMPLETE}),
D=4)),f._stopInvoked=!1,b.handleStateTransition(a.RENDERER_STATE_COMPLETED))}this._rendererController=null};var P=function(b){t=b;a.warn(t);a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT||A()};i._fw_videoAdPlaying=!0;var B=!1,M=function(){if(!B){B=!0;n&&(w.addEventListener(q,F,!1),w.addEventListener(v,y,!1));i.addEventListener("ended",A,!1);i.addEventListener("error",A,!0);i.addEventListener("pause",H,!1);i.addEventListener("playing",K,!1);i.addEventListener("timeupdate",N,!1);i.addEventListener("stalled",
L,!1);i.addEventListener("waiting",I,!1);i.addEventListener("canplay",r,!1);i.src=l.getUrl();a.log("VideoRenderer play video ad "+i.src);i.load();if(i._fw_fromVideoPool||a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT){var c=b.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||5E3;o=setTimeout(P,c,c+"ms timeout before playing")}a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE&&b.handleStateTransition(a.RENDERER_STATE_STARTED);0<a.PLATFORM_ANDROID_VERSION?(c=b.getParameter(a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY)||
100,setTimeout(function(){i.play()},c)):setTimeout(function(){i.play()},100)}};!a.VideoRenderer._fw_playedDummyVideo&&d.getTimePositionClass()===a.TIME_POSITION_CLASS_PREROLL&&a.PLATFORM_PLAY_DUMMY_VIDEO_FOR_PREROLL&&!/\.webm$/.test(l.getUrl())?(a.VideoRenderer._fw_playedDummyVideo=!0,a.debug("play dummy video for iOS 3.2-4.1"),i.src="http://127.0.0.1:1/404.mp4",i.load(),i.play(),i._fw_videoAdPlaying=!0,i.addEventListener("error",function(){event.target.removeEventListener("error",arguments.callee,
!0);M()},!0),setTimeout(M,a.PLATFORM_NOT_WAIT_FOR_ERROR_WHEN_PLAY_DUMMY_VIDEO_FOR_PREROLL?500:5E3)):M()}}},stop:function(){a.debug("VideoRenderer stop");this._stopInvoked=!0;if(this._adVideo)this._adVideo._fw_videoAdPlaying=!1,this._adVideo.pause(),this.dispose();this._rendererController=null},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){if(this._isEnded&&0<this._duration)return this._duration;if(this._adVideo){var a=this._adVideo.currentTime;if(0<a)return a}return this._playheadTime},
getDuration:function(){return this._duration},setVolume:function(b){a.debug("VideoRenderer setVolume("+b+")");this._adVideo?(this._adVideo.volume=b,this._adVideo.muted=0==b,this._volume!=b&&this._rendererController.processEvent({name:a.EVENT_AD_VOLUME_CHANGE}),0==this._volume&&0!=b?this._rendererController.processEvent({name:a.EVENT_AD_UNMUTE}):0!=this._volume&&0==b&&this._rendererController.processEvent({name:a.EVENT_AD_MUTE}),this._volume=b):a.debug("VideoRenderer ad video is null, ignore.")}};
a.VideoRenderer.prototype.constructor=a.VideoRenderer;a.VideoStateExtension=function(){};a.VideoStateExtension.prototype={_enabled:function(){if(null==this._context)return!1;var b=this._context.getParameter(a.PARAMETER_EXTENSION_VIDEO_STATE_ENABLED);null==b&&(b="false");return!0===a.Util.str2bool(b)},init:function(b){this._context=b;this._enabled()?this._context.setVideoState(a.VIDEO_STATE_PLAYING):a.log("VideoStateExtension is disabled.")},dispose:function(){this._context=null}};a.VideoStateExtension.prototype.constructor=
a.VideoStateExtension;a.VPAIDWrapper=function(){this._creative=null;this._timeoutInMs=0;this._eventHandlers={};this._loadIntervalTimer=this._timeoutTimer=null;this._timeoutOperation="";this.timeoutReached=!1;this._visibilityChangeListener=null};a.VPAIDWrapper.prototype={_isCreativeFunctionInvokable:function(a){return!this._creative?!1:(a=this._creative[a])&&"function"==typeof a?!0:!1},checkVPAIDInterface:function(a){for(var c={passed:!0,missingInterfaces:""},d=a.length-1;0<=d;d--)if(!this._isCreativeFunctionInvokable(a[d]))c.passed=
!1,c.missingInterfaces+=a[d]+" ";return c},loadCreativeAsset:function(b){a.log("loadCreativeAsset("+b+")");var c=document.getElementById("vpaidFrame"),d=document.createElement("iframe");d.id="vpaidFrame";null==c?document.body.appendChild(d):document.body.replaceChild(d,c);d.width=0;d.height=0;d.style.display="none";d.contentWindow.document.open();d.contentWindow.document.write('<script type="text/javascript" src="'+b+'"> <\/script>');d.contentWindow.document.close();this._timeoutOperation="loadCreativeAsset";
this._waitForTimeout();var f=this;this._loadIntervalTimer=setInterval(function(){var b=document.getElementById("vpaidFrame").contentWindow.getVPAIDAd;if(b&&"function"===typeof b)clearInterval(f._loadIntervalTimer),b=b(),"undefined"===typeof b?a.debug("getVPAIDAd() returns undefined value"):null===b?a.debug("getVPAIDAd() returns null"):(f._creative=b,f._eventHandlers.CreativeAssetLoaded())},200)},setCallbacksForCreative:function(a,c){for(var d in a)a.hasOwnProperty(d)&&this._creative.subscribe(a[d],
d,c)},removeCallbacksForCreative:function(a){for(var c in a)a.hasOwnProperty(c)&&this._creative.unsubscribe(a[c],c)},handshakeVersion:function(b){a.log("VPAID Creative: handshakeVersion("+b+")");return this._creative.handshakeVersion(b)},initAd:function(b,c,d,f,g,h){a.log("VPAID Creative: initAd()");this._timeoutOperation="initAd";this._waitForTimeout();this._creative.initAd(b,c,d,f,g,h)},startAd:function(){a.log("VPAID Creative: startAd()");this._timeoutOperation="startAd";this._waitForTimeout();
this._creative.startAd()},stopAd:function(){a.log("VPAID Creative: stopAd()");"startAd"===this._timeoutOperation?(clearTimeout(this._timeoutTimer),this._timeoutOperation="startAd and stopAd"):this._timeoutOperation+="stopAd";this._waitForTimeout();this._creative.stopAd()},canPauseAd:function(){return this._isCreativeFunctionInvokable("pauseAd")},canResumeAd:function(){return this._isCreativeFunctionInvokable("resumeAd")},canResizeAd:function(){return this._isCreativeFunctionInvokable("resizeAd")},
pauseAd:function(){this.canPauseAd()&&(a.log("VPAID Creative: pauseAd()"),this._creative.pauseAd())},resumeAd:function(){this.canResumeAd()&&(a.log("VPAID Creative: resumeAd()"),this._creative.resumeAd())},resizeAd:function(b,c,d){this.canResizeAd()?(a.log("VPAID Creative: resizeAd()"),this._creative.resizeAd(b,c,d)):a.log("The creative is not able to resize")},getAdVolume:function(){return this._isCreativeFunctionInvokable("getAdVolume")?this._creative.getAdVolume():-1},setAdVolume:function(a){this._isCreativeFunctionInvokable("setAdVolume")&&
this._creative.setAdVolume(a)},getAdExpanded:function(){return this._isCreativeFunctionInvokable("getAdExpanded")?this._creative.getAdExpanded():!1},getAdRemainingTime:function(){return this._isCreativeFunctionInvokable("getAdRemainingTime")?this._creative.getAdRemainingTime():-1},getAdDuration:function(){return this._isCreativeFunctionInvokable("getAdDuration")?this._creative.getAdDuration():-1},getAdLinear:function(){return this._creative.getAdLinear()},getAdCompanions:function(){return this._isCreativeFunctionInvokable("getAdCompanions")?
this._creative.getAdCompanions():""},setTimeoutValueInMs:function(a){this._timeoutInMs=a},cancelTimeoutEvent:function(){var a="startAd and stopAd"!==this._timeoutOperation;clearTimeout(this._timeoutTimer);if(!a){this._timeoutOperation="startAd";var c=this;setTimeout(function(){c._eventHandlers.timeout.call()},500)}},addEventListener:function(a,c){this._eventHandlers[a]=c},removeEventListener:function(a){this._eventHandlers[a]=null},_waitForTimeout:function(){a.log("Wait for "+this._timeoutOperation+
" for "+this._timeoutInMs+"ms");if(this._eventHandlers.timeout){var b=this;this._timeoutTimer=setTimeout(function(){if(!b.timeoutReached)b.timeoutReached=!0;"startAd"===b._timeoutOperation?b.stopAd():("loadCreativeAsset"===b._timeoutOperation&&clearInterval(b._loadIntervalTimer),b._eventHandlers.timeout.call())},this._timeoutInMs)}},getTimeoutOperation:function(){return this._timeoutOperation}};a.VPAIDWrapper.prototype.constructor=a.VPAIDWrapper;a.VPAIDRenderer=function(){this.vpaidCreative=this.rendererController=
null;this.vpaidVolume=this.vpaidDuration=-1;this.creativeEventCallbacks={};this.isMuted=!1;this.adPlaybackState="";this.creativeTimeoutDelayInMs=1E4;this.vpaidDesiredBitrate=268;this.vpaidViewmode="normal";this.playheadTime=0;this.videoBase=document.createElement("div");this.videoParent=null;this.SUPPORTED_CREATIVE_VPAID_VERSION_MIN=this.PLAYER_VPAID_VERSION=2};a.VPAIDRenderer.prototype={};a.VPAIDRenderer.prototype.constructor=a.VPAIDRenderer;a.VPAIDRenderer.VastCompanion=function(a,c,d,f){this._width=
a;this._height=c;this._apiFramework=d;this._xmlNode=f};a.VPAIDRenderer.VastCompanion.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},_isValidResource:function(a,c){return"StaticResource"===a&&c["@attributes"].creativeType||"IFrameResource"===a&&c.value||"HTMLResource"===a&&c.value},hasValidRendtions:function(){for(var a in this._xmlNode)if(this._xmlNode.hasOwnProperty(a)&&("StaticResource"===a||"IFrameResource"===a||"HTMLResource"===a))for(var c=[].concat(this._xmlNode[a]),
d=c.length-1;0<=d;d--)if(this._isValidResource(a,c[d]))return!0;return!1},translateToAdInstance:function(b){this._xmlNode.CompanionClickThrough&&b.setClickThroughUrl(a.EVENT_AD_CLICK,this._xmlNode.CompanionClickThrough.value);if(this._xmlNode.TrackingEvents){var c=this._xmlNode.TrackingEvents;if(c.Tracking){for(var c=[].concat(c.Tracking),d=[],f=c.length-1;0<=f;f--)"creativeView"===c[f]["@attributes"].event&&d.push(c[f].value);0<d.length&&b.addEventCallbackUrls(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,
d)}}for(var g in this._xmlNode)if(this._xmlNode.hasOwnProperty(g)&&("StaticResource"===g||"IFrameResource"===g||"HTMLResource"===g)){c=[].concat(this._xmlNode[g]);for(f=c.length-1;0<=f;f--)if(this._isValidResource(g,c[f])){var d=c[f],h=b.addCreativeRendition();h.setWidth(this._width);h.setHeight(this._height);h.setCreativeApi("None");var i=h.addCreativeRenditionAsset("VPAIDAsset"+f,!0);i.setContentType("text/html_doc_lit_mobile");i.setMimeType("text/html");var j=b.getEventCallbackUrls(a.EVENT_AD_CLICK,
a.EVENT_TYPE_CLICK)[0],k=g;"HTMLResource"===k?i.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(d.value,b.getSlot().getCustomId(),this._width,this._height)):("IFrameResource"===k?creativeType="iframe":"StaticResource"===k&&(creativeType=this._xmlNode.creativeType),i.setContent(a.HTMLAdGenerator.generateAd(d.value,j,b.getSlot().getCustomId(),this._width,this._height,creativeType,i.getContentType())));a.debug("rendtion width: "+h.getWidth()+" height:"+h.getHeight()+" asset content:"+i.getContent())}}}};
a.VPAIDRenderer.VastCompanion.prototype.constructor=a.VPAIDRenderer.VastCompanion;a.VPAIDRenderer.VastAdSelect=function(){};a.VPAIDRenderer.VastAdSelect.prototype={_getDeadSpaceRatio:function(b,c){var d=b.getWidth(),f=b.getHeight(),g=c.getWidth(),h=c.getHeight(),i=1;d<=g&&f<=h&&(i=1-d*f/(g*h));a.debug("computing dead space ratio ("+i+") for slot "+g+"x"+h+" and ad "+d+"x"+f);return i},matchAdsWithSlots:function(b,c){a.log("VPAIDRenderer: Matching ads with slots");for(var d=0;d<c.length;++d)c[d].matched=
!1;for(var f=[],g=[],d=0;d<b.length;d++)for(var h=0;h<c.length;h++)g.push({ratio:this._getDeadSpaceRatio(b[d],c[h]),adIndex:d,slotIndex:h});g.sort(function(a,b){return a.ratio-b.ratio});for(d=0;d<g.length&&!(1==g[d].ratio);d++){var h=g[d],i=b[h.adIndex],j=c[h.slotIndex];if(!i.matched&&!j.matched)a.log("Winning ratio:"+h.ratio+" Winning ad:"+i.getWidth()+"x"+i.getHeight()+" for slot:"+j.getWidth()+"x"+j.getHeight()),f.push({ad:i,slot:j}),i.matched=!0,j.matched=!0}return f}};a.VPAIDRenderer.VastAdSelect.prototype.constructor=
a.VPAIDRenderer.VastAdSelect;a.Util.mixin(a.VPAIDRenderer.prototype,{_failWithError:function(b,c){this.rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VPAIDRenderer",errorCode:b,errorInfo:c});this.dispose()},onCreativeTimeout:function(){a.log("VPAIDRenderer: onCreativeTimeout()");var b=this.vpaidCreative.getTimeoutOperation();this._failWithError(a.ERROR_TIMEOUT,"loadCreativeAsset"!==b?"Creative function "+b+" timeout":"load creative asset timeout")},setVolume:function(b){a.log("VPAIDRenderer: setVolume("+
b+")");this.vpaidCreative&&this.vpaidCreative.setAdVolume(b)},onAdVolumeChange:function(){a.log("VPAIDRenderer: onAdVolumeChange()");var b=this.vpaidCreative.getAdVolume();if(0>b||1<b)a.log("Invalid ad volume value");else{if(this.isMuted&&2<100*b)this.isMuted=!1,this.rendererController.processEvent({name:a.EVENT_AD_UNMUTE});else if(!this.isMuted&&2>100*b)this.isMuted=!0,this.rendererController.processEvent({name:a.EVENT_AD_MUTE});this.rendererController.processEvent({name:a.EVENT_AD_VOLUME_CHANGE})}},
onAdExpandedChange:function(){a.log("VPAIDRenderer: onAdExpandedChange()");this.vpaidCreative.getAdExpanded()?this.rendererController.processEvent({name:a.EVENT_AD_EXPAND}):this.rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})},onAdDurationChange:function(){a.log("VPAIDRenderer: onAdDurationChange(): duration changed to "+this.vpaidCreative.getAdDuration())},onAdClickThru:function(b,c,d){a.log("VPAIDRenderer: onAdClickThru() with url:"+b+" id:"+c+" playerHandles:"+d);c={name:tv.freewheel.SDK.EVENT_AD_CLICK,
info:{}};c.info[a.INFO_KEY_SHOW_BROWSER]=!0===d;!0===d?b?(a.log("onAdClickThru(): open window with overrided url"),c.info[a.INFO_KEY_URL]=b):a.log("onAdClickThru(): open window with url booked in MRM UI or VAST clickthru url"):a.log("onAdClickThru(): send click tracking");this.rendererController.processEvent(c)},onCreativeAssetLoaded:function(){a.log("VPAIDRenderer: onCreativeAssetLoaded()");this.vpaidCreative.cancelTimeoutEvent();var b=this,c=function(){var c=b.vpaidCreative.handshakeVersion(b.PLAYER_VPAID_VERSION.toFixed(1));
if(c){if(parseFloat(c)<b.SUPPORTED_CREATIVE_VPAID_VERSION_MIN)return b._failWithError(a.ERROR_INVALID_VALUE,"Only support creatives with VPAID version >= "+b.SUPPORTED_CREATIVE_VPAID_VERSION_MIN.toFixed(1)),!1}else return b._failWithError(a.ERROR_3P_COMPONENT,"Cannot get VPAID version from the creative"),!1;return!0};if(function(){var c=b.vpaidCreative.checkVPAIDInterface("handshakeVersion,initAd,startAd,stopAd,subscribe,unsubscribe,getAdLinear".split(","));c.passed||b._failWithError(a.ERROR_3P_COMPONENT,
"Missing interfaces in the VPAID creative: "+c.missingInterfaces);return c.passed}()&&c()){(function(){if((param=b.rendererController.getParameter(a.PARAMETER_VPAID_CREATIVE_TIMEOUT_DELAY))&&0<Number(param))b.creativeTimeoutDelayInMs=Number(param);a.log("initParams(), creative timeout delay in miliseconds:"+b.creativeTimeoutDelayInMs);var c=parseFloat(b.rendererController.getParameter(a.PARAMETER_DESIRED_BITRATE));b.vpaidDesiredBitrate=0<c?c:b.vpaidDesiredBitrate;a.log("initParams(), desired bitrate: "+
b.vpaidDesiredBitrate)})();b.creativeEventCallbacks={AdStarted:b.onAdStarted,AdStopped:b.onAdStopped,AdSkipped:b.onAdSkipped,AdLoaded:b.onAdLoaded,AdLinearChange:b.onAdLinearChange,AdSizeChange:b.onAdSizeChange,AdExpandedChange:b.onAdExpandedChange,AdDurationChange:b.onAdDurationChange,AdVolumeChange:b.onAdVolumeChange,AdImpression:b.onAdImpression,AdClickThru:b.onAdClickThru,AdVideoFirstQuartile:b.onAdVideoFirstQuartile,AdVideoMidpoint:b.onAdVideoMidpoint,AdVideoThirdQuartile:b.onAdVideoThirdQuartile,
AdVideoComplete:b.onAdVideoComplete,AdUserAcceptInvitation:b.onAdUserAcceptInvitation,AdUserMinimize:b.onAdUserMinimize,AdUserClose:b.onAdUserClose,AdPaused:b.onAdPaused,AdPlaying:b.onAdResumed,AdError:b.onAdError,AdLog:b.onAdLog};b.vpaidCreative.setCallbacksForCreative(b.creativeEventCallbacks,b);this.rendererController.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_EXPAND,
a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_CLOSE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_MINIMIZE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_ACCEPT_INVITATION,a.CAPABILITY_STATUS_ON);(c=this.rendition?this.rendition.getParameter("VPAID_creativeData"):null)&&(c=a.Util.trim(c));var c={AdParameters:c},d=this.rendererController.getAdInstance().getSlot();
this.videoBase.style.width="0px";this.videoBase.style.height="0px";this.videoBase.style.zIndex="100000";this.videoBase.style.position="absolute";this.videoBase.style.left=this.rendererController.getContentVideoElement().style.left;this.videoBase.style.top=this.rendererController.getContentVideoElement().style.top;this.videoParent=d.getBase();var f=this.rendererController.getContentVideoElement();if("nodeType"in f&&0<f.nodeType)try{this.videoParent.insertBefore(this.videoBase,this.rendererController.getContentVideoElement())}catch(g){this.videoParent.insertBefore(this.videoBase,
this.videoParent.firstChild)}else this.videoParent.insertBefore(this.videoBase,this.videoParent.firstChild);var f={slot:this.videoBase,videoSlot:this.rendererController.getContentVideoElement(),videoSlotCanAutoPlay:!0},h=d.getWidth(),d=d.getHeight();if((!h||!d)&&this.rendition)h=this.rendition.getWidth(),d=this.rendition.getHeight();this.vpaidCreative.initAd(h,d,this.vpaidViewmode,this.vpaidDesiredBitrate,c,f)}},onAdLoaded:function(){a.log("VPAIDRenderer: onAdLoaded()");this.vpaidCreative.cancelTimeoutEvent();
a.log("Ad duration:"+this.getDuration());var b=this,c=function(c,d){a.debug(d.length+" companion slots to fill.");if(!(0===d.length||0===c.length)){var h=(new a.VPAIDRenderer.VastAdSelect).matchAdsWithSlots(c,d);if(0!==h.length){for(var c=[],d=[],i=h.length-1;0<=i;i--)c.push(h[i].ad),d.push(h[i].slot);h=b.rendererController.scheduleAdInstances(d);for(i=h.length-1;0<=i;i--)c[i].translateToAdInstance(h[i])}}},d=function(b){if(!b)return a.log("The adCompanions property is empty."),null;a.log("parsing adCompanions: "+
b);xmlDoc=null;window.DOMParser?xmlDoc=(new DOMParser).parseFromString(b,"text/xml"):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(b));b=a.Util.xmlToJson(xmlDoc);if(!b||!b.CompanionAds||!b.CompanionAds.Companion)return a.log("No companion ads found in parsed xml"),[];for(var b=[].concat(b.CompanionAds.Companion),c=[],d=b.length-1;0<=d;d--){var i=b[d];if(i["@attributes"]){var j=i["@attributes"].width,k=i["@attributes"].height;if(!j||!k||0>j||0>k)a.log("Missing width/height for companion.");
else{var m=i["@attributes"].apiFramework||"";a.debug("Companion "+j+"x"+k+" api:"+m);i=new a.VPAIDRenderer.VastCompanion(j,k,m,i);i.hasValidRendtions()&&c.push(i)}}}return c}(b.vpaidCreative.getAdCompanions());d&&0<d.length?c(d,this.rendererController.getCompanionSlots()):a.log("VPAIDAdRenderer: No companions from VPAID creative.");this.vpaidCreative.startAd()},onVisibilityChange:function(){a.log("onVisibilityChange:"+(document.hidden?"invisible":"visible"));a.log("Current playback state:"+this.adPlaybackState);
if(document.hidden&&"playing"==this.adPlaybackState)a.log("Pause the VPAID creative"),this.adPlaybackState="pausing",this.vpaidCreative.pauseAd();else if(!document.hidden&&("paused"==this.adPlaybackState||8>a.PLATFORM_IOS_VERSION))a.log("Resume the VPAID creative"),this.adPlaybackState="resuming",this.vpaidCreative.resumeAd()},onAdStarted:function(){a.log("VPAIDRenderer: onAdStarted()");if(this.vpaidCreative.timeoutReached)a.log("VPAID ad has already failed due to timeout. The AdStarted event will not be handled.");
else if(this.vpaidCreative.cancelTimeoutEvent(),7<=a.PLATFORM_IOS_VERSION||4.4<=a.PLATFORM_ANDROID_VERSION)this._visibilityChangeListener=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._visibilityChangeListener,!1)},onAdStopped:function(){a.log("VPAIDRenderer: onAdStopped()");this.vpaidCreative?(this.vpaidCreative.cancelTimeoutEvent(),this.timePositionClass===a.TIME_POSITION_CLASS_OVERLAY&&this.vpaidCreative.getAdLinear()&&this.rendererController.requestContentStateChange(!1),
this.vpaidCreative&&!this.vpaidCreative.timeoutReached&&(this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED),this.dispose())):a.log("The VPAID creative has been disposed. Return.")},onAdImpression:function(){a.log("VPAIDRenderer: onAdImpression()");if(this.vpaidCreative.timeoutReached)a.log("VPAID ad has already failed due to timeout. The AdImpression event will not be handled.");else{var b=this.vpaidCreative.getAdVolume();this.isMuted=0<b&&2>=100*b;this.adPlaybackState="playing";
this.rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)}},onAdLinearChange:function(){a.log("VPAIDRenderer: onAdLinearChange()");var b=this.vpaidCreative.getAdLinear();b?a.log("onAdLinearChange(): non-linear click to linear -> request content video to pause"):a.log("onAdLinearChange(): linear back to non-linear -> request content video to resume");this.rendererController.requestContentStateChange(b)},onAdSizeChange:function(){a.log("VPAIDRenderer: onAdSizeChange()")},onAdPaused:function(){a.log("VPAIDRenderer: onAdPaused()");
"playing"===this.adPlaybackState&&this.rendererController.processEvent({name:a.EVENT_AD_PAUSE});this.adPlaybackState="paused"},onAdResumed:function(){a.log("VPAIDRenderer: onAdResumed()");"paused"===this.adPlaybackState&&this.rendererController.processEvent({name:a.EVENT_AD_RESUME});this.adPlaybackState="playing"},onAdSkipped:function(){a.log("VPAIDRenderer: onAdSkipped()");this.dispose();this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED)},onAdVideoFirstQuartile:function(){a.log("VPAIDRenderer: onAdVideoFirstQuartile()");
this.rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE})},onAdVideoMidpoint:function(){a.log("VPAIDRenderer: onAdVideoMidpoint()");this.rendererController.processEvent({name:a.EVENT_AD_MIDPOINT})},onAdVideoThirdQuartile:function(){a.log("VPAIDRenderer: onAdVideoThirdQuartile()");this.rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE})},onAdVideoComplete:function(){a.log("VPAIDRenderer: onAdVideoComplete");this.rendererController.processEvent({name:a.EVENT_AD_COMPLETE})},
onAdUserAcceptInvitation:function(){a.log("VPAIDRenderer: onAdUserAcceptInvitation()");this.rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION})},onAdUserClose:function(){a.log("VPAIDRenderer: onAdUserClose()");this.rendererController.processEvent({name:a.EVENT_AD_CLOSE})},onAdUserMinimize:function(){a.log("VPAIDRenderer: onAdUserMinimize()");this.rendererController.processEvent({name:a.EVENT_AD_MINIMIZE})},onAdLog:function(b){a.log("VPAIDRenderer: onAdLog: "+b)},onAdError:function(b){a.log("VPAIDRenderer: onAdError(): "+
b);this._failWithError(a.ERROR_3P_COMPONENT,"AdError event:"+b)},start:function(b){var d;a.log("VPAIDRenderer start()");this.rendererController=b;this.timePositionClass=b.getAdInstance().getSlot().getTimePositionClass();if(b=(d=(this.rendition=b.getAdInstance().getActiveCreativeRendition())?this.rendition.getPrimaryCreativeRenditionAsset():null,b=d)?b.getUrl():null){this.vpaidCreative=new a.VPAIDWrapper;this.vpaidCreative.setTimeoutValueInMs(this.creativeTimeoutDelayInMs);this.vpaidCreative.addEventListener("timeout",
this.onCreativeTimeout.bind(this));this.vpaidCreative.addEventListener("CreativeAssetLoaded",this.onCreativeAssetLoaded.bind(this));try{this.vpaidCreative.loadCreativeAsset(b)}catch(c){this._failWithError(a.ERROR_IO,c)}}else this._failWithError(a.ERROR_NULL_ASSET,"Creative asset url cannot be null")},stop:function(){a.log("VPAIDRenderer stop()");this.vpaidCreative.stopAd()},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){var a=this.vpaidCreative.getAdDuration(),
c=this.vpaidCreative.getAdRemainingTime();if(0<=a&&0<=c)this.playheadTime=a-c;if(0>this.playheadTime)this.playheadTime=-1;return this.playheadTime},getDuration:function(){var a=this.vpaidCreative.getAdDuration();return 0<=a?a:-1},pause:function(){a.log("VPAIDRenderer pause()");this.rendererController.processEvent({name:a.EVENT_AD_PAUSE});if(this.vpaidCreative.canPauseAd()){if("playing"==this.adPlaybackState)this.adPlaybackState="pausing",this.vpaidCreative.pauseAd()}else a.log("The creative is not able to pause")},
resume:function(){a.log("VPAIDRenderer resume()");this.rendererController.processEvent({name:a.EVENT_AD_RESUME});if(this.vpaidCreative.canResumeAd()){if("paused"==this.adPlaybackState)this.adPlaybackState="resuming",this.vpaidCreative.resumeAd()}else a.log("The creative is not able to resume")},dispose:function(){a.log("VPAIDRenderer dispose()");if(this.vpaidCreative){if(this.videoParent)this.videoParent.removeChild(this.videoBase),this.videoParent=null;this._visibilityChangeListener&&(a.log("remove visibilitychange listener"),
document.removeEventListener("visibilitychange",this._visibilityChangeListener,!1));this.vpaidCreative.removeCallbacksForCreative(this.creativeEventCallbacks);this.vpaidCreative.removeEventListener("timeout");this.vpaidCreative=null}},resize:function(){a.log("VPAIDAdRenderer resize()");var b=this.rendererController.getAdInstance().getSlot(),c=b.getWidth(),b=b.getHeight();a.log("VPAIDRenderer new size width:"+c+" height:"+b);this.vpaidCreative.resizeAd(c,b,this.vpaidViewmode)}});return a};if(!v.tv.freewheel.SDK)v.tv.freewheel.SDK=
v.tv.freewheel[R]("tv.freewheel.SDK");return v})();

!function(){var define;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hls=e()}}(function(){return function s(e,t,r){function i(a,d){if(!t[a]){if(!e[a]){var l="function"==typeof require&&require;if(!d&&l)return l(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var o=t[a]={exports:{}};e[a][0].call(o.exports,function(t){var r=e[a][1][t];return i(r?r:t)},o,o.exports,s,e,t,r)}return t[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(s,a,o){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function t(e){return"function"==typeof e}function n(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}a.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},e.prototype.emit=function(l){var s,e,u,a,n,o;if(this._events||(this._events={}),"error"===l&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(s=arguments[1],s instanceof Error)throw s;throw TypeError('Uncaught, unspecified "error" event.')}if(e=this._events[l],i(e))return!1;if(t(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),e.apply(this,a)}else if(r(e))for(a=Array.prototype.slice.call(arguments,1),o=e.slice(),u=o.length,n=0;u>n;n++)o[n].apply(this,a);return!0},e.prototype.addListener=function(a,n){var s;if(!t(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,t(n.listener)?n.listener:n),this._events[a]?r(this._events[a])?this._events[a].push(n):this._events[a]=[this._events[a],n]:this._events[a]=n,r(this._events[a])&&!this._events[a].warned&&(s=i(this._maxListeners)?e.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[a].length>s&&(this._events[a].warned=!0,"function"==typeof console.trace)),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(i,e){function r(){this.removeListener(i,r),a||(a=!0,e.apply(this,arguments))}if(!t(e))throw TypeError("listener must be a function");var a=!1;return r.listener=e,this.on(i,r),this},e.prototype.removeListener=function(a,i){var e,s,o,n;if(!t(i))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(e=this._events[a],o=e.length,s=-1,e===i||t(e.listener)&&e.listener===i)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,i);else if(r(e)){for(n=o;n-- >0;)if(e[n]===i||e[n].listener&&e[n].listener===i){s=n;break}if(0>s)return this;1===e.length?(e.length=0,delete this._events[a]):e.splice(s,1),this._events.removeListener&&this.emit("removeListener",a,i)}return this},e.prototype.removeAllListeners=function(r){var i,e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[r]&&delete this._events[r],this;if(0===arguments.length){for(i in this._events)"removeListener"!==i&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[r],t(e))this.removeListener(r,e);else if(e)for(;e.length;)this.removeListener(r,e[e.length-1]);return delete this._events[r],this},e.prototype.listeners=function(e){var r;return r=this._events&&this._events[e]?t(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.prototype.listenerCount=function(r){if(this._events){var e=this._events[r];if(t(e))return 1;if(e)return e.length}return 0},e.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(n,i,s){var a=arguments[3],e=arguments[4],r=arguments[5],t=JSON.stringify;i.exports=function(l){for(var i,s=Object.keys(r),n=0,d=s.length;d>n;n++){var o=s[n],u=r[o].exports;if(u===l||u.default===l){i=o;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},n=0,d=s.length;d>n;n++){var o=s[n];h[o]=o}e[i]=[Function(["require","module","exports"],"("+l+")(self)"),h]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[i]=i,e[f]=[Function(["require"],"var f = require("+t(i)+");(f.default ? f.default : f)(self);"),c];var g="("+a+")({"+Object.keys(e).map(function(r){return t(r)+":["+e[r][0]+","+t(e[r][1])+"]"}).join(",")+"},{},["+t(f)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(v.createObjectURL(new Blob([g],{type:"text/javascript"})))}},{}],3:[function(e,m,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),c=e("../events"),t=r(c),d=e("../event-handler"),a=r(d),f=e("../helper/buffer-helper"),o=r(f),s=e("../errors"),i=e("../utils/logger"),p=e("./ewma-bandwidth-estimator"),u=r(p),y=function(r){function e(i){h(this,e);var r=v(this,Object.getPrototypeOf(e).call(this,i,t.default.FRAG_LOADING,t.default.FRAG_LOADED,t.default.ERROR));return r.lastLoadedFragLevel=0,r._autoLevelCapping=-1,r._nextAutoLevel=-1,r.hls=i,r.onCheck=r.abandonRulesCheck.bind(r),r}return g(e,r),l(e,[{key:"destroy",value:function(){this.clearTimer(),a.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var n=a.frag;if("main"===n.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var t=this.hls,s=a.frag.level,o=t.levels[s].details.live,e=t.config,r=void 0,i=void 0;o?(r=e.abrEwmaFastLive,i=e.abrEwmaSlowLive):(r=e.abrEwmaFastVoD,i=e.abrEwmaSlowVoD),this.bwEstimator=new u.default(t,i,r,e.abrEwmaDefaultEstimate)}this.fragCurrent=n}}},{key:"abandonRulesCheck",value:function(){var s=this.hls,n=s.media,e=this.fragCurrent,l=e.loader;if(!l||l.stats&&l.stats.aborted)return i.logger.warn("frag loader destroy or aborted, disarm abandonRulesCheck"),void this.clearTimer();var a=l.stats;if(n&&(!n.paused&&0!==n.playbackRate||!n.readyState)&&e.autoLevel&&e.level){var h=performance.now()-a.trequest,f=Math.abs(n.playbackRate);if(h>500*e.duration/f){var p=s.levels,g=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/h),y=a.total?a.total:Math.max(a.loaded,Math.round(e.duration*p[e.level].bitrate/8)),v=n.currentTime,c=(y-a.loaded)/g,u=(o.default.bufferInfo(n,v,s.config.maxBufferHole).end-v)/f;if(u<2*e.duration/f&&c>u){var d=void 0,r=void 0;for(r=e.level-1;r>=0&&(d=e.duration*p[r].bitrate/(6.4*g),i.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+r+"] :"+c.toFixed(1)+"/"+u.toFixed(1)+"/"+d.toFixed(1)),!(u>d));r--);c>d&&(r=Math.max(0,r),s.nextLoadLevel=r,this.bwEstimator.sample(h,a.loaded),i.logger.warn("loading too slow, abort fragment loading and switch to level "+r),e.loader.abort(),this.clearTimer(),s.trigger(t.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e}))}}}}},{key:"onFragLoaded",value:function(r){var e=r.frag;if("main"===e.type){var t=r.stats;void 0===t.aborted&&1===e.loadCounter&&this.bwEstimator.sample(performance.now()-t.trequest,t.loaded),this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1}}},{key:"onError",value:function(e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var r=this.hls,i=r.config,t=r.levels,a=r.media,e=void 0,n=void 0;if(n=-1===this._autoLevelCapping&&t&&t.length?t.length-1:this._autoLevelCapping,-1!==this._nextAutoLevel)return Math.min(this._nextAutoLevel,n);var s=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,o=this.bwEstimator?this.bwEstimator.getEstimate()/s:i.abrEwmaDefaultEstimate/s,l=void 0;for(e=0;n>=e;e++)if(l=e<=this.lastLoadedFragLevel?i.abrBandWidthFactor*o:i.abrBandWidthUpFactor*o,l<t[e].bitrate)return Math.max(0,e-1);return e-1},set:function(e){this._nextAutoLevel=e}}]),e}(a.default);n.default=y},{"../errors":24,"../event-handler":25,"../events":26,"../helper/buffer-helper":28,"../utils/logger":43,"./ewma-bandwidth-estimator":8}],4:[function(i,A,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(s,"__esModule",{value:!0});var k=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=i("../utils/binary-search"),u=n(l),d=i("../helper/buffer-helper"),h=n(d),f=i("../demux/demuxer"),T=n(f),g=i("../events"),t=n(g),p=i("../event-handler"),o=n(p),m=i("../helper/level-helper"),E=n(m),b=i("../utils/timeRanges"),R=n(b),a=i("../errors"),r=i("../utils/logger"),e={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},c=function(n){function i(r){v(this,i);var e=y(this,Object.getPrototypeOf(i).call(this,r,t.default.MEDIA_ATTACHED,t.default.MEDIA_DETACHING,t.default.AUDIO_TRACKS_UPDATED,t.default.AUDIO_TRACK_SWITCH,t.default.AUDIO_TRACK_LOADED,t.default.KEY_LOADED,t.default.FRAG_LOADED,t.default.FRAG_PARSING_INIT_SEGMENT,t.default.FRAG_PARSING_DATA,t.default.FRAG_PARSED,t.default.ERROR,t.default.BUFFER_CREATED,t.default.BUFFER_APPENDED,t.default.BUFFER_FLUSHED));return e.config=r.config,e.audioCodecSwap=!1,e.ticks=0,e.ontick=e.tick.bind(e),e}return _(i,n),k(i,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),o.default.prototype.destroy.call(this),this.state=e.STOPPED}},{key:"startLoad",value:function(t){if(this.tracks){var a=this.media,i=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,a&&i?(r.logger.log("configure startPosition @"+i),this.state=e.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=e.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=e.STOPPED}},{key:"stopLoad",value:function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=e.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var v,g,n,f=this.hls,d=f.config;switch(this.state){case e.ERROR:case e.PAUSED:break;case e.STARTING:this.state=e.WAITING_TRACK,this.loadedmetadata=!1;break;case e.IDLE:if(!this.media&&(this.startFragRequested||!d.startFragPrefetch))break;v=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;var c=this.mediaBuffer?this.mediaBuffer:this.media,E=h.default.bufferInfo(c,v,d.maxBufferHole),T=E.len,o=E.end,l=this.fragPrevious,A=d.maxMaxBufferLength;if(A>T&&this.trackId<this.tracks.length){if(n=this.tracks[this.trackId].details,"undefined"==typeof n){this.state=e.WAITING_TRACK;break}if(!n.live&&l&&l.sn===n.endSN&&(!this.media.seeking||this.media.duration-o<l.duration/2)){this.hls.trigger(t.default.BUFFER_EOS,{type:"audio"}),this.state=e.ENDED;break}var s=n.fragments,p=s.length,y=s[0].start,m=s[p-1].start+s[p-1].duration,i=void 0;if(y>o?i=s[0]:!function(){var e=void 0,t=d.maxFragLookUpTolerance;m>o?(o>m-t&&(t=0),e=u.default.search(s,function(e){return e.start+e.duration-t<=o?1:e.start-t>o?-1:0})):e=s[p-1],e&&(i=e,y=e.start,l&&i.level===l.level&&i.sn===l.sn&&(i.sn<n.endSN?(i=s[i.sn+1-n.startSN],r.logger.log("SN just loaded, load next one: "+i.sn)):i=null))}(),i)if(null!=i.decryptdata.uri&&null==i.decryptdata.key)r.logger.log("Loading key for "+i.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+this.trackId),this.state=e.KEY_LOADING,f.trigger(t.default.KEY_LOADING,{frag:i});else{if(r.logger.log("Loading "+i.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+this.trackId+", currentTime:"+v+",bufferEnd:"+o.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,i.loadCounter){i.loadCounter++;var b=d.fragLoadingLoopThreshold;if(i.loadCounter>b&&Math.abs(this.fragLoadIdx-i.loadIdx)<b)return void f.trigger(t.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:i})}else i.loadCounter=1;i.loadIdx=this.fragLoadIdx,this.fragCurrent=i,this.startFragRequested=!0,f.trigger(t.default.FRAG_LOADING,{frag:i}),this.state=e.FRAG_LOADING}}break;case e.WAITING_TRACK:g=this.tracks[this.trackId],g&&g.details&&(this.state=e.IDLE);break;case e.FRAG_LOADING_WAITING_RETRY:var k=performance.now(),R=this.retryDate;c=this.media;var _=c&&c.seeking;(!R||k>=R||_)&&(r.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=e.IDLE);break;case e.STOPPED:case e.FRAG_LOADING:case e.PARSING:case e.PARSED:case e.ENDED:}}},{key:"onMediaAttached",value:function(r){var e=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var t=this.config;this.tracks&&t.autoStartLoad&&this.startLoad(t.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(r.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===e.ENDED&&(this.state=e.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){r.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitch",value:function(r){this.trackId=r.id,this.state=e.IDLE,this.fragCurrent=null,this.state=e.PAUSED,"main"===r.type?this.demuxer&&(this.demuxer.destroy(),this.demuxer=null):this.timer||(this.timer=setInterval(this.ontick,100)),this.hls.trigger(t.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),this.tick()}},{key:"onAudioTrackLoaded",value:function(a){var t=a.details,n=a.id,s=this.tracks[n],o=t.totalduration;if(r.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.PTSKnown=!1,s.details=t,!this.startFragRequested){if(-1===this.startPosition){var i=t.startTimeOffset;isNaN(i)?this.startPosition=0:(r.logger.log("start time offset found in playlist, adjust startPosition to "+i),this.startPosition=i)}this.nextLoadPosition=this.startPosition}this.state===e.WAITING_TRACK&&(this.state=e.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===e.KEY_LOADING&&(this.state=e.IDLE,this.tick())}},{key:"onFragLoaded",value:function(i){var t=this.fragCurrent;if(this.state===e.FRAG_LOADING&&t&&"audio"===i.frag.type&&i.frag.level===t.level&&i.frag.sn===t.sn){this.state=e.PARSING,this.stats=i.stats;var n=this.tracks[this.trackId],a=n.details,l=a.totalduration,u=t.start,s=t.level,o=t.sn,d=this.config.defaultAudioCodec||n.audioCodec;this.pendingAppending=0,this.demuxer||(this.demuxer=new T.default(this.hls,"audio")),r.logger.log("Demuxing "+o+" of ["+a.startSN+" ,"+a.endSN+"],track "+s),this.demuxer.push(i.payload,d,null,u,t.cc,s,o,l,t.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var n=this.fragCurrent;if(n&&"audio"===a.id&&a.sn===n.sn&&a.level===n.level&&this.state===e.PARSING){var s=a.tracks,i=void 0;if(i=s.audio){i.levelCodec="mp4a.40.2",i.id=a.id,this.hls.trigger(t.default.BUFFER_CODECS,s),r.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var o=i.initSegment;o&&(this.pendingAppending++,this.hls.trigger(t.default.BUFFER_APPENDING,{type:"audio",data:o,parent:"audio",content:"initSegment"})),this.tick()}}}},{key:"onFragParsingData",value:function(i){var n=this,a=this.fragCurrent;if(a&&"audio"===i.id&&i.sn===a.sn&&i.level===a.level&&this.state===e.PARSING){var s=this.tracks[this.trackId],o=this.fragCurrent;r.logger.log("parsed "+i.type+",PTS:["+i.startPTS.toFixed(3)+","+i.endPTS.toFixed(3)+"],DTS:["+i.startDTS.toFixed(3)+"/"+i.endDTS.toFixed(3)+"],nb:"+i.nb),E.default.updateFragPTSDTS(s.details,o.sn,i.startPTS,i.endPTS),[i.data1,i.data2].forEach(function(e){e&&(n.pendingAppending++,n.hls.trigger(t.default.BUFFER_APPENDING,{type:i.type,data:e,parent:"audio",content:"data"}))}),this.nextLoadPosition=i.endPTS,this.tick()}}},{key:"onFragParsed",value:function(t){var r=this.fragCurrent;r&&"audio"===t.id&&t.sn===r.sn&&t.level===r.level&&this.state===e.PARSING&&(this.stats.tparsed=performance.now(),this.state=e.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(t){if("audio"===t.parent)switch(this.state){case e.PARSING:case e.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===e.PARSED&&0===this.pendingAppending){var i=this.fragCurrent,a=this.stats;if(i){this.fragPrevious=i,a.tbuffered=performance.now(),this.hls.trigger(t.default.FRAG_BUFFERED,{stats:a,frag:i,id:"audio"});var n=this.mediaBuffer?this.mediaBuffer:this.media;r.logger.log("audio buffered : "+R.default.toString(n.buffered)),this.state=e.IDLE}this.tick()}}},{key:"onError",value:function(i){var s=i.frag;if(!s||"audio"===s.type)switch(i.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!i.fatal){var n=this.fragLoadError;if(n?n++:n=1,n<=this.config.fragLoadingMaxRetry){this.fragLoadError=n,s.loadCounter=0;var o=Math.min(Math.pow(2,n-1)*this.config.fragLoadingRetryDelay,64e3);r.logger.warn("audioStreamController: frag loading failed, retry in "+o+" ms"),this.retryDate=performance.now()+o,this.state=e.FRAG_LOADING_WAITING_RETRY}else r.logger.error("audioStreamController: "+i.details+" reaches max retry, redispatch as fatal ..."),i.fatal=!0,this.hls.trigger(t.default.ERROR,i),this.state=e.ERROR}break;case a.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==e.ERROR&&(this.state=i.fatal?e.ERROR:e.IDLE,r.logger.warn("audioStreamController: "+i.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=e.IDLE,this.fragPrevious=null,this.tick()}}]),i}(o.default);s.default=c},{"../demux/demuxer":20,"../errors":24,"../event-handler":25,"../events":26,"../helper/buffer-helper":28,"../helper/level-helper":29,"../utils/binary-search":39,"../utils/logger":43,"../utils/timeRanges":45}],5:[function(r,c,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var f=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r("../events"),e=a(l),d=r("../event-handler"),n=a(d),t=r("../utils/logger"),o=function(i){function r(t){return u(this,r),h(this,Object.getPrototypeOf(r).call(this,t,e.default.MANIFEST_LOADING,e.default.MANIFEST_LOADED,e.default.AUDIO_TRACK_LOADED))}return s(r,i),f(r,[{key:"destroy",value:function(){n.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(n){var s=this,r=n.audioTracks||[],i=!1;this.tracks=r,this.hls.trigger(e.default.AUDIO_TRACKS_UPDATED,{audioTracks:r});var a=0;r.forEach(function(e){return e.default?(s.audioTrack=a,void(i=!0)):void a++}),i===!1&&r.length&&(t.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(t.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(r){if(r>=0&&r<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=r,t.logger.log("switching to audioTrack "+r);var i=this.tracks[r],a=i.type;this.hls.trigger(e.default.AUDIO_TRACK_SWITCH,{id:r,type:a});var n=i.details;"main"===a||void 0!==n&&n.live!==!0||(t.logger.log("(re)loading playlist for audioTrack "+r),this.hls.trigger(e.default.AUDIO_TRACK_LOADING,{url:i.url,id:r}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),r}(n.default);i.default=o},{"../event-handler":25,"../events":26,"../utils/logger":43}],6:[function(i,g,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=i("../events"),t=n(l),d=i("../event-handler"),s=n(d),e=i("../utils/logger"),r=i("../errors"),o=function(a){function i(r){u(this,i);var e=h(this,Object.getPrototypeOf(i).call(this,r,t.default.MEDIA_ATTACHING,t.default.MEDIA_DETACHING,t.default.MANIFEST_PARSED,t.default.BUFFER_RESET,t.default.BUFFER_APPENDING,t.default.BUFFER_CODECS,t.default.BUFFER_EOS,t.default.BUFFER_FLUSHING,t.default.LEVEL_UPDATED));return e._msDuration=null,e._levelDuration=null,e.onsbue=e.onSBUpdateEnd.bind(e),e.onsbe=e.onSBUpdateError.bind(e),e.pendingTracks={},e}return f(i,a),c(i,[{key:"destroy",value:function(){s.default.prototype.destroy.call(this)}},{key:"onManifestParsed",value:function(r){var i=r.audio,a=r.video,t=0;(i||a)&&(t=(i?1:0)+(a?1:0),e.logger.log(t+" sourceBuffer(s) expected")),this.sourceBufferNb=t}},{key:"onMediaAttaching",value:function(r){var t=this.media=r.media;if(t){var e=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),e.addEventListener("sourceopen",this.onmso),e.addEventListener("sourceended",this.onmse),e.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(e)}}},{key:"onMediaDetaching",value:function(){e.logger.log("media source detaching");var r=this.mediaSource;if(r){if("open"===r.readyState)try{r.endOfStream()}catch(t){e.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}r.removeEventListener("sourceopen",this.onmso),r.removeEventListener("sourceended",this.onmse),r.removeEventListener("sourceclose",this.onmsc),this.media&&(this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.sourceBuffer={}}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(t.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){e.logger.log("media source opened"),this.hls.trigger(t.default.MEDIA_ATTACHED,{media:this.media});var r=this.mediaSource;r&&r.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;!t||this.sourceBufferNb!==t&&0!==this.sourceBufferNb||(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){e.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){e.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1,this.hls.trigger(t.default.BUFFER_APPENDED,{parent:this.parent}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(i){e.logger.error("sourceBuffer error:"+i),this.hls.trigger(t.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var t=this.sourceBuffer;for(var r in t){var e=t[r];try{this.mediaSource.removeSourceBuffer(e),e.removeEventListener("updateend",this.onsbue),e.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(a){var l=this.sourceBuffer,u=this.mediaSource;for(var n in a)if(!l[n]){var i=a[n],d=i.levelCodec||i.codec,s=i.container+";codecs="+d;e.logger.log("creating sourceBuffer with mimeType:"+s);try{var o=l[n]=u.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),i.buffer=o}catch(i){e.logger.error("error while trying to add sourceBuffer:"+i.message),this.hls.trigger(t.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:i,mimeType:s})}}this.hls.trigger(t.default.BUFFER_CREATED,{tracks:a})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(i){e.logger.error("sourceBuffer error:"+i.event),this.hls.trigger(t.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(a){var r=this.sourceBuffer,i=a.type;for(var t in r)i&&t!==i||r[t].ended||(r[t].ended=!0,e.logger.log(t+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var t=this.sourceBuffer,r=this.mediaSource;if(!r||"open"!==r.readyState)return void(this._needsEos=!1);for(var i in t){if(!t[i].ended)return;if(t[i].updating)return void(this._needsEos=!0)}e.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"),r.endOfStream(),this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(t){var e=t.details;0!==e.fragments.length&&(this._levelDuration=e.totalduration+e.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){if(null!==this._levelDuration){var i=this.media,t=this.mediaSource,r=this.sourceBuffer;if(i&&t&&r&&0!==i.readyState&&"open"===t.readyState){for(var a in r)if(r[a].updating)return;null===this._msDuration&&(this._msDuration=t.duration),this._levelDuration>this._msDuration&&(e.logger.log("Updating mediasource duration to "+this._levelDuration),t.duration=this._levelDuration,this._msDuration=this._levelDuration)}}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var r=0,i=this.sourceBuffer;for(var a in i)r+=i[a].buffered.length;this.appended=r,this.hls.trigger(t.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var a=this.hls,s=this.sourceBuffer,n=this.segments;if(Object.keys(s).length){if(this.media.error)return this.segments=[],void e.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var o=n.shift();try{var l=o.type;s[l]?(s[l].ended=!1,this.parent=o.parent,s[l].appendBuffer(o.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(s){e.logger.error("error while trying to append buffer:"+s.message),n.unshift(o);var i={type:r.ErrorTypes.MEDIA_ERROR};if(22===s.code)return this.segments=[],i.details=r.ErrorDetails.BUFFER_FULL_ERROR,void a.trigger(t.default.ERROR,i);if(this.appendError?this.appendError++:this.appendError=1,i.details=r.ErrorDetails.BUFFER_APPEND_ERROR,i.frag=this.fragCurrent,this.appendError>a.config.appendErrorMaxRetry)return e.logger.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),
n=[],i.fatal=!0,void a.trigger(t.default.ERROR,i);i.fatal=!1,a.trigger(t.default.ERROR,i)}}}}},{key:"flushBuffer",value:function(l,n,h){var t,r,o,s,i,a,u=this.sourceBuffer;if(Object.keys(u).length){if(e.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime+"/"+l+"/"+n),this.flushBufferCounter<this.appended){for(var d in u)if(!h||d===h){if(t=u[d],t.updating)return e.logger.warn("cannot flush, sb updating in progress"),!1;for(r=0;r<t.buffered.length;r++)if(o=t.buffered.start(r),s=t.buffered.end(r),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&n===Number.POSITIVE_INFINITY?(i=l,a=n):(i=Math.max(o,l),a=Math.min(s,n)),Math.min(a,s)-i>.5)return this.flushBufferCounter++,e.logger.log("flush "+d+" ["+i+","+a+"], of ["+o+","+s+"], pos:"+this.media.currentTime),t.remove(i,a),!1}}else e.logger.warn("abort flushing too many retries");e.logger.log("buffer flushed")}return!0}}]),i}(s.default);a.default=o},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],7:[function(t,f,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=t("../events"),e=i(l),d=t("../event-handler"),s=i(d),u=function(r){function t(r){return a(this,t),n(this,Object.getPrototypeOf(t).call(this,r,e.default.FPS_DROP_LEVEL_CAPPING,e.default.MEDIA_ATTACHING,e.default.MANIFEST_PARSED))}return h(t,r),o(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){this.hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,this.hls.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;e&&(this.hls.autoLevelCapping=this.getMaxLevel(e-1),this.hls.autoLevelCapping>this.autoLevelCapping&&this.hls.streamController.nextLevelSwitch(),this.autoLevelCapping=this.hls.autoLevelCapping)}}},{key:"getMaxLevel",value:function(n){var r=0,e=void 0,t=void 0,s=this.mediaWidth,o=this.mediaHeight,i=0,a=0;for(e=0;n>=e&&(t=this.levels[e],!this.isLevelRestricted(e))&&(r=e,i=t.width,a=t.height,!(i>=s||a>=o));e++);return r}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(e))}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0;return this.media&&(e=this.media.width||this.media.clientWidth||this.media.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0;return this.media&&(e=this.media.height||this.media.clientHeight||this.media.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(s.default);r.default=u},{"../event-handler":25,"../events":26}],8:[function(r,l,e){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=r("../utils/ewma"),t=i(s),o=function(){function e(r,i,n,s){a(this,e),this.hls=r,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new t.default(i),this.fast_=new t.default(n)}return n(e,[{key:"sample",value:function(e,i){e=Math.max(e,this.minDelayMs_);var t=8e3*i/e,r=e/1e3;this.fast_.sample(r,t),this.slow_.sample(r,t)}},{key:"getEstimate",value:function(){return!this.fast_||!this.slow_||this.fast_.getTotalWeight()<this.minWeight_?this.defaultEstimate_:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}},{key:"destroy",value:function(){}}]),e}();e.default=o},{"../utils/ewma":42}],9:[function(e,c,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var f=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e("../events"),t=i(l),d=e("../event-handler"),h=i(d),o=e("../utils/logger"),u=function(r){function e(r){return a(this,e),n(this,Object.getPrototypeOf(e).call(this,r,t.default.MEDIA_ATTACHING))}return s(e,r),f(e,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){this.hls.config.capLevelOnFPSDrop&&(this.video=e.media instanceof HTMLVideoElement?e.media:null,"function"==typeof this.video.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),this.hls.config.fpsDroppedMonitoringPeriod))}},{key:"checkFPS",value:function(d,r,i){var n=performance.now();if(r){if(this.lastTime){var l=n-this.lastTime,a=i-this.lastDroppedFrames,s=r-this.lastDecodedFrames,u=1e3*a/l;if(this.hls.trigger(t.default.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),u>0&&a>this.hls.config.fpsDroppedMonitoringThreshold*s){var e=this.hls.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===this.hls.autoLevelCapping||this.hls.autoLevelCapping>=e)&&(e-=1,this.hls.trigger(t.default.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:this.hls.currentLevel}),this.hls.autoLevelCapping=e,this.hls.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=r}}},{key:"checkFPSInterval",value:function(){if(this.video)if(this.isVideoPlaybackQualityAvailable){var e=this.video.getVideoPlaybackQuality();this.checkFPS(this.video,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(this.video,this.video.webkitDecodedFrameCount,this.video.webkitDroppedFrameCount)}}]),e}(h.default);r.default=u},{"../event-handler":25,"../events":26,"../utils/logger":43}],10:[function(i,g,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=i("../events"),t=n(l),d=i("../event-handler"),h=n(d),r=i("../utils/logger"),e=i("../errors"),o=function(a){function i(r){u(this,i);var e=f(this,Object.getPrototypeOf(i).call(this,r,t.default.MANIFEST_LOADED,t.default.LEVEL_LOADED,t.default.ERROR));return e.ontick=e.tick.bind(e),e._manualLevel=e._autoLevelCapping=-1,e}return s(i,a),c(i,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0,this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(d){var s,a,n=[],i=[],h={},o=!1,l=!1,u=this.hls;if(d.levels.forEach(function(e){e.videoCodec&&(o=!0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(l=!0);var t=h[e.bitrate];void 0===t?(h[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),o&&l?n.forEach(function(e){e.videoCodec&&i.push(e)}):i=n,i=i.filter(function(e){var i=function(e){return MediaSource.isTypeSupported("audio/mp4;codecs="+e)},a=function(e){return MediaSource.isTypeSupported("video/mp4;codecs="+e)},t=e.audioCodec,r=e.videoCodec;return(!t||i(t))&&(!r||a(r))}),i.length){for(s=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i,a=0;a<i.length;a++)if(i[a].bitrate===s){this._firstLevel=a,r.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+s);break}u.trigger(t.default.MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:d.stats,audio:l,video:o})}else u.trigger(t.default.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:u.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(i){var s=this._levels;if(i>=0&&i<s.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level=i,r.logger.log("switching to level "+i),this.hls.trigger(t.default.LEVEL_SWITCH,{level:i});var a=s[i],n=a.details;if(!n||n.live===!0&&performance.now()-n.tload>1e3){r.logger.log("(re)loading playlist for level "+i);var o=a.urlId;this.hls.trigger(t.default.LEVEL_LOADING,{url:a.url[o],level:i,id:o})}}else this.hls.trigger(t.default.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(n){if(!n.fatal){var a=n.details,o=this.hls,s=void 0,i=void 0,l=!1;switch(a){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:s=n.frag.level;break;case e.ErrorDetails.LEVEL_LOAD_ERROR:case e.ErrorDetails.LEVEL_LOAD_TIMEOUT:s=n.context.level,l=!0}if(void 0!==s)if(i=this._levels[s],i.urlId<i.url.length-1)i.urlId++,i.details=void 0,r.logger.warn("level controller,"+a+" for level "+s+": switching to redundant stream id "+i.urlId);else{var u=-1===this._manualLevel&&s;u?(r.logger.warn("level controller,"+a+": emergency switch-down for next fragment"),o.abrController.nextAutoLevel=0):i&&i.details&&i.details.live?(r.logger.warn("level controller,"+a+" on live stream, discard"),l&&(this._level=void 0)):a!==e.ErrorDetails.FRAG_LOAD_ERROR&&a!==e.ErrorDetails.FRAG_LOAD_TIMEOUT&&(r.logger.error("cannot recover "+a+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),n.fatal=!0,o.trigger(t.default.ERROR,n))}}}},{key:"onLevelLoaded",value:function(i){if(i.level===this._level){var t=i.details;if(t.live){var e=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),n=this._levels[i.level],a=n.details;a&&t.endSN===a.endSN&&(e/=2,r.logger.log("same live playlist, reload twice faster")),e-=performance.now()-i.stats.trequest,e=Math.max(1e3,Math.round(e)),r.logger.log("live playlist, reload in "+e+" ms"),this.timer=setTimeout(this.ontick,e)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var r=this._levels[e],i=r.urlId;this.hls.trigger(t.default.LEVEL_LOADING,{url:r.url[i],level:e,id:i})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._firstLevel:this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),i}(h.default);a.default=o},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],11:[function(a,A,d){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(d,"__esModule",{value:!0});var E=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),y=a("../utils/binary-search"),v=n(y),f=a("../helper/buffer-helper"),s=n(f),m=a("../demux/demuxer"),u=n(m),g=a("../events"),r=n(g),p=a("../event-handler"),l=n(p),h=a("../helper/level-helper"),o=n(h),b=a("../utils/timeRanges"),R=n(b),i=a("../errors"),t=a("../utils/logger"),e={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},T=function(n){function a(t){c(this,a);var e=k(this,Object.getPrototypeOf(a).call(this,t,r.default.MEDIA_ATTACHED,r.default.MEDIA_DETACHING,r.default.MANIFEST_LOADING,r.default.MANIFEST_PARSED,r.default.LEVEL_LOADED,r.default.KEY_LOADED,r.default.FRAG_LOADED,r.default.FRAG_LOAD_EMERGENCY_ABORTED,r.default.FRAG_PARSING_INIT_SEGMENT,r.default.FRAG_PARSING_DATA,r.default.FRAG_PARSED,r.default.ERROR,r.default.AUDIO_TRACK_SWITCH,r.default.BUFFER_CREATED,r.default.BUFFER_APPENDED,r.default.BUFFER_FLUSHED));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e.ontick=e.tick.bind(e),e}return _(a,n),E(a,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),l.default.prototype.destroy.call(this),this.state=e.STOPPED}},{key:"startLoad",value:function(a){if(this.levels){var r=this.media,i=this.lastCurrentTime;this.stopLoad(),this.demuxer=new u.default(this.hls,"main"),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,r&&i>0?(t.logger.log("configure startPosition @"+i),this.lastPaused||(t.logger.log("resuming video"),r.play()),this.state=e.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=e.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else t.logger.warn("cannot start loading as manifest not parsed yet"),this.state=e.STOPPED}},{key:"stopLoad",value:function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=e.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case e.STARTING:var i=this.hls,r=i.startLevel;-1===r&&(r=0,this.fragBitrateTest=!0),this.level=i.nextLoadLevel=r,this.state=e.WAITING_LEVEL,this.loadedmetadata=!1;break;case e.IDLE:if(!this._doTickIdle())return;break;case e.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=e.IDLE);break;case e.FRAG_LOADING_WAITING_RETRY:var s=performance.now(),n=this.retryDate;(!n||s>=n||this.media&&this.media.seeking)&&(t.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=e.IDLE);break;case e.ERROR:case e.PAUSED:case e.STOPPED:case e.FRAG_LOADING:case e.PARSING:case e.PARSED:case e.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var f=this.hls,n=f.config,o=this.media;if(!o&&(this.startFragRequested||!n.startFragPrefetch))return!0;var u=void 0;u=this.loadedmetadata?o.currentTime:this.nextLoadPosition;var a=f.nextLoadLevel,i=void 0;this.levels[a].hasOwnProperty("bitrate")?(i=Math.max(8*n.maxBufferSize/this.levels[a].bitrate,n.maxBufferLength),i=Math.min(i,n.maxMaxBufferLength)):i=n.maxBufferLength;var d=s.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:o,u,n.maxBufferHole),c=d.len;if(c>=i)return!0;t.logger.trace("buffer length of "+c.toFixed(3)+" is below max of "+i.toFixed(3)+". checking for more payload ..."),f.nextLoadLevel=a,this.level=a;var l=this.levels[a].details;if("undefined"==typeof l||l.live&&this.levelLastLoaded!==a)return this.state=e.WAITING_LEVEL,!0;var h=this.fragPrevious;if(!l.live&&h&&h.sn===l.endSN&&(!o.seeking||o.duration-d.end<h.duration/2)){var g={};return"AUDIO"===this.audioTrackType&&(g.type="video"),this.hls.trigger(r.default.BUFFER_EOS,g),this.state=e.ENDED,!0}return this._fetchPayloadOrEos({pos:u,bufferInfo:d,levelDetails:l})}},{key:"_fetchPayloadOrEos",value:function(s){var h=s.pos,u=s.bufferInfo,r=s.levelDetails,o=this.fragPrevious,d=this.level,e=r.fragments,i=e.length,n=e[0].start,l=e[i-1].start+e[i-1].duration,a=u.end,t=void 0;if(r.live){if(t=this._ensureFragmentAtLivePoint({levelDetails:r,bufferEnd:a,start:n,end:l,fragPrevious:o,fragments:e,fragLen:i}),null===t)return!1}else n>a&&(t=e[0]);return t||(t=this._findFragment({start:n,fragPrevious:o,fragLen:i,fragments:e,bufferEnd:a,end:l,levelDetails:r})),t?this._loadFragmentOrKey({frag:t,level:d,levelDetails:r,pos:h,bufferEnd:a}):!0}},{key:"_ensureFragmentAtLivePoint",value:function(e){var r=e.levelDetails,a=e.bufferEnd,f=e.start,h=e.end,d=e.fragPrevious,u=e.fragments,c=e.fragLen,o=this.hls.config,i=void 0,g=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*r.targetduration;if(a<Math.max(f,h-g)){var s=this.liveSyncPosition=this.computeLivePosition(f,r);t.logger.log("buffer end: "+a+" is located too far from the end of live sliding playlist, reset currentTime to : "+s.toFixed(3)),a=s;var n=this.media;n&&n.readyState&&n.duration>s&&(n.currentTime=s)}if(r.PTSKnown&&a>h)return null;if(this.startFragRequested&&!r.PTSKnown){if(d){var l=d.sn+1;l>=r.startSN&&l<=r.endSN&&(i=u[l-r.startSN],t.logger.log("live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=u[Math.min(c-1,Math.round(c/2))],t.logger.log("live playlist, switching playlist, unknown, load middle frag : "+i.sn))}return i}},{key:"_findFragment",value:function(r){var c=r.start,i=r.fragPrevious,g=r.fragLen,s=r.fragments,o=r.bufferEnd,d=r.end,f=r.levelDetails,u=this.hls.config,e=void 0,a=void 0,n=u.maxFragLookUpTolerance;if(d>o?(o>d-n&&(n=0),a=v.default.search(s,function(e){return e.start+e.duration-n<=o?1:e.start-n>o&&e.start?-1:0})):a=s[g-1],a&&(e=a,c=a.start,i&&e.level===i.level&&e.sn===i.sn))if(e.sn<f.endSN){var h=i.deltaPTS,l=e.sn-f.startSN;h&&h>u.maxBufferHole&&i.dropped&&l?(e=s[l-1],t.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),i.loadCounter--):(e=s[l+1],t.logger.log("SN just loaded, load next one: "+e.sn))}else e=null;return e}},{key:"_loadFragmentOrKey",value:function(n){var a=n.frag,l=n.level,o=n.levelDetails,d=n.pos,h=n.bufferEnd,s=this.hls,f=s.config;if(null==a.decryptdata.uri||null!=a.decryptdata.key){if(t.logger.log("Loading "+a.sn+" of ["+o.startSN+" ,"+o.endSN+"],level "+l+", currentTime:"+d+",bufferEnd:"+h.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var u=f.fragLoadingLoopThreshold;if(a.loadCounter>u&&Math.abs(this.fragLoadIdx-a.loadIdx)<u)return s.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a}),!1}else a.loadCounter=1;return a.loadIdx=this.fragLoadIdx,a.autoLevel=s.autoLevelEnabled,this.fragCurrent=a,this.startFragRequested=!0,s.trigger(r.default.FRAG_LOADING,{frag:a}),this.state=e.FRAG_LOADING,!0}t.logger.log("Loading key for "+a.sn+" of ["+o.startSN+" ,"+o.endSN+"],level "+l),this.state=e.KEY_LOADING,s.trigger(r.default.KEY_LOADING,{frag:a})}},{key:"getBufferRange",value:function(i){var e,t,r=this.bufferRange;if(r)for(e=r.length-1;e>=0;e--)if(t=r[e],i>=t.start&&i<=t.end)return t;return null}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"isBuffered",value:function(r){var i=this.media;if(i)for(var t=i.buffered,e=0;e<t.length;e++)if(r>=t.start(e)&&r<=t.end(e))return!0;return!1}},{key:"_checkFragmentChanged",value:function(){var t,e,i=this.media;if(i&&i.seeking===!1&&(e=i.currentTime,e>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),this.isBuffered(e)?t=this.getBufferRange(e):this.isBuffered(e+.1)&&(t=this.getBufferRange(e+.1)),t)){var a=t.frag;a!==this.fragPlaying&&(this.fragPlaying=a,this.hls.trigger(r.default.FRAG_CHANGED,{frag:a}))}}},{key:"immediateLevelSwitch",value:function(){if(t.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var i=this.media,a=void 0;i?(a=i.paused,i.pause()):a=!0,this.previouslyPaused=a}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.state=e.PAUSED,this.hls.trigger(r.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,this.isBuffered(e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var t=this.media;if(t&&t.readyState){var n=void 0,a=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,a=this.getBufferRange(t.currentTime),a&&a.start>1&&(this.state=e.PAUSED,this.hls.trigger(r.default.BUFFER_FLUSHING,{startOffset:0,endOffset:a.start-1})),t.paused)n=0;else{var l=this.hls.nextLoadLevel,u=this.levels[l],o=this.fragLastKbps;n=o&&this.fragCurrent?this.fragCurrent.duration*u.bitrate/(1e3*o)+1:0}if(i=this.getBufferRange(t.currentTime+n),i&&(i=this.followingBufferRange(i))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.state=e.PAUSED,this.hls.trigger(r.default.BUFFER_FLUSHING,{startOffset:i.start,endOffset:Number.POSITIVE_INFINITY})}}}},{key:"onMediaAttached",value:function(r){var e=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var t=this.config;this.levels&&t.autoStartLoad&&this.hls.startLoad(t.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(t.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var r=this.levels;r&&r.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var a=this.media,i=a?a.currentTime:void 0;if(t.logger.log("media seeking to "+i),this.state===e.FRAG_LOADING){var o=s.default.bufferInfo(a,i,this.config.maxBufferHole),r=this.fragCurrent;if(0===o.len&&r){var n=this.config.maxFragLookUpTolerance,l=r.start-n,u=r.start+r.duration+n;l>i||i>u?(r.loader&&(t.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=e.IDLE):t.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===e.ENDED&&(this.state=e.IDLE);a&&(this.lastCurrentTime=i),this.state!==e.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaSeeked",value:function(){t.logger.log("media seeked to "+this.media.currentTime),this.tick()}},{key:"onMediaEnded",value:function(){t.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){t.logger.log("trigger BUFFER_RESET"),this.hls.trigger(r.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(r){var e,i=!1,a=!1;r.levels.forEach(function(t){e=t.audioCodec,e&&(-1!==e.indexOf("mp4a.40.2")&&(i=!0),-1!==e.indexOf("mp4a.40.5")&&(a=!0))}),this.audioCodecSwitch=i&&a,this.audioCodecSwitch&&t.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var n=this.config;n.autoStartLoad&&this.hls.startLoad(n.startPosition)}},{key:"onLevelLoaded",value:function(u){var i=u.details,s=u.level,d=this.levels[s],h=i.totalduration,n=0;if(t.logger.log("level "+s+" loaded ["+i.startSN+","+i.endSN+"],duration:"+h),this.levelLastLoaded=s,i.live){var l=d.details;l?(o.default.mergeDetails(l,i),n=i.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(n,l),i.PTSKnown?t.logger.log("live playlist sliding:"+n.toFixed(3)):t.logger.log("live playlist - outdated PTS, unknown sliding")):(i.PTSKnown=!1,t.logger.log("live playlist - first load, unknown sliding"))}else i.PTSKnown=!1;if(d.details=i,this.hls.trigger(r.default.LEVEL_UPDATED,{details:i,level:s}),this.startFragRequested===!1){if(-1===this.startPosition){var a=i.startTimeOffset;isNaN(a)?i.live?(this.startPosition=this.computeLivePosition(n,i),t.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(0>a&&(t.logger.log("negative start time offset "+a+", count from end of last fragment"),a=n+h+a),t.logger.log("start time offset found in playlist, adjust startPosition to "+a),this.startPosition=a)}this.nextLoadPosition=this.startPosition}this.state===e.WAITING_LEVEL&&(this.state=e.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===e.KEY_LOADING&&(this.state=e.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var i=this.fragCurrent;if(this.state===e.FRAG_LOADING&&i&&"main"===a.frag.type&&a.frag.level===i.level&&a.frag.sn===i.sn)if(t.logger.log("Loaded  "+i.sn+" of level "+i.level),this.fragBitrateTest===!0)this.state=e.IDLE,this.fragBitrateTest=!1,this.startFragRequested=!1,a.stats.tparsed=a.stats.tbuffered=performance.now(),this.hls.trigger(r.default.FRAG_BUFFERED,{stats:a.stats,frag:i,id:"main"});else{this.state=e.PARSING,this.stats=a.stats;var s=this.levels[this.level],o=s.details,f=o.totalduration,c=void 0!==i.startDTS?i.startDTS:i.start,d=i.level,h=i.sn,n=this.config.defaultAudioCodec||s.audioCodec;this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),void 0===n&&(n=this.lastAudioCodec),n&&(n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingAppending=0,t.logger.log("Demuxing "+h+" of ["+o.startSN+" ,"+o.endSN+"],level "+d+", cc "+i.cc);var l=this.demuxer;l||(l=this.demuxer=new u.default(this.hls,"main")),l.push(a.payload,n,s.videoCodec,c,i.cc,d,h,f,i.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(n){var u=this.fragCurrent;if(u&&"main"===n.id&&n.sn===u.sn&&n.level===u.level&&this.state===e.PARSING){var l,i,a=n.tracks;if(a.audio&&"AUDIO"===this.audioTrackType&&delete a.audio,i=a.audio){var s=this.levels[this.level].audioCodec,d=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===d.indexOf("firefox")&&(s="mp4a.40.5"),-1!==d.indexOf("android")&&(s="mp4a.40.2",t.logger.log("Android: force audio codec to"+s)),i.levelCodec=s,i.id=n.id}if(i=a.video,i&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=n.id),n.unique){var o={codec:"",levelCodec:""};for(l in n.tracks)i=a[l],o.container=i.container,o.codec&&(o.codec+=",",o.levelCodec+=","),i.codec&&(o.codec+=i.codec),i.levelCodec&&(o.levelCodec+=i.levelCodec);a={audiovideo:o}}this.hls.trigger(r.default.BUFFER_CODECS,a);for(l in a){i=a[l],t.logger.log("main track:"+l+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var h=i.initSegment;h&&(this.pendingAppending++,this.hls.trigger(r.default.BUFFER_APPENDING,{type:l,data:h,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(i){var u=this,a=this.fragCurrent;if(a&&"main"===i.id&&i.sn===a.sn&&i.level===a.level&&("audio"!==i.type||"AUDIO"!==this.audioTrackType)&&this.state===e.PARSING){var s=this.levels[this.level],n=this.fragCurrent;t.logger.log("parsed "+i.type+",PTS:["+i.startPTS.toFixed(3)+","+i.endPTS.toFixed(3)+"],DTS:["+i.startDTS.toFixed(3)+"/"+i.endDTS.toFixed(3)+"],nb:"+i.nb+",dropped:"+(i.dropped||0));var d=o.default.updateFragPTSDTS(s.details,n.sn,i.startPTS,i.endPTS,i.startDTS,i.endDTS),l=this.hls;l.trigger(r.default.LEVEL_PTS_UPDATED,{details:s.details,level:this.level,drift:d}),"video"===i.type&&(n.dropped=i.dropped),[i.data1,i.data2].forEach(function(e){e&&(u.pendingAppending++,l.trigger(r.default.BUFFER_APPENDING,{type:i.type,data:e,parent:"main",content:"data"}))}),this.nextLoadPosition=i.endPTS,this.bufferRange.push({type:i.type,start:i.startPTS,end:i.endPTS,frag:n}),this.tick()}}},{key:"onFragParsed",value:function(t){var r=this.fragCurrent;r&&"main"===t.id&&t.sn===r.sn&&t.level===r.level&&this.state===e.PARSING&&(this.stats.tparsed=performance.now(),this.state=e.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitch",value:function(a){var r=a.type;if("main"===r){if(this.mediaBuffer!==this.media){t.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),
this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(t.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=e.IDLE}}else this.videoBuffer&&this.mediaBuffer!==this.videoBuffer&&(t.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=this.videoBuffer);this.audioTrackType=r}},{key:"onBufferCreated",value:function(o){var r=o.tracks,i=void 0,a=void 0,n=!1;for(var e in r){var s=r[e];"main"===s.id?(a=e,i=s,"video"===e&&(this.videoBuffer=r[e].buffer)):n=!0}n&&i?(t.logger.log("alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(t){if("main"===t.parent)switch(this.state){case e.PARSING:case e.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===e.PARSED&&0===this.pendingAppending){var a=this.fragCurrent,i=this.stats;if(a){this.fragPrevious=a,i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(r.default.FRAG_BUFFERED,{stats:i,frag:a,id:"main"});var n=this.mediaBuffer?this.mediaBuffer:this.media;t.logger.log("main buffered : "+R.default.toString(n.buffered)),this.state=e.IDLE}this.tick()}}},{key:"onError",value:function(a){var s=a.frag;if(!s||"main"===s.type)switch(a.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var n=this.fragLoadError;if(n?n++:n=1,n<=this.config.fragLoadingMaxRetry||this.media&&this.isBuffered(this.media.currentTime)){this.fragLoadError=n,s.loadCounter=0;var o=Math.min(Math.pow(2,n-1)*this.config.fragLoadingRetryDelay,64e3);t.logger.warn("mediaController: frag loading failed, retry in "+o+" ms"),this.retryDate=performance.now()+o,this.state=e.FRAG_LOADING_WAITING_RETRY}else t.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.trigger(r.default.ERROR,a),this.state=e.ERROR}break;case i.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==e.ERROR&&(this.state=a.fatal?e.ERROR:e.IDLE,t.logger.warn("mediaController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case i.ErrorDetails.BUFFER_FULL_ERROR:this.state!==e.PARSING&&this.state!==e.PARSED||(this.config.maxMaxBufferLength/=2,t.logger.warn("reduce max buffer length to "+this.config.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=e.IDLE)}}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var n=e.currentTime,d=e.buffered;if(!this.loadedmetadata&&d.length){this.loadedmetadata=!0;var a=this.startPosition,h=this.isBuffered(a);n===a&&h||(t.logger.log("target start position:"+a),h||(a=d.start(0),t.logger.log("target start position not buffered, seek to buffered.start(0) "+a)),t.logger.log("adjust currentTime from "+n+" to "+a),e.currentTime=a)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var l=s.default.bufferInfo(e,n,0),v=!(e.paused||e.ended||0===e.buffered.length),u=.4,f=n>e.playbackRate*this.lastCurrentTime;if(this.stalled&&f&&(this.stalled=!1,t.logger.log("playback not stuck anymore @"+n)),v&&l.len<=u&&(f?(u=0,this.seekHoleNudgeDuration=0):this.stalled?this.seekHoleNudgeDuration+=this.config.seekHoleNudgeDuration:(this.seekHoleNudgeDuration=0,t.logger.log("playback seems stuck @"+n),this.hls.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1}),this.stalled=!0),l.len<=u)){var o=l.nextStart,c=o-n;if(o&&c<this.config.maxSeekHole&&c>0){t.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+o+" + nudge "+this.seekHoleNudgeDuration);var g=o+this.seekHoleNudgeDuration-e.currentTime;e.currentTime=o+this.seekHoleNudgeDuration,this.hls.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:g})}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=e.IDLE,this.tick()}},{key:"onBufferFlushed",value:function(){var t,r,i=[];for(r=0;r<this.bufferRange.length;r++)t=this.bufferRange[r],this.isBuffered((t.start+t.end)/2)&&i.push(t);this.bufferRange=i,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=e.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(t,e){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-r)}},{key:"state",set:function(e){if(this.state!==e){var i=this.state;this._state=e,t.logger.log("engine state transition from "+i+" to "+e),this.hls.trigger(r.default.STREAM_STATE_TRANSITION,{previousState:i,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){if(this.media){var e=this.getBufferRange(this.media.currentTime);if(e)return e.frag.level}return-1}},{key:"nextBufferRange",get:function(){return this.media?this.followingBufferRange(this.getBufferRange(this.media.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),a}(l.default);d.default=T},{"../demux/demuxer":20,"../errors":24,"../event-handler":25,"../events":26,"../helper/buffer-helper":28,"../helper/level-helper":29,"../utils/binary-search":39,"../utils/logger":43,"../utils/timeRanges":45}],12:[function(t,g,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=t("../events"),e=r(l),d=t("../event-handler"),a=r(d),f=t("../utils/cea-608-parser"),o=r(f),u=function(r){function t(a){h(this,t);var i=n(this,Object.getPrototypeOf(t).call(this,a,e.default.MEDIA_ATTACHING,e.default.MEDIA_DETACHING,e.default.FRAG_PARSING_USERDATA,e.default.MANIFEST_LOADING,e.default.FRAG_LOADED,e.default.LEVEL_SWITCH));if(i.hls=a,i.config=a.config,i.enabled=!0,i.Cues=a.config.cueHandler,i.config.enableCEA708Captions){var r=i,s={newCue:function(e,t,i){r.textTrack1||(r.textTrack1=r.createTextTrack("captions","Unknown CC1","en")),r.Cues.newCue(r.textTrack1,e,t,i)}},l={newCue:function(e,t,i){r.textTrack2||(r.textTrack2=r.createTextTrack("captions","Unknown CC2","es")),r.Cues.newCue(r.textTrack2,e,t,i)}};i.cea608Parser=new o.default(0,s,l)}return i}return s(t,r),c(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"createTextTrack",value:function(e,t,r){return this.media?this.media.addTextTrack(e,t,r):void 0}},{key:"destroy",value:function(){a.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(t){if(this.enabled)for(var e=0;e<t.samples.length;e++){var r=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,r)}}},{key:"extractCea608Data",value:function(e){for(var t,r,i,s,o,u=31&e[0],a=2,n=[],l=0;u>l;l++)t=e[a++],r=127&e[a++],i=127&e[a++],s=0!==(4&t),o=3&t,0===r&&0===i||s&&0===o&&(n.push(r),n.push(i));return n}}]),t}(a.default);i.default=u},{"../event-handler":25,"../events":26,"../utils/cea-608-parser":40}],13:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(h){t(this,e),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var i,s,r,o,l,n=this._tables[0][4],u=this._tables[1],a=h.length,d=1;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);for(o=h.slice(0),l=[],this._key=[o,l],i=a;4*a+28>i;i++)r=o[i-1],(i%a===0||8===a&&i%a===4)&&(r=n[r>>>24]<<24^n[r>>16&255]<<16^n[r>>8&255]<<8^n[255&r],i%a===0&&(r=r<<8^r>>>24^d<<24,d=d<<1^283*(d>>7))),o[i]=o[i-a]^r;for(s=0;i;s++,i--)r=o[3&s?i:i-4],4>=i||4>s?l[s]=r:l[s]=u[0][n[r>>>24]]^u[1][n[r>>16&255]]^u[2][n[r>>8&255]]^u[3][n[255&r]]}return r(e,[{key:"_precompute",value:function(){var e,i,r,u,h,d,t,s,l,n=this._tables[0],o=this._tables[1],f=n[4],g=o[4],a=[],c=[];for(e=0;256>e;e++)c[(a[e]=e<<1^283*(e>>7))^e]=e;for(i=r=0;!f[i];i^=u||1,r=c[r]||1)for(t=r^r<<1^r<<2^r<<3^r<<4,t=t>>8^255&t^99,f[i]=t,g[t]=i,d=a[h=a[u=a[i]]],l=16843009*d^65537*h^257*u^16843008*i,s=257*a[t]^16843008*t,e=0;4>e;e++)n[e][i]=s=s<<24^s>>>8,o[e][t]=l=l<<24^l>>>8;for(e=0;5>e;e++)n[e]=n[e].slice(0),o[e]=o[e].slice(0)}},{key:"decrypt",value:function(_,p,R,b,E,m){var f,v,g,n,e=this._key[1],t=_^e[0],i=b^e[1],a=R^e[2],r=p^e[3],y=e.length/4-2,s=4,o=this._tables[1],h=o[0],d=o[1],u=o[2],l=o[3],c=o[4];for(n=0;y>n;n++)f=h[t>>>24]^d[i>>16&255]^u[a>>8&255]^l[255&r]^e[s],v=h[i>>>24]^d[a>>16&255]^u[r>>8&255]^l[255&t]^e[s+1],g=h[a>>>24]^d[r>>16&255]^u[t>>8&255]^l[255&i]^e[s+2],r=h[r>>>24]^d[t>>16&255]^u[i>>8&255]^l[255&a]^e[s+3],s+=4,t=f,i=v,a=g;for(n=0;4>n;n++)E[(3&-n)+m]=c[t>>>24]<<24^c[i>>16&255]<<16^c[a>>8&255]<<8^c[255&r]^e[s++],f=t,t=i,i=a,a=r,r=f}}]),e}();e.default=i},{}],14:[function(t,l,e){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=t("./aes"),s=r(n),o=function(){function e(t,r){i(this,e),this.key=t,this.iv=r}return a(e,[{key:"ntoh",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"doDecrypt",value:function(i,v,a){var u,f,o,h,l,c,d,n,e,r=new Int32Array(i.buffer,i.byteOffset,i.byteLength>>2),p=new s.default(Array.prototype.slice.call(v)),g=new Uint8Array(i.byteLength),t=new Int32Array(g.buffer);for(u=~~a[0],f=~~a[1],o=~~a[2],h=~~a[3],e=0;e<r.length;e+=4)l=~~this.ntoh(r[e]),c=~~this.ntoh(r[e+1]),d=~~this.ntoh(r[e+2]),n=~~this.ntoh(r[e+3]),p.decrypt(l,c,d,n,t,e),t[e]=this.ntoh(t[e]^u),t[e+1]=this.ntoh(t[e+1]^f),t[e+2]=this.ntoh(t[e+2]^o),t[e+3]=this.ntoh(t[e+3]^h),u=l,f=c,o=d,h=n;return g}},{key:"localDecrypt",value:function(e,t,r,i){var a=this.doDecrypt(e,t,r);i.set(a,e.byteOffset)}},{key:"decrypt",value:function(n){var r=32e3,t=new Int32Array(n),i=new Uint8Array(n.byteLength),e=0,s=this.key,a=this.iv;for(this.localDecrypt(t.subarray(e,e+r),s,a,i),e=r;e<t.length;e+=r)a=new Uint32Array([this.ntoh(t[e-4]),this.ntoh(t[e-3]),this.ntoh(t[e-2]),this.ntoh(t[e-1])]),this.localDecrypt(t.subarray(e,e+r),s,a,i);return i}}]),e}();e.default=o},{"./aes":13}],15:[function(t,d,r){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=t("./aes128-decrypter"),o=l(s),i=t("../errors"),e=t("../utils/logger"),n=function(){function t(r){a(this,t),this.hls=r;try{var e=window?window.crypto:crypto;this.subtle=e.subtle||e.webkitSubtle,this.disableWebCrypto=!this.subtle}catch(e){this.disableWebCrypto=!0}}return u(t,[{key:"destroy",value:function(){}},{key:"decrypt",value:function(e,t,r,i){this.disableWebCrypto&&this.hls.config.enableSoftwareAES?this.decryptBySoftware(e,t,r,i):this.decryptByWebCrypto(e,t,r,i)}},{key:"decryptByWebCrypto",value:function(t,r,i,a){var n=this;e.logger.log("decrypting by WebCrypto API"),this.subtle.importKey("raw",r,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(e){n.subtle.decrypt({name:"AES-CBC",iv:i.buffer},e,t).then(a).catch(function(e){n.onWebCryptoError(e,t,r,i,a)})}).catch(function(e){n.onWebCryptoError(e,t,r,i,a)})}},{key:"decryptBySoftware",value:function(r,i,a,n){e.logger.log("decrypting by JavaScript Implementation");var t=new DataView(i.buffer),s=new Uint32Array([t.getUint32(0),t.getUint32(4),t.getUint32(8),t.getUint32(12)]);t=new DataView(a.buffer);var l=new Uint32Array([t.getUint32(0),t.getUint32(4),t.getUint32(8),t.getUint32(12)]),u=new o.default(s,l);n(u.decrypt(r).buffer)}},{key:"onWebCryptoError",value:function(t,r,a,n,s){this.hls.config.enableSoftwareAES?(e.logger.log("disabling to use WebCrypto API"),this.disableWebCrypto=!0,this.decryptBySoftware(r,a,n,s)):(e.logger.error("decrypting error : "+t.message),this.hls.trigger(Event.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))}}]),t}();r.default=n},{"../errors":24,"../utils/logger":43,"./aes128-decrypter":14}],16:[function(e,h,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),d=e("./adts"),o=i(d),t=e("../utils/logger"),u=e("../demux/id3"),a=i(u),s=function(){function e(t,r,a,i){l(this,e),this.observer=t,this.id=r,this.remuxerClass=a,this.config=i,this.remuxer=new this.remuxerClass(t,r,i),this.insertDiscontinuity()}return n(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}},{key:"push",value:function(r,b,k,R,E,d,g,_){var i,n,s,m,c,e,l,v,u,y,f=new a.default(r),h=90*f.timeStamp,p=!1;for(E!==this.lastCC?(t.logger.log(this.id+" discontinuity detected"),this.lastCC=E,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):d!==this.lastLevel?(t.logger.log("audio track switch detected"),this.lastLevel=d,this.remuxer.switchLevel(),this.insertDiscontinuity()):g===this.lastSN+1&&(p=!0),i=this._aacTrack,this.lastSN=g,this.lastLevel=d,e=f.length,u=r.length;u-1>e&&(255!==r[e]||240!==(240&r[e+1]));e++);for(i.audiosamplerate||(n=o.default.getAudioConfig(this.observer,r,e,b),i.config=n.config,i.audiosamplerate=n.samplerate,i.channelCount=n.channelCount,i.codec=n.codec,i.duration=_,t.logger.log("parsed codec:"+i.codec+",rate:"+n.samplerate+",nb channel:"+n.channelCount)),c=0,m=9216e4/i.audiosamplerate;u>e+5&&(l=1&r[e+1]?7:9,s=(3&r[e+3])<<11|r[e+4]<<3|(224&r[e+5])>>>5,s-=l,s>0&&u>=e+l+s);)for(v=h+c*m,y={unit:r.subarray(e+l,e+l+s),pts:v,dts:v},i.samples.push(y),i.len+=s,e+=s+l,c++;u-1>e&&(255!==r[e]||240!==(240&r[e+1]));e++);this.remuxer.remux(d,g,this._aacTrack,{samples:[]},{samples:[{pts:h,dts:h,unit:f.payload}]},{samples:[]},R,p)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(t){var e,r,i=new a.default(t);if(i.hasTimeStamp)for(e=i.length,r=t.length;r-1>e;e++)if(255===t[e]&&240===(240&t[e+1]))return!0;return!1}}]),e}();r.default=s},{"../demux/id3":22,"../utils/logger":43,"./adts":17}],17:[function(e,o,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e("../utils/logger"),r=e("../errors"),s=function(){function e(){i(this,e)}return a(e,null,[{key:"getAudioConfig",value:function(f,u,l,a){var i,e,s,o,t,h=navigator.userAgent.toLowerCase(),d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return i=((192&u[l+2])>>>6)+1,e=(60&u[l+2])>>>2,e>d.length-1?void f.trigger(Event.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e}):(o=(1&u[l+2])<<2,o|=(192&u[l+3])>>>6,n.logger.log("manifest codec:"+a+",ADTS data:type:"+i+",sampleingIndex:"+e+"["+d[e]+"Hz],channelConfig:"+o),-1!==h.indexOf("firefox")?e>=6?(i=5,t=new Array(4),s=e-3):(i=2,t=new Array(2),s=e):-1!==h.indexOf("android")?(i=2,t=new Array(2),s=e):(i=5,t=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&e>=6?s=e-3:((a&&-1!==a.indexOf("mp4a.40.2")&&e>=6&&1===o||!a&&1===o)&&(i=2,t=new Array(2)),s=e)),t[0]=i<<3,t[0]|=(14&e)>>1,t[1]|=(1&e)<<7,t[1]|=o<<3,5===i&&(t[1]|=(14&s)>>1,t[2]=(1&s)<<7,t[2]|=8,t[3]=0),{config:t,samplerate:d[e],channelCount:o,codec:"mp4a.40."+i})}}]),e}();t.default=s},{"../errors":24,"../utils/logger":43}],18:[function(e,y,i){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var f=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),g=e("../events"),o=t(g),a=e("../errors"),p=e("../demux/aacdemuxer"),n=t(p),h=e("../demux/tsdemuxer"),r=t(h),c=e("../remux/mp4-remuxer"),s=t(c),v=e("../remux/passthrough-remuxer"),u=t(v),l=function(){function e(t,r,i){var a=arguments.length<=3||void 0===arguments[3]?null:arguments[3];d(this,e),this.hls=t,this.id=r,this.config=this.hls.config||a,this.typeSupported=i}return f(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(l,h,v,g,d,p,f,c){var e=this.demuxer;if(!e){var i=this.hls,t=this.id;if(r.default.probe(l))e=this.typeSupported.mp2t===!0?new r.default(i,t,u.default,this.config):new r.default(i,t,s.default,this.config);else{if(!n.default.probe(l))return void i.trigger(o.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,id:t,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});e=new n.default(i,t,s.default,this.config)}this.demuxer=e}e.push(l,h,v,g,d,p,f,c)}}]),e}();i.default=l},{"../demux/aacdemuxer":16,"../demux/tsdemuxer":23,"../errors":24,"../events":26,"../remux/mp4-remuxer":36,"../remux/passthrough-remuxer":37}],19:[function(t,d,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var a=t("../demux/demuxer-inline"),u=r(a),s=t("../events"),e=r(s),l=t("events"),n=r(l),o=function(r){var t=new n.default;t.trigger=function(i){for(var r=arguments.length,a=Array(r>1?r-1:0),e=1;r>e;e++)a[e-1]=arguments[e];t.emit.apply(t,[i,i].concat(a))},t.off=function(a){for(var r=arguments.length,i=Array(r>1?r-1:0),e=1;r>e;e++)i[e-1]=arguments[e];t.removeListener.apply(t,[a].concat(i))},r.addEventListener("message",function(i){var e=i.data;switch(e.cmd){case"init":r.demuxer=new u.default(t,e.id,e.typeSupported,JSON.parse(e.config));break;case"demux":r.demuxer.push(new Uint8Array(e.data),e.audioCodec,e.videoCodec,e.timeOffset,e.cc,e.level,e.sn,e.duration)}});var i=function(e,t){r.postMessage({event:e,data:t})};t.on(e.default.FRAG_PARSING_INIT_SEGMENT,i),t.on(e.default.FRAG_PARSED,i),t.on(e.default.ERROR,i),t.on(e.default.FRAG_PARSING_METADATA,i),t.on(e.default.FRAG_PARSING_USERDATA,i),t.on(e.default.FRAG_PARSING_DATA,function(a,e){var t=e.data1.buffer,i=e.data2.buffer;delete e.data1,delete e.data2,r.postMessage({event:a,data:e,data1:t,data2:i},[t,i])})};i.default=o},{"../demux/demuxer-inline":18,"../events":26,events:1}],20:[function(e,p,r){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),f=e("../events"),i=t(f),v=e("../demux/demuxer-inline"),n=t(v),d=e("../demux/demuxer-worker"),h=t(d),s=e("../utils/logger"),c=e("../crypt/decrypter"),g=t(c),a=e("../errors"),o=function(){function t(r,o){l(this,t),this.hls=r,this.id=o;var u={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:r.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(r.config.enableWorker&&"undefined"!=typeof Worker){s.logger.log("demuxing in webworker");try{var f=e("webworkify"),d=this.w=f(h.default);this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(e){r.trigger(i.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:u,id:o,config:JSON.stringify(r.config)})}catch(e){s.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),this.demuxer=new n.default(r,o,u)}}else this.demuxer=new n.default(r,o,u);this.demuxInitialized=!0}return u(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var r=this.decrypter;r&&(r.destroy(),this.decrypter=null)}},{key:"pushDecrypted",value:function(e,t,r,i,a,n,s,o){var l=this.w;if(l)l.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:r,timeOffset:i,cc:a,level:n,sn:s,duration:o},[e]);else{var u=this.demuxer;u&&u.push(new Uint8Array(e),t,r,i,a,n,s,o)}}},{key:"push",value:function(t,r,i,a,n,s,o,l,e){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){null==this.decrypter&&(this.decrypter=new g.default(this.hls));var u=this;this.decrypter.decrypt(t,e.key,e.iv,function(e){u.pushDecrypted(e,r,i,a,n,s,o,l)})}else this.pushDecrypted(t,r,i,a,n,s,o,l)}},{key:"onWorkerMessage",value:function(t){var e=t.data,r=this.hls;switch(e.event){case i.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data.data2=new Uint8Array(e.data2);default:r.trigger(e.event,e.data)}}}]),t}();r.default=o},{"../crypt/decrypter":15,"../demux/demuxer-inline":18,"../demux/demuxer-worker":19,"../errors":24,"../events":26,"../utils/logger":43,webworkify:2}],21:[function(t,s,e){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=t("../utils/logger"),n=function(){function e(t){r(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function(){var t=this.data.byteLength-this.bytesAvailable,r=new Uint8Array(4),e=Math.min(4,this.bytesAvailable);if(0===e)throw new Error("no bytes available");r.set(this.data.subarray(t,t+e)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return t>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0?r<<e|this.readBits(e):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(a){var t,i,r=8,e=8;for(t=0;a>t;t++)0!==e&&(i=this.readEG(),e=(r+i+256)%256),r=0===e?r:e}},{key:"readSPS",value:function(){var t,v,p,l,a,n,i,o,r,s=0,d=0,h=0,f=0,c=1;if(this.readUByte(),t=this.readUByte(),v=this.readBits(5),this.skipBits(3),p=this.readUByte(),this.skipUEG(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var g=this.readUEG();if(3===g&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(o=3!==g?8:12,r=0;o>r;r++)this.readBoolean()&&(6>r?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var u=this.readUEG();if(0===u)this.readUEG();else if(1===u)for(this.skipBits(1),this.skipEG(),this.skipEG(),l=this.readUEG(),r=0;l>r;r++)this.skipEG();if(this.skipUEG(),this.skipBits(1),a=this.readUEG(),n=this.readUEG(),i=this.readBits(1),0===i&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(s=this.readUEG(),d=this.readUEG(),h=this.readUEG(),f=this.readUEG()),this.readBoolean()&&this.readBoolean()){var e=void 0,y=this.readUByte();switch(y){case 1:e=[1,1];break;case 2:e=[12,11];break;case 3:e=[10,11];break;case 4:e=[16,11];break;case 5:e=[40,33];break;case 6:e=[24,11];break;case 7:e=[20,11];break;case 8:e=[32,11];break;case 9:e=[80,33];break;case 10:e=[18,11];break;case 11:e=[15,11];break;case 12:e=[64,33];break;case 13:e=[160,99];break;case 14:e=[4,3];break;case 15:e=[3,2];break;case 16:e=[2,1];break;case 255:e=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}e&&(c=e[0]/e[1])}return{width:Math.ceil((16*(a+1)-2*s-2*d)*c),height:(2-i)*(n+1)*16-(i?2:4)*(h+f)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();e.default=n},{"../utils/logger":43}],22:[function(r,s,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),e=r("../utils/logger"),n=function(){function t(a){i(this,t),this._hasTimeStamp=!1;for(var l,u,d,h,f,s,o,n,r=0;;)if(o=this.readUTF(a,r,3),r+=3,"ID3"===o)r+=3,l=127&a[r++],u=127&a[r++],d=127&a[r++],h=127&a[r++],f=(l<<21)+(u<<14)+(d<<7)+h,s=r+f,this._parseID3Frames(a,r,s),r=s;else{if("3DI"!==o)return r-=3,n=r,void(n&&(this.hasTimeStamp||e.logger.warn("ID3 tag found, but no timestamp"),this._length=n,this._payload=a.subarray(0,n)));r+=7,e.logger.log("3DI footer found, end: "+r)}}return a(t,[{key:"readUTF",value:function(i,e,a){var t="",r=e,n=e+a;do t+=String.fromCharCode(i[r++]);while(n>r);return t}},{key:"_parseID3Frames",value:function(r,t,n){for(var a,s,o,l,i;n>=t+8;)switch(a=this.readUTF(r,t,4),t+=4,s=r[t++]<<24+r[t++]<<16+r[t++]<<8+r[t++],l=r[t++]<<8+r[t++],o=t,a){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(r,t,44)){t+=44,t+=4;var u=1&r[t++];this._hasTimeStamp=!0,i=((r[t++]<<23)+(r[t++]<<15)+(r[t++]<<7)+r[t++])/45,u&&(i+=47721858.84),i=Math.round(i),e.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),t}();t.default=n},{"../utils/logger":43}],23:[function(t,g,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var h=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),f=t("./adts"),c=i(f),l=t("../events"),n=i(l),d=t("./exp-golomb"),s=i(d),e=t("../utils/logger"),r=t("../errors"),o=function(){function t(e,r,a,i){u(this,t),this.observer=e,this.id=r,this.remuxerClass=a,this.config=i,this.lastCC=0,this.remuxer=new this.remuxerClass(e,r,i)}return h(t,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0},this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcNaluState=0,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(i,w,P,C,b,f,h,I){var o,l,s,t,u,T,L,a,c=i.length,E=this.remuxer.passthrough,g=!1;this.audioCodec=w,this.videoCodec=P,this.timeOffset=C,this._duration=I,this.contiguous=!1,b!==this.lastCC&&(e.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=b),f!==this.lastLevel?(e.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=f):h===this.lastSN+1&&(this.contiguous=!0),this.lastSN=h;var _=this.pmtParsed,v=this._avcTrack.id,p=this._aacTrack.id,A=this._id3Track.id,S=this._pmtId,O=this._parsePAT,D=this._parsePMT,d=this._parsePES,m=this._parseAVCPES.bind(this),R=this._parseAACPES.bind(this),k=this._parseID3PES.bind(this);
for(c-=c%188,t=0;c>t;t+=188)if(71===i[t]){if(u=!!(64&i[t+1]),T=((31&i[t+1])<<8)+i[t+2],L=(48&i[t+3])>>4,L>1){if(a=t+5+i[t+4],a===t+188)continue}else a=t+4;switch(T){case v:if(u){if(o&&(m(d(o)),E&&this._avcTrack.codec&&(-1===p||this._aacTrack.codec)))return void this.remux(f,h,i);o={data:[],size:0}}o&&(o.data.push(i.subarray(a,t+188)),o.size+=t+188-a);break;case p:if(u){if(l&&(R(d(l)),E&&this._aacTrack.codec&&(-1===v||this._avcTrack.codec)))return void this.remux(f,h,i);l={data:[],size:0}}l&&(l.data.push(i.subarray(a,t+188)),l.size+=t+188-a);break;case A:u&&(s&&k(d(s)),s={data:[],size:0}),s&&(s.data.push(i.subarray(a,t+188)),s.size+=t+188-a);break;case 0:u&&(a+=i[a]+1),S=this._pmtId=O(i,a);break;case S:u&&(a+=i[a]+1);var y=D(i,a);v=this._avcTrack.id=y.avc,p=this._aacTrack.id=y.aac,A=this._id3Track.id=y.id3,g&&!_&&(e.logger.log("reparse from beginning"),g=!1,t=-188),_=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.trigger(n.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,id:this.id,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});o&&m(d(o)),l&&R(d(l)),s&&k(d(s)),this.remux(f,h,null)}},{key:"remux",value:function(e,t,r){this.remuxer.remux(e,t,this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,this.timeOffset,this.contiguous,r)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(r,t){var n,s,o,a,i={aac:-1,avc:-1,id3:-1};for(n=(15&r[t+1])<<8|r[t+2],s=t+3+n-4,o=(15&r[t+10])<<8|r[t+11],t+=12+o;s>t;){switch(a=(31&r[t+1])<<8|r[t+2],r[t]){case 15:-1===i.aac&&(i.aac=a);break;case 21:-1===i.id3&&(i.id3=a);break;case 27:-1===i.avc&&(i.avc=a);break;case 36:e.logger.warn("HEVC stream type found, not supported for now");break;default:e.logger.log("unkown stream type:"+r[t])}t+=((15&r[t+3])<<8|r[t+4])+5}return i}},{key:"_parsePES",value:function(u){for(var e,o,f,h,d,s,i,a,r,c=0,t=u.data;t[0].length<19&&t.length>1;){var l=new Uint8Array(t[0].length+t[1].length);l.set(t[0]),l.set(t[1],t[0].length),t[0]=l,t.splice(1,1)}if(e=t[0],f=(e[0]<<16)+(e[1]<<8)+e[2],1===f){for(h=(e[4]<<8)+e[5],o=e[7],192&o&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,i>4294967295&&(i-=8589934592),64&o?(a=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,a>4294967295&&(a-=8589934592)):a=i),d=e[8],r=d+9,u.size-=r,s=new Uint8Array(u.size);t.length;){e=t.shift();var n=e.byteLength;if(r){if(r>n){r-=n;continue}e=e.subarray(r),n-=r,r=0}s.set(e,c),c+=n}return{data:s,pts:i,dts:a,len:h}}return null}},{key:"_parseAVCPES",value:function(a){var t,m,o,i,h=this,r=this._avcTrack,u=r.samples,y=this._parseAVCNALu(a.data),d=[],l=!1,g=!1,f=0;if(0===y.length&&u.length>0){var v=u[u.length-1],c=v.units.units[v.units.units.length-1],p=new Uint8Array(c.data.byteLength+a.data.byteLength);p.set(c.data,0),p.set(a.data,c.data.byteLength),c.data=p,v.units.length+=a.data.byteLength,r.len+=a.data.byteLength}a.data=null;var n="",E=function(){d.length&&(!this.config.forceKeyFrameOnDiscontinuity||g===!0||r.sps&&(u.length||this.contiguous)?(m={units:{units:d,length:f},pts:a.pts,dts:a.dts,key:g},u.push(m),r.len+=f,r.nbNalu+=d.length):r.dropped++,d=[],f=0)}.bind(this);y.forEach(function(e){switch(e.type){case 1:o=!0,l&&(n+="NDR ");break;case 5:o=!0,l&&(n+="IDR "),g=!0;break;case 6:o=!0,l&&(n+="SEI "),t=new s.default(h.discardEPB(e.data)),t.readUByte();for(var y=0,c=0,b=!1,u=0;!b&&t.bytesAvailable>1;){y=0;do u=t.readUByte(),y+=u;while(255===u);c=0;do u=t.readUByte(),c+=u;while(255===u);if(4===y&&0!==t.bytesAvailable){b=!0;var A=t.readUByte();if(181===A){var T=t.readUShort();if(49===T){var S=t.readUInt();if(1195456820===S){var O=t.readUByte();if(3===O){var m=t.readUByte(),D=t.readUByte(),k=31&m,v=[m,D];for(i=0;k>i;i++)v.push(t.readUByte()),v.push(t.readUByte()),v.push(t.readUByte());h._insertSampleInOrder(h._txtTrack.samples,{type:3,pts:a.pts,bytes:v})}}}}}else if(c<t.bytesAvailable)for(i=0;c>i;i++)t.readUByte()}break;case 7:if(o=!0,l&&(n+="SPS "),!r.sps){t=new s.default(e.data);var R=t.readSPS();r.width=R.width,r.height=R.height,r.sps=[e.data],r.duration=h._duration;var L=e.data.subarray(1,4),_="avc1.";for(i=0;3>i;i++){var p=L[i].toString(16);p.length<2&&(p="0"+p),_+=p}r.codec=_}break;case 8:o=!0,l&&(n+="PPS "),r.pps||(r.pps=[e.data]);break;case 9:o=!1,l&&(n+="AUD "),E();break;default:o=!1,n+="unknown NAL "+e.type+" "}o&&(d.push(e),f+=e.data.byteLength)}),(l||n.length)&&e.logger.log(n),E()}},{key:"_insertSampleInOrder",value:function(e,t){var i=e.length;if(i>0){if(t.pts>=e[i-1].pts)e.push(t);else for(var r=i-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)}},{key:"_parseAVCNALu",value:function(r){for(var s,i,l,R,n,d,t=0,v=r.byteLength,e=this.avcNaluState,g=[];v>t;)switch(s=r[t++],e){case 0:0===s&&(e=1);break;case 1:e=0===s?2:0;break;case 2:case 3:if(0===s)e=3;else if(1===s&&v>t){if(R=31&r[t],n)l={data:r.subarray(n,t-e-1),type:d},g.push(l);else{var a=this.avcNaluState;if(a&&4-a>=t){var m=this._avcTrack,c=m.samples;if(c.length){var p=c[c.length-1],_=p.units.units,u=_[_.length-1];u.state&&(u.data=u.data.subarray(0,u.data.byteLength-a),p.units.length-=a,m.len-=a)}}if(i=t-e-1,i>0){var y=this._avcTrack,f=y.samples;if(f.length){var E=f[f.length-1],b=E.units.units,o=b[b.length-1],h=new Uint8Array(o.data.byteLength+i);h.set(o.data,0),h.set(r.subarray(0,i),o.data.byteLength),o.data=h,E.units.length+=i,y.len+=i}}}n=t,d=R,e=0}else e=0}return n&&(l={data:r.subarray(n,v),type:d,state:e},g.push(l),this.avcNaluState=e),g}},{key:"discardEPB",value:function(t){for(var a,n,s=t.byteLength,r=[],e=1;s-2>e;)0===t[e]&&0===t[e+1]&&3===t[e+2]?(r.push(e+2),e+=2):e++;if(0===r.length)return t;a=s-r.length,n=new Uint8Array(a);var i=0;for(e=0;a>e;i++,e++)i===r[0]&&(i++,r.shift()),n[e]=t[i];return n}},{key:"_parseAACPES",value:function(_){var l,o,p,E,t,d,h,s,R,a=this._aacTrack,i=_.data,g=_.pts,A=0,T=this._duration,k=this.audioCodec,u=this.aacOverFlow,b=this.aacLastPTS;if(u){var m=new Uint8Array(u.byteLength+i.byteLength);m.set(u,0),m.set(i,u.byteLength),i=m}for(t=A,s=i.length;s-1>t&&(255!==i[t]||240!==(240&i[t+1]));t++);if(t){var y,f;if(s-1>t?(y="AAC PES did not start with ADTS header,offset:"+t,f=!1):(y="no ADTS header found in AAC PES",f=!0),this.observer.trigger(n.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,id:this.id,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:f,reason:y}),f)return}if(a.audiosamplerate||(l=c.default.getAudioConfig(this.observer,i,t,k),a.config=l.config,a.audiosamplerate=l.samplerate,a.channelCount=l.channelCount,a.codec=l.codec,a.duration=T,e.logger.log("parsed codec:"+a.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)),E=0,p=9216e4/a.audiosamplerate,u&&b){var v=b+p;Math.abs(v-g)>1&&(e.logger.log("AAC: align PTS for overlapping frames by "+Math.round((v-g)/90)),g=v)}for(;s>t+5&&(d=1&i[t+1]?7:9,o=(3&i[t+3])<<11|i[t+4]<<3|(224&i[t+5])>>>5,o-=d,o>0&&s>=t+d+o);)for(h=g+E*p,R={unit:i.subarray(t+d,t+d+o),pts:h,dts:h},a.samples.push(R),a.len+=o,t+=o+d,E++;s-1>t&&(255!==i[t]||240!==(240&i[t+1]));t++);u=s>t?i.subarray(t,s):null,this.aacOverFlow=u,this.aacLastPTS=h}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),t}();a.default=o},{"../errors":24,"../events":26,"../utils/logger":43,"./adts":17,"./exp-golomb":21}],24:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},e.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],25:[function(e,h,t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e("./utils/logger"),r=e("./errors"),u=e("./events"),s=i(u),l=function(){function e(n){a(this,e),this.hls=n,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,i=Array(r>1?r-1:0),t=1;r>t;t++)i[t-1]=arguments[t];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return d(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var i=function(t,r){var e="on"+t.replace("hls","");if("function"!=typeof this[e])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+e+")");return this[e].bind(this,r)};try{i.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(s.default.ERROR,{type:r.ErrorTypes.OTHER_ERROR,details:r.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();t.default=l},{"./errors":24,"./events":26,"./utils/logger":43}],26:[function(t,e,r){"use strict";e.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],27:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return r(e,null,[{key:"getSilentFrame",value:function(e){return 1===e?new Uint8Array([0,200,0,128,35,128]):2===e?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===e?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}]),e}();e.default=i},{}],28:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return r(e,null,[{key:"bufferInfo",value:function(r,a,n){if(r){var e,t=r.buffered,i=[];for(e=0;e<t.length;e++)i.push({start:t.start(e),end:t.end(e)});return this.bufferedInfo(i,a,n)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(r,i,s){var o,l,a,f,e,t=[];for(r.sort(function(e,t){var r=e.start-t.start;return r?r:t.end-e.end}),e=0;e<r.length;e++){var u=t.length;if(u){var d=t[u-1].end;r[e].start-d<s?r[e].end>d&&(t[u-1].end=r[e].end):t.push(r[e])}else t.push(r[e])}for(e=0,o=0,l=a=i;e<t.length;e++){var n=t[e].start,h=t[e].end;if(i+s>=n&&h>i)l=n,a=h,o=a-i;else if(n>i+s){f=n;break}}return{len:o,start:l,end:a,nextStart:f}}}]),e}();e.default=i},{}],29:[function(r,s,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),e=r("../utils/logger"),n=function(){function t(){i(this,t)}return a(t,null,[{key:"mergeDetails",value:function(o,i){var a,c=Math.max(o.startSN,i.startSN)-i.startSN,f=Math.min(o.endSN,i.endSN)-i.startSN,u=i.startSN-o.startSN,h=o.fragments,l=i.fragments,d=0;if(c>f)return void(i.PTSKnown=!1);for(var r=c;f>=r;r++){var s=h[u+r],n=l[r];n&&s&&(d=s.cc-n.cc,isNaN(s.startPTS)||(n.start=n.startPTS=s.startPTS,n.endPTS=s.endPTS,n.duration=s.duration,a=n))}if(d)for(e.logger.log("discontinuity sliding from playlist, take drift into account"),r=0;r<l.length;r++)l[r].cc+=d;if(a)t.updateFragPTSDTS(i,a.sn,a.startPTS,a.endPTS,a.startDTS,a.endDTS);else if(u>=0&&u<h.length){var g=h[u].start;for(r=0;r<l.length;r++)l[r].start+=g}i.PTSKnown=o.PTSKnown}},{key:"updateFragPTSDTS",value:function(a,l,i,s,d,u){var o,n,e,r;if(l<a.startSN||l>a.endSN)return 0;if(o=l-a.startSN,n=a.fragments,e=n[o],!isNaN(e.startPTS)){var h=Math.abs(e.startPTS-i);isNaN(e.deltaPTS)?e.deltaPTS=h:e.deltaPTS=Math.max(h,e.deltaPTS),i=Math.min(i,e.startPTS),s=Math.max(s,e.endPTS),d=Math.min(d,e.startDTS),u=Math.max(u,e.endDTS)}var f=i-e.start;for(e.start=e.startPTS=i,e.endPTS=s,e.startDTS=d,e.endDTS=u,e.duration=s-i,r=o;r>0;r--)t.updatePTS(n,r,r-1);for(r=o;r<n.length-1;r++)t.updatePTS(n,r,r+1);return a.PTSKnown=!0,f}},{key:"updatePTS",value:function(s,i,a){var t=s[i],r=s[a],n=r.startPTS;isNaN(n)?a>i?r.start=t.start+t.duration:r.start=t.start-r.duration:a>i?(t.duration=n-t.start,t.duration<0&&e.logger.error("negative duration computed for frag "+t.sn+",level "+t.level+", there should be some duration drift between playlist and fragment!")):(r.duration=t.start-n,r.duration<0&&e.logger.error("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!"))}}]),t}();t.default=n},{"../utils/logger":43}],30:[function(e,B,a){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),P=e("./events"),i=t(P),s=e("./errors"),u=e("./loader/playlist-loader"),d=t(u),h=e("./loader/fragment-loader"),f=t(h),c=e("./controller/abr-controller"),g=t(c),v=e("./controller/buffer-controller"),p=t(v),y=e("./controller/cap-level-controller"),m=t(y),E=e("./controller/audio-stream-controller"),G=t(E),R=e("./controller/stream-controller"),_=t(R),k=e("./controller/level-controller"),T=t(k),A=e("./controller/timeline-controller"),S=t(A),L=e("./controller/fps-controller"),D=t(L),O=e("./controller/audio-track-controller"),w=t(O),r=e("./utils/logger"),I=e("./utils/xhr-loader"),C=t(I),x=e("events"),M=t(x),N=e("./loader/key-loader"),F=t(N),U=e("./utils/cues"),b=t(U),l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,e);var n=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in n)a in t||(t[a]=n[a]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,r.enableLogs)(t.debug),this.config=t;var i=this.observer=new M.default;i.trigger=function(r){for(var t=arguments.length,a=Array(t>1?t-1:0),e=1;t>e;e++)a[e-1]=arguments[e];i.emit.apply(i,[r,r].concat(a))},i.off=function(a){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;t>e;e++)r[e-1]=arguments[e];i.removeListener.apply(i,[a].concat(r))},this.on=i.on.bind(i),this.off=i.off.bind(i),this.trigger=i.trigger.bind(i),this.playlistLoader=new d.default(this),this.fragmentLoader=new f.default(this),this.levelController=new T.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new w.default(this),this.keyLoader=new F.default(this)}return n(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.2-6"}},{key:"Events",get:function(){return i.default}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,seekHoleNudgeDuration:.01,stalledInBufferedNudgeThreshold:10,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:C.default,fLoader:void 0,pLoader:void 0,abrController:g.default,bufferController:p.default,capLevelController:m.default,fpsController:D.default,streamController:_.default,audioStreamController:G.default,timelineController:S.default,cueHandler:b.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:5,abrEwmaSlowLive:9,abrEwmaFastVoD:4,abrEwmaSlowVoD:15,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.8,abrBandWidthUpFactor:.7}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),n(e,[{key:"destroy",value:function(){r.logger.log("destroy"),this.trigger(i.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){r.logger.log("attachMedia"),this.media=e,this.trigger(i.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){r.logger.log("detachMedia"),this.trigger(i.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){r.logger.log("loadSource:"+e),this.url=e,this.trigger(i.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length<=0||void 0===arguments[0]?-1:arguments[0];r.logger.log("startLoad"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){r.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){r.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){r.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){r.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){r.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){r.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return this.levelController.firstLevel},set:function(e){r.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){r.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){r.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();a.default=l},{"./controller/abr-controller":3,"./controller/audio-stream-controller":4,"./controller/audio-track-controller":5,"./controller/buffer-controller":6,"./controller/cap-level-controller":7,"./controller/fps-controller":9,"./controller/level-controller":10,"./controller/stream-controller":11,"./controller/timeline-controller":12,"./errors":24,"./events":26,"./loader/fragment-loader":32,"./loader/key-loader":33,"./loader/playlist-loader":34,"./utils/cues":41,"./utils/logger":43,"./utils/xhr-loader":47,events:1}],31:[function(e,t,r){"use strict";t.exports=e("./hls.js").default},{"./hls.js":30}],32:[function(t,g,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=t("../events"),e=a(l),d=t("../event-handler"),n=a(d),r=t("../errors"),o=t("../utils/logger"),u=function(i){function t(i){h(this,t);var r=f(this,Object.getPrototypeOf(t).call(this,i,e.default.FRAG_LOADING));return r.loaders={},r}return s(t,i),c(t,[{key:"destroy",value:function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},n.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(d){var e=d.frag,a=e.type,r=this.loaders[a],t=this.hls.config;e.loaded=0,r&&(o.logger.warn("abort previous fragment loader for type:"+a),r.abort()),r=this.loaders[a]=e.loader="undefined"!=typeof t.fLoader?new t.fLoader(t):new t.loader(t);var i=void 0,n=void 0,s=void 0;i={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var l=e.byteRangeStartOffset,u=e.byteRangeEndOffset;isNaN(l)||isNaN(u)||(i.rangeStart=l,i.rangeEnd=u),n={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:t.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},r.load(i,n,s)}},{key:"loadsuccess",value:function(r,i,a){var n=r.data,t=a.frag;t.loader=void 0,this.loaders[t.type]=void 0,this.hls.trigger(e.default.FRAG_LOADED,{payload:n,frag:t,stats:i})}},{key:"loaderror",value:function(a,t){var i=t.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(e.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:a})}},{key:"loadtimeout",value:function(a,t){var i=t.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(e.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(t,i,a){var r=i.frag;r.loaded=t.loaded,this.hls.trigger(e.default.FRAG_LOAD_PROGRESS,{frag:r,stats:t})}}]),t}(n.default);i.default=u},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],33:[function(t,g,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=t("../events"),e=a(l),d=t("../event-handler"),n=a(d),r=t("../errors"),o=t("../utils/logger"),u=function(i){function t(i){h(this,t);var r=f(this,Object.getPrototypeOf(t).call(this,i,e.default.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return s(t,i),c(t,[{key:"destroy",value:function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},n.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(h){var t=h.frag,i=t.type,n=this.loaders[i],s=t.decryptdata,a=s.uri;if(a!==this.decrypturl||null===this.decryptkey){var r=this.hls.config;n&&(o.logger.warn("abort previous fragment loader for type:"+i),n.abort()),t.loader=this.loaders[i]=new r.loader(r),this.decrypturl=a,this.decryptkey=null;var l=void 0,u=void 0,d=void 0;l={url:a,frag:t,responseType:"arraybuffer"},u={timeout:r.fragLoadingTimeOut,maxRetry:r.fragLoadingMaxRetry,retryDelay:r.fragLoadingRetryDelay,maxRetryDelay:r.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(l,u,d)}else this.decryptkey&&(s.key=this.decryptkey,this.hls.trigger(e.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(i,a,r){var t=r.frag;this.decryptkey=t.decryptdata.key=new Uint8Array(i.data),t.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(e.default.KEY_LOADED,{frag:t})}},{key:"loaderror",value:function(n,t){var i=t.frag,a=i.loader;a&&a.abort(),this.loaders[t.type]=void 0,this.hls.trigger(e.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:n})}},{key:"loadtimeout",value:function(n,t){var i=t.frag,a=i.loader;a&&a.abort(),this.loaders[t.type]=void 0,this.hls.trigger(e.default.ERROR,{type:r.ErrorTypes.NETWORK_ERROR,details:r.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})}}]),t}(n.default);i.default=u},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],34:[function(r,m,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{
constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(o,"__esModule",{value:!0});var f=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r("../events"),t=i(u),d=r("../event-handler"),s=i(d),e=r("../errors"),l=r("../utils/url"),g=i(l),v=r("../utils/attr-list"),n=i(v),a=r("../utils/logger"),y=function(i){function r(i){h(this,r);var e=c(this,Object.getPrototypeOf(r).call(this,i,t.default.MANIFEST_LOADING,t.default.LEVEL_LOADING,t.default.AUDIO_TRACK_LOADING));return e.loaders={},e}return p(r,i),f(r,[{key:"destroy",value:function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},s.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(l,t){var n,s,o,i,e=this.hls.config;"manifest"===t.type?(n=e.manifestLoadingMaxRetry,s=e.manifestLoadingTimeOut,o=e.manifestLoadingRetryDelay,i=e.manifestLoadingMaxRetryTimeOut):(n=e.levelLoadingMaxRetry,s=e.levelLoadingTimeOut,o=e.levelLoadingRetryDelay,i=e.levelLoadingMaxRetryTimeOut);var r=this.loaders[t.type];if(r){var u=r.context;if(u&&u.url===l)return void a.logger.warn("playlist request ongoing");a.logger.warn("abort previous loader for type:"+t.type),r.abort()}r=this.loaders[t.type]=t.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),t.url=l,t.responseType="";var d=void 0,h=void 0;d={timeout:s,maxRetry:n,retryDelay:o,maxRetryDelay:i},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.load(t,d,h)}},{key:"resolve",value:function(e,t){return g.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(h,u){for(var l=[],i=void 0,d=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;null!=(i=d.exec(h));){var e={},r=e.attrs=new n.default(i[1]);e.url=this.resolve(i[2],u);var s=r.decimalResolution("RESOLUTION");s&&(e.width=s.width,e.height=s.height),e.bitrate=r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),e.name=r.NAME;var t=r.CODECS;if(t){t=t.split(",");for(var o=0;o<t.length;o++){var a=t[o];-1!==a.indexOf("avc1")?e.videoCodec=this.avc1toavcoti(a):e.audioCodec=a}}l.push(e)}return l}},{key:"parseMasterPlaylistMedia",value:function(s,o,r){for(var i=void 0,a=[],l=/#EXT-X-MEDIA:(.*)/g;null!=(i=l.exec(s));){var e={},t=new n.default(i[1]);t.TYPE===r&&(e.groupId=t["GROUP-ID"],e.name=t.NAME,e.type=r,e.default="YES"===t.DEFAULT,e.autoselect="YES"===t.AUTOSELECT,e.forced="YES"===t.FORCED,t.URI&&(e.url=this.resolve(t.URI,o)),e.lang=t.LANGUAGE,e.name||(e.name=e.lang),a.push(e))}return a}},{key:"createInitializationVector",value:function(r){for(var t=new Uint8Array(16),e=12;16>e;e++)t[e]=r>>8*(15-e)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,r){var t=e;return e&&e.method&&e.uri&&!e.iv&&(t=this.cloneObj(e),t.iv=this.createInitializationVector(r)),t}},{key:"avc1toavcoti",value:function(r){var e,t=r.split(".");return t.length>2?(e=t.shift()+".",e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).substr(-4)):e=r,e}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"parseLevelPlaylist",value:function(P,f,L,S){var b,e,k,h=0,o=0,t={type:null,version:null,url:f,fragments:[],live:!0,startSN:0},i={method:null,key:null,iv:null,uri:null},m=0,v=null,r=null,l=null,g=null,c=null,u=null,s=[];for(k=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF):(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE):(\d+(?:@\d+(?:\.\d+)?)?)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g;null!==(e=k.exec(P));)switch(e.shift(),e=e.filter(function(e){return void 0!==e}),e[0]){case"PLAYLIST-TYPE":t.type=e[1].toUpperCase();break;case"MEDIA-SEQUENCE":h=t.startSN=parseInt(e[1]);break;case"TARGETDURATION":t.targetduration=parseFloat(e[1]);break;case"VERSION":t.version=parseInt(e[1]);break;case"EXTM3U":break;case"ENDLIST":t.live=!1;break;case"DIS":m++,s.push(e);break;case"BYTERANGE":var p=e[1].split("@");u=1===p.length?c:parseInt(p[1]),c=parseInt(p[0])+u;break;case"INF":l=parseFloat(e[1]),g=e[2]?e[2]:null,s.push(e);break;case"":if(!isNaN(l)){var _=h++;b=this.fragmentDecryptdataFromLevelkey(i,_);var A=e[1]?this.resolve(e[1],f):null;r={url:A,type:S,duration:l,title:g,start:o,sn:_,level:L,cc:m,decryptdata:b,programDateTime:v,tagList:s},null!==u&&(r.byteRangeStartOffset=u,r.byteRangeEndOffset=c),t.fragments.push(r),o+=l,l=null,g=null,u=null,v=null,s=[]}break;case"KEY":var T=e[1],y=new n.default(T),d=y.enumeratedString("METHOD"),R=y.URI,D=y.hexadecimalInteger("IV");d&&(i={method:null,key:null,iv:null,uri:null},R&&"AES-128"===d&&(i.method=d,i.uri=this.resolve(R,f),i.key=null,i.iv=D));break;case"START":var O=e[1],w=new n.default(O),E=w.decimalFloatingPoint("TIME-OFFSET");E&&(t.startTimeOffset=E);break;case"PROGRAM-DATE-TIME":v=new Date(Date.parse(e[1])),s.push(e);break;case"#":e.shift(),s.push(e);break;default:a.logger.warn("line parsed but not handled: "+e)}return r&&!r.url&&(t.fragments.pop(),o-=r.duration),t.totalduration=o,t.averagetargetduration=o/t.fragments.length,t.endSN=h-1,t}},{key:"loadsuccess",value:function(v,i,l){var s=v.data,r=v.url,h=l.type,f=l.id,c=l.level,n=this.hls;if(this.loaders[h]=void 0,void 0!==r&&0!==r.indexOf("data:")||(r=l.url),i.tload=performance.now(),0===s.indexOf("#EXTM3U"))if(s.indexOf("#EXTINF:")>0){var g="audioTrack"!==h,u=this.parseLevelPlaylist(s,r,c||f||0,g?"main":"audio");u.tload=i.tload,"manifest"===h&&n.trigger(t.default.MANIFEST_LOADED,{levels:[{url:r,details:u}],url:r,stats:i}),i.tparsed=performance.now(),g?n.trigger(t.default.LEVEL_LOADED,{details:u,level:c||0,id:f||0,stats:i}):n.trigger(t.default.AUDIO_TRACK_LOADED,{details:u,id:f,stats:i})}else{var d=this.parseMasterPlaylist(s,r);if(d.length){var o=this.parseMasterPlaylistMedia(s,r,"AUDIO");if(o.length){var p=!1;o.forEach(function(e){e.url||(p=!0)}),p===!1&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(a.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),o.unshift({type:"main",name:"main"}))}n.trigger(t.default.MANIFEST_LOADED,{levels:d,audioTracks:o,url:r,stats:i})}else n.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:r,reason:"no level found in manifest"})}else n.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:r,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(s,r){var i,a,n=r.loader;switch(r.type){case"manifest":i=e.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case"level":i=e.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case"audioTrack":i=e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1}n&&(n.abort(),this.loaders[r.type]=void 0),this.hls.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:i,fatal:a,url:n.url,loader:n,response:s,context:r})}},{key:"loadtimeout",value:function(s,r){var i,a,n=r.loader;switch(r.type){case"manifest":i=e.ErrorDetails.MANIFEST_LOAD_TIMEOUT,a=!0;break;case"level":i=e.ErrorDetails.LEVEL_LOAD_TIMEOUT,a=!1;break;case"audioTrack":i=e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,a=!1}n&&(n.abort(),this.loaders[r.type]=void 0),this.hls.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:i,fatal:a,url:n.url,loader:n,context:r})}}]),r}(s.default);o.default=y},{"../errors":24,"../event-handler":25,"../events":26,"../utils/attr-list":38,"../utils/logger":43,"../utils/url":46}],35:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return r(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:a};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,r,l,r,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function(a){for(var t,i=Array.prototype.slice.call(arguments,1),e=8,r=i.length,n=r;r--;)e+=i[r].byteLength;for(t=new Uint8Array(e),t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=255&e,t.set(a,4),r=0,e=8;n>r;r++)t.set(i[r],e),e+=i[r].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){return r*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))}},{key:"moov",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(r){for(var t=r.length,i=[];t--;)i[t]=e.trex(r[t]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,r){r*=t;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)}},{key:"sdtp",value:function(n){var r,t,i=n.samples||[],a=new Uint8Array(4+i.length);for(t=0;t<i.length;t++)r=i[t].flags,a[t+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,a,n,i=[],s=[];for(r=0;r<t.sps.length;r++)a=t.sps[r],n=a.byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(a));for(r=0;r<t.pps.length;r++)a=t.pps[r],n=a.byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(a));var u=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),o=t.width,l=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,n=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))}},{key:"traf",value:function(i,t){var a=e.sdtp(i),r=i.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t])),e.trun(i,a.length+16+16+8+16+8+8),a)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(r){var t=r.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(f,o){var i,a,n,s,t,l,d=f.samples||[],r=d.length,h=12+16*r,u=new Uint8Array(h);for(o+=8+h,u.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,o>>>24&255,o>>>16&255,o>>>8&255,255&o],0),i=0;r>i;i++)a=d[i],n=a.duration,s=a.size,t=a.flags,l=a.cts,u.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,61440&t.degradPrio,15&t.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,u)}},{key:"initSegment",value:function(i){e.types||e.init();var t,r=e.moov(i);return t=new Uint8Array(e.FTYP.byteLength+r.byteLength),t.set(e.FTYP),t.set(r,e.FTYP.byteLength),t}}]),e}();e.default=i},{}],36:[function(r,g,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(s,"__esModule",{value:!0});var l=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r("../helper/aac"),a=n(u),d=r("../events"),t=n(d),e=r("../utils/logger"),f=r("../remux/mp4-generator"),i=n(f),o=r("../errors");r("../utils/polyfill");var c=function(){function r(e,t,i){h(this,r),this.observer=e,this.id=t,this.config=i,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return l(r,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(h,d,r,i,l,o,e,a){if(this.level=h,this.sn=d,this.ISGenerated||this.generateIS(r,i,e),this.ISGenerated)if(r.samples.length){var s=this.remuxAudio(r,e,a);if(i.samples.length){var u=void 0;s&&(u=s.endPTS-s.startPTS),this.remuxVideo(i,e,a,u)}}else{var n=void 0;i.samples.length&&(n=this.remuxVideo(i,e,a)),n&&r.codec&&this.remuxEmptyAudio(r,e,a,n)}l.samples.length&&this.remuxID3(l,e),o.samples.length&&this.remuxText(o,e),this.observer.trigger(t.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(r,a,f){var n,s,c=this.observer,g=r.samples,d=a.samples,h=this.PES_TIMESCALE,l={},v={id:this.id,level:this.level,sn:this.sn,tracks:l,unique:!1},u=void 0===this._initPTS;u&&(n=s=1/0),r.config&&g.length&&(r.timescale=r.audiosamplerate,r.timescale*r.duration>Math.pow(2,32)&&!function(){var e=function r(t,e){return e?r(e,t%e):t};r.timescale=r.audiosamplerate/e(r.audiosamplerate,1024)}(),e.logger.log("audio mp4 timescale :"+r.timescale),l.audio={container:"audio/mp4",codec:r.codec,initSegment:i.default.initSegment([r]),metadata:{channelCount:r.channelCount}},u&&(n=s=g[0].pts-h*f)),a.sps&&a.pps&&d.length&&(a.timescale=this.MP4_TIMESCALE,l.video={container:"video/mp4",codec:a.codec,initSegment:i.default.initSegment([a]),metadata:{width:a.width,height:a.height}},u&&(n=Math.min(n,d[0].pts-h*f),s=Math.min(s,d[0].dts-h*f))),Object.keys(l).length?(c.trigger(t.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,u&&(this._initPTS=n,this._initDTS=s)):c.trigger(t.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,id:this.id,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(s,B,w,x){var r,v,C,g,l,H,R,_,E=8,f=this.PES_TIMESCALE,n=this.PES2MP4SCALEFACTOR,a=s.samples,p=[],u=void 0;u=w?this.nextAvcDts:B*f;var y=a[0];l=Math.max(this._PTSNormalize(y.dts-this._initDTS,u),0),g=Math.max(this._PTSNormalize(y.pts-this._initDTS,u),0);var c=Math.round((l-u)/90);w&&c&&(c>1?e.logger.log("AVC:"+c+" ms hole between fragments detected,filling it"):-1>c&&e.logger.log("AVC:"+-c+" ms overlapping between fragments detected"),l=u,a[0].dts=l+this._initDTS,g=Math.max(g-c,u),a[0].pts=g+this._initDTS,e.logger.log("Video/PTS/DTS adjusted: "+g+"/"+l+",delta:"+c)),H=l,y=a[a.length-1],_=Math.max(this._PTSNormalize(y.dts-this._initDTS,u),0),R=Math.max(this._PTSNormalize(y.pts-this._initDTS,u),0),R=Math.max(R,_);var N=navigator.vendor,I=navigator.userAgent,L=N&&N.indexOf("Apple")>-1&&I&&!I.match("CriOS");L&&(r=Math.round((_-l)/(n*(a.length-1))));for(var b=0;b<a.length;b++){var d=a[b];L?d.dts=l+b*n*r:(d.dts=Math.max(this._PTSNormalize(d.dts-this._initDTS,u),l),d.dts=Math.round(d.dts/n)*n),d.pts=Math.max(this._PTSNormalize(d.pts-this._initDTS,u),d.dts),d.pts=Math.round(d.pts/n)*n}v=new Uint8Array(s.len+4*s.nbNalu+8);var D=new DataView(v.buffer);D.setUint32(0,v.byteLength),v.set(i.default.types.mdat,4);for(var h=0;h<a.length;h++){for(var o=a[h],P=0,T=void 0;o.units.units.length;){var m=o.units.units.shift();D.setUint32(E,m.data.byteLength),E+=4,v.set(m.data,E),E+=m.data.byteLength,P+=4+m.data.byteLength}if(L)T=Math.max(0,r*Math.round((o.pts-o.dts)/(n*r)));else{if(h<a.length-1)r=a[h+1].dts-o.dts;else{var S=this.config,k=o.dts-a[h>0?h-1:h].dts;if(S.stretchShortVideoTrack){var F=S.maxBufferHole,U=S.maxSeekHole,G=Math.floor(Math.min(F,U)*f),A=(x?g+x*f:this.nextAacPts)-o.pts;A>G?(r=A-k,0>r&&(r=k),e.logger.log("It is approximately "+A/90+" ms to the next segment; using duration "+r/90+" ms for the last video frame.")):r=k}else r=k}r/=n,T=Math.round((o.pts-o.dts)/n)}p.push({size:P,duration:r,cts:T,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:o.key?2:1,isNonSync:o.key?0:1}})}this.nextAvcDts=_+r*n;var j=s.dropped;if(s.len=0,s.nbNalu=0,s.dropped=0,p.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var O=p[0].flags;O.dependsOn=2,O.isNonSync=0}s.samples=p,C=i.default.moof(s.sequenceNumber++,l/n,s),s.samples=[];var M={id:this.id,level:this.level,sn:this.sn,data1:C,data2:v,startPTS:g/f,endPTS:(R+n*r)/f,startDTS:l/f,endDTS:this.nextAvcDts/f,type:"video",nb:p.length,dropped:j};return this.observer.trigger(t.default.FRAG_PARSING_DATA,M),M}},{key:"remuxAudio",value:function(r,j,G){var M,A,p,g,c,F,U,C,E,w,P,d,v,n,y,f=this.PES_TIMESCALE,H=r.timescale,k=f/H,B=1024*r.timescale/r.audiosamplerate,T=8,_=[],u=[];r.samples.sort(function(e,t){return e.pts-t.pts}),u=r.samples;for(var l=G?this.nextAacPts:j*f,o=B*k,S=l,s=0;s<u.length;){var h=u[s],x=this._PTSNormalize(h.pts-this._initDTS,l),m=x-S;if(-.5*o>m)e.logger.log("Dropping frame due to "+Math.round(Math.abs(m/90))+" ms overlap."),u.splice(s,1),r.len-=h.unit.length;else if(m>.5*o){var D=Math.round(m/o);e.logger.log("Injecting "+D+" frame"+(D>1?"s":"")+" of missing audio due to "+Math.round(m/90)+" ms gap.");for(var I=0;D>I;I++)y=h.pts-(D-I)*o,y=Math.max(y,this._initDTS),n=a.default.getSilentFrame(r.channelCount),n||(e.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),n=h.unit.slice(0)),u.splice(s,0,{unit:n,pts:y,dts:y}),r.len+=n.length,s+=1;h.pts=u[s-1].pts+o,S=this._PTSNormalize(h.pts+o-this._initDTS,l),s+=1}else Math.abs(m)>.1*o&&e.logger.log("Invalid frame delta "+Math.round(x-S+o)+" at PTS "+Math.round(x/90)+" (should be "+Math.round(o)+")."),S+=o,0===s?h.pts=this._initDTS+l:h.pts=u[s-1].pts+o,s+=1}for(;u.length;){if(A=u.shift(),g=A.unit,w=A.pts-this._initDTS,P=A.dts-this._initDTS,void 0!==E)d=this._PTSNormalize(w,E),v=this._PTSNormalize(P,E),p.duration=Math.round((v-E)/k);else{d=this._PTSNormalize(w,l),v=this._PTSNormalize(P,l);var R=Math.round(1e3*(d-l)/f),b=0;if(G&&R){if(R>0)b=Math.round((d-l)/o),e.logger.log(R+" ms hole between AAC samples detected,filling it"),b>0&&(n=a.default.getSilentFrame(r.channelCount),n||(n=g.slice(0)),r.len+=b*n.length);else if(-12>R){e.logger.log(-R+" ms overlapping between AAC samples detected, drop frame"),r.len-=g.byteLength;continue}d=v=l}if(U=Math.max(0,d),C=Math.max(0,v),!(r.len>0))return;for(c=new Uint8Array(r.len+8),M=new DataView(c.buffer),M.setUint32(0,c.byteLength),c.set(i.default.types.mdat,4),s=0;b>s;s++)y=d-(b-s)*o,n=a.default.getSilentFrame(r.channelCount),n||(e.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),n=g.slice(0)),c.set(n,T),T+=n.byteLength,p={size:n.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(p)}c.set(g,T),T+=g.byteLength,p={size:g.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(p),E=v}var O=0,L=_.length;if(L>=2&&(O=_[L-2].duration,p.duration=O),L){this.nextAacPts=d+k*O,r.len=0,r.samples=_,F=i.default.moof(r.sequenceNumber++,C/k,r),r.samples=[];var N={id:this.id,level:this.level,sn:this.sn,data1:F,data2:c,startPTS:U/f,endPTS:this.nextAacPts/f,startDTS:C/f,endDTS:(v+k*O)/f,type:"audio",nb:L};return this.observer.trigger(t.default.FRAG_PARSING_DATA,N),N}return null}},{key:"remuxEmptyAudio",value:function(t,f,p,l){var i=this.PES_TIMESCALE,v=t.timescale?t.timescale:t.audiosamplerate,g=i/v,u=l.startDTS*i+this._initDTS,y=l.endDTS*i+this._initDTS,h=1024,d=g*h,c=Math.ceil((y-u)/d),n=a.default.getSilentFrame(t.channelCount);if(!n)return void e.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var o=[],r=0;c>r;r++){var s=u+r*d;o.push({unit:n.slice(0),pts:s,dts:s}),t.len+=n.length}t.samples=o,this.remuxAudio(t,f,p)}},{key:"remuxID3",value:function(r,a){var e,n=r.samples.length;if(n){for(var i=0;n>i;i++)e=r.samples[i],e.pts=(e.pts-this._initPTS)/this.PES_TIMESCALE,e.dts=(e.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(t.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:r.samples})}r.samples=[],a=a}},{key:"remuxText",value:function(e,a){e.samples.sort(function(e,t){return e.pts-t.pts});var r,n=e.samples.length;if(n){for(var i=0;n>i;i++)r=e.samples[i],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(t.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],a=a}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;for(r=e>t?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}},{key:"passthrough",get:function(){return!1}}]),r}();s.default=c},{"../errors":24,"../events":26,"../helper/aac":27,"../remux/mp4-generator":35,"../utils/logger":43,"../utils/polyfill":44}],37:[function(r,l,e){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=r("../events"),t=i(s),o=function(){function e(t,r){a(this,e),this.observer=t,this.id=r,this.ISGenerated=!1}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(o,s,h,d,a,u){var n=this.observer;if(!this.ISGenerated){var l={},i={id:this.id,tracks:l,unique:!0},e=s,r=e.codec;r&&(i.tracks.video={container:e.container,codec:r,metadata:{width:e.width,height:e.height}}),e=o,r=e.codec,r&&(i.tracks.audio={container:e.container,codec:r,metadata:{channelCount:e.channelCount}}),this.ISGenerated=!0,n.trigger(t.default.FRAG_PARSING_INIT_SEGMENT,i)}n.trigger(t.default.FRAG_PARSING_DATA,{id:this.id,data1:u,startPTS:a,startDTS:a,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();e.default=o},{"../events":26}],38:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(r){t(this,e),"string"==typeof r&&(r=e.parseAttrList(r));for(var i in r)r.hasOwnProperty(i)&&(this[i]=r[i])}return r(e,[{key:"decimalInteger",value:function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}},{key:"hexadecimalInteger",value:function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),t=0;t<e.length/2;t++)i[t]=parseInt(e.slice(2*t,2*t+2),16);return i}return null}},{key:"hexadecimalIntegerAsNumber",value:function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(t){var e=/^(\d+)x(\d+)$/.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}}],[{key:"parseAttrList",value:function(a){for(var t,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,r={};null!==(t=n.exec(a));){var e=t[2],i='"';0===e.indexOf(i)&&e.lastIndexOf(i)===e.length-1&&(e=e.slice(1,-1)),r[t[1]]=e}return r}}]),e}();e.default=i},{}],39:[function(r,e,i){"use strict";var t={search:function(a,s){for(var t=0,r=a.length-1,e=null,i=null;r>=t;){e=(t+r)/2|0,i=a[e];var n=s(i);if(n>0)t=e+1;else{if(!(0>n))return i;r=e-1}}return null}};e.exports=t},{}],40:[function(R,b,o){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},u=function(e){var t=e;return d.hasOwnProperty(e)&&(t=d[e]),String.fromCharCode(t)},t=15,r=32,g={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},v={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},E={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],e={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,r){var t=this.verboseFilter[e];this.verboseLevel>=t}},i=function(t){for(var r=[],e=0;e<t.length;e++)r.push(t[e].toString(16));return r},h=function(){function e(t,r,i,n,s){a(this,e),this.foreground=t||"white",this.underline=r||!1,this.italics=i||!1,this.background=n||"black",this.flash=s||!1}return n(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(r){for(var i=["foreground","underline","italics","background","flash"],e=0;e<i.length;e++){var t=i[e];r.hasOwnProperty(t)&&(this[t]=r[t])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),y=function(){function e(t,r,i,n,s,o){a(this,e),this.uchar=t||" ",this.penState=new h(r,i,n,s,o)}return n(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),m=function(){function t(){a(this,t),this.chars=[];for(var e=0;r>e;e++)this.chars.push(new y);this.pos=0,this.currPenState=new h}return n(t,[{key:"equals",value:function(i){for(var t=!0,e=0;r>e;e++)if(!this.chars[e].equals(i.chars[e])){t=!1;break}return t}},{key:"copy",value:function(t){for(var e=0;r>e;e++)this.chars[e].copy(t.chars[e])}},{key:"isEmpty",value:function(){for(var t=!0,e=0;r>e;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}},{key:"setCursor",value:function(t){this.pos!==t&&(this.pos=t),this.pos<0?(e.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>r&&(e.log("ERROR","Too large cursor position "+this.pos),this.pos=r)}},{key:"moveCursor",value:function(t){var r=this.pos+t;if(t>1)for(var e=this.pos+1;r+1>e;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(r)}},{key:"backSpace",value:function(){
this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(t){t>=144&&this.backSpace();var i=u(t);return this.pos>=r?void e.log("ERROR","Cannot insert "+t.toString(16)+" ("+i+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(i,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(t){var e;for(e=t;r>e;e++)this.chars[e].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var t=[],i=!0,e=0;r>e;e++){var a=this.chars[e].uchar;" "!==a&&(i=!1),t.push(a)}return i?"":t.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)}}]),t}(),s=function(){function r(){a(this,r),this.rows=[];for(var e=0;t>e;e++)this.rows.push(new m);this.currRow=t-1,this.nrRollUpRows=null,this.reset()}return n(r,[{key:"reset",value:function(){for(var e=0;t>e;e++)this.rows[e].clear();this.currRow=t-1}},{key:"equals",value:function(i){for(var r=!0,e=0;t>e;e++)if(!this.rows[e].equals(i.rows[e])){r=!1;break}return r}},{key:"copy",value:function(r){for(var e=0;t>e;e++)this.rows[e].copy(r.rows[e])}},{key:"isEmpty",value:function(){for(var r=!0,e=0;t>e;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r}},{key:"backSpace",value:function(){var e=this.rows[this.currRow];e.backSpace()}},{key:"clearToEndOfRow",value:function(){var e=this.rows[this.currRow];e.clearToEndOfRow()}},{key:"insertChar",value:function(e){var t=this.rows[this.currRow];t.insertChar(e)}},{key:"setPen",value:function(e){var t=this.rows[this.currRow];t.setPenStyles(e)}},{key:"moveCursor",value:function(e){var t=this.rows[this.currRow];t.moveCursor(e)}},{key:"setCursor",value:function(t){e.log("INFO","setCursor: "+t);var r=this.rows[this.currRow];r.setCursor(t)}},{key:"setPAC",value:function(t){e.log("INFO","pacData = "+JSON.stringify(t));var r=t.row-1;this.nrRollUpRows&&r<this.nrRollUpRows-1&&(r=this.nrRollUpRows-1),this.currRow=r;var i=this.rows[this.currRow];if(null!==t.indent){var a=t.indent,n=Math.max(a-1,0);i.setCursor(t.indent),t.color=i.chars[n].penState.foreground}var s={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(s)}},{key:"setBkgData",value:function(t){e.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void e.log("DEBUG","roll_up but nrRollUpRows not set yet");e.log("TEXT",this.getDisplayText());var r=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(r,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),e.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(r){r=r||!1;for(var e=[],n="",s=-1,i=0;t>i;i++){var a=this.rows[i].getTextString();a&&(s=i+1,r?e.push("Row "+s+": '"+a+"'"):e.push(a.trim()))}return e.length>0&&(n=r?"["+e.join(" | ")+"]":e.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),r}(),l=function(){function r(e,i){a(this,r),this.chNr=e,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new s,this.nonDisplayedMemory=new s,this.lastOutputScreen=new s,this.currRollUpRow=this.displayedMemory.rows[t-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return n(r,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[t-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(t){t!==this.mode&&(this.mode=t,e.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}},{key:"insertChars",value:function(r){for(var t=0;t<r.length;t++)this.writeScreen.insertChar(r[t]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";e.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(e.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){e.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){e.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){e.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(t){e.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}},{key:"ccFON",value:function(){e.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){e.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){e.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){e.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){e.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){e.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){e.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(e.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,e.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(t){e.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}},{key:"ccMIDROW",value:function(r){var t={flash:!1};if(t.underline=r%2===1,t.italics=r>=46,t.italics)t.foreground="white";else{var i=Math.floor(r/2)-16,a=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=a[i]}e.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var t=e.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),r}(),p=function(){function t(i,e,r){a(this,t),this.field=i||1,this.outputs=[e,r],this.channels=[new l(1,e),new l(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return n(t,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(l,s){var t,r,a,o=!1;this.lastTime=l,e.setTime(l);for(var n=0;n<s.length;n+=2)if(r=127&s[n],a=127&s[n+1],0!==r||0!==a){if(e.log("DATA","["+i([s[n],s[n+1]])+"] -> ("+i([r,a])+")"),t=this.parseCmd(r,a),t||(t=this.parseMidrow(r,a)),t||(t=this.parsePAC(r,a)),t||(t=this.parseBackgroundAttributes(r,a)),!t&&(o=this.parseChars(r,a)))if(this.currChNr&&this.currChNr>=0){var u=this.channels[this.currChNr-1];u.insertChars(o)}else e.log("WARNING","No channel found yet. TEXT-MODE?");t?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,e.log("WARNING","Couldn't parse cleaned data "+i([r,a])+" orig: "+i([s[n],s[n+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(a,t){var n=null,s=(20===a||28===a)&&t>=32&&47>=t,o=(23===a||31===a)&&t>=33&&35>=t;if(!s&&!o)return!1;if(a===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,e.log("DEBUG","Repeated command ("+i([a,t])+") is dropped"),!0;n=20===a||23===a?1:2;var r=this.channels[n-1];return 20===a||28===a?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.lastCmdA=a,this.lastCmdB=t,this.currChNr=n,!0}},{key:"parseMidrow",value:function(t,r){var a=null;if((17===t||25===t)&&r>=32&&47>=r){if(a=17===t?1:2,a!==this.currChNr)return e.log("ERROR","Mismatch channel in midrow parsing"),!1;var n=this.channels[a-1];return n.ccMIDROW(r),e.log("DEBUG","MIDROW ("+i([t,r])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var r=null,i=null,a=(e>=17&&23>=e||e>=25&&31>=e)&&t>=64&&127>=t,n=(16===e||24===e)&&t>=64&&95>=t;if(!a&&!n)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=23>=e?1:2,i=t>=64&&95>=t?1===r?g[e]:f[e]:1===r?v[e]:E[e];var s=this.interpretPAC(i,t),o=this.channels[r-1];return o.setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0}},{key:"interpretPAC",value:function(i,r){var e=r,t={color:null,italics:!1,indent:null,underline:!1,row:i};return e=r>95?r-96:r-64,t.underline=1===(1&e),13>=e?t.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(e/2)]:15>=e?(t.italics=!0,t.color="white"):t.indent=4*Math.floor((e-16)/2),t}},{key:"parseChars",value:function(t,r){var s=null,n=null,a=null;if(t>=25?(s=2,a=t-8):(s=1,a=t),a>=17&&19>=a){var o=r;o=17===a?r+80:18===a?r+112:r+144,e.log("INFO","Special char '"+u(o)+"' in channel "+s),n=[o]}else t>=32&&127>=t&&(n=0===r?[t]:[t,r]);if(n){var l=i(n);e.log("DEBUG","Char codes =  "+l.join(",")),this.lastCmdA=null,this.lastCmdB=null}return n}},{key:"parseBackgroundAttributes",value:function(r,e){var t,i,a,n,s=(16===r||24===r)&&e>=32&&47>=e,o=(23===r||31===r)&&e>=45&&47>=e;return s||o?(t={},16===r||24===r?(i=Math.floor((e-32)/2),t.background=c[i],e%2===1&&(t.background=t.background+"_semi")):45===e?t.background="transparent":(t.foreground="black",47===e&&(t.underline=!0)),a=24>r?1:2,n=this.channels[a-1],n.setBkgData(t),this.lastCmdA=null,this.lastCmdB=null,!0):!1}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)}}]),t}();o.default=p},{}],41:[function(r,e,i){"use strict";var t={newCue:function(h,l,d,o){for(var i,t,s,r,n,u=window.VTTCue||window.TextTrackCue,e=0;e<o.rows.length;e++)if(i=o.rows[e],s=!0,r=0,n="",!i.isEmpty()){for(var a=0;a<i.chars.length;a++)i.chars[a].uchar.match(/\s/)&&s?r++:(n+=i.chars[a].uchar,s=!1);t=new u(l,d,n.trim()),r>=16?r--:r++,navigator.userAgent.match(/Firefox\//)?t.line=e+1:t.line=e>7?e-2:e+1,t.align="left",t.position=100*(r/32)+(navigator.userAgent.match(/Firefox\//)?50:0),h.addCue(t)}}};e.exports=t},{}],42:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(r){t(this,e),this.alpha_=r?Math.exp(Math.log(.5)/r):0,this.estimate_=0,this.totalWeight_=0}return r(e,[{key:"sample",value:function(e,r){var t=Math.pow(this.alpha_,e);this.estimate_=r*(1-t)+t*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();e.default=i},{}],43:[function(l,u,r){"use strict";function e(){}function a(t,e){return e="["+t+"] > "+e}function n(t){var r=window.console[t];return r?function(){for(var n=arguments.length,e=Array(n),i=0;n>i;i++)e[i]=arguments[i];e[0]&&(e[0]=a(t,e[0])),r.apply(window.console,e)}:e}function s(r){for(var i=arguments.length,a=Array(i>1?i-1:0),e=1;i>e;e++)a[e-1]=arguments[e];a.forEach(function(e){t[e]=r[e]?r[e].bind(r):n(e)})}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i={trace:e,debug:e,log:e,warn:e,info:e,error:e},t=i;r.enableLogs=function(e){if(e===!0||"object"===("undefined"==typeof e?"undefined":o(e))){s(e,"debug","log","info","warn","error");try{t.log()}catch(e){t=i}}else t=i},r.logger=t},{}],44:[function(e,t,r){"use strict";"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(r,t){var i=new Uint8Array(this);void 0===t&&(t=i.length);for(var a=new ArrayBuffer(t-r),n=new Uint8Array(a),e=0;e<n.length;e++)n[e]=i[e+r];return a})},{}],45:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return r(e,null,[{key:"toString",value:function(t){for(var r="",i=t.length,e=0;i>e;e++)r+="["+t.start(e)+","+t.end(e)+"]";return r}}]),e}();e.default=i},{}],46:[function(r,t,i){"use strict";var e={buildAbsoluteURL:function(r,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var l=null,o=null,n=/^([^#]*)(.*)$/.exec(t);n&&(o=n[2],t=n[1]);var s=/^([^\?]*)(.*)$/.exec(t);s&&(l=s[2],t=s[1]);var h=/^([^#]*)(.*)$/.exec(r);h&&(r=h[1]);var u=/^([^\?]*)(.*)$/.exec(r);u&&(r=u[1]);var i=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(r);if(!i)throw new Error("Error trying to parse base URL.");var f=i[2]||"",d=i[1]||"",c=i[4],a=null;return a=/^\/\//.test(t)?f+"//"+e.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?d+"/"+e.buildAbsolutePath("",t.substring(1)):e.buildAbsolutePath(d+c,t),l&&(a+=l),o&&(a+=o),a},buildAbsolutePath:function(n,s){for(var i,e,o=s,a="",t=n.replace(/[^\/]*$/,o.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),r=0;e=t.indexOf("/../",r),e>-1;r=e+i)i=/^\/(?:\.\.\/)*/.exec(t.slice(e))[0].length,a=(a+t.substring(r,e)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");return a+t.substr(r)}};t.exports=e},{}],47:[function(r,s,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),e=r("../utils/logger"),n=function(){function t(e){i(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return a(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(t,e,r){this.context=t,this.config=e,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onloadend=this.loadend.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var r=this.stats;r.tfirst=0,r.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"loadend",value:function(l){var i=l.currentTarget,r=i.status,t=this.stats,a=this.context,o=this.config;if(!t.aborted)if(window.clearTimeout(this.requestTimeout),r>=200&&300>r){t.tload=Math.max(t.tfirst,performance.now());var n=void 0,s=void 0;"arraybuffer"===a.responseType?(n=i.response,s=n.byteLength):(n=i.responseText,s=n.length),t.loaded=t.total=s;var u={url:i.responseURL,data:n};this.callbacks.onSuccess(u,t,a)}else t.retry>=o.maxRetry||r>=400&&499>r?(e.logger.error(r+" while loading "+a.url),this.callbacks.onError({code:r,text:i.statusText},a)):(e.logger.warn(r+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),t.retry++)}},{key:"loadtimeout",value:function(){e.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(t){var e=this.stats;0===e.tfirst&&(e.tfirst=Math.max(performance.now(),e.trequest)),e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total);var r=this.callbacks.onProgress;r&&r(e,this.context,null)}}]),t}();t.default=n},{"../utils/logger":43}]},{},[31])(31)});

}(),function(){function a(b,c){for(var d in c)"object"!=typeof c[d]?"undefined"!=typeof b[d]&&null!==b[d]||(b[d]=c[d]):(b.hasOwnProperty(d)||(b[d]={}),a(b[d],c[d]))}window.NDP_DEBUG="0",window.NDP_DEBUG=!!+window.NDP_DEBUG;var b="none",c=0,d='<?xml version="1.0"?><layout><controls><region id="tpTitleRegion"><row id="tpTitleContainer" percentWidth="100"><control id="tpTitle"/></row></region><region id="tpAdCountdownRegion"><row id="tpAdCountdownContainer" percentWidth="100"><control id="tpAdCountdown" text="Your video will resume in {remainingTime} {second|seconds}"/></row></region><region id="tpBottomFloatRegion"><row><control id="tpPlay"/><group percentWidth="100"><spacer width="20"/><control id="tpCurrentTime"/><spacer width="10"/><control id="tpScrubber" showTooltip="never"/><spacer width="10"/><control id="tpTotalTime"/><control id="tpVolume" expandDirection="up"/><control id="tpCC" deck="forms" card="tpSubtitleStylesCard" icon="IconCC" onMedia="onCCMedia" onPreview="onCCPreview"/><control id="tpFullScreen"/></group></row></region></controls></layout>',e={location:null,autoPlay:!1,id:null,useCustomControls:!1,adpolicy:35810,freewheel:{network:169843,url:"http://29773.v.fwmrm.net/ad/p/1",siteSection:"TODAY_fallback_site_section",siteSectionFallbackID:884196,videoAssetFallbackID:90320017,adManagerUrl:"http://media1.s-nbcnews.com/i/videoassets/pdk/vendor/AdManager-6.5.0.r1.{ext}",playerProfile:"nbcnews_{runtime}_live",logLevel:c,requestTimeout:7e3},pdk:{source:{version:"5.7.0",url:"http://media1.s-nbcnews.com/i/videoassets/pdk/5.7.0/"},skin:{version:"brushed",url:"http://media1.s-nbcnews.com/i/videoassets/pdk/default_skin/brushed2.json"},layout:{version:"default",url:"http://media1.s-nbcnews.com/i/videoassets/pdk/default_layout/metaLayout_brushed.xml",string:d},playerConfig:{formats:"F4M,MPEG4,M3U",expandVideo:!0,logLevel:b,allowFullScreen:"true",plugin0:"type=adcomponent|url={pdkUrl}swf/freewheel.swf{fwConfigString}",plugin1:"type=adcomponent|url={pdkUrl}js/plugins/freewheel.js{fwConfigString}",plugin2:"type=content|url={pdkUrl}swf/akamaiHD.swf|fallback=switch%3Dhttp|bufferProfile=livestable|priority=1|videoLayer=AkamaiHD",plugin3:"type=content|url={pdkUrl}js/plugins/akamaiHD.js|fallback=switch%3Dhttp|bufferProfile=livestable|priority=1|videoLayer=AkamaiHD",plugin4:"type=captions|url={pdkUrl}swf/liveCaptions.swf|priority=1|align=top",skinUrl:"{skinUrl}",layout:"{layoutString}"}}};"#testAdNetwork"===location.hash&&(e.freewheel.network=171224,e.freewheel.url="http://29cd8.v.fwmrm.net/ad/g/1",e.freewheel.siteSection="Today_Show_2015_Test_Site_Section",e.freewheel.siteSectionFallbackID=884196,e.freewheel.videoAssetFallbackID=90320017),window.$ndp&&window.$ndp.configuration?a($ndp.configuration,e):(window.console,window.$ndp={},window.$ndp.configuration=e)}(),function(a){function b(){if(!window.$ndp||!window.$ndp.configuration)throw new Error("Default configuration.js was not found.");this.configuration=$ndp.configuration,this.DataStore={},this.isDebug(e),this.debugMode(d)}var c=b.prototype={constructor:b};c.__version="1.3.4",c.__datetime="2017-03-08 1152",c.__timestamp=(new Date).getTime();var d=parseInt(a.ndpDebugMode)||(a.NDP_DEBUG?3:0),e=("string"==typeof a.ndpDEBUG?"true"===a.ndpDEBUG.toLowerCase():a.ndpDEBUG)||a.NDP_DEBUG;c.debugMode=function(){if(arguments.length){if(d=parseInt(arguments[0])||d,this.console){arguments[1]||void 0;this.console.supportedMode.apply(this.console,arguments)}if(this.configuration){var a=this.configuration.pdk&&this.configuration.pdk.playerConfig||{},b=function(a){var b=window.tv&&window.tv.freewheel&&window.tv.freewheel.SDK;b&&b.setLogLevel(b[a])};d>0?3===d?(b("LOG_LEVEL_DEBUG"),a.logLevel="debug"):(b("LOG_LEVEL_INFO"),a.logLevel="info"):b("LOG_LEVEL_QUIET")}}return d},c.isDebug=function(){if(arguments.length){var b=arguments[0],b=Boolean("string"==typeof b?"true"===b.toLowerCase():b);if(e="boolean"==typeof b?b:e,!this.console)return setTimeout(function(){c.isDebug.apply(this,arguments)},10),e;this.console.dump(e),a.NDP_DEBUG=e}return e},c.__getDateTime=function(){var a=new Date,b={year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return a.toLocaleString("en-US",b)+"."+a.getMilliseconds()},c.__bind=function(a,b){return function(){return b.apply(a,arguments)}},c.__createId=function(a){return a=a||"",a+(new Date).getTime()},c.__cloneObjToJson=function(a,b){return a&&null!==a?(b=b||function(a,b){if($ndp.isDomElement(b)){var c=$ndp.models.domModel;return new c(b)}if(b instanceof Function)return b.toString().replace(/(\r)(\s+)/gm," ");if("object"==typeof b&&null!==b){var c=$ndp.models.nativeObj;return new c(b)}return b},a=JSON.stringify(a,b),JSON.parse(a)):a},c.isNaO=function(a){return"undefined"==typeof a||null===a},c.isDomElement=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},c.isArray=function(a){var b=Object.prototype.toString.call([]);return"[object Array]"===b&&"[object Array]"===Object.prototype.toString.call(a)},c.getFnName=function(a){var b="function"==typeof a,c=b&&(a.name&&["",a.name]||a.toString().match(/function ([^\(]+)/));return!b&&"false"||c&&c[1]||"anonymous"},c.__extend=function(a){if("function"==typeof Object.assign)return Object.assign.apply(null,arguments);if(!a)return a;for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b},c.__has=function(a,b){if(!a)return!1;for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},c.__getTraceStack=function(a){var b;b=a instanceof Error?a:this instanceof Error?this:new Error;var c=b.stack;try{throw b}catch(a){c=a.stack,c||(c=this.getStackTrace instanceof Function?this.getStackTrace():this.captureStackTrace instanceof Function?this.captureStackTrace():a.message)}return c||""},a.$ndp=new b}(window),function(a){function b(a,b,c){this.id=a,this.name=b,this.url=c,this.isLiveMedia=arguments[3]||!1}b.prototype.getID=function(){return this.id},b.prototype.getName=function(){return this.name},b.prototype.getURL=function(){return this.url},b.prototype.getCC=function(){return this.cc},b.prototype.isLive=function(){return this.isLiveMedia},b.prototype.getVideoData=function(){var a=this.getURL(),b=a.indexOf("?")>0?"&":"?",c="format=redirect&Tracking=true&Embedded=true&formats=MPEG4",d={};return d.url=a+b+c,d.cc=this.getCC(),d},a.MediaAsset=b}(window.$ndp),function(a){function b(a){this.raw=a,this.once=null,this.llnHigh=null,this.llnLow=null,this.liveM3U=null,this.liveF4M=null,this.captionType="srt",this.ccRoute="/captions?url=",this.cc=null,this.__parse()}var c=a.MediaAsset,d=window.screen.width<600;b.prototype=new c,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.getRawData=function(){return this.raw},b.prototype.__parse=function(){if(this.id=this.raw.guid,this.__parseURL(),this.__getCC(),this.isLiveMedia=!!this.liveM3U||!!this.liveF4M,this.isLiveMedia)if("native"==a.playbackAdapter){var b=/\?/.test(this.liveM3U);b=b?"&":"?",this.url=this.liveM3U+b+"format=redirect"}else this.url=this.liveF4M+"?MBR=TRUE&feed=All%20Content";else null!==this.once?this.url=this.once:null===this.llnHigh||d?this.url=this.llnLow:this.url=this.llnHigh},b.prototype.__getCC=function(){this.raw.captionLinks&&this.raw.captionLinks[this.captionType]&&(this.cc=this.raw.captionLinks[this.captionType])},b.prototype.__parseURL=function(){for(var a=this.raw.videoAssets.length,b=null,c=null;a--;)b=this.raw.videoAssets[a],c=parseInt(b.bitRate,10),"MPEG4"===b.format&&"FireTV-Once"!==b.assetType&&(0===c?this.once=b.publicUrl:8e5===c?this.llnHigh=b.publicUrl:5e5===c?this.llnLow=b.publicUrl:this.llnLow=b.publicUrl),"F4M"===b.format&&(this.liveF4M=b.publicUrl),"M3U"===b.format&&(this.liveM3U=b.publicUrl)},a.MPXMediaAsset=b}(window.$ndp),function(a){function b(){this.NotSupported="undefined"==typeof window.console;for(var a=f.length;a--;)this[f[a]]=this._noop;this._setLevels()}window.console=window.console||void 0;var c=["error","trace"],d=["debug","warn","info"],e=["assert","count","dir","group","groupCollapsed","groupEnd","log","time","timeEnd"],f=["assert","count","debug","dir","error","group","groupCollapsed","groupEnd","info","log","time","timeEnd","trace","warn"],g=a.isDebug()||!1,h=parseInt(a.debugMode())||1,i=[];b.prototype={constructor:b},b.prototype.dump=function(){return arguments.length&&(g=Boolean(arguments[0]),this._setLevels()),g},b.prototype.supportedMode=function(){if(arguments.length){var a;h=parseInt(arguments[0])||h,arguments[1]&&(a=arguments[1]),this._setLevels(a)}return h},b.prototype.supportedLevels=function(){return arguments.length&&(i=Array.prototype.slice.call(arguments[0],0)||i),i},b.prototype._setLevels=function(a){if(g){switch(this.supportedMode()){case 1:this.supportedLevels(c);break;case 2:this.supportedLevels(c.concat(d));break;case 3:this.supportedLevels(c.concat(d,e));break;case 4:a&&this.supportedLevels(a)}return void this.process()}this.supportedLevels([]),this.process()},b.prototype.process=function(a){if(a=a||f,!this.NotSupported){var b=window.console||a;for(var c in b)isNaN(c)||(c=b[c]),this[c]=this._noop,this._build(c)}},b.prototype._noop=function(){},b.prototype._default=function(a){return Function.prototype.bind.call(console[a],console,"[NDPPlayerConsole]\t")},b.prototype._verify=function(a){Function.prototype.bind&&"object"==typeof console&&"object"==typeof console[a]&&(console[a]=Function.prototype.call.bind(console[a],console))},b.prototype._build=function(a){var b=this._isSupported(a)?a:"log";this._isSupported(b)&&(this._verify(b),this[a]="function"==typeof console[b]?this._default(b):this._noop)},b.prototype._isSupported=function(b){return!a.isNaO(window.console)&&!a.isNaO(window.console[b])&&!!a.__has(this.supportedLevels(),b)},a.console=new b}(window.$ndp),function(a){function b(){var a=document.body;return a||(a=document.createElement("body"),a.fake=!0),a}a.detectFullscreenSupport=function(a){var b={fullscreenElement:document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,fullscreenEnabled:document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled,fn:null};return a?(a.requestFullscreen?b.fn={Request:"requestFullscreen",Exit:"exitFullscreen"}:a.webkitRequestFullscreen?b.fn={Request:"webkitRequestFullscreen",Exit:"webkitExitFullscreen"}:a.mozRequestFullScreen?b.fn={Request:"mozRequestFullScreen",Exit:"mozCancelFullScreen"}:a.msRequestFullscreen&&(b.fn={Request:"msRequestFullscreen",Exit:"msExitFullscreen"}),b):b},a.detectAutoplay=function(b){function c(){d.paused===!1&&(a.AUTOPLAY=!0,clearTimeout(f)),d.removeEventListener("canplay",c),a.console.warn("***detectAutoplay:onCanPlayHandler***",d),b instanceof Function&&b()}if(a.AUTOPLAY=!1,!a.IsHTML5Supported())return a.detectFlash(function(c){a.AUTOPLAY=c,a.console.warn("***detectAutoplay:!IsHTML5Supported***",a.AUTOPLAY),b instanceof Function&&b()}),null;var d=document.createElement("video"),e=document.createElement("source");e.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==",d.appendChild(e),d.autoplay=!0,d.addEventListener("canplay",c);var f=setTimeout(c,200)},a.IsHTML5Supported=function(){var a=document.createElement("video");return!(!a.canPlayType||!a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,""))},a.detectFlash=function(c,d){var e=document.documentElement,f=function(b,e){var f=!!b;f&&(f=new Boolean(f),f.blocked="blocked"===b),a.console.warn("Has FLASH",f),a.FLASH=f,e&&k.removeChild(e),"function"==typeof c&&c.call(d||this,a.FLASH)};if(a.FLASH instanceof Boolean)return void("function"==typeof c&&c.call(d||this,a.FLASH));var g,h;try{h="ActiveXObject"in window&&"Pan"in new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(b){a.console.error("Error reading ActiveXObject in FLASH Compat test",b)}if(g=!("plugins"in navigator&&"Shockwave Flash"in navigator.plugins||h))f(!1);else{var i,j=document.createElement("embed"),k=b();if(j.type="application/x-shockwave-flash",k.appendChild(j),!("Pan"in j||h))return void f("blocked",j);setTimeout(function(){e.contains(j)?(i=j.style.cssText,f(""===i||"blocked",j)):f("blocked"),k.fake&&k.parentNode&&k.parentNode.removeChild(k)},10)}}}(window.$ndp),function(a){a.isDomElement,a.isNaO,a.console,a.isDebug;a.models={},a.models.nativeObj=function(b,c){if(!b||a.isArray(b))return b;c=isNaN(parseInt(c))?2:c,this.$NDP_MAPPED_NATIVE=(new Date).getTime();for(var d in b){var e=b[d],f=Object.prototype.toString.call(e),g=/(undefined|null|string|number|boolean|array)/;if(g.test(f.toLowerCase()))this[d]=e;else if(a.isDomElement(e)){var h=a.models.domModel;this[d]=new h(e)}else if(e instanceof Function){if(!b.hasOwnProperty(d))continue;var i=e.toString().replace(/(\r*)(\s+)/gm," ").split(" "),j=[];i.length>7?j.push(f):j=i,this[d]=j.join(" ")}else if("[object Object]"===f&&c&&b.hasOwnProperty(d)){var h=a.models.nativeObj,k=--c;this[d]=new h(e,k)}}},a.models.domModel=function(a,b){if(!a)return{};this.$NDP_MAPPED_ELEMENT=(new Date).getTime();for(var c in a)if("on"!==c.substring(0,2)){var d=a[c],e=Object.prototype.toString.call(d),f=/(undefined|null|string|number|boolean|array)/;f.test(e.toLowerCase())?this[c]=d:b&&(this[c]=e)}},a.models.videoModel=function(b){if(!b)return{};for(var c in b)if("on"!==c.substring(0,2)){var d=b[c],e=Object.prototype.toString.call(d),f=/(undefined|null|string|number|boolean|array)/;if(f.test(e.toLowerCase()))this[c]=d;else switch(c){case"seekable":var g=b.seekable||[];this.seekable=[];for(var h=0;h<g.length;h++)this.seekable.push({start:g.start(h),end:g.end(h)});break;case"buffered":var i=b.buffered||[];this.buffered=[];for(var h=0;h<i.length;h++)this.buffered.push({start:i.start(h),end:i.end(h)});break;case"played":var j=b.played||[];this.played=[];for(var h=0;h<j.length;h++)this.played.push({start:j.start(h),end:j.end(h)});break;case"textTracks":var k=b.textTracks||[];this.textTracks=[];for(var h=0;h<k.length;h++)this.textTracks.push({id:k[h].id,kind:k[h].kind,label:k[h].label,mode:k[h].mode,language:k[h].language,cues:k[h].cues,activeCues:k[h].activeCues,src:k[h].src,srclang:k[h].srclang});break;case"videoTracks":var l=b.videoTracks||[];this.videoTracks=[];for(var h=0;h<l.length;h++)this.videoTracks.push({id:l[h].id,kind:l[h].kind,label:l[h].label,language:l[h].language,selected:l[h].selected})}}this.fullscreen=a.detectFullscreenSupport(b)}}(window.$ndp),function(a){function b(){}b.prototype.getFile=function(a,b){if(!a||""===a)return void b("");var c=new XMLHttpRequest,d=function(){c.addEventListener("load",d),b(c.responseText)};c.addEventListener("load",d),c.open("GET",a),c.send()},b.prototype.parse=function(a){if(!a||0===a.length)return[];for(var b,c=a.split("\r\n\r\n"),d=[],e=c.length;e--;)b=this.parseCue(c.shift()),b&&d.push(b);return d},b.prototype.parseCue=function(a){if(!a||0===a.length)return null;for(var b=a.split(/\r\n|\n|\r/);0===b[0].length||!isNaN(+b[0]);)if(b.shift(),0===b.length)return null;var c=b.shift().split(" "),d=b.join("\n"),e=window.VTTCue||window.TextTrackCue;return new e(this.parseTime(c[0]),this.parseTime(c[2]),d)},b.prototype.parseTime=function(a){var b=a.split(":"),c=60*b.shift()*60,d=60*b.shift(),e=b.shift().split(","),f=+e.shift(),g=e.shift()/1e3;return c+d+f+g},a.SRTParser=new b}(window.$ndp),function(a){function b(){}function c(a){for(var b=d.length;b--;)if(d[b]===a)return!0;return!1}var d=[];b.prototype.create=function(a){for(var b=[],c=null,e=d.length;e--;)c=d[e],c.canHandle(a)&&b.push(c);return b},b.prototype.add=function(a){if(!(a.canHandle instanceof Function))throw new Error("AdapterFactory.add() - An adapter must implement a static 'canHandle' method");c(a)===!1&&d.push(a)},a.AdapterFactory=new b}(window.$ndp),function(a){function b(){}function c(a){for(var b=d.length;b--;)if(d[b]===a)return!0;return!1}var d=[];b.prototype.create=function(b,c){if(a.console.debug("ModuleManager.create",(new Date).getTime()),!(b instanceof a.MessageBus))throw new Error("ModuleManager.create() cannot be called without an instance of MessageBus");for(var e=null,f=d.length;f--;)e=new d[f],e.init(b,c)},b.prototype.add=function(a){c(a)===!1&&d.push(a)},a.ModuleManager=new b}(window.$ndp),function(a){function b(){this.pointer=0,this.items=[]}var c=a.MediaAsset;b.prototype.add=function(a){if(!(a instanceof c))throw new Error("Only media of type NDP MediaAsset are supported");this.items.push(a)},b.prototype.remove=function(a){var b=a instanceof c?this.getAssetAtIndex(a):a;b<this.items.length&&this.items.splice(b,1)},b.prototype.getAssetIndex=function(a){for(var b=this.items.length;b--;)if(this.items[b]===a)return b;return-1},b.prototype.getAssetAtIndex=function(a){return this.items[a]||null},b.prototype.next=function(){var a=this.items[++this.pointer]||null;return a},b.prototype.previous=function(){var a=this.items[--this.pointer]||null;return a},b.prototype.first=function(){this.pointer=0;var a=this.items[this.pointer]||null;return a},b.prototype.last=function(){this.pointer=this.items.length-1;var a=this.items[this.pointer]||null;return a},b.prototype.length=function(){return this.items.length},a.Playlist=b}(window.$ndp),function(a){function b(a,b){this.type=a,this.payload=b,this.autoDispatch=!0}b.prototype.getType=function(){return this.type},b.prototype.getPayload=function(){return this.payload},b.prototype.makeNow=function(){return window.performance&&window.performance.now()||null},b.prototype.getNow=function(){return this.timing||this.makeNow()},a.events=a.events||{},a.events.Event=b}(window.$ndp),function(a){function b(a,b){this.type=a,this.payload=b,this.asset=b.asset,this.autoDispatch=!1}var c=a.events.Event;b.LOAD=["NDP_CommandEvent_LOAD"],b.PLAY=["NDP_CommandEvent_PLAY"],b.PAUSE=["NDP_CommandEvent_PAUSE"],b.STOP=["NDP_CommandEvent_STOP"],b.SETPLAYHEAD=["NDP_CommandEvent_SETPLAYHEAD"],b.SETVOLUME=["NDP_CommandEvent_SETVOLUME"],b.FULLSCREEN=["NDP_CommandEvent_FULLSCREEN"],b.CAPTION=["NDP_CommandEvent_CAPTION"],b.UPDATEDISPLAYBASE=["NDP_CommandEvent_UPDATEDISPLAYBASE"],b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.getAsset=function(){return this.asset},b.prototype.getVolume=function(){return this.payload.volume},b.prototype.seekTo=function(){return this.payload.seekTo},b.prototype.isCaption=function(){return this.payload.caption},b.prototype.isAutoPlay=function(){return this.payload.isAutoPlay},b.prototype.isLive=function(){return this.asset.isLive},a.events.CommandEvent=b}(window.$ndp),function(a){function b(a,b){this.type=a,this.payload=b,this.asset=b.asset}var c=a.events.Event;b.LOADED=["NDP_PlaybackEvent_LOADED"],b.PLAY=["NDP_PlaybackEvent_PLAY"],b.PLAYING=["NDP_PlaybackEvent_PLAYING"],b.START=["NDP_PlaybackEvent_START"],b.PAUSE=["NDP_PlaybackEvent_PAUSE"],b.STOP=["NDP_PlaybackEvent_STOP"],b.COMPLETE=["NDP_PlaybackEvent_COMPLETE"],b.SEEK=["NDP_PlaybackEvent_SEEK"],b.PROGRESS=["NDP_PlaybackEvent_PROGRESS"],b.VOLUME_CHANGE=["NDP_PlaybackEvent_VOLUMECHANGE"],b.FULLSCREEN=["NDP_PlaybackEvent_FULLSCREEN"],b.HAS_CAPTIONS=["NDP_PlaybackEvent_HAS_CAPTIONS"],b.PLAYLIST_COMPLETE=["NDP_PlaybackEvent_PLAYLIST_COMPLETE"],b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.getAsset=function(){return this.asset},b.prototype.getVolume=function(){return this.payload.volume},b.prototype.getPlayheadPosition=function(){return this.payload.playheadPosition},b.prototype.getTotalLength=function(){return this.payload.totalLength},b.prototype.getRemainingTime=function(){return this.payload.totalLength-this.payload.playheadPosition},b.prototype.isLive=function(){return this.payload.isLive},a.events.PlaybackEvent=b}(window.$ndp),function(a){function b(a,b){this.type=a,this.payload=b}var c=a.events.Event;b.ADSKIP=["NDP_AdEvent_ADSKIP"],b.NOPREROLL=["NDP_AdEvent_NOPREROLL"],b.ERROR=["NDP_AdEvent_ERROR"],b.PLAY=["NDP_AdEvent_PLAY"],b.START=["NDP_AdEvent_START"],b.PAUSE=["NDP_AdEvent_PAUSE"],b.CLICK=["NDP_AdEvent_CLICK"],b.PROGRESS=["NDP_AdEvent_PROGRESS"],b.COMPLETE=["NDP_AdEvent_COMPLETE"],b.TIMEOUT=["NDP_AdEvent_TIMEOUT"],b.VOLUME_CHANGE=["NDP_AdEvent_VOLUMECHANGE"],b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.getVolume=function(){return this.payload.volume},b.prototype.getPlayheadPosition=function(){return this.payload.playheadPosition},b.prototype.getTotalLength=function(){return this.payload.totalLength},b.prototype.getRemainingTime=function(){return this.payload.totalLength-this.payload.playheadPosition},b.prototype.getBanners=function(){return this.payload.banners},a.events.AdEvent=b}(window.$ndp),function(a){function b(a,b){this.type=a,this.payload=b}var c=a.events.Event;b.MEDIA_ERROR=["NDP_ErrorEvent_MEDIA_ERROR"],b.NETWORK_ERROR=["NDP_ErrorEvent_NETWORK_ERROR"],b.TIMEOUT_ERROR=["NDP_ErrorEvent_TIMEOUT_ERROR"],b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.getError=function(){return this.payload.error},a.events.ErrorEvent=b}(window.$ndp),function(a){function b(a,b){this.type=a,this.payload=b,this.timing=this.makeNow()}var c=a.events.Event;b.REQUEST_START=["NDP_PerfEvent_REQUEST_START"],b.REQUEST_END=["NDP_PerfEvent_REQUEST_END"],b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,a.events.PerfEvent=b}(window.$ndp),function(a){function b(a,b){this.type=a,this.payload=b,this.autoDispatch=!1}var c=a.events.Event;b.ELEMENT_CREATED=["NDP_SystemEvent_ELEMENT_CREATED"],b.VIEWPORT_UPDATE=["NDP_SystemEvent_VIEWPORT_UPDATE"],b.PLAYER_LOADED=["NDP_SystemEvent_PLAYER_LOADED"],b.SHUTDOWN=["NDP_SystemEvent_SHUTDOWN"],b.SWITCH_NATIVE_ADAPTERS=["NDP_SystemEvent_SWITCH_NATIVE_ADAPTERS"],b.MEDIAELEMENTJS_LOADED=["NDP_SystemEvent_MEDIA_ELEMENT_JS_LOADED"],b.VIDEO_ERROR=["NDP_SystemEvent_VIDEO_ERROR"],b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.getVideoElement=function(){return this.payload.videoElementTag},a.events.SystemEvent=b}(window.$ndp),function(a){function b(a){this.type=a}var c=a.events.Event;b.ERROR=["NDP_VideoEvent_ERROR"],b.STALLED=["NDP_VideoEvent_STALLED"],b.EMPTIED=["NDP_VideoEvent_EMPTIED"],b.ABORT=["NDP_VideoEvent_ABORT"],b.PLAY=["NDP_VideoEvent_PLAY"],b.PLAYING=["NDP_VideoEvent_PLAYING"],b.PAUSE=["NDP_VideoEvent_PAUSE"],b.COMPLETE=["NDP_VideoEvent_COMPLETE"],b.SEEK=["NDP_VideoEvent_SEEK"],b.SEEKED=["NDP_VideoEvent_SEEKED"],b.PROGRESS=["NDP_VideoEvent_PROGRESS"],b.VOLUME_CHANGE=["NDP_VideoEvent_VOLUMECHANGE"],b.FULLSCREEN=["NDP_VideoEvent_FULLSCREEN"],b.SWITCH_ADAPTERS=["NDP_VideoEvent_SWITCH_ADAPTERS"],b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,a.events.VideoEvent=b}(window.$ndp),function(a){function b(){this.listeners={},this.listeners["*"]=[]}b.prototype.addListener=function(a,b){if(!b)throw new Error("Event Listeners cannot be null");var c=this.listeners[a]||[];arguments[2]&&(b={scope:arguments[2],listener:b}),this.__getListenerIndex(c,b)===-1&&c.push(b),this.listeners[a]=c},b.prototype.removeListener=function(a,b){var c=this.listeners[a]||[];arguments[2]&&(b={scope:arguments[2],listener:b});var d=this.__getListenerIndex(c,b);d>-1&&c.splice(d,1)},b.prototype.once=function(a,b){this.addListener(a,{once:!0,listener:b})},b.prototype.notify=function(a){var b,c,d=this.listeners[a.getType()]||[];if(a.autoDispatch&&(d=d.concat(this.listeners["*"])),d.length>0)for(c=d.length;c--;)b=d[c],b instanceof Function?b(a):b.notify instanceof Function?b.notify(a):b.listener.call(b.scope,a)},b.prototype.__getListenerIndex=function(a,b){var c=null,d=null,e=null,f=a.length;for(b.scope&&(c=b.scope,d=b.listener);f--;)if(e=a[f],e===b||null!==c&&null!==d&&e.scope===c&&e.listener===d)return f;return-1},a.AbstractObserver=window.$ndp.AbstractObserver||b}(window.$ndp),function(a){function b(){this.mbus=null,this.domElement=null,this.adapters=[]}var c="NDPAdAdapter",d=a.ModuleManager,e=a.AdapterFactory,f=a.AbstractObserver,g=a.events.CommandEvent,h=a.events.AdEvent,i=a.events.SystemEvent;b.prototype=new f,b.prototype.constructor=b,b.constructor=f.prototype.constructor,b.prototype.__super=f.prototype,b.prototype.init=function(b,d){a.console.debug("AdModule.init",(new Date).getTime()),this.mbus=b,this.domElement=d,this.__addHandlers();for(var f=e.create(c),h=f.length,j=null;h--;)j=f[h],this.adapters.push(new j(this,d));this.mbus.addListener(g.LOAD,this.dispatch,this),this.mbus.addListener(i.ELEMENT_CREATED,this.dispatch,this)},b.prototype.destroy=function(){this.mbus.removeListener(i.ELEMENT_CREATED,this.dispatch,this),this.mbus.removeListener(g.LOAD,this.dispatch,this),this.__removeHandlers();for(var a=this.adapters.length;a--;)this.adapters[a].destroy();this.adapters.length=0,this.domElement=null,this.mbus=null},b.prototype.notify=function(a){a.getType()===h.COMPLETE&&this.__removeHandlers(),this.mbus.notify(a)},b.prototype.dispatch=function(a){a.getType()===g.LOAD&&this.__addHandlers(),this.__super.notify.call(this,a)},b.prototype.__addHandlers=function(){this.mbus.addListener(g.PLAY,this.dispatch,this),this.mbus.addListener(g.PAUSE,this.dispatch,this),this.mbus.addListener(g.STOP,this.dispatch,this),this.mbus.addListener(g.SETVOLUME,this.dispatch,this),this.mbus.addListener(g.FULLSCREEN,this.dispatch,this),this.mbus.addListener(g.CAPTION,this.dispatch,this),this.mbus.addListener(g.UPDATEDISPLAYBASE,this.dispatch,this)},b.prototype.__removeHandlers=function(){this.mbus.removeListener(g.PLAY,this.dispatch,this),this.mbus.removeListener(g.PAUSE,this.dispatch,this),this.mbus.removeListener(g.STOP,this.dispatch,this),this.mbus.removeListener(g.SETVOLUME,this.dispatch,this),this.mbus.removeListener(g.FULLSCREEN,this.dispatch,this),this.mbus.removeListener(g.CAPTION,this.dispatch,this),this.mbus.removeListener(g.UPDATEDISPLAYBASE,this.dispatch,this)},b.prototype.toString=function(){return"AdModule"},d.add(b),a.adapterTypes=a.adapterTypes||{},a.adapterTypes.AD=c}(window.$ndp),function(a){function b(){this.messageQueue=[],this.yieldDelay=10,this.timer=-1}b.prototype=new a,b.prototype.__super=a.prototype,b.prototype.constructor=b,b.constructor=a.prototype.constructor,b.prototype.notify=function(a){this.messageQueue.push(a),a&&a.type===$ndp.events.CommandEvent.FULLSCREEN?this.__process():this.__setYieldTimer()},b.prototype.__process=function(){var a=this.messageQueue.shift();this.__super.notify.call(this,a),this.timer=-1,this.__setYieldTimer()},b.prototype.__setYieldTimer=function(){this.messageQueue.length>0&&this.timer===-1&&(this.timer=setTimeout(function(a){return function(){a.__process()}}(this),this.yieldDelay))},window.$ndp.MessageBus=b}(window.$ndp.AbstractObserver),function(a){function b(){this.mbus=null,this.adapter=null,this.domElement=null}var c="NDPlaybackAdapter",d=a.ModuleManager,e=a.AdapterFactory,f=a.AbstractObserver,g=a.events.CommandEvent,h=a.events.SystemEvent,i=(a.events.PlaybackEvent,a.events.AdEvent);b.prototype=new f,b.prototype.constructor=b,b.constructor=f.prototype.constructor,b.prototype.__super=f.prototype,b.prototype.init=function(b,c){a.console.debug("PlaybackModule.init",(new Date).getTime()),this.mbus=b,this.domElement=c,this.mbus.once(h.SHUTDOWN,function(a){return function(b){a.destroy()}}(this)),this.__initHandlers();var d=e.create("PDK_INIT")[0];!d||this.adapter instanceof d||(this.adapter=new d(this,this.domElement))},b.prototype.destroy=function(){this.__removeAllHandlers(),this.adapter.destroy(),this.adapter=null,this.domElement=null,this.mbus=null},b.prototype.notify=function(a){this.mbus.notify(a)},b.prototype.dispatch=function(a){this.__super.notify.call(this,a)},b.prototype.__onLoad=function(a){var b=e.create(a.getAsset())[0];$ndp.console.debug("*** PlaybackModule.__onLoad ***",b,a),!b||this.adapter instanceof b||(this.adapter=new b(this,this.domElement)),this.dispatch(a)},b.prototype.__toggleHandlers=function(a){this.dispatch(a)},b.prototype.__initHandlers=function(){this.mbus.addListener(i.NOPREROLL,this.__toggleHandlers,this),this.mbus.addListener(i.START,this.__toggleHandlers,this),this.mbus.addListener(i.COMPLETE,this.__toggleHandlers,this),this.__addHandlers()},b.prototype.__addHandlers=function(){this.mbus.addListener(g.LOAD,this.__onLoad,this),this.mbus.addListener(g.PLAY,this.dispatch,this),this.mbus.addListener(g.PAUSE,this.dispatch,this),this.mbus.addListener(g.STOP,this.dispatch,this),this.mbus.addListener(g.SETVOLUME,this.dispatch,this),this.mbus.addListener(g.SETPLAYHEAD,this.dispatch,this),this.mbus.addListener(g.FULLSCREEN,this.dispatch,this),this.mbus.addListener(g.CAPTION,this.dispatch,this)},b.prototype.__removeHandlers=function(){this.mbus.removeListener(g.LOAD,this.__onLoad,this),this.mbus.removeListener(g.PLAY,this.dispatch,this),this.mbus.removeListener(g.PAUSE,this.dispatch,this),this.mbus.removeListener(g.STOP,this.dispatch,this),this.mbus.removeListener(g.SETVOLUME,this.dispatch,this),this.mbus.removeListener(g.SETPLAYHEAD,this.dispatch,this),this.mbus.removeListener(g.FULLSCREEN,this.dispatch,this),this.mbus.removeListener(g.CAPTION,this.dispatch,this)},b.prototype.__removeAllHandlers=function(){this.__removeHandlers(),this.mbus.removeListener(i.START,this.__toggleHandlers,this),this.mbus.removeListener(i.COMPLETE,this.__toggleHandlers,this)},d.add(b),a.adapterTypes=a.adapterTypes||{},a.adapterTypes.PLAYBACK=c}(window.$ndp),function(a){function b(){var a=[];this.contentURL=null,this.contentIsLive=!1,this.captions=a,this.containerElement=null,this.videoElement=document.createElement("video"),this.tt=this.videoElement.addTextTrack("captions",f),this.ttMode=null,this.allowPreRollAd=!0,this.videoElement.textTracks.addEventListener("change",function(b){var c=b.target,d=null,e=c.length;if(!(e<=1))for(;e--;)if(d=c[e],a.length>0&&d.mode===g&&d.label!==f)return d.mode=i,void(c[0].mode=g)}),this.isAdState=!1,this.handleEvent=function(a){return function(b){a.processEvent(b)}}(this),this.srtResponseHandler=function(a){return function(b){for(var c=e.parse(b);c.length;)a.captions.unshift(c.shift())}}(this),this.addVideoListeners()}var c=(a.console,a.AbstractObserver),d=a.events.VideoEvent,e=a.SRTParser,f="Closed Captions",g="showing",h="hidden",i="disabled",j={
error:d.VIDEO_ERROR,emptied:d.EMPTIED,abort:d.ABORT,play:d.PLAY,playing:d.PLAYING,pause:d.PAUSE,timeupdate:d.PROGRESS,ended:d.COMPLETE,seeking:d.SEEK,seeked:d.SEEKED,volumechange:d.VOLUME_CHANGE};b.prototype=new c,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.src=function(){return 1===arguments.length&&(this.isAdState=!1,this.contentIsLive=a.DataStore.mediaAsset.isLiveMedia,this.videoElement.src=this.contentURL=arguments[0],this.removeCaptions()),this.videoElement.src},b.prototype.showPreroll=function(){return 1===arguments.length&&(this.allowPreRollAd=arguments[0]),this.allowPreRollAd},b.prototype.restartFromAd=function(){this.videoElement.src!==this.contentURL&&(this.videoElement.src=this.contentURL),this.createCaptions(),this.showControls(),this.play()},b.prototype.play=function(){this.videoElement.paused&&this.videoElement.play()},b.prototype.pause=function(){this.videoElement.paused||this.videoElement.pause()},b.prototype.stop=function(){this.pause(),this.currentTime(0)},b.prototype.load=function(){this.videoElement.load()},b.prototype.currentTime=function(){return 1===arguments.length&&(this.videoElement.currentTime=+arguments[0]),+this.videoElement.currentTime||0},b.prototype.volume=function(){return 1===arguments.length&&(this.videoElement.volume=+arguments[0]),+this.videoElement.volume},b.prototype.duration=function(){return+this.videoElement.duration||0},b.prototype.seeking=function(){return this.videoElement.seeking},b.prototype.requestFullscreen=function(){var a=this.videoElement;this.containerElement&&(a=this.containerElement),a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen()},b.prototype.exitFullscreen=function(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.webkitExitFullscreen?window.document.webkitExitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen&&window.document.msExitFullscreen()},b.prototype.setAttribute=function(a,b){this.videoElement.setAttribute(a,b)},b.prototype.setAttributes=function(a){for(var b in a)this.setAttribute(b,a[b])},b.prototype.offsetWidth=function(){return this.containerElement?this.containerElement.offsetWidth:0},b.prototype.offsetHeight=function(){return this.containerElement?this.containerElement.offsetHeight:0},b.prototype.getAttribute=function(a){return this.videoElement.getAttribute(a)},b.prototype.showCaptions=function(){this.isLive()?this.videoElement.textTracks.length>1&&(this.videoElement.textTracks[1].mode=g):this.tt.mode=g},b.prototype.hideCaptions=function(){this.isLive()?this.videoElement.textTracks.length>1&&(this.videoElement.textTracks[1].mode=h):this.tt.mode=h},b.prototype.showControls=function(){this.videoElement.controls=!a.configuration.useCustomControls},b.prototype.hideControls=function(){this.videoElement.controls=!1},b.prototype.isLive=function(){return 1===arguments.length&&(this.contentIsLive=arguments[0]),this.contentIsLive},b.prototype.getErrorCode=function(){return this.videoElement.error.code},b.prototype.hasCaptions=function(){return this.captions.length>1},b.prototype.getVideoElement=function(){return this.videoElement},b.prototype.placeVideo=function(a){null===this.containerElement&&(this.containerElement=a,this.containerElement.appendChild(this.videoElement),this.showControls(),this.setAttributes({preload:"metadata","x-webkit-airplay":"allow",style:"height: 100%; width: 100%"}))},b.prototype.setAdState=function(a){this.isAdState=a,this.notify(new d(d.SWITCH_ADAPTERS))},b.prototype.inAdState=function(){return this.isAdState},b.prototype.addVideoListeners=function(){for(var a in j)this.videoElement.addEventListener(a,this.handleEvent)},b.prototype.processEvent=function(a){var b=j[a.type];b&&this.notify(new d(b))},b.prototype.setCaptions=function(a){this.captions.length=0,this.ttMode=this.tt.mode,e.getFile(a,this.srtResponseHandler)},b.prototype.createCaptions=function(){var a=this.captions.length;for(this.ttMode===g||this.tt.cues||(this.tt.mode=h),this.tt.cues.length>0&&this.removeCaptions();a--;)this.tt.addCue(this.captions[a]);return this.hasCaptions()},b.prototype.removeCaptions=function(){for(var a=this.tt.cues||[],b=a.length;b--;)this.tt.removeCue(a[b])},b.prototype.adCompleteAction=function(){},a.NativeSingleton=b}(window.$ndp),function(a,b){function c(){e.call(this),this.hls=new b({debug:!1}),f=!!b.isSupported()}var d=a.console;if(!window.Hls)return void d.warn("HLS WAS NOT LOADED.");var e=a.NativeSingleton,f=(a.AbstractObserver,!1),g=!1,h=!1,i=!1,j=a.events.VideoEvent,k=(a.SRTParser,{error:j.VIDEO_ERROR,emptied:j.EMPTIED,abort:j.ABORT,play:j.PLAY,playing:j.PLAYING,pause:j.PAUSE,timeupdate:j.PROGRESS,ended:j.COMPLETE,seeking:j.SEEK,seeked:j.SEEKED,volumechange:j.VOLUME},{MEDIA_ATTACHED:b.Events.MEDIA_ATTACHED,MEDIA_ATTACHING:b.Events.MEDIA_ATTACHING,MEDIA_DETACHED:b.Events.MEDIA_DETACHED,MEDIA_DETACHING:b.Events.MEDIA_DETACHING,MANIFEST_LOADED:b.Events.MANIFEST_LOADED,MANIFEST_LOADING:b.Events.MANIFEST_LOADING,MANIFEST_PARSED:b.Events.MANIFEST_PARSED,LEVEL_LOADED:b.Events.LEVEL_LOADED,LEVEL_LOADING:b.Events.LEVEL_LOADING,LEVEL_UPDATED:b.Events.LEVEL_UPDATED,FRAG_LOADED:b.Events.FRAG_LOADED,FRAG_PARSING_METADATA:b.Events.FRAG_PARSING_METADATA,FRAG_BUFFERED:b.Events.FRAG_BUFFERED,DESTROYING:b.Events.DESTROYING,ERROR:b.Events.ERROR}),l={MEDIA_ERROR:b.ErrorTypes.MEDIA_ERROR,NETWORK_ERROR:b.ErrorTypes.NETWORK_ERROR,OTHER_ERROR:b.ErrorTypes.OTHER_ERROR};c.prototype=Object.create(e.prototype,{constructor:{value:c},__super:{value:e.prototype}}),c.constructor=e.prototype.constructor,c.prototype.adCompleteAction=function(){if(this.isLive()){this.detachMedia(this.contentURL);var a=!0;this.loadSource(a)}},c.prototype.src=function(){return arguments.length?(d.info("HlsSingleton.src",this),g?(this.detachMedia(arguments[0]),this.contentURL):(this.switchMedia.apply(this,arguments),this.contentURL)):this.contentURL},c.prototype.restartFromAd=function(){return d.debug("*** HlsSingleton.prototype.restartFromAd ****","isLive?",this.isLive()),this.isLive()?(this.createCaptions(),this.showControls(),void this.play()):void this.__super.restartFromAd.call(this)},c.prototype.play=function(){this.isLive()&&!h&&(i=!0),this.videoElement.paused&&this.videoElement.play()},c.prototype.loadSource=function(a){d.info("HlsSingleton.loadSource",this.contentURL);var b=this,c=function(a,e){b.hls.off(k.MANIFEST_PARSED,c),d.info("HlsSingleton.loadSource"),h=!0,i&&b.play()};h=i=!1,a===!0&&(i=!0),this.hls.on(k.MANIFEST_PARSED,c),this.hls.loadSource(this.contentURL)},c.prototype.attachMedia=function(){this.contentURL=arguments[0],this.removeCaptions();var a=this,b=function(c,e){a.hls.off(k.MEDIA_ATTACHED,b),d.info("HlsSingleton.attachMedia"),g=!0,a.loadSource()};this.hls.on(k.MEDIA_ATTACHED,b),this.hls.attachMedia(this.videoElement)},c.prototype.detachMedia=function(a){var b=this,c=function(e,f){b.hls.off(k.MEDIA_DETACHED,c),d.info("HlsSingleton.detachMedia"),g=!1,h=!1,b.switchMedia(a)};this.hls&&this.videoElement&&(this.hls.on(k.MEDIA_DETACHED,c),this.hls.detachMedia())},c.prototype.switchMedia=function(a){this.pause(),d.info("HlsSingleton.switchMedia",this.contentIsLive&&!!a),this.isLive()?this.attachMedia(a):this.__super.src.apply(this,arguments)},c.prototype.addHandlers=function(){for(var a in k)this.hls.on(k[a],this.eventHandler)},c.prototype._eventHandler=function(a,b){d.log("HLS EVENT :: "+Date.now(),a,b)},c.prototype._errorHandler=function(a,c){var e=(b.ErrorDetails,c.type);c.details,c.fatal;switch(d.error(e,a,c),e){case l.NETWORK_ERROR:this.hls.startLoad();break;case l.MEDIA_ERROR:this.hls.recoverMediaError();break;default:this.hls.destroy()}},c.prototype.setConfiguration=function(){var a={debug:!1};a.autoStartLoad=!0,a.startPosition=-1,a.defaultAudioCodec=void 0,a.capLevelToPlayerSize=!1,a.startFragPrefech=!1,a.liveMaxLatencyDurationCount=10,a.liveSyncDurationCount=3,a.maxBufferLength=30,a.maxMaxBufferLength=600,a.maxBufferSize=6e7,a.maxBufferHole=.5,a.maxSeekHole=2,a.maxFragLookUpTolerance=.2,a.seekHoleNudgeDuration=.01,a.enableSoftwareAES=!0,a.enableWorker=!0,a.manifestLoadingTimeOut=1e4,a.manifestLoadingMaxRetry=6,a.manifestLoadingRetryDelay=500,a.levelLoadingTimeOut=1e4,a.levelLoadingMaxRetry=6,a.levelLoadingRetryDelay=500,a.fragLoadingTimeOut=2e4,a.fragLoadingMaxRetry=6,a.fragLoadingRetryDelay=500,a.appendErrorMaxRetry=3,a.enableCEA708Captions=!0,a.stretchShortVideoTrack=!1,a.forceKeyFrameOnDiscontinuity=!0;return a},a.NativeSingleton=c}(window.$ndp,window.Hls),function(a){var b={LOAD:["loadTransition"],LOADED:["loadedTransition"],WAIT:["adwaitTransition"],START:["startTransition"],PLAY:["playTransition"],PAUSE:["pauseTransition"],STOP:["stopTransition"],SEEK:["seekTransition"],SEEKED:["seekedTransition"],PROGRESS:["progressTransition"],VOLUME:["volumeTransition"],LOCK:["lockTransition"],UNLOCK:["unlockTransition"],COMPLETE:["completeTransition"],ADCOMPLETE:["adcompleteTransition"],NOAD:["noadTransition"]};a.states=a.states||{},a.states.Transitions=b,a.NativeSingleton=new a.NativeSingleton}(window.$ndp),function(a){function b(a){this.parent=a,this.transitions={},this.handler=function(a){return function(b){a.__processEvent(b)}}(this)}var c=a.events.CommandEvent,d=a.NativeSingleton;b.prototype.enter=function(){this.__toggleHandlers(!0)},b.prototype.exit=function(){this.__toggleHandlers(!1)},b.prototype.handleCommand=function(b){var e=d;switch(arguments.length&&arguments[1]&&(e=arguments[1],a.console.debug("*** ActiveState.handleCommand :: AdInstance ***",arguments[1])),a.console.debug("*** ActiveState.handleCommand ***",b,e),b.getType()){case c.PLAY:e.play();break;case c.LOAD:case c.PAUSE:e.pause();break;case c.STOP:d.stop();break;case c.SETVOLUME:e.volume(b.getVolume());break;case c.SETPLAYHEAD:d.currentTime(d.duration()*b.seekTo());break;case c.FULLSCREEN:b.payload.fullscreen?d.requestFullscreen():d.exitFullscreen();break;case c.CAPTION:b.isCaption()?d.showCaptions():d.hideCaptions()}},b.prototype.__toggleHandlers=function(a){var b=a===!0?"addListener":"removeListener";for(var c in this.transitions)d[b](c,this.handler)},b.prototype.__processEvent=function(a){var b=d.duration(),c=this.transitions[a.type],e={};return!(c===$ndp.states.Transitions.START&&d.currentTime()===b&&!d.isLive())&&void this.parent.stateUpdate(c,e)},a.states=a.states||{},a.states.Active=b}(window.$ndp),function(a){function b(a){b.constructor.call(this,a),this.transitions=f}var c=a.states.Active,d=a.states.Transitions,e=a.events.VideoEvent,f={};f[e.PLAYING]=d.START,f[e.VOLUME_CHANGE]=d.VOLUME,b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,a.states.Loaded=b}(window.$ndp),function(a){function b(a){b.constructor.call(this,a),this.transitions=g}var c=a.states.Active,d=a.states.Transitions,e=a.NativeSingleton,f=a.events.VideoEvent,g={};g[f.PLAY]=d.PLAY,g[f.PAUSE]=d.PAUSE,g[f.PROGRESS]=d.PROGRESS,g[f.COMPLETE]=d.COMPLETE,g[f.SEEK]=d.SEEK,g[f.VOLUME_CHANGE]=d.VOLUME,b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.enter=function(){this.__super.enter.call(this),e.addListener(f.STALLED,this.onStallHandler),e.inAdState()?e.hideControls():e.showControls()},b.prototype.exit=function(){this.__super.exit.call(this),e.removeListener(f.STALLED,this.onStallHandler)},b.prototype.onStallHandler=function(){e.play()},b.prototype.__canProcess=function(a){var b=a.type,c=!0;return b===f.PAUSE&&e.currentTime()===e.duration()?c=!1:b!==f.PAUSE&&b!==f.PLAY||e.seeking()!==!0||(c=!1),c},b.prototype.__processEvent=function(a){this.__canProcess(a)&&this.__super.__processEvent.call(this,a)},a.states.Play=b}(window.$ndp),function(a){function b(a){b.constructor.call(this,a),this.transitions=f}var c=a.states.Active,d=a.states.Transitions,e=a.events.VideoEvent,f={};f[e.PLAY]=d.PLAY,f[e.PAUSE]=d.PAUSE,f[e.SEEK]=d.SEEK,b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,a.states.Idle=b}(window.$ndp),function(a){function b(a){b.constructor.call(this,a),this.transitions=f}var c=a.states.Active,d=a.states.Transitions,e=a.events.VideoEvent,f={};f[e.SEEKED]=d.SEEKED,b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,a.states.Seek=b}(window.$ndp),function(a){function b(a){this.parent=a,this.commandQueue=[]}b.prototype.enter=function(){this.commandQueue.length=0},b.prototype.exit=function(){return this.commandQueue},b.prototype.handleCommand=function(a){this.commandQueue.push(a)},a.states=a.states||{},a.states.Inactive=b}(window.$ndp),function(a){function b(a){this.parent=a,b.constructor.call(this,a)}var c=a.states,d=c.Inactive,e=c.Transitions,f=a.MPXMediaAsset,g=(a.events.VideoEvent,a.NativeSingleton);b.prototype=new d,b.prototype.__super=d.prototype,b.prototype.constructor=b,b.constructor=d.prototype.constructor,b.prototype.enter=function(a){this.__super.enter.call(this);var b=a instanceof f&&!a.isLiveMedia,c=b?a.getVideoData():{url:a.getURL(),isLiveMedia:a.isLiveMedia};g.pause(),g.isLive(c.isLiveMedia),g.src(c.url),g.setCaptions(c.cc||""),this.parent.stateUpdate(e.LOADED,{})},b.prototype.exit=function(){return this.__super.exit.call(this)},a.states.Load=b}(window.$ndp),function(a){function b(a){this.parent=a,this.previousState=null}var c=a.states.Inactive;b.prototype=new c,b.prototype.__super=c.prototype,b.prototype.constructor=b,b.constructor=c.prototype.constructor,b.prototype.enter=function(){this.__super.enter.call(this),this.previousState=this.parent.previousState},b.prototype.exit=function(){return this.parent.previousState=this.previousState,this.__super.exit.call(this)},a.states=a.states||{},a.states.Locked=b}(window.$ndp),function(a,b){function c(a){g.warn("*** AdLoadState Initialized ***"),c.constructor.call(this,a),this.positions={pre:[],mid:[],post:[],overlay:[]},this.adAbandonmentTracker=0,this.onRequestCompleteHandler=function(a){return function(b){a.parent.parent.notify(new e(e.REQUEST_END,{})),a.__transitionReady(b)}}(this),this.forceViewportUpdate=function(a){return function(b){a.adContext.registerVideoDisplayBase(a.containerId)}}(this)}if(b){var d=(a.events.AdEvent,a.events.CommandEvent),e=a.events.PerfEvent,f=!1,g=a.console,h=a.states,i=h.Inactive,j=h.Transitions,k=a.NativeSingleton;c.prototype=new i,c.prototype.__super=i.prototype,c.prototype.constructor=c,c.constructor=i.prototype.constructor,c.prototype.enter=function(a){this.__super.enter.call(this);var b=1,c=this;setTimeout(function(){k.showPreroll()?(c.__createAdContext(a.config),c.parent.parent.addListener(d.UPDATEDISPLAYBASE,c.forceViewportUpdate),c.parent.parent.notify(new e(e.REQUEST_START,{})),k.setAdState(!0),c.adContext.registerVideoDisplayBase(a.container.id),c.containerId=a.container.id,c.adContext.submitRequest(a.config.requestTimeout),c.parent.__initAdVerification(),c.adAbandonmentTracker=window.setTimeout(function(){c.skipAd()},c.parent.adMoniter.threshold()),f=!0):(g.debug("*** AdLoadState Enter => Exit :: showPreroll***"),c.exit(),c.parent.lockedState.enter(),c.parent.__playVideoAsset())},b)},c.prototype.skipAd=function(){this.exit(),this.parent.__clearAdVerification(),this.parent.__skipAdReport()},c.prototype.exit=function(){return this.adAbandonmentTracker&&clearTimeout(this.adAbandonmentTracker),this.adContext&&this.adContext.removeEventListener(b.EVENT_REQUEST_COMPLETE,this.onRequestCompleteHandler),this.__super.exit.call(this)},c.prototype.__createAdContext=function(c){this.adContext&&this.adContext.previousSlot&&(g.warn("*** AdLoadState.__createAdContext ***","AdManager Context: Clear Slots & Dispose."),this.adContext.previousSlot.stop(),this.adContext.dispose()),this.adContext=c.adManager.newContext(),this.adContext.setProfile(c.profileId),this.adContext.setVideoAsset(c.assetId,c.duration,c.networkId,null,null,null,null,c.fallbackId),this.adContext.setSiteSection(c.siteSectionId,c.networkId,null,null,c.siteSectionFallbackId),this.__addKeyValues(c.siteData),this.adContext.addEventListener(b.EVENT_REQUEST_COMPLETE,this.onRequestCompleteHandler),this.adContext.setParameter(b.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE,!a.configuration.useCustomControls,b.PARAMETER_LEVEL_GLOBAL)},c.prototype.__addKeyValues=function(a){if(a){var b,c,d;for(b in a)if(c=a[b],"string"==typeof c)this.adContext.addKeyValue(b,c);else if("kxsegs"===b)for(d in c)this.adContext.addKeyValue("ksg",c[d].ksg)}},c.prototype.__transitionReady=function(a){this.positions={pre:[],mid:[],post:[],overlay:[]},a.success?(this.positions.pre=this.adContext.getSlotsByTimePositionClass(b.TIME_POSITION_CLASS_PREROLL)||[],this.positions.pre.length>0&&(this.adContext.previousSlot=this.positions.pre[0]),this.parent.stateUpdate(j.LOADED,{positions:this.positions,context:this.adContext})):(g.error("TIME_POSITION_CLASS_PREROLL has FAILED"),this.parent.stateUpdate(j.NOAD,{}))},a.states.AdLoad=c}}(window.$ndp,window.tv&&window.tv.freewheel&&window.tv.freewheel.SDK),function(a){function b(a){b.constructor.call(this,a)}var c=a.events.CommandEvent,d=a.states.Active,e=a.NativeSingleton,f=a.events.VideoEvent;b.prototype=new d,b.prototype.__super=d.prototype,b.prototype.constructor=b,b.constructor=d.prototype.constructor,b.prototype.enter=function(a){this.__super.enter.call(this),this.ad=a,e.addListener(f.ABORT,this.onAbortHandler,this)},b.prototype.exit=function(){this.__super.exit.call(this),e.removeListener(f.ABORT,this.onAbortHandler,this)},b.prototype.onAbortHandler=function(){a.console.error("ABORT",":: MEDIA_ERROR :: Media ended unexpectedly",this),this.ad.stop(),this.parent.__restartContent()},b.prototype.handleCommand=function(a){a.getType()===c.PLAY&&this.ad.play()},a.states.AdReady=b}(window.$ndp),function(a){function b(){switch(document.readyState){case"interactive":case"loaded":case"complete":document.removeEventListener("readystatechange",b),c(),"ontouchstart"in window&&document.addEventListener("touchstart",d)}}function c(){u.setAttribute("style","left:-9999px;height:1px;width:1px;position:absolute;"),document.body.appendChild(u.getVideoElement())}function d(){u.play(),document.removeEventListener("touchstart",d)}function e(b,c){this.parent=b,this.currentAsset=null,this.container=c;var d=new o(this),e=new p(this);this.states={},this.states[r.LOAD]=new m(this),this.states[r.LOADED]=new n(this),this.states[r.SEEK]=new q(this),this.states[r.START]=e,this.states[r.PLAY]=e,this.states[r.VOLUME]=e,this.states[r.PAUSE]=d,this.states[r.STOP]=d,this.states[r.COMPLETE]=d,this.lockedState=new l(this),this.currentState=null,this.previousState=null,this.onVideoError=function(b){return function(){var c,d,e;switch(u.getErrorCode()){case MediaError.MEDIA_ERR_NETWORK:c=j.NETWORK_ERROR,e="Network connection was not properly established";break;case MediaError.MEDIA_ERR_DECODE:case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:c=j.MEDIA_ERROR,e="Media failed to load correctly, MediaAssetID: "+b.currentAsset.getID()}c&&u.src()===b.src&&(a.console.error(c,":: MEDIA_ERROR :: Media failed to load correctly"),d=new j(c,{error:e}),b.parent.notify(d))}}(this),this.__render(),this.__addHandlers();var f="fullscreenchange",g="";document.webkitFullscreenEnabled?g="webkit":document.mozFullScreenEnabled?g="moz":document.msFullscreenEnabled&&(f="FullscreenChange",g="MS"),document.addEventListener(g+f,function(a,b){var c=!1;switch(b){case"webkit":c=document.webkitIsFullScreen;break;case"moz":c=document.mozIsFullScreen;break;case"MS":c=null!==document.msFullscreenElement;break;default:c=document.isFullScreen}return function(b){a.parent.notify(new i(i.FULLSCREEN,{fullscreen:c}))}}(this,g))}a.console;a.playbackAdapter="native";var f=a.isDebug(),g=a.events.CommandEvent,h=a.events.SystemEvent,i=a.events.PlaybackEvent,j=a.events.ErrorEvent,k=a.events.VideoEvent,l=a.states.Locked,m=a.states.Load,n=a.states.Loaded,o=a.states.Idle,p=a.states.Play,q=a.states.Seek,r=a.states.Transitions,s=a.AdapterFactory,t=a.MediaAsset,u=a.NativeSingleton,v={};v[r.LOADED]=i.LOADED,v[r.START]=i.START,v[r.PLAY]=i.PLAY,v[r.PAUSE]=i.PAUSE,v[r.PROGRESS]=i.PROGRESS,v[r.COMPLETE]=i.COMPLETE,v[r.SEEKED]=i.SEEK,v[r.VOLUME]=i.VOLUME_CHANGE,a.__has(["complete","loaded","interactive"],document.readyState)?b():document.addEventListener("readystatechange",b),e.canHandle=function(a){return a instanceof t},e.prototype.destroy=function(){this.__removeHandlers(),this.queuedEvents.length=0,this.container=null,this.parent=null},e.prototype.handleLoad=function(a){null!==this.currentAsset&&a.getAsset().getID()===this.currentAsset.getID()||(null!==this.currentState&&this.currentState.exit(),this.currentAsset=a.getAsset(),this.currentState=this.states[r.LOAD],this.currentState.enter(this.currentAsset))},e.prototype.handleCommand=function(a){this.currentState.handleCommand(a)},e.prototype.stateUpdate=function(a,b){var c=this.states[a];switch(a){case r.START:u.createCaptions();break;case r.SEEKED:c=this.previousState;break;case r.UNLOCK:return void this.__handleUnlock()}this.__switchStates(c),this.__processTransitionEvent(a,b)},e.prototype.__handleLock=function(){this.currentState!==this.lockedState&&(this.currentState.exit(),this.lockedState.enter(),this.previousState=this.currentState,this.currentState=this.lockedState)},e.prototype.__handleUnlock=function(){this.currentState===this.lockedState&&(this.currentState=this.previousState,this.lockedState.exit(),this.currentState.enter())},e.prototype.__switchStates=function(b){var c;b&&(this.previousState=this.currentState||null,c=this.previousState.exit(),this.currentState=b,f&&(a.DataStore.currentState=b),this.currentState.enter(),this.__processQueuedCommands(c))},e.prototype.__processQueuedCommands=function(a){if(a)for(var b;a.length;)b=a.shift(),b.getType()===g.LOAD?this.handleLoad(b):this.currentState.handleCommand(b)},e.prototype.__processTransitionEvent=function(b,c){var d=v[b];d&&(c=a.__extend(c,{asset:this.currentAsset,native:u.getVideoElement(),playheadPosition:Math.ceil(1e3*u.currentTime()),totalLength:Math.ceil(1e3*u.duration()),volume:u.volume(),isLive:u.isLive()}),this.parent.notify(new i(d,c)))},e.prototype.toggleLock=function(a){u.inAdState()?this.__handleLock():u.inAdState()||this.__handleUnlock()},e.prototype.__addHandlers=function(){this.parent.addListener(g.LOAD,this.handleLoad,this),this.parent.addListener(g.PLAY,this.handleCommand,this),this.parent.addListener(g.PAUSE,this.handleCommand,this),this.parent.addListener(g.STOP,this.handleCommand,this),this.parent.addListener(g.SETPLAYHEAD,this.handleCommand,this),this.parent.addListener(g.FULLSCREEN,this.handleCommand,this),this.parent.addListener(g.SETVOLUME,this.handleCommand,this),this.parent.addListener(g.CAPTION,this.handleCommand,this),u.addListener(h.VIDEO_ERROR,this.onVideoError,this),u.addListener(k.SWITCH_ADAPTERS,this.toggleLock,this),u.addListener(i.HAS_CAPTIONS,this.forwardEvent,this)},e.prototype.__removeHandlers=function(){this.parent.removeListener(g.LOAD,this.handleLoad,this),this.parent.removeListener(g.PLAY,this.handleCommand,this),this.parent.removeListener(g.PAUSE,this.handleCommand,this),this.parent.removeListener(g.STOP,this.handleCommand,this),this.parent.removeListener(g.SETVOLUME,this.handleCommand,this),this.parent.removeListener(g.SETPLAYHEAD,this.handleCommand,this),this.parent.removeListener(g.FULLSCREEN,this.handleCommand,this),this.parent.removeListener(g.CAPTION,this.handleCommand,this),u.removeListener(h.VIDEO_ERROR,this.onVideoError,this),u.removeListener(k.SWITCH_ADAPTERS,this.toggleLock,this),u.removeListener(i.HAS_CAPTIONS,this.forwardEvent,this)},e.prototype.forwardEvent=function(a){this.parent.notify(a)},e.prototype.setVideoSrc=function(a){u.setVideoSrc(a)},e.prototype.__render=function(){c=function(){},u.placeVideo(this.container),this.container.setAttribute("style","height: 100%");var a=new h(h.PLAYER_LOADED,{});a.autoDispatch=!0,this.parent.notify(a)},s.add(e)}(window.$ndp),function(a,b){function c(a,b){this.parent=a,this.container=b,this.videoElement=s.getVideoElement(),this.captions=[],this.currentAd=null,this.slotPositions=null,this.isFullScreen=!1,this.emptiedCount=0,this.adMoniter={tracker:0,threshold:function(){return parseInt(t.requestTimeout)||5e3},startTime:0},this.onAdClickedHandler=function(a){return function(){a.handleCommand(new g(g.PAUSE,{}))}}(this),this.onAdHandler=function(a){return function(b){a.__onAdEvent(b)}}(this),this.onSlotStarted=function(a){return function(b){a.__onSlotStarted(b)}}(this),this.onSlotEnded=function(a){return function(b){a.__onSlotEnded(b,a.slotPositions)}}(this),this.fullscreenHandler=function(){s.showControls()},this.currentAdState=function(){return arguments.length&&(e.log("[CURRENT AD STATE] Updated",arguments[0]),f=arguments[0]),f},this.__addHandlers(),this.initStates()}if(b){var d=a.isDebug(),e=a.console,f=null,g=a.events.CommandEvent,h=(a.events.SystemEvent,a.events.AdEvent),i=a.events.VideoEvent,j=a.events.ErrorEvent,k=a.states.Locked,l=a.states.AdLoad,m=a.states.AdReady,n=a.states.Idle,o=a.states.Play,p=a.states.Transitions,q={};q[p.LOADED]=h.LOADED,q[p.START]=h.START,q[p.PLAY]=h.PLAY,q[p.PAUSE]=h.PAUSE,q[p.PROGRESS]=h.PROGRESS,q[p.ADCOMPLETE]=h.COMPLETE,q[p.NOAD]=h.NOPREROLL,q[p.VOLUME]=h.VOLUME_CHANGE;var r=a.AdapterFactory,s=a.NativeSingleton,t=a.configuration.freewheel,u="missing guid",v=500,w=new b.AdManager;w.setNetwork(t.network),w.setServer(t.url),b.setLogLevel(t.logLevel||b.LOG_LEVEL_QUIET),c.prototype.initStates=function(){var a=new n(this),b=new o(this);this.states={},this.states[p.LOAD]=new l(this),this.states[p.LOADED]=new m(this),this.states[p.START]=b,this.states[p.PLAY]=b,this.states[p.VOLUME]=b,this.states[p.PAUSE]=a,this.states[p.STOP]=a,this.states[p.ADCOMPLETE]=a,this.states[p.NOAD]=a,this.lockedState=new k(this),this.currentState=this.lockedState,this.previousState=null},c.prototype.destroy=function(){this.__removeHandlers(),this.__destroyAdContext(),this.adContext=null,this.onAdClickedHandler=null,this.container=null,this.videoElement=null,this.parent=null},c.canHandle=function(b){return b===a.adapterTypes.AD},c.prototype.handleCommand=function(a){var b=!1;this.currentAd&&(b={play:this.currentAd.resume,pause:this.currentAd.pause,volume:this.adContext&&this.adContext.setAdVolume.bind(this.adContext)}),this.currentState.handleCommand(a,b)},c.prototype.handleLoad=function(){this.__removeAdHandlers(),this.__clearAdVerification(),this.currentState.exit(),this.__handleUnlock()},c.prototype.__skipAd=function(){this.currentAd?this.currentAd.skipCurrentAd():this.__restartContent(),this.__skipAdReport()},c.prototype.__skipAdReport=function(){var a=new Date;this.__adErrorReport(h.ADSKIP,"The ad render had been abandoned at "+(a-this.adMoniter.startTime)+" milliseconds.")},c.prototype.__initAdVerification=function(){this.__clearAdVerification(),this.adMoniter.startTime=new Date;var a=this;this.adMoniter.tracker=window.setTimeout(function(){a.__triggerAdTimeout()},this.adMoniter.threshold())},c.prototype.__clearAdVerification=function(){this.adMoniter.tracker&&window.clearTimeout(this.adMoniter.tracker)},c.prototype.__triggerAdTimeout=function(){this.__clearAdVerification(),this.__skipAd()},c.prototype.__adErrorReport=function(b,c){var d=this.currentAdState(),e={state:d,positions:a.__cloneObjToJson(this.slotPositions),context:a.__cloneObjToJson(this.adContext)},f=new j(h.ERROR,{error:b,description:c||"",fw_ads:e});this.parent.notify(f)},c.prototype.stateUpdate=function(a,b){this.slotPositions=b.positions||null;var c=this.states[a];switch(a){case p.UNLOCK:return void this.__handleUnlock();case p.START:this.__clearAdVerification(),s.removeCaptions(),this.setControlsTrue();break;case p.LOADED:if(this.adContext=b.context,!(this.currentAd=b.positions.pre.shift()))return this.__restartContent();this.__addAdHandlers();break;case p.LOCK:return void this.__handleLock();case p.ADCOMPLETE:this.adContext&&this.adContext.previousSlot&&this.adContext.previousSlot.stop()}this.__switchStates(c),this.__processTransitionEvent(a,b),p.ADCOMPLETE!==a&&p.NOAD!==a||this.__restartContent()},c.prototype.__restartContent=function(){var a=this;s.setAdState(!1),this.__clearAdVerification(),this.__handleLock(),setTimeout(function(){a.__playVideoAsset()},1)},c.prototype.__playVideoAsset=function(){s.restartFromAd()},c.prototype.__processTransitionEvent=function(b,c){var d=q[b];if(d){var e=0,f=0,g=s.getVideoElement(),i=s.volume();this.currentAd&&(e=this.currentAd.getTotalDuration(),f=this.currentAd.getPlayheadTime(),g=this.adContext.getContentVideoElement(),i=this.adContext.getAdVolume()),c=a.__extend(c,{native:g,playheadPosition:Math.ceil(1e3*f),totalLength:Math.ceil(1e3*e),volume:i,banners:{}}),this.parent.notify(new h(q[b],c))}},c.prototype.__handleLock=function(){this.currentState.exit(),this.currentState!==this.lockedState&&(e.debug("NativeFreewheelAdapter.__handleLock",this.currentState,this.adContext),s.addListener(i.PLAY,this.__updateContentState,this),s.addListener(i.PAUSE,this.__updateContentState,this),s.addListener(i.COMPLETE,this.__updateContentState,this),this.lockedState.enter(),this.previousState=this.currentState,this.currentState=this.lockedState,this.adContext&&this.__removeAdHandlers())},c.prototype.__handleUnlock=function(){var a=this.lockedState.exit();this.videoElement.addEventListener("webkitbeginfullscreen",this.fullscreenHandler),this.videoElement.addEventListener("webkitendfullscreen",this.fullscreenHandler),s.removeListener(i.PLAY,this.__updateContentState,this),s.removeListener(i.PAUSE,this.__updateContentState,this),s.removeListener(i.COMPLETE,this.__updateContentState,this),this.currentState=this.states[p.LOAD],this.currentState.enter({container:this.container,config:this.__getAdConfiguration()}),this.__processQueuedCommands(a)},c.prototype.__updateContentState=function(a){if(this.adContext)switch(a.getType()){case i.PLAY:this.adContext.setVideoState(b.VIDEO_STATE_PLAYING);break;case i.PAUSE:this.adContext.setVideoState(b.VIDEO_STATE_PAUSED);break;case i.COMPLETE:this.adContext.setVideoState(b.VIDEO_STATE_STOPPED),this.adContext.setVideoState(b.VIDEO_STATE_COMPLETED),this.currentAdState(null)}},c.prototype.__getAdConfiguration=function(){var b={adManager:w,profileId:t.playerProfile.replace("{runtime}","html5"),assetId:u,duration:v,fallbackId:t.videoAssetFallbackID,networkId:t.network,siteSectionId:t.siteSection,siteSectionFallbackId:t.siteSectionFallbackID,requestTimeout:t.requestTimeout/1e3+2};return a.configuration.siteData?(b.siteData=a.configuration.siteData,b.siteSectionId=a.configuration.siteData.siteSection):b.siteData={},a.DataStore.mediaAsset&&a.DataStore.mediaAsset.raw&&a.DataStore.mediaAsset.raw.duration&&!a.DataStore.mediaAsset.isLiveMedia&&(b.duration=a.DataStore.mediaAsset.raw.duration),a.DataStore&&a.DataStore.currentGuid&&(b.assetId=a.DataStore.currentGuid),b},c.prototype.__switchStates=function(b){var c;b&&(this.previousState=this.currentState||null,c=this.previousState.exit(),d&&(a.DataStore.currentState=b),this.currentState=b,this.currentState.enter(this.currentAd),this.__processQueuedCommands(c))},c.prototype.__processQueuedCommands=function(a){if(a)for(var b;a.length;)b=a.shift(),this.handleCommand(b),b.getType()===g.LOAD&&this.__handleUnlock()},c.prototype.__destroyAdContext=function(){this.__clearAdVerification(),this.adContext&&(this.__removeAdHandlers(),this.adContext.dispose(),this.adContext=null)},c.prototype.toggleLock=function(a){!this.emptiedCount||a.payload.isAdState&&this.currentState===this.lockedState?(this.__handleUnlock(),this.emptiedCount++):a.payload.isAdState||(this.__handleLock(),this.emptiedCount=0)},c.prototype.__addHandlers=function(){this.parent.addListener(g.LOAD,this.handleLoad,this),this.parent.addListener(g.PLAY,this.handleCommand,this),this.parent.addListener(g.PAUSE,this.handleCommand,this),this.parent.addListener(g.SETVOLUME,this.handleCommand,this),
this.parent.addListener(g.SETPLAYHEAD,this.handleCommand,this),this.parent.addListener(g.FULLSCREEN,this.handleCommand,this),s.addListener(i.ERROR,this.__restartContent,this)},c.prototype.__removeHandlers=function(){this.parent.removeListener(g.LOAD,this.handleLoad,this),this.parent.removeListener(g.PLAY,this.handleCommand,this),this.parent.removeListener(g.PAUSE,this.handleCommand,this),this.parent.removeListener(g.SETVOLUME,this.handleCommand,this),this.parent.removeListener(g.SETPLAYHEAD,this.handleCommand,this),this.parent.removeListener(g.FULLSCREEN,this.handleCommand,this),s.removeListener(i.ERROR,this.__restartContent,this),this.videoElement.removeEventListener("webkitbeginfullscreen",this.fullscreenHandler),this.videoElement.removeEventListener("webkitendfullscreen",this.fullscreenHandler)},c.prototype.__addAdHandlers=function(){this.adContext&&(this.adContext.addEventListener(b.EVENT_AD_CLICK,this.onAdClickedHandler),this.adContext.addEventListener(b.EVENT_AD,this.onAdHandler),this.adContext.addEventListener(b.EVENT_SLOT_STARTED,this.onSlotStarted),this.adContext.addEventListener(b.EVENT_SLOT_ENDED,this.onSlotEnded),this.adContext.addEventListener(b.EVENT_AD_MUTE,this.onAdHandler),this.adContext.addEventListener(b.EVENT_AD_UNMUTE,this.onAdHandler),this.adContext.addEventListener(b.EVENT_AD_PAUSE,this.onAdHandler),this.adContext.addEventListener(b.EVENT_AD_RESUME,this.onAdHandler))},c.prototype.__removeAdHandlers=function(){this.adContext&&(this.adContext.removeEventListener(b.EVENT_AD_CLICK,this.onAdClickedHandler),this.adContext.removeEventListener(b.EVENT_AD,this.onAdHandler),this.adContext.removeEventListener(b.EVENT_SLOT_STARTED,this.onSlotStarted),this.adContext.removeEventListener(b.EVENT_SLOT_ENDED,this.onSlotEnded),this.adContext.removeEventListener(b.EVENT_AD_MUTE,this.onAdHandler),this.adContext.removeEventListener(b.EVENT_AD_UNMUTE,this.onAdHandler),this.adContext.removeEventListener(b.EVENT_AD_PAUSE,this.onAdHandler),this.adContext.removeEventListener(b.EVENT_AD_RESUME,this.onAdHandler))},c.prototype.__onSlotStarted=function(a){var c=a.slot;c.getTimePositionClass()===b.TIME_POSITION_CLASS_PREROLL&&c.getState()instanceof b.MediaPlayingState&&this.stateUpdate(p.START,{})},c.prototype.__onSlotEnded=function(c){var d=c.slot;this.__clearAdVerification(),d.getTimePositionClass()===b.TIME_POSITION_CLASS_PREROLL&&(d.getState()instanceof b.MediaEndState?(a.NativeSingleton.adCompleteAction(),this.stateUpdate(p.ADCOMPLETE,{})):this.__restartContent())},c.prototype.__onAdEvent=function(a){var c=a.adInstance,d=a.slot;switch(e.debug("NativeFreewheelAdapter.__onAdEvent",a),a.subType){case b.EVENT_AD_IMPRESSION:case b.EVENT_AD_IMPRESSION_END:d===this.currentAd&&this.currentAdState(a.subType),e.debug("[EVENT_AD]: "+a.subType+" with ad:"+c.getAdId()+" and slot:"+d.getCustomId());break;case b.EVENT_AD_FIRST_QUARTILE:case b.EVENT_AD_MIDPOINT:case b.EVENT_AD_THIRD_QUARTILE:case b.EVENT_AD_COMPLETE:d===this.currentAd&&this.currentAdState(a.subType),e.info("[EVENT_AD]: "+a.subType+" with ad:"+c.getAdId()+" and slot:"+d.getCustomId());break;case b.EVENT_AD_EXPAND:case b.EVENT_AD_COLLAPSE:case b.EVENT_AD_CLOSE:case b.EVENT_AD_MINIMIZE:e.warn("[EVENT_AD]: "+a.subType+" with ad:"+c.getAdId()+" and slot:"+d.getCustomId());break;case b.EVENT_RESELLER_NO_AD:case b.EVENT_ERROR:d===this.currentAd&&this.currentAdState(a.subType);var f=a.subType===b.EVENT_ERROR?"[EVENT_ERROR]":"[EVENT_RESELLER_NO_AD]",g="[EVENT_AD]"+f+": "+a.subType+" with ad:"+c.getAdId()+" and slot:"+d.getCustomId();this.__adErrorReport(errorEvent,description),e.error(g,a);break;default:e.log("[EVENT_AD]: "+a.subType+" with ad:"+c.getAdId()+" and slot:"+d.getCustomId())}},c.prototype.setControlsTrue=function(){var a=this;a.isFullScreen&&!a.videoElement.controls&&setTimeout(function(){a.videoElement.controls=!0},100)},a.flashAvailable||r.add(c)}}(window.$ndp,window.tv&&window.tv.freewheel&&window.tv.freewheel.SDK),function(a){function b(b){var d=b&&b.location||a.configuration.location,e=m(d)?d:document.getElementById(d),g=document.createElement("div");if(!e)throw new Error("HTML Element location does not exist");g.id="ndp_"+(new Date).getTime(),g.style.height="100%",e.appendChild(g),this.dataStore={container:g,location:g,autoPlay:!1,id:g.id||null,continuousPlay:!1,volume:1,isMuted:!1,seekTo:0,caption:!1,mediaAsset:null,playlist:null,currentGuid:null,currentState:null,on:{}},$ndp.DataStore=this.dataStore,this.__mBus=new h,this.__mBus.addListener("*",this),this.__mBus.addListener(a.events.PlaybackEvent.COMPLETE,this.__onMediaComplete,this),c.call(this,b),f.create(this.__mBus,g)}function c(a){a=a||{};var b=this,c=b.dataStore;o.debug("mapping location to dataStore",[b,a]),m(a)?a={location:a}:"string"==typeof a&&(a={location:document.getElementById(a)});for(var d in a){if("undefined"==typeof c[d])throw new Error("No property match for "+d);b[d](a[d])}}function d(a,b){a[b.propertyName]=e.call(a,b)}function e(a){a=a||{};var b=a.propertyName||"_default",c=!!n(a.canGet)||a.canGet,d=!!n(a.canSet)||a.canSet,e=a.callback||null;return function(){var f=this,g=f.dataStore;if(o.log("Check settings of Method property: "+b,a),d&&arguments.length&&(o.info("observe arguments",arguments),d instanceof Function?d.apply(f,arguments):g[b]=arguments[0],e instanceof Function&&e.call(f,g[b]),o.debug("_defineMethod "+b,f)),c)return c instanceof Function?c.apply(f):g[b]}}if(!a)throw new Error("$npd Object does not exist. ");var f=a.ModuleManager,g=a.AbstractObserver,h=a.MessageBus,i=a.events.CommandEvent,j=a.events.SystemEvent,k=a.Playlist,l=a.MediaAsset,m=a.isDomElement,n=a.isNaO,o=a.console;a.isDebug;b.prototype=new g,b.prototype.constructor=b,b.constructor=g.prototype.constructor,b.prototype.__super=g.prototype,b.prototype.on=function(){switch(arguments.length){case 1:var a=arguments[0],b=null;for(var c in a)b=a[c],b.hasOwnProperty("scope")?this.addListener(c,b.listener,b.scope):this.addListener(c,b);break;default:this.addListener.apply(this,arguments)}},b.prototype.off=function(){switch(arguments.length){case 1:var a=arguments[0],b=null;for(var c in a)b=a[c],b.hasOwnProperty("scope")?this.removeListener(c,b.listener,b.scope):this.removeListener(c,b);break;default:this.addListener.apply(this,arguments)}};var p=b.prototype;d(p,{propertyName:"id"}),d(p,{propertyName:"location",canGet:function(){return this.dataStore.location},canSet:function(a){"string"==typeof a&&(a=document.getElementById(a)),this.dataStore.location=a},callback:function(a){if(!a||!m(a))throw new Error("HTML Element location does not exist");a.appendChild(this.dataStore.container),this.locationId=a.id,this.__mBus.notify(new j(j.VIEWPORT_UPDATE,{})),o.info("location ",a)}}),d(p,{propertyName:"container",canGet:function(){return this.dataStore.container},canSet:!1}),d(p,{propertyName:"mediaAsset",callback:function(b){function c(b){return function(){a.AUTOPLAY&&b.play()}}if(!(b instanceof l||b instanceof k))throw new Error("Asset type must be of NDP MediaAsset or NDP Playlist");var d=this.dataStore.playlist;d&&d.getAssetIndex(b)===-1&&(this.dataStore.playlist=null),b instanceof k&&(this.dataStore.playlist=b,b=b.first()),this.dataStore.mediaAsset=b,$ndp.DataStore.currentGuid=b.id;var e=new i(i.LOAD,{asset:b,isAutoPlay:!1});this.__mBus.notify(e),this.dataStore.autoPlay&&(void 0===a.AUTOPLAY?a.detectAutoplay(c(this)):a.AUTOPLAY&&this.play())}}),d(p,{propertyName:"autoPlay",canGet:function(){return this.dataStore.autoPlay},canSet:function(a){this.dataStore.autoPlay=a}}),p.play=function(){arguments[0]instanceof l&&this.mediaAsset(arguments[0]);var a=new i(i.PLAY,{asset:this.mediaAsset});this.__mBus.notify(a)},p.pause=function(){var a=new i(i.PAUSE,{asset:this.mediaAsset});this.__mBus.notify(a)},p.fullscreen=function(){return arguments.length&&this.__mBus.notify(new i(i.FULLSCREEN,{fullscreen:arguments[0]&&!0})),!0},p.volume=function(){return arguments.length&&(this.dataStore.volume=parseFloat(arguments[0]),this.__mBus.notify(new i(i.SETVOLUME,{volume:this.dataStore.volume}))),this.dataStore.volume},p.mute=function(){this.__mBus.notify(new i(i.SETVOLUME,{volume:this.dataStore.isMuted?this.dataStore.volume:0})),this.dataStore.isMuted=!this.dataStore.isMuted},p.scrub=function(){return arguments.length&&(this.dataStore.seekTo=parseFloat(arguments[0])||0,this.__mBus.notify(new i(i.SETPLAYHEAD,{seekTo:this.dataStore.seekTo}))),this.dataStore.seekTo},p.caption=function(){return arguments.length?this.dataStore.caption=Boolean(arguments[0])||!1:this.dataStore.caption=!this.dataStore.caption,this.__mBus.notify(new i(i.CAPTION,{caption:this.dataStore.caption})),this.dataStore.caption},p.updateDisplayBase=function(){var a=new i(i.UPDATEDISPLAYBASE,{asset:this.mediaAsset});this.__mBus.notify(a)},p.destroy=function(){var b=this.dataStore.container;this.__mBus.removeListener("*",this),this.__mBus.removeListener(a.events.PlaybackEvent.COMPLETE,this.__onMediaComplete,this),this.__mBus.notify(new j(j.SHUTDOWN,{})),null!==b.parentElement&&b.parentElement.removeChild(b),this.dataStore.container=null,this.__mBus=null},p.__onMediaComplete=function(b){if(null!==this.dataStore.playlist){var c=this.dataStore.playlist.next();c instanceof l?this.play(c):this.notify(new a.events.PlaybackEvent(a.events.PlaybackEvent.PLAYLIST_COMPLETE,{}))}},p.callFn=function(a){o.info("observe accessor arguments",arguments);var b=this[a];if(!(b instanceof Function))throw new Error("Requested property does not exist:  "+a,this);var c=Array.prototype.slice.call(arguments,1);return b.apply(this,c)},p.__renderPlayer=function(){var a=this.__mBus,b={id:"ndp_renderPlayer",propertyName:"renderPlayer",arguments:["Player has been rendered."]};a.notify(b)},window.NDPPlayer=b}(window.$ndp);